---
created: 2025-05-29T23:49
updated: 2025-05-30T01:30
version: 1.1
---

# 4. Java ì‹¤ì‹œê°„ ì†Œì¼“ ì„œë²„ ë©”ì‹œì§€ í”„ë¡œí† ì½œ v1.1

## 1. í”„ë¡œí† ì½œ ê°œìš”

### 1.1 ê¸°ë³¸ ì •ë³´

- **í†µì‹  ë°©ì‹**: TCP Socket (Native Java Socket)
- **í¬íŠ¸**: 12345
- **ë©”ì‹œì§€ í˜•ì‹**: JSON
- **ì¸ì½”ë”©**: UTF-8
- **ì—°ê²° ë°©ì‹**: Persistent Connection

### 1.2 ë©”ì‹œì§€ êµ¬ì¡°

```json
{
  "action": "ACTION_TYPE",
  "data": { ... },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "unique_sequence_id",
  "user_id": 123
}
```

### 1.3 ë°ì´í„° ëª¨ë¸ ì°¸ì¡°

**ìƒì„¸ ì†Œì¼“ ë©”ì‹œì§€ ëª¨ë¸**: [ğŸ“„ 05. ì£¼ìš” ë°ì´í„° ëª¨ë¸ ì •ì˜ - SocketMessage](./05.%20ì£¼ìš”%20ë°ì´í„°%20ëª¨ë¸%20ì •ì˜.md#61-socketmessage-ì†Œì¼“-ë©”ì‹œì§€)

## 2. ì—°ê²° ë° ì¸ì¦

### 2.1 ì´ˆê¸° ì—°ê²°

í´ë¼ì´ì–¸íŠ¸ê°€ ì†Œì¼“ ì„œë²„ì— ì—°ê²° í›„ ì¸ì¦ í•„ìš”:

```json
// Client â†’ Server
{
  "action": "CONNECT",
  "data": {
    "jwt_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9..."
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "auth_001"
}

// Server â†’ Client (ì„±ê³µ)
{
  "action": "CONNECT_SUCCESS",
  "data": {
    "user_id": 123,
    "session_id": "session_abc123",
    "server_time": "2024-01-01T12:00:01.000Z"
  },
  "timestamp": "2024-01-01T12:00:01.000Z",
  "seq_id": "auth_001"
}

// Server â†’ Client (ì‹¤íŒ¨)
{
  "action": "CONNECT_ERROR",
  "data": {
    "error_code": "INVALID_TOKEN",
    "message": "JWT í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
  },
  "timestamp": "2024-01-01T12:00:01.000Z",
  "seq_id": "auth_001"
}
```

### 2.2 ì—°ê²° ìœ ì§€ (Heartbeat)

```json
// Client â†’ Server (30ì´ˆë§ˆë‹¤)
{
  "action": "PING",
  "data": {},
  "timestamp": "2024-01-01T12:00:30.000Z",
  "seq_id": "ping_001"
}

// Server â†’ Client
{
  "action": "PONG",
  "data": {
    "server_time": "2024-01-01T12:00:30.100Z"
  },
  "timestamp": "2024-01-01T12:00:30.100Z",
  "seq_id": "ping_001"
}
```

## 3. ì±„íŒ… ë©”ì‹œì§€

### 3.1 ì±„íŒ…ë°© ì°¸ê°€

```json
// Client â†’ Server
{
  "action": "JOIN_ROOM",
  "data": {
    "chatroom_id": 1
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "join_001",
  "user_id": 123
}

// Server â†’ Client (ì„±ê³µ)
{
  "action": "JOIN_ROOM_SUCCESS",
  "data": {
    "chatroom_id": 1,
    "participants_count": 5,
    "online_participants": [
      {
        "user_id": 123,
        "nickname": "ì‚¬ìš©ì1",
        "is_online": true
      }
    ]
  },
  "timestamp": "2024-01-01T12:00:00.500Z",
  "seq_id": "join_001"
}

// Server â†’ All Room Members (ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼)
{
  "action": "USER_JOINED",
  "data": {
    "chatroom_id": 1,
    "user_id": 123,
    "nickname": "ì‚¬ìš©ì1",
    "participants_count": 5
  },
  "timestamp": "2024-01-01T12:00:00.500Z",
  "seq_id": "broadcast_001"
}
```

### 3.2 ë©”ì‹œì§€ ì „ì†¡

```json
// Client â†’ Server
{
  "action": "SEND_MESSAGE",
  "data": {
    "chatroom_id": 1,
    "content": "ì•ˆë…•í•˜ì„¸ìš”!",
    "message_type": "text"
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "msg_001",
  "user_id": 123
}

// Server â†’ All Room Members
{
  "action": "NEW_MESSAGE",
  "data": {}, // Message ëª¨ë¸ - 05. ë°ì´í„° ëª¨ë¸ ì°¸ì¡°
  "timestamp": "2024-01-01T12:00:00.100Z",
  "seq_id": "msg_001"
}
```

**ë©”ì‹œì§€ ë°ì´í„° êµ¬ì¡°**: [ğŸ“„ 05. ì£¼ìš” ë°ì´í„° ëª¨ë¸ ì •ì˜ - Message](./05.%20ì£¼ìš”%20ë°ì´í„°%20ëª¨ë¸%20ì •ì˜.md#42-message-ë©”ì‹œì§€)

### 3.3 ì±„íŒ…ë°© ë‚˜ê°€ê¸°

```json
// Client â†’ Server
{
  "action": "LEAVE_ROOM",
  "data": {
    "chatroom_id": 1
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "leave_001",
  "user_id": 123
}

// Server â†’ All Room Members
{
  "action": "USER_LEFT",
  "data": {
    "chatroom_id": 1,
    "user_id": 123,
    "nickname": "ì‚¬ìš©ì1",
    "participants_count": 4
  },
  "timestamp": "2024-01-01T12:00:00.100Z",
  "seq_id": "broadcast_002"
}
```

## 4. ì˜ìƒí†µí™” (WebRTC ì‹œê·¸ë„ë§)

### 4.1 ì˜ìƒíšŒì˜ ë°© ìƒì„±

```json
// Client â†’ Server
{
  "action": "CREATE_VIDEO_ROOM",
  "data": {
    "chatroom_id": 1,
    "video_room_name": "ì˜ìƒíšŒì˜",
    "max_participants": 10
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "video_001",
  "user_id": 123
}

// Server â†’ All Room Members
{
  "action": "VIDEO_ROOM_CREATED",
  "data": {
    "video_room_id": 200,
    "chatroom_id": 1,
    "video_room_name": "ì˜ìƒíšŒì˜",
    "host_user_id": 123,
    "max_participants": 10
  },
  "timestamp": "2024-01-01T12:00:00.100Z",
  "seq_id": "video_001"
}
```

### 4.2 ì˜ìƒíšŒì˜ ì°¸ê°€

```json
// Client â†’ Server
{
  "action": "JOIN_VIDEO_ROOM",
  "data": {
    "video_room_id": 200,
    "media_status": {
      "audio_enabled": true,
      "video_enabled": true
    }
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "video_join_001",
  "user_id": 124
}

// Server â†’ All Video Room Participants
{
  "action": "VIDEO_PARTICIPANT_JOINED",
  "data": {
    "video_room_id": 200,
    "user_id": 124,
    "nickname": "ì°¸ê°€ì",
    "media_status": {
      "audio_enabled": true,
      "video_enabled": true
    },
    "participants_count": 2
  },
  "timestamp": "2024-01-01T12:00:00.100Z",
  "seq_id": "video_join_001"
}
```

### 4.3 WebRTC SDP êµí™˜

```json
// Client â†’ Server (Offer)
{
  "action": "SDP_OFFER",
  "data": {
    "video_room_id": 200,
    "target_user_id": 124,
    "sdp": {
      "type": "offer",
      "sdp": "v=0\r\no=- 123456789 2 IN IP4 127.0.0.1\r\n..."
    }
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "sdp_001",
  "user_id": 123
}

// Server â†’ Target User
{
  "action": "SDP_OFFER",
  "data": {
    "video_room_id": 200,
    "from_user_id": 123,
    "sdp": {
      "type": "offer",
      "sdp": "v=0\r\no=- 123456789 2 IN IP4 127.0.0.1\r\n..."
    }
  },
  "timestamp": "2024-01-01T12:00:00.050Z",
  "seq_id": "sdp_001"
}

// Target User â†’ Server (Answer)
{
  "action": "SDP_ANSWER",
  "data": {
    "video_room_id": 200,
    "target_user_id": 123,
    "sdp": {
      "type": "answer",
      "sdp": "v=0\r\no=- 987654321 2 IN IP4 127.0.0.1\r\n..."
    }
  },
  "timestamp": "2024-01-01T12:00:01.000Z",
  "seq_id": "sdp_002",
  "user_id": 124
}
```

### 4.4 ICE Candidate êµí™˜

```json
// Client â†’ Server
{
  "action": "ICE_CANDIDATE",
  "data": {
    "video_room_id": 200,
    "target_user_id": 124,
    "candidate": {
      "candidate": "candidate:1 1 UDP 2130706431 192.168.1.100 54400 typ host",
      "sdpMid": "0",
      "sdpMLineIndex": 0
    }
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "ice_001",
  "user_id": 123
}

// Server â†’ Target User
{
  "action": "ICE_CANDIDATE",
  "data": {
    "video_room_id": 200,
    "from_user_id": 123,
    "candidate": {
      "candidate": "candidate:1 1 UDP 2130706431 192.168.1.100 54400 typ host",
      "sdpMid": "0",
      "sdpMLineIndex": 0
    }
  },
  "timestamp": "2024-01-01T12:00:00.050Z",
  "seq_id": "ice_001"
}
```

### 4.5 ë¯¸ë””ì–´ ìƒíƒœ ë³€ê²½

```json
// Client â†’ Server
{
  "action": "MEDIA_STATUS_CHANGE",
  "data": {
    "video_room_id": 200,
    "media_status": {
      "audio_enabled": false,
      "video_enabled": true,
      "screen_sharing": false
    }
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "media_001",
  "user_id": 123
}

// Server â†’ All Video Room Participants
{
  "action": "PARTICIPANT_MEDIA_CHANGED",
  "data": {
    "video_room_id": 200,
    "user_id": 123,
    "nickname": "ì‚¬ìš©ì1",
    "media_status": {
      "audio_enabled": false,
      "video_enabled": true,
      "screen_sharing": false
    }
  },
  "timestamp": "2024-01-01T12:00:00.100Z",
  "seq_id": "media_001"
}
```

## 5. ì‹œìŠ¤í…œ ë©”ì‹œì§€

### 5.1 ì‚¬ìš©ì ìƒíƒœ ë³€ê²½

```json
// Server â†’ All Related Users (ìë™ ë°œì†¡)
{
  "action": "USER_STATUS_CHANGED",
  "data": {
    "user_id": 123,
    "is_online": false,
    "last_seen": "2024-01-01T12:00:00.000Z"
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "status_001"
}
```

### 5.2 ì„œë²„ ê³µì§€

```json
// Server â†’ All Connected Users
{
  "action": "SERVER_ANNOUNCEMENT",
  "data": {
    "title": "ì„œë²„ ì ê²€ ì•ˆë‚´",
    "message": "2024ë…„ 1ì›” 2ì¼ ì˜¤ì „ 2ì‹œë¶€í„° 4ì‹œê¹Œì§€ ì„œë²„ ì ê²€ì´ ìˆìŠµë‹ˆë‹¤.",
    "type": "maintenance",
    "priority": "high"
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "announce_001"
}
```

## 6. ì—ëŸ¬ ì²˜ë¦¬

### 6.1 ì—ëŸ¬ ì‘ë‹µ í˜•ì‹

```json
{
  "action": "ERROR",
  "data": {
    "error_code": "ERROR_CODE",
    "message": "ì—ëŸ¬ ë©”ì‹œì§€",
    "original_seq_id": "ì›ë³¸_ìš”ì²­_seq_id",
    "original_action": "ì›ë³¸_ì•¡ì…˜ëª…"
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "error_001"
}
```

### 6.2 ì£¼ìš” ì—ëŸ¬ ì½”ë“œ

- `INVALID_TOKEN`: JWT í† í° ì˜¤ë¥˜
- `INVALID_ACTION`: ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜
- `INVALID_DATA`: ì˜ëª»ëœ ë°ì´í„° í˜•ì‹
- `ROOM_NOT_FOUND`: ì±„íŒ…ë°© ì—†ìŒ
- `PERMISSION_DENIED`: ê¶Œí•œ ë¶€ì¡±
- `USER_BLOCKED`: ì°¨ë‹¨ëœ ì‚¬ìš©ì
- `ROOM_FULL`: ì±„íŒ…ë°© ì¸ì› ì´ˆê³¼
- `VIDEO_ROOM_FULL`: ì˜ìƒíšŒì˜ ì¸ì› ì´ˆê³¼

## 7. ì„±ëŠ¥ ìµœì í™”

### 7.1 ë©”ì‹œì§€ ì••ì¶•

ëŒ€ìš©ëŸ‰ ë©”ì‹œì§€ì˜ ê²½ìš° gzip ì••ì¶• ì ìš©:

```json
{
  "action": "SEND_MESSAGE",
  "data": "gzipped_json_data",
  "compressed": true,
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "msg_001",
  "user_id": 123
}
```

### 7.2 ë°°ì¹˜ ë©”ì‹œì§€

ì—¬ëŸ¬ ë©”ì‹œì§€ë¥¼ í•œ ë²ˆì— ì „ì†¡:

```json
{
  "action": "BATCH_MESSAGES",
  "data": {
    "messages": [
      {}, // Message 1
      {}, // Message 2
      {}  // Message 3
    ]
  },
  "timestamp": "2024-01-01T12:00:00.000Z",
  "seq_id": "batch_001"
}
```

## 8. ì¸í„°í˜ì´ìŠ¤ ì—°ë™

### 8.1 Laravel ë°±ì—”ë“œ ì—°ë™

**API ì—°ë™ ë°©ì‹**: [ğŸ“„ 12. ì»´í¬ë„ŒíŠ¸ ê°„ ì¸í„°í˜ì´ìŠ¤ ëª…ì„¸ ì°¸ì¡°](./12.%20ì»´í¬ë„ŒíŠ¸%20ê°„%20ì¸í„°í˜ì´ìŠ¤%20ëª…ì„¸.md#2-android-â†”-java-socket-í†µì‹ )

### 8.2 ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™

**DB ìŠ¤í‚¤ë§ˆ**: [ğŸ“„ 02. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì°¸ì¡°](./02.%20ë°ì´í„°ë² ì´ìŠ¤%20ìŠ¤í‚¤ë§ˆ.md)

## 9. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 9.1 JWT í† í° ê²€ì¦

- ëª¨ë“  ìš”ì²­ì—ì„œ JWT í† í° ìœ íš¨ì„± ê²€ì¦
- í† í° ë§Œë£Œ ì‹œ ì—°ê²° ì¢…ë£Œ
- í† í° ê°±ì‹  ë©”ì»¤ë‹ˆì¦˜ ì§€ì›

### 9.2 ë©”ì‹œì§€ ê²€ì¦

- ì‚¬ìš©ì ê¶Œí•œ í™•ì¸
- ì±„íŒ…ë°© ì°¸ì—¬ ì—¬ë¶€ ê²€ì¦
- ì°¨ë‹¨ëœ ì‚¬ìš©ì í•„í„°ë§
- ë©”ì‹œì§€ ë‚´ìš© ê²€ì¦ (ìŠ¤íŒ¸, ì•…ì„± ì½”ë“œ)

---

ğŸ’¡ **ì°¸ê³ **: ëª¨ë“  ë©”ì‹œì§€ ë°ì´í„° êµ¬ì¡°ëŠ” [ğŸ“„ 05. ì£¼ìš” ë°ì´í„° ëª¨ë¸ ì •ì˜](./05.%20ì£¼ìš”%20ë°ì´í„°%20ëª¨ë¸%20ì •ì˜.md)ë¥¼ ì°¸ì¡°í•˜ê³ , ì»´í¬ë„ŒíŠ¸ ê°„ ì—°ë™ì€ [ğŸ“„ 12. ì¸í„°í˜ì´ìŠ¤ ëª…ì„¸](./12.%20ì»´í¬ë„ŒíŠ¸%20ê°„%20ì¸í„°í˜ì´ìŠ¤%20ëª…ì„¸.md)ë¥¼ ì°¸ì¡°í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
