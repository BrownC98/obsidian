---
created: 2025-05-29T23:57
updated: 2025-05-30T00:01
version: 1
---

# 7. ASSA 공통 개발 지침 및 원칙 v1.0

## 1. 개발 철학 및 원칙

### 1.1 핵심 개발 원칙

#### 1.1.1 SOLID 원칙

- **S (Single Responsibility)**: 각 클래스는 단일 책임을 가짐
- **O (Open/Closed)**: 확장에는 열려있고 수정에는 닫혀있음
- **L (Liskov Substitution)**: 하위 타입은 상위 타입을 대체 가능해야 함
- **I (Interface Segregation)**: 클라이언트는 사용하지 않는 인터페이스에 의존하지 않음
- **D (Dependency Inversion)**: 추상화에 의존하고 구체화에 의존하지 않음

#### 1.1.2 DRY (Don't Repeat Yourself)

- 코드 중복 최소화
- 공통 기능은 유틸리티 클래스나 헬퍼로 분리
- 설정값은 별도 파일로 관리

#### 1.1.3 KISS (Keep It Simple, Stupid)

- 간단하고 명확한 코드 작성
- 과도한 추상화 지양
- 읽기 쉬운 코드 우선

#### 1.1.4 YAGNI (You Aren't Gonna Need It)

- 현재 필요하지 않은 기능은 구현하지 않음
- 미래의 요구사항을 위한 과도한 설계 지양
- MVP 우선 개발

## 2. TDD (Test-Driven Development) 방법론

### 2.1 TDD 사이클

```
1. Red: 실패하는 테스트 작성
2. Green: 테스트가 통과하는 최소한의 코드 작성
3. Refactor: 코드 개선 및 리팩토링
```

### 2.2 테스트 작성 원칙

#### 2.2.1 AAA 패턴

```java
@Test
public void testUserRegistration() {
    // Arrange (준비)
    String email = "test@example.com";
    String nickname = "testuser";
    String password = "password123";

    // Act (실행)
    User result = userService.register(email, nickname, password);

    // Assert (검증)
    assertNotNull(result);
    assertEquals(email, result.getEmail());
    assertEquals(nickname, result.getNickname());
}
```

#### 2.2.2 테스트 네이밍 컨벤션

**Java:**

```java
// should_ReturnExpectedResult_When_GivenCondition
@Test
public void should_ReturnUser_When_ValidEmailProvided() { }

@Test
public void should_ThrowException_When_EmailAlreadyExists() { }
```

**PHP:**

```php
// test_should_return_expected_result_when_given_condition
public function test_should_return_user_when_valid_email_provided() { }

public function test_should_throw_exception_when_email_already_exists() { }
```

### 2.3 테스트 커버리지 목표

- **단위 테스트**: 80% 이상
- **통합 테스트**: 주요 API 엔드포인트 100%
- **E2E 테스트**: 핵심 사용자 시나리오 100%

### 2.4 테스트 분류

#### 2.4.1 단위 테스트 (Unit Test)

- 개별 함수/메서드 테스트
- 외부 의존성 Mocking
- 빠른 실행 (1초 이내)

#### 2.4.2 통합 테스트 (Integration Test)

- API 엔드포인트 테스트
- 데이터베이스 연동 테스트
- 컴포넌트 간 상호작용 테스트

#### 2.4.3 E2E 테스트 (End-to-End Test)

- 전체 사용자 시나리오 테스트
- UI 자동화 테스트 (Android)
- 성능 테스트

## 3. 코딩 컨벤션

### 3.1 공통 규칙

#### 3.1.1 네이밍 규칙

**변수 및 함수명:**

- Java: camelCase (`userName`, `getUserById`)
- PHP: snake_case (`user_name`, `get_user_by_id`)

**클래스명:**

- 모든 언어: PascalCase (`UserService`, `PostController`)

**상수명:**

- 모든 언어: UPPER_SNAKE_CASE (`MAX_FILE_SIZE`, `API_BASE_URL`)

**데이터베이스:**

- 테이블명: snake_case 복수형 (`users`, `chat_rooms`)
- 컬럼명: snake_case 단수형 (`user_id`, `created_at`)

#### 3.1.2 파일 및 패키지 구조

**Java (Android):**

```
com/assa/android/
├── activity/          # Activity 클래스
├── fragment/          # Fragment 클래스
├── adapter/           # RecyclerView Adapter
├── model/             # 데이터 모델
├── service/           # 서비스 클래스
├── util/              # 유틸리티 클래스
└── constant/          # 상수 클래스
```

**PHP (Laravel):**

```
app/
├── Http/Controllers/  # 컨트롤러
├── Models/           # Eloquent 모델
├── Services/         # 비즈니스 로직
├── Repositories/     # 데이터 액세스 레이어
├── Helpers/          # 헬퍼 함수
└── Constants/        # 상수 클래스
```

**Java (Socket Server):**

```
com/assa/socket/
├── server/           # 서버 관련 클래스
├── handler/          # 메시지 핸들러
├── model/            # 데이터 모델
├── service/          # 비즈니스 로직
├── util/             # 유틸리티 클래스
└── constant/         # 상수 클래스
```

### 3.2 언어별 상세 컨벤션

#### 3.2.1 Java 컨벤션

**클래스 선언:**

```java
public class UserService {
    private static final int MAX_RETRY_COUNT = 3;
    private final UserRepository userRepository;

    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    public User getUserById(Long userId) {
        if (userId == null) {
            throw new IllegalArgumentException("User ID cannot be null");
        }

        return userRepository.findById(userId)
            .orElseThrow(() -> new UserNotFoundException("User not found: " + userId));
    }
}
```

**인터페이스 명명:**

```java
// Service 인터페이스
public interface UserService { }

// Repository 인터페이스
public interface UserRepository { }

// Listener 인터페이스
public interface OnClickListener { }
```

#### 3.2.2 PHP 컨벤션

**컨트롤러 클래스:**

```php
<?php

namespace App\Http\Controllers;

use App\Services\UserService;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class UserController extends Controller
{
    private UserService $userService;

    public function __construct(UserService $userService)
    {
        $this->userService = $userService;
    }

    public function show(int $userId): JsonResponse
    {
        try {
            $user = $this->userService->getUserById($userId);

            return response()->json([
                'success' => true,
                'data' => $user
            ]);
        } catch (Exception $e) {
            return response()->json([
                'success' => false,
                'message' => $e->getMessage()
            ], 404);
        }
    }
}
```

**모델 클래스:**

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class User extends Model
{
    use SoftDeletes;

    protected $fillable = [
        'email',
        'nickname',
        'password',
        'profile_image',
        'introduction'
    ];

    protected $hidden = [
        'password',
        'remember_token'
    ];

    protected $casts = [
        'email_verified_at' => 'datetime',
        'created_at' => 'datetime',
        'updated_at' => 'datetime'
    ];
}
```

### 3.3 주석 및 문서화

#### 3.3.1 주석 작성 원칙

- **Why를 설명**: 무엇을 하는지보다 왜 하는지를 설명
- **복잡한 로직**: 비즈니스 규칙이나 알고리즘 설명
- **API 문서**: 모든 public 메서드에 JavaDoc/PHPDoc 작성

#### 3.3.2 JavaDoc 예시

```java
/**
 * 사용자 정보를 조회합니다.
 *
 * @param userId 조회할 사용자 ID
 * @return 사용자 정보
 * @throws UserNotFoundException 사용자를 찾을 수 없는 경우
 * @throws IllegalArgumentException userId가 null인 경우
 * @since 1.0
 */
public User getUserById(Long userId) throws UserNotFoundException {
    // 구현 코드
}
```

#### 3.3.3 PHPDoc 예시

```php
/**
 * 사용자 정보를 조회합니다.
 *
 * @param int $userId 조회할 사용자 ID
 * @return User 사용자 정보
 * @throws UserNotFoundException 사용자를 찾을 수 없는 경우
 * @throws InvalidArgumentException userId가 유효하지 않은 경우
 * @since 1.0
 */
public function getUserById(int $userId): User
{
    // 구현 코드
}
```

## 4. Git 관리 규칙

### 4.1 브랜치 전략 (Git Flow)

```
main (배포용)
├── develop (개발 통합)
    ├── feature/user-auth (기능 개발)
    ├── feature/post-crud (기능 개발)
    └── feature/chat-system (기능 개발)
└── hotfix/critical-bug (긴급 수정)
```

#### 4.1.1 브랜치 명명 규칙

- **feature/**: 새로운 기능 개발 (`feature/user-authentication`)
- **bugfix/**: 버그 수정 (`bugfix/login-error`)
- **hotfix/**: 긴급 수정 (`hotfix/security-patch`)
- **release/**: 릴리스 준비 (`release/v1.0.0`)

### 4.2 커밋 메시지 컨벤션

#### 4.2.1 커밋 메시지 형식

```
<type>(<scope>): <subject>

<body>

<footer>
```

#### 4.2.2 Type 종류

- **feat**: 새로운 기능 추가
- **fix**: 버그 수정
- **docs**: 문서 수정
- **style**: 코드 스타일 변경 (포맷팅, 세미콜론 등)
- **refactor**: 코드 리팩토링
- **test**: 테스트 추가/수정
- **chore**: 빌드 프로세스, 도구 설정 등

#### 4.2.3 커밋 메시지 예시

```
feat(auth): JWT 토큰 기반 인증 시스템 구현

- JWT 토큰 생성 및 검증 로직 추가
- 로그인/로그아웃 API 구현
- 토큰 갱신 기능 추가

Closes #123
```

```
fix(chat): 메시지 전송 시 중복 발송 문제 해결

동일한 메시지가 여러 번 전송되는 문제를 해결했습니다.
클라이언트에서 중복 요청을 방지하는 로직을 추가했습니다.

Fixes #456
```

### 4.3 Pull Request 규칙

#### 4.3.1 PR 제목 형식

```
[FEAT] 사용자 인증 시스템 구현
[FIX] 채팅 메시지 중복 전송 문제 해결
[REFACTOR] 게시물 서비스 코드 리팩토링
```

#### 4.3.2 PR 템플릿

```markdown
## 변경사항

- 구현한 기능 또는 수정한 내용을 명시

## 테스트

- [ ] 단위 테스트 추가/수정
- [ ] 통합 테스트 확인
- [ ] 수동 테스트 완료

## 체크리스트

- [ ] 코딩 컨벤션 준수
- [ ] 문서 업데이트 (필요한 경우)
- [ ] 브레이킹 체인지 없음

## 관련 이슈

Closes #123
```

### 4.4 코드 리뷰 가이드라인

#### 4.4.1 리뷰어 체크리스트

- **기능성**: 요구사항에 맞게 구현되었는가?
- **코드 품질**: 코딩 컨벤션을 준수하는가?
- **성능**: 성능상 문제는 없는가?
- **보안**: 보안 취약점은 없는가?
- **테스트**: 적절한 테스트가 작성되었는가?

#### 4.4.2 리뷰 코멘트 가이드

**건설적인 피드백:**

```
// 좋은 예
"getUserById 메서드에서 null 체크를 추가하면 더 안전할 것 같습니다."

// 나쁜 예
"이 코드는 잘못되었습니다."
```

**개선 제안:**

```
// 좋은 예
"Optional을 사용하면 null 처리를 더 명확하게 할 수 있습니다."

// 나쁜 예
"이 방법은 좋지 않습니다."
```

## 5. 보안 가이드라인

### 5.1 인증 및 권한

#### 5.1.1 JWT 토큰 관리

```java
// Android - 토큰 저장
SharedPreferences prefs = getSharedPreferences("auth", MODE_PRIVATE);
prefs.edit()
    .putString("access_token", token)
    .apply();

// 토큰 만료 체크
public boolean isTokenExpired(String token) {
    try {
        JWT jwt = JWT.decode(token);
        return jwt.getExpiresAt().before(new Date());
    } catch (JWTDecodeException e) {
        return true;
    }
}
```

```php
// PHP - 토큰 검증
public function validateToken(string $token): bool
{
    try {
        $decoded = JWT::decode($token, new Key(config('jwt.secret'), 'HS256'));
        return true;
    } catch (Exception $e) {
        return false;
    }
}
```

#### 5.1.2 비밀번호 보안

```php
// PHP - 비밀번호 해싱
public function hashPassword(string $password): string
{
    return Hash::make($password);
}

public function verifyPassword(string $password, string $hash): bool
{
    return Hash::check($password, $hash);
}
```

### 5.2 입력 검증

#### 5.2.1 SQL 인젝션 방지

```php
// 좋은 예 - Prepared Statement 사용
public function getUserByEmail(string $email): ?User
{
    return User::where('email', '=', $email)->first();
}

// 나쁜 예 - 직접 쿼리 조합
public function getUserByEmail(string $email): ?User
{
    return DB::select("SELECT * FROM users WHERE email = '$email'");
}
```

#### 5.2.2 XSS 방지

```java
// Android - HTML 이스케이프
public String escapeHtml(String input) {
    return TextUtils.htmlEncode(input);
}
```

```php
// PHP - 출력 시 이스케이프
public function renderComment(string $content): string
{
    return htmlspecialchars($content, ENT_QUOTES, 'UTF-8');
}
```

### 5.3 API 보안

#### 5.3.1 Rate Limiting

```php
// Laravel - API 요청 제한
public function configureRateLimiting()
{
    RateLimiter::for('api', function (Request $request) {
        return Limit::perMinute(60)->by($request->user()?->id ?: $request->ip());
    });

    RateLimiter::for('login', function (Request $request) {
        return Limit::perMinute(5)->by($request->ip());
    });
}
```

#### 5.3.2 CORS 설정

```php
// config/cors.php
return [
    'paths' => ['api/*'],
    'allowed_methods' => ['GET', 'POST', 'PUT', 'DELETE'],
    'allowed_origins' => [env('FRONTEND_URL')],
    'allowed_headers' => ['Content-Type', 'Authorization'],
    'max_age' => 86400,
];
```

## 6. 에러 처리 가이드라인

### 6.1 예외 처리 원칙

#### 6.1.1 예외 계층 구조

```java
// Custom Exception 정의
public class AssaException extends Exception {
    private final String errorCode;

    public AssaException(String errorCode, String message) {
        super(message);
        this.errorCode = errorCode;
    }
}

public class UserNotFoundException extends AssaException {
    public UserNotFoundException(String userId) {
        super("USER_NOT_FOUND", "User not found: " + userId);
    }
}
```

#### 6.1.2 에러 응답 표준화

```php
// PHP - 에러 응답 형식
public function errorResponse(string $message, string $errorCode = null, int $status = 400): JsonResponse
{
    return response()->json([
        'success' => false,
        'message' => $message,
        'error_code' => $errorCode,
        'timestamp' => now()->toISOString()
    ], $status);
}
```

### 6.2 로깅 전략

#### 6.2.1 로그 레벨

- **DEBUG**: 디버깅 정보
- **INFO**: 일반 정보
- **WARN**: 경고 (복구 가능한 오류)
- **ERROR**: 에러 (복구 불가능한 오류)
- **FATAL**: 치명적 에러 (시스템 종료)

#### 6.2.2 구조화된 로깅

```java
// Java - 구조화된 로그
Logger logger = LoggerFactory.getLogger(UserService.class);

public void logUserAction(String userId, String action, String result) {
    Map<String, Object> logData = Map.of(
        "userId", userId,
        "action", action,
        "result", result,
        "timestamp", Instant.now()
    );

    logger.info("User action: {}", gson.toJson(logData));
}
```

```php
// PHP - 구조화된 로그
Log::info('User action performed', [
    'user_id' => $userId,
    'action' => $action,
    'result' => $result,
    'timestamp' => now(),
    'ip_address' => request()->ip()
]);
```

## 7. 성능 최적화 가이드라인

### 7.1 데이터베이스 최적화

#### 7.1.1 쿼리 최적화

```php
// 좋은 예 - Eager Loading
public function getPostsWithUser(): Collection
{
    return Post::with('user')->get();
}

// 나쁜 예 - N+1 Problem
public function getPostsWithUser(): Collection
{
    $posts = Post::all();
    foreach ($posts as $post) {
        $post->user; // N+1 쿼리 발생
    }
    return $posts;
}
```

#### 7.1.2 인덱스 활용

```sql
-- 자주 사용되는 검색 조건에 인덱스 생성
CREATE INDEX idx_posts_user_created ON posts(user_id, created_at);
CREATE INDEX idx_messages_room_created ON messages(chat_room_id, created_at);
```

### 7.2 API 성능 최적화

#### 7.2.1 페이지네이션

```php
// Cursor 기반 페이지네이션
public function getPostsPaginated(int $cursor = null, int $limit = 20): array
{
    $query = Post::orderBy('id', 'desc');

    if ($cursor) {
        $query->where('id', '<', $cursor);
    }

    $posts = $query->limit($limit + 1)->get();

    return [
        'data' => $posts->take($limit),
        'has_more' => $posts->count() > $limit,
        'next_cursor' => $posts->count() > $limit ? $posts->last()->id : null
    ];
}
```

#### 7.2.2 캐싱 전략

```php
// 캐싱 사용
public function getUserProfile(int $userId): User
{
    return Cache::remember(
        "user_profile_{$userId}",
        now()->addMinutes(30),
        fn() => User::with('posts')->findOrFail($userId)
    );
}
```

### 7.3 Android 성능 최적화

#### 7.3.1 이미지 최적화

```java
// Glide를 사용한 이미지 로딩
Glide.with(context)
    .load(imageUrl)
    .placeholder(R.drawable.placeholder)
    .error(R.drawable.error_image)
    .centerCrop()
    .into(imageView);
```

#### 7.3.2 리스트 성능 최적화

```java
// RecyclerView ViewHolder 패턴
public class PostViewHolder extends RecyclerView.ViewHolder {
    private TextView contentText;
    private ImageView profileImage;

    public PostViewHolder(View itemView) {
        super(itemView);
        contentText = itemView.findViewById(R.id.content_text);
        profileImage = itemView.findViewById(R.id.profile_image);
    }

    public void bind(Post post) {
        contentText.setText(post.getContent());
        // 이미지 로딩 등
    }
}
```

## 8. 품질 관리

### 8.1 정적 분석 도구

#### 8.1.1 Java (Android)

```gradle
// build.gradle - SonarQube 설정
plugins {
    id "org.sonarqube" version "3.3"
}

sonarqube {
    properties {
        property "sonar.projectKey", "assa-android"
        property "sonar.host.url", "http://localhost:9000"
    }
}
```

#### 8.1.2 PHP (Laravel)

```json
// composer.json - PHP 정적 분석 도구
{
  "require-dev": {
    "phpstan/phpstan": "^1.0",
    "squizlabs/php_codesniffer": "^3.6"
  }
}
```

### 8.2 CI/CD 파이프라인

#### 8.2.1 GitHub Actions 예시

```yaml
# .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: "8.2"

      - name: Install dependencies
        run: composer install

      - name: Run tests
        run: php artisan test

      - name: Run static analysis
        run: vendor/bin/phpstan analyse
```

---

본 문서는 ASSA 프로젝트의 모든 개발자가 준수해야 하는 공통 개발 지침과 원칙을 정의하며, 일관성 있고 품질 높은 코드 작성을 보장합니다.
