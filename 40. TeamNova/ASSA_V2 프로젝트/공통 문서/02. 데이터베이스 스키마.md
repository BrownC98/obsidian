---
created: 2025-05-29T23:46
updated: 2025-05-30T00:41
version: 1
tags:
  - MySQL
  - í…Œì´ë¸”_ìŠ¤í‚¤ë§ˆ
  - ERD
  - ë°ì´í„°ë² ì´ìŠ¤_ì„¤ê³„
  - ê´€ê³„_ëª¨ë¸
llm_keywords:
  - MySQL
  - ë°ì´í„°ë² ì´ìŠ¤
  - ìŠ¤í‚¤ë§ˆ
  - í…Œì´ë¸”
  - ì™¸ë˜í‚¤
  - ì¸ë±ìŠ¤
  - SQL
  - DDL
context: MySQL 8.x ë°ì´í„°ë² ì´ìŠ¤ ì™„ì „í•œ ìŠ¤í‚¤ë§ˆ ì •ì˜ - ëª¨ë“  í…Œì´ë¸” êµ¬ì¡° ë° ê´€ê³„ ëª…ì„¸
importance: critical
audience:
  - all_llm
  - php_backend
  - java_socket
relationships:
  - 05_ë°ì´í„°ëª¨ë¸
  - 03_APIëª…ì„¸
  - 11_ë”ë¯¸ë°ì´í„°
---

# ğŸ¤– ASSA ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ v1.0

## ğŸ“Š LLM ë¹ ë¥¸ ì°¸ì¡° ì •ë³´

### ğŸ¯ **ë¬¸ì„œ ëª©ì **

- **ì£¼ ëª©ì **: MySQL ë°ì´í„°ë² ì´ìŠ¤ì˜ ì™„ì „í•œ í…Œì´ë¸” êµ¬ì¡° ë° ê´€ê³„ ì •ì˜
- **LLM í™œìš©**: DB ì¿¼ë¦¬ ì‘ì„±, ë°ì´í„° ëª¨ë¸ ì´í•´, API ì„¤ê³„ ì‹œ ë°ì´í„° êµ¬ì¡° ì°¸ì¡°
- **ì°¸ì¡° ì‹œì **: ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ëª¨ë“  ê°œë°œ ì‘ì—…

### ğŸ” **í•µì‹¬ í…Œì´ë¸” ì¹´í…Œê³ ë¦¬**

```
ğŸ‘¤ ì‚¬ìš©ì ê´€ë ¨: users, oauths
ğŸ“ ê²Œì‹œë¬¼ ê´€ë ¨: posts, post_files, comments, replies
ğŸ‘ ì¢‹ì•„ìš” ê´€ë ¨: post_likes, comment_likes
ğŸ‘¥ ì†Œì…œ ê´€ê³„: follows, friends, blocked_users
ğŸ’¬ ì±„íŒ… ê´€ë ¨: chat_rooms, chat_members, messages
ğŸ“¹ ì˜ìƒí†µí™”: video_rooms, video_participants
ğŸ”” ì•Œë¦¼ ê´€ë ¨: notifications, notification_settings
```

### ğŸ“š **ê´€ë ¨ ë¬¸ì„œ ë§¤í•‘**

- **ë°ì´í„° ëª¨ë¸** â†’ [ğŸ“„ 05. ì£¼ìš” ë°ì´í„° ëª¨ë¸ ì •ì˜](./05.%20ì£¼ìš”%20ë°ì´í„°%20ëª¨ë¸%20ì •ì˜.md)
- **API ëª…ì„¸** â†’ [ğŸ“„ 03. PHP ë°±ì—”ë“œ API ëª…ì„¸](./03.%20PHP%20ë°±ì—”ë“œ%20API%20ëª…ì„¸.md)
- **ë”ë¯¸ ë°ì´í„°** â†’ [ğŸ“„ 11. ë”ë¯¸ ë°ì´í„° ë° ì´ˆê¸° ë°ì´í„° ì •ì˜](./11.%20ë”ë¯¸%20ë°ì´í„°%20ë°%20ì´ˆê¸°%20ë°ì´í„°%20ì •ì˜.md)

---

# 2. ASSA ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ v1.0

## 1. ê°œìš”

### 1.1 ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´

- **DBMS**: MySQL 8.x
- **ë¬¸ìì…‹**: utf8mb4 (UTF-8 ì „ì²´ ì§€ì›)
- **Collation**: utf8mb4_unicode_ci
- **ì—”ì§„**: InnoDB (íŠ¸ëœì­ì…˜ ë° ì™¸ë˜í‚¤ ì§€ì›)
- **ì‹œê°„ëŒ€**: UTC

### 1.2 ëª…ëª… ê·œì¹™

- **í…Œì´ë¸”ëª…**: snake_case (ë³µìˆ˜í˜•)
- **ì»¬ëŸ¼ëª…**: snake_case (ë‹¨ìˆ˜í˜•)
- **ì¸ë±ìŠ¤ëª…**: `idx_í…Œì´ë¸”ëª…_ì»¬ëŸ¼ëª…`
- **ì™¸ë˜í‚¤ëª…**: `fk_í…Œì´ë¸”ëª…_ì°¸ì¡°í…Œì´ë¸”ëª…`

### 1.3 ê³µí†µ ê·œì¹™

- ëª¨ë“  í…Œì´ë¸”ì€ `id` (BIGINT, AUTO_INCREMENT, PRIMARY KEY) í¬í•¨
- ìƒì„±/ìˆ˜ì • ì‹œê°„ ì¶”ì : `created_at`, `updated_at` (TIMESTAMP)
- ì†Œí”„íŠ¸ ì‚­ì œ: `deleted_at` (TIMESTAMP NULL)
- ì™¸ë˜í‚¤ëŠ” `BIGINT UNSIGNED` íƒ€ì… ì‚¬ìš©

## 2. ì‚¬ìš©ì ê´€ë ¨ í…Œì´ë¸”

### 2.1 users (ì‚¬ìš©ì)

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    nickname VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    profile_image VARCHAR(500) NULL,
    introduction TEXT NULL,
    email_verified_at TIMESTAMP NULL,
    remember_token VARCHAR(100) NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    INDEX idx_users_email (email),
    INDEX idx_users_nickname (nickname),
    INDEX idx_users_created_at (created_at),
    INDEX idx_users_deleted_at (deleted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `email`: ë¡œê·¸ì¸ìš© ì´ë©”ì¼ (ê³ ìœ ê°’)
- `nickname`: í™”ë©´ í‘œì‹œìš© ë‹‰ë„¤ì„ (ê³ ìœ ê°’)
- `password`: í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸
- `profile_image`: í”„ë¡œí•„ ì´ë¯¸ì§€ URL/ê²½ë¡œ
- `introduction`: ìê¸°ì†Œê°œ
- `email_verified_at`: ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ ì‹œê°„

### 2.2 oauths (ì†Œì…œ ë¡œê·¸ì¸)

```sql
CREATE TABLE oauths (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    provider VARCHAR(50) NOT NULL,
    provider_id VARCHAR(255) NOT NULL,
    provider_email VARCHAR(255) NULL,
    provider_nickname VARCHAR(100) NULL,
    provider_profile_image VARCHAR(500) NULL,
    access_token TEXT NULL,
    refresh_token TEXT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY fk_oauths_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_provider_user (provider, provider_id),
    INDEX idx_oauths_user_id (user_id),
    INDEX idx_oauths_provider (provider)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `provider`: OAuth ì œê³µì (kakao, google, etc.)
- `provider_id`: ì œê³µìì˜ ì‚¬ìš©ì ID
- `provider_email`: ì œê³µìì—ì„œ ë°›ì€ ì´ë©”ì¼
- `access_token`: OAuth ì•¡ì„¸ìŠ¤ í† í°

## 3. ê²Œì‹œë¬¼ ê´€ë ¨ í…Œì´ë¸”

### 3.1 posts (ê²Œì‹œë¬¼)

```sql
CREATE TABLE posts (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    content TEXT NOT NULL,
    view_count INT UNSIGNED DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    FOREIGN KEY fk_posts_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_posts_user_id (user_id),
    INDEX idx_posts_created_at (created_at),
    INDEX idx_posts_view_count (view_count),
    INDEX idx_posts_deleted_at (deleted_at),
    FULLTEXT idx_posts_content (content)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `content`: ê²Œì‹œë¬¼ ë‚´ìš©
- `view_count`: ì¡°íšŒìˆ˜

### 3.2 post_files (ê²Œì‹œë¬¼ ì²¨ë¶€íŒŒì¼)

```sql
CREATE TABLE post_files (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    post_id BIGINT UNSIGNED NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_size INT UNSIGNED NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    file_order TINYINT UNSIGNED DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY fk_post_files_post (post_id) REFERENCES posts(id) ON DELETE CASCADE,
    INDEX idx_post_files_post_id (post_id),
    INDEX idx_post_files_order (post_id, file_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `file_order`: íŒŒì¼ í‘œì‹œ ìˆœì„œ (0ë¶€í„° ì‹œì‘)
- `file_size`: íŒŒì¼ í¬ê¸° (bytes)

### 3.3 comments (ëŒ“ê¸€)

```sql
CREATE TABLE comments (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    post_id BIGINT UNSIGNED NOT NULL,
    user_id BIGINT UNSIGNED NOT NULL,
    content TEXT NOT NULL,
    is_edited BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    FOREIGN KEY fk_comments_post (post_id) REFERENCES posts(id) ON DELETE CASCADE,
    FOREIGN KEY fk_comments_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_comments_post_id (post_id),
    INDEX idx_comments_user_id (user_id),
    INDEX idx_comments_created_at (created_at),
    INDEX idx_comments_deleted_at (deleted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 3.4 replies (ë‹µê¸€)

```sql
CREATE TABLE replies (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    comment_id BIGINT UNSIGNED NOT NULL,
    user_id BIGINT UNSIGNED NOT NULL,
    content TEXT NOT NULL,
    mentioned_user_id BIGINT UNSIGNED NULL,
    is_edited BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    FOREIGN KEY fk_replies_comment (comment_id) REFERENCES comments(id) ON DELETE CASCADE,
    FOREIGN KEY fk_replies_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_replies_mentioned_user (mentioned_user_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_replies_comment_id (comment_id),
    INDEX idx_replies_user_id (user_id),
    INDEX idx_replies_mentioned_user_id (mentioned_user_id),
    INDEX idx_replies_created_at (created_at),
    INDEX idx_replies_deleted_at (deleted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `mentioned_user_id`: ë‹µê¸€ì—ì„œ ë©˜ì…˜ëœ ì‚¬ìš©ì ID

## 4. ì¢‹ì•„ìš” ê´€ë ¨ í…Œì´ë¸”

### 4.1 user_post_likes (ê²Œì‹œë¬¼ ì¢‹ì•„ìš”)

```sql
CREATE TABLE user_post_likes (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    post_id BIGINT UNSIGNED NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY fk_user_post_likes_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_user_post_likes_post (post_id) REFERENCES posts(id) ON DELETE CASCADE,
    UNIQUE KEY unique_user_post_like (user_id, post_id),
    INDEX idx_user_post_likes_post_id (post_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 4.2 user_comment_likes (ëŒ“ê¸€ ì¢‹ì•„ìš”)

```sql
CREATE TABLE user_comment_likes (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    comment_id BIGINT UNSIGNED NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY fk_user_comment_likes_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_user_comment_likes_comment (comment_id) REFERENCES comments(id) ON DELETE CASCADE,
    UNIQUE KEY unique_user_comment_like (user_id, comment_id),
    INDEX idx_user_comment_likes_comment_id (comment_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 4.3 user_reply_likes (ë‹µê¸€ ì¢‹ì•„ìš”)

```sql
CREATE TABLE user_reply_likes (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    reply_id BIGINT UNSIGNED NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY fk_user_reply_likes_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_user_reply_likes_reply (reply_id) REFERENCES replies(id) ON DELETE CASCADE,
    UNIQUE KEY unique_user_reply_like (user_id, reply_id),
    INDEX idx_user_reply_likes_reply_id (reply_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 5. ì†Œì…œ ê´€ê³„ í…Œì´ë¸”

### 5.1 follows (íŒ”ë¡œìš° ê´€ê³„)

```sql
CREATE TABLE follows (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    follower_id BIGINT UNSIGNED NOT NULL,
    followed_id BIGINT UNSIGNED NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY fk_follows_follower (follower_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_follows_followed (followed_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_follow_relation (follower_id, followed_id),
    INDEX idx_follows_follower_id (follower_id),
    INDEX idx_follows_followed_id (followed_id),

    CONSTRAINT chk_follows_self_follow CHECK (follower_id != followed_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì œì•½ì¡°ê±´**:

- ìê¸° ìì‹ ì„ íŒ”ë¡œìš°í•  ìˆ˜ ì—†ìŒ

### 5.2 friends (ì¹œêµ¬ ê´€ê³„)

```sql
CREATE TABLE friends (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    requester_id BIGINT UNSIGNED NOT NULL,
    addressee_id BIGINT UNSIGNED NOT NULL,
    status ENUM('pending', 'accepted', 'rejected') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY fk_friends_requester (requester_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_friends_addressee (addressee_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_friend_relation (requester_id, addressee_id),
    INDEX idx_friends_requester_id (requester_id),
    INDEX idx_friends_addressee_id (addressee_id),
    INDEX idx_friends_status (status),

    CONSTRAINT chk_friends_self_friend CHECK (requester_id != addressee_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `status`: ì¹œêµ¬ ìš”ì²­ ìƒíƒœ (pending, accepted, rejected)

### 5.3 blocked_users (ì°¨ë‹¨ ê´€ê³„)

```sql
CREATE TABLE blocked_users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    blocker_id BIGINT UNSIGNED NOT NULL,
    blocked_id BIGINT UNSIGNED NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY fk_blocked_users_blocker (blocker_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_blocked_users_blocked (blocked_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_block_relation (blocker_id, blocked_id),
    INDEX idx_blocked_users_blocker_id (blocker_id),
    INDEX idx_blocked_users_blocked_id (blocked_id),

    CONSTRAINT chk_blocked_users_self_block CHECK (blocker_id != blocked_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 6. ì±„íŒ… ê´€ë ¨ í…Œì´ë¸”

### 6.1 chat_rooms (ì±„íŒ…ë°©)

```sql
CREATE TABLE chat_rooms (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT NULL,
    host_user_id BIGINT UNSIGNED NOT NULL,
    is_open BOOLEAN DEFAULT FALSE,
    max_participants INT UNSIGNED DEFAULT 100,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    FOREIGN KEY fk_chat_rooms_host (host_user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_chat_rooms_host_user_id (host_user_id),
    INDEX idx_chat_rooms_is_open (is_open),
    INDEX idx_chat_rooms_created_at (created_at),
    INDEX idx_chat_rooms_deleted_at (deleted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `is_open`: ì˜¤í”ˆ ì±„íŒ…ë°© ì—¬ë¶€
- `max_participants`: ìµœëŒ€ ì°¸ì—¬ì ìˆ˜

### 6.2 user_chatroom_map (ì±„íŒ…ë°© ì°¸ì—¬ì ë§¤í•‘)

```sql
CREATE TABLE user_chatroom_map (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    chat_room_id BIGINT UNSIGNED NOT NULL,
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    left_at TIMESTAMP NULL,
    is_active BOOLEAN DEFAULT TRUE,
    role ENUM('host', 'admin', 'member') DEFAULT 'member',
    notification_enabled BOOLEAN DEFAULT TRUE,

    FOREIGN KEY fk_user_chatroom_map_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_user_chatroom_map_room (chat_room_id) REFERENCES chat_rooms(id) ON DELETE CASCADE,
    INDEX idx_user_chatroom_map_user_id (user_id),
    INDEX idx_user_chatroom_map_room_id (chat_room_id),
    INDEX idx_user_chatroom_map_active (is_active),
    INDEX idx_user_chatroom_map_joined_at (joined_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `role`: ì±„íŒ…ë°©ì—ì„œì˜ ì—­í• 
- `notification_enabled`: ì•Œë¦¼ ìˆ˜ì‹  ì„¤ì •

### 6.3 messages (ë©”ì‹œì§€)

```sql
CREATE TABLE messages (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    chat_room_id BIGINT UNSIGNED NOT NULL,
    user_id BIGINT UNSIGNED NULL,
    content TEXT NOT NULL,
    message_type ENUM('text', 'image', 'system', 'file') DEFAULT 'text',
    file_path VARCHAR(500) NULL,
    file_name VARCHAR(255) NULL,
    is_edited BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    FOREIGN KEY fk_messages_room (chat_room_id) REFERENCES chat_rooms(id) ON DELETE CASCADE,
    FOREIGN KEY fk_messages_user (user_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_messages_room_id (chat_room_id),
    INDEX idx_messages_user_id (user_id),
    INDEX idx_messages_created_at (created_at),
    INDEX idx_messages_type (message_type),
    INDEX idx_messages_deleted_at (deleted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `user_id`: NULLì¸ ê²½ìš° ì‹œìŠ¤í…œ ë©”ì‹œì§€
- `message_type`: ë©”ì‹œì§€ ìœ í˜•

### 6.4 message_read_status (ë©”ì‹œì§€ ì½ìŒ ìƒíƒœ)

```sql
CREATE TABLE message_read_status (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    message_id BIGINT UNSIGNED NOT NULL,
    user_id BIGINT UNSIGNED NOT NULL,
    read_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY fk_message_read_status_message (message_id) REFERENCES messages(id) ON DELETE CASCADE,
    FOREIGN KEY fk_message_read_status_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_message_user_read (message_id, user_id),
    INDEX idx_message_read_status_message_id (message_id),
    INDEX idx_message_read_status_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 7. ì•Œë¦¼ ê´€ë ¨ í…Œì´ë¸”

### 7.1 notifications (ì•Œë¦¼)

```sql
CREATE TABLE notifications (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    type VARCHAR(50) NOT NULL,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    data JSON NULL,
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    read_at TIMESTAMP NULL,

    FOREIGN KEY fk_notifications_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_notifications_user_id (user_id),
    INDEX idx_notifications_type (type),
    INDEX idx_notifications_is_read (is_read),
    INDEX idx_notifications_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**ì»¬ëŸ¼ ì„¤ëª…**:

- `type`: ì•Œë¦¼ ìœ í˜• (post_like, comment, reply, follow, friend_request, etc.)
- `data`: ì¶”ê°€ ì •ë³´ë¥¼ JSON í˜•íƒœë¡œ ì €ì¥

### 7.2 follow_notification_settings (íŒ”ë¡œìš° ì•Œë¦¼ ì„¤ì •)

```sql
CREATE TABLE follow_notification_settings (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    followed_user_id BIGINT UNSIGNED NOT NULL,
    post_notification BOOLEAN DEFAULT TRUE,
    comment_notification BOOLEAN DEFAULT TRUE,
    reply_notification BOOLEAN DEFAULT TRUE,
    like_notification BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY fk_follow_notification_settings_user (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY fk_follow_notification_settings_followed (followed_user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_follow_notification (user_id, followed_user_id),
    INDEX idx_follow_notification_settings_user_id (user_id),
    INDEX idx_follow_notification_settings_followed_user_id (followed_user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 8. ê´€ê³„ë„ (ERD)

### 8.1 ì£¼ìš” ê´€ê³„

```
users (1) â†â”€â”€â”€â”€ (N) posts
users (1) â†â”€â”€â”€â”€ (N) comments
users (1) â†â”€â”€â”€â”€ (N) replies
users (M) â†â”€â”€â”€â”€ (N) follows â”€â”€â”€â”€â†’ (1) users
users (M) â†â”€â”€â”€â”€ (N) friends â”€â”€â”€â”€â†’ (1) users
users (M) â†â”€â”€â”€â”€ (N) blocked_users â”€â”€â”€â”€â†’ (1) users
users (M) â†â”€â”€â”€â”€ (N) user_chatroom_map â”€â”€â”€â”€â†’ (1) chat_rooms
posts (1) â†â”€â”€â”€â”€ (N) post_files
posts (1) â†â”€â”€â”€â”€ (N) comments (1) â†â”€â”€â”€â”€ (N) replies
```

### 8.2 ì°¸ì¡° ë¬´ê²°ì„± ê·œì¹™

- **CASCADE DELETE**: ë¶€ëª¨ ë ˆì½”ë“œ ì‚­ì œ ì‹œ ìì‹ ë ˆì½”ë“œë„ í•¨ê»˜ ì‚­ì œ

  - user ì‚­ì œ â†’ í•´ë‹¹ userì˜ posts, comments, likes ë“± ëª¨ë‘ ì‚­ì œ
  - post ì‚­ì œ â†’ í•´ë‹¹ postì˜ comments, likes ëª¨ë‘ ì‚­ì œ
  - comment ì‚­ì œ â†’ í•´ë‹¹ commentì˜ replies ëª¨ë‘ ì‚­ì œ

- **SET NULL**: ë¶€ëª¨ ë ˆì½”ë“œ ì‚­ì œ ì‹œ ì™¸ë˜í‚¤ë¥¼ NULLë¡œ ì„¤ì •
  - user ì‚­ì œ â†’ messagesì˜ user_idê°€ NULL (ì‹œìŠ¤í…œ ë©”ì‹œì§€ë¡œ ë³€í™˜)

## 9. ì¸ë±ìŠ¤ ì „ëµ

### 9.1 ì„±ëŠ¥ ìµœì í™” ì¸ë±ìŠ¤

- **ë³µí•© ì¸ë±ìŠ¤**: ìì£¼ í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼ë“¤
- **ì»¤ë²„ë§ ì¸ë±ìŠ¤**: SELECT ì ˆì˜ ëª¨ë“  ì»¬ëŸ¼ì„ í¬í•¨í•˜ëŠ” ì¸ë±ìŠ¤
- **ë¶€ë¶„ ì¸ë±ìŠ¤**: ì¡°ê±´ë¶€ ì¸ë±ìŠ¤ (deleted_at IS NULL ë“±)

### 9.2 ì£¼ìš” ì¿¼ë¦¬ë³„ ì¸ë±ìŠ¤

```sql
-- ê²Œì‹œë¬¼ ëª©ë¡ ì¡°íšŒ (ìµœì‹ ìˆœ)
CREATE INDEX idx_posts_active_created ON posts(deleted_at, created_at DESC);

-- íŒ”ë¡œìš° í”¼ë“œ ì¡°íšŒ
CREATE INDEX idx_posts_user_created ON posts(user_id, deleted_at, created_at DESC);

-- ì±„íŒ…ë°©ë³„ ë©”ì‹œì§€ ì¡°íšŒ
CREATE INDEX idx_messages_room_created ON messages(chat_room_id, deleted_at, created_at);

-- ì½ì§€ ì•Šì€ ì•Œë¦¼ ê°œìˆ˜
CREATE INDEX idx_notifications_user_unread ON notifications(user_id, is_read, created_at);
```

## 10. ë°ì´í„° ì¼ê´€ì„± ê·œì¹™

### 10.1 ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™

- ì‚¬ìš©ìëŠ” ìê¸° ìì‹ ì„ íŒ”ë¡œìš°/ì¹œêµ¬ ì‹ ì²­/ì°¨ë‹¨í•  ìˆ˜ ì—†ìŒ
- ì°¨ë‹¨ëœ ì‚¬ìš©ì ê°„ì—ëŠ” ì±„íŒ…ë°© ìƒì„± ë¶ˆê°€
- ê²Œì‹œë¬¼ ì‘ì„±ìë§Œ í•´ë‹¹ ê²Œì‹œë¬¼ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
- ì±„íŒ…ë°© í˜¸ìŠ¤íŠ¸ë§Œ ì±„íŒ…ë°© ì„¤ì • ë³€ê²½ ê°€ëŠ¥

### 10.2 íŠ¸ë¦¬ê±° ì •ì˜

```sql
-- ì°¨ë‹¨ ì‹œ ê¸°ì¡´ ì¹œêµ¬ ê´€ê³„ ìë™ í•´ì œ
DELIMITER $$
CREATE TRIGGER tr_blocked_users_remove_friend
    AFTER INSERT ON blocked_users
    FOR EACH ROW
BEGIN
    DELETE FROM friends
    WHERE (requester_id = NEW.blocker_id AND addressee_id = NEW.blocked_id)
       OR (requester_id = NEW.blocked_id AND addressee_id = NEW.blocker_id);
END$$
DELIMITER ;

-- ê²Œì‹œë¬¼ ì‚­ì œ ì‹œ ê´€ë ¨ íŒŒì¼ ì •ë¦¬ (ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì²˜ë¦¬)
-- ì‚¬ìš©ì ì‚­ì œ ì‹œ í”„ë¡œí•„ ì´ë¯¸ì§€ ì •ë¦¬ (ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì²˜ë¦¬)
```

## 11. ë°±ì—… ë° ë³µêµ¬ ì „ëµ

### 11.1 ë°±ì—… ì •ì±…

- **ì „ì²´ ë°±ì—…**: ë§¤ì¼ ìì • (mysqldump)
- **ì¦ë¶„ ë°±ì—…**: ë§¤ì‹œê°„ (binlog)
- **ë³´ê´€ ê¸°ê°„**: 30ì¼
- **ì••ì¶•**: gzip ì••ì¶• ì €ì¥

### 11.2 ë³µêµ¬ ì ˆì°¨

1. ìµœì‹  ì „ì²´ ë°±ì—… ë³µì›
2. ì¦ë¶„ ë°±ì—…ì„ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©
3. ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
4. ì• í”Œë¦¬ì¼€ì´ì…˜ ì—°ê²° í…ŒìŠ¤íŠ¸

---

ë³¸ ìŠ¤í‚¤ë§ˆëŠ” ASSA í”„ë¡œì íŠ¸ì˜ ëª¨ë“  ë°ì´í„° êµ¬ì¡°ì™€ ê´€ê³„ë¥¼ ì •ì˜í•˜ë©°, ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ë™ì¼í•œ ë°ì´í„° ëª¨ë¸ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
