---
date: 2025-04-28
tags:
  - daily
created: 2025-04-28T17:33
updated: 2025-04-28T17:34
---
<documents>  
<document index="1">  
<source>app/src/main/java\com\teamnova\assa\application\GlobalApplication.java</source>  
<document_content>  
package com.teamnova.assa.application;  
  
import android.app.Application;  
import android.app.NotificationChannel;  
import android.app.NotificationManager;  
import android.content.Context;  
import android.database.sqlite.SQLiteDatabase;  
import android.os.Build;  
  
import com.kakao.sdk.common.KakaoSdk;  
import com.teamnova.assa.BuildConfig;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.util.DBHelper;  
  
/**  
 * 앱 실행시 초기화 할 정보들을 여기서 세팅한다  
 * 카카오 문서 참고 - https://developers.kakao.com/docs/latest/ko/android/getting-started#init  
 */  
public class GlobalApplication extends Application {  
    public static final String NOTIFICATION_CHAT_CHANNEL_ID = "chat_notification";  
    public static DBHelper dbHelper;  
  
    @Override  
    public void onCreate() {  
        super.onCreate();  
        KakaoSdk.init(this, BuildConfig.KAKAO_NATIVE_APP_KEY);  
        SPHelper.init(getApplicationContext());  
        createChannel(getApplicationContext());  
  
        dbHelper = new DBHelper(this.getApplicationContext());  
        SQLiteDatabase db = dbHelper.getWritableDatabase(); // db 켜기  
        // 실행되는 쿼리 로깅  
//        db.enableWriteAheadLogging();  
//        db.execSQL("PRAGMA foreign_keys=ON;");  
//        db.execSQL("PRAGMA journal_mode=WAL;");  
//        db.execSQL("PRAGMA synchronous=OFF;");  
//        db.execSQL("PRAGMA log_query_plan = ON;");  
//        db.execSQL("PRAGMA database_list;");  
    }  
  
    public void createChannel(Context context) {  
        if (Build.VERSION.SDK_INT < 26) {  
            return;  
        }  
        NotificationManager notificationManager =  
                (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);  
        NotificationChannel channel = new NotificationChannel(NOTIFICATION_CHAT_CHANNEL_ID, "name", NotificationManager.IMPORTANCE_HIGH);  
        channel.setDescription("Description");  
        notificationManager.createNotificationChannel(channel);  
    }  
}  
  
</document_content>  
</document>  
<document index="2">  
<source>app/src/main/java\com\teamnova\assa\broadcastReceiver\AlarmReceiver.java</source>  
<document_content>  
package com.teamnova.assa.broadcastReceiver;  
  
import android.content.BroadcastReceiver;  
import android.content.Context;  
import android.content.Intent;  
import android.util.Log;  
  
import com.teamnova.assa.service.ChattingSocketService;  
  
public class AlarmReceiver extends BroadcastReceiver {  
    public static final String TAG = AlarmReceiver.class.getSimpleName();  
  
    @Override  
    public void onReceive(Context context, Intent intent) {  
        Log.d(TAG, "onReceive: 알람 수신됨 ");  
        context.startService(new Intent(context, ChattingSocketService.class));  
    }  
}  
</document_content>  
</document>  
<document index="3">  
<source>app/src/main/java\com\teamnova\assa\broadcastReceiver\BootReceiver.java</source>  
<document_content>  
package com.teamnova.assa.broadcastReceiver;  
  
import android.content.BroadcastReceiver;  
import android.content.Context;  
import android.content.Intent;  
import android.util.Log;  
import android.widget.Toast;  
  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.service.RestartService;  
  
/**  
 * 핸드폰 켜지는 것을 감지하는 리시버  
 */  
public class BootReceiver extends BroadcastReceiver {  
    public static final String TAG = BootReceiver.class.getSimpleName();  
  
    @Override  
    public void onReceive(Context context, Intent intent) {  
        // 사용자가 로그인 중인 상태라면 서비스를 실행한다.  
        Toast.makeText(context, "부팅 이벤트 수신됨", Toast.LENGTH_LONG).show();  
        Log.i(TAG, "onReceive: 부팅 이벤트 수신됨 ");  
  
        Long userId = SPHelper.getUserId();  
        Log.i(TAG, "onReceive: 현재 로그인된 유저 id = " + userId);  
  
        if(userId != null){  
            context.startForegroundService(new Intent(context, RestartService.class));  
        }  
    }  
}  
</document_content>  
</document>  
<document index="4">  
<source>app/src/main/java\com\teamnova\assa\command\Action.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
// 명령 액션 enum  
  
public enum Action {  
    CONNECT(ConnectCommand.class), // 소켓 접속  
    DISCONNECT(null),  
    CREATE_ROOM(CreateRoomCommand.class), // 채팅방 생성  
    EXIT_ROOM(ExitRoomCommand.class),  
    ROOM_INFO(RoomInfoCommand.class),  
    SEND_MESSAGE(SendMessageCommand.class),  
    CHECK_RECEIVE(CheckReceiveCommand.class), INVITE(InviteCommand.class),  
    CREATE_VIDEO_ROOM(CreateVideoRoomCommand.class), SDP(SDPCommand.class), ICE_CANDIDATE(IceCandidateCommand.class), JOIN_VIDEO_ROOM(JoinVideoRoomCommand.class),  
    VIDEO_ROOM(VideoRoomCommand.class), EXIT_VIDEO_ROOM(ExitVideoRoomCommand.class), MEDIA_STATUS(MediaStatusCommand.class), GET_VIDEO_ROOM_PARTICIPANT(GetVideoRoomParticipantCommand.class);  
  
    private final Class<? extends BaseCommand> commandClass;  
  
    Action(Class<? extends BaseCommand> commandClass) {  
        this.commandClass = commandClass;  
    }  
  
    public Class<? extends BaseCommand> getCommandClass() {  
        return commandClass;  
    }  
  
}  
  
</document_content>  
</document>  
<document index="5">  
<source>app/src/main/java\com\teamnova\assa\command\BaseCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import com.google.gson.Gson;  
import com.google.gson.GsonBuilder;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.util.TimeUtils;  
  
public class BaseCommand {  
  
    private static final Gson GSON = new GsonBuilder().setPrettyPrinting().create();  
  
    public Long id;  
    public Action action;  
    public Long requesterId; // 요청자  
    public String createdAT; // 커맨드가 생성된 시간  
  
    public BaseCommand(Action action) {  
        this.action = action;  
        this.requesterId = SPHelper.getUserId();  
        this.createdAT = TimeUtils.getCurrentTimeInUTC();  
    }  
  
    public String toJson() {  
        return new Gson().toJson(this);  
    }  
  
    public static <T extends BaseCommand> T fromJson(String json, Class<T> clazz) throws Exception {  
        try {  
            return GSON.fromJson(json, clazz);  
        } catch (Exception e) {  
            throw new Exception("Failed to parse JSON to " + clazz.getSimpleName(), e);  
        }  
    }  
  
    // action에 맞는 커맨드 객체 생성  
    public static BaseCommand fromJson(Action action, String json) throws Exception {  
        return fromJson(json, action.getCommandClass());  
    }  
}  
</document_content>  
</document>  
<document index="6">  
<source>app/src/main/java\com\teamnova\assa\command\CheckReceiveCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
public class CheckReceiveCommand extends BaseCommand {  
  
    public Long commandId;  
  
    public CheckReceiveCommand(Long commandId) {  
        super(Action.CHECK_RECEIVE);  
        this.commandId = commandId;  
    }  
  
    public static CheckReceiveCommand fromJson(String json) throws Exception {  
        return fromJson(json, CheckReceiveCommand.class);  
    }  
}  
</document_content>  
</document>  
<document index="7">  
<source>app/src/main/java\com\teamnova\assa\command\ConnectCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
public class ConnectCommand extends BaseCommand {  
  
    public ConnectCommand() {  
        super(Action.CONNECT);  
    }  
  
    public static ConnectCommand fromJson(String json) throws Exception {  
        return fromJson(json, ConnectCommand.class);  
    }  
  
}  
  
</document_content>  
</document>  
<document index="8">  
<source>app/src/main/java\com\teamnova\assa\command\CreateRoomCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import java.util.List;  
  
public class CreateRoomCommand extends BaseCommand {  
  
    public List<Long> invitedIdList;  
    public String roomName;  
    public String description;  
    public RoomType roomType = RoomType.NORMAL;  
  
    public CreateRoomCommand(List<Long> invitedIdList) {  
        super(Action.CREATE_ROOM);  
        this.invitedIdList = invitedIdList;  
    }  
  
    public CreateRoomCommand(String roomName, String description, RoomType roomType) {  
        super(Action.CREATE_ROOM);  
        this.roomName = roomName;  
        this.description = description;  
        this.roomType = roomType;  
    }  
  
    public static CreateRoomCommand fromJson(String json) throws Exception {  
        return fromJson(json, CreateRoomCommand.class);  
    }  
  
    public enum RoomType {  
        NORMAL,  
        OPEN  
    }  
}  
</document_content>  
</document>  
<document index="9">  
<source>app/src/main/java\com\teamnova\assa\command\CreateVideoRoomCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
/**  
 * 영상통화 방 생성 요청 커맨드  
 */  
public class CreateVideoRoomCommand extends ResponseCommand {  
  
    public String videoRoomId;  
  
    public CreateVideoRoomCommand(Long roomId) {  
        super(Action.CREATE_VIDEO_ROOM, 0L);  
        this.roomId = roomId;  
    }  
  
    public static CreateVideoRoomCommand fromJson(String json) throws Exception {  
        return fromJson(json, CreateVideoRoomCommand.class);  
    }  
}  
  
  
</document_content>  
</document>  
<document index="10">  
<source>app/src/main/java\com\teamnova\assa\command\ExitRoomCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import android.util.Log;  
  
import com.teamnova.assa.data.dto.data.SimpleUser;  
  
import java.util.List;  
  
// 퇴장 요청시 필요한 데이터 - 방 id, 나가는 사람 id (요청자)  
// 남은 멤버가 받아야할 데이터 - 방 id, 메시지 id, 나가는 사람 id (요청자),  
public class ExitRoomCommand extends RoomInfoCommand {  
    private static final String TAG = ExitRoomCommand.class.getSimpleName();  
  
    public Long messageId; // 문구를 출력하기 위한 id  
  
    public ExitRoomCommand(Long recipientId, Long roomId, Long requesterId, List<SimpleUser> memberList, Long messageId) {  
        super(Action.EXIT_ROOM, recipientId, roomId, memberList);  
        this.requesterId = requesterId;  
        this.messageId = messageId;  
    }  
  
    public ExitRoomCommand(Long roomId){  
        super(Action.EXIT_ROOM, 0L, roomId, null);  
    }  
  
    public static ExitRoomCommand fromJson(String json) throws Exception {  
        return fromJson(json, ExitRoomCommand.class);  
    }  
  
    public SendMessageCommand getMessageCommand() {  
        Log.d(TAG, "getMessageCommand: START");  
  
        // ex -> EXIT:0  
        String content = "EXIT:" + this.requesterId;  
  
        SendMessageCommand c = new SendMessageCommand(roomId, content, SendMessageCommand.Type.TEXT);  
        c.messageId = this.messageId;  
        c.requesterId = 0L;  
        c.recipientId = this.recipientId;  
        c.createdAT = this.createdAT;  
  
        Log.d(TAG, "getMessageCommand: return - 생성된 메시지 커맨드 = " + c.toJson());  
        return c;  
    }  
}  
  
</document_content>  
</document>  
<document index="11">  
<source>app/src/main/java\com\teamnova\assa\command\ExitVideoRoomCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
public class ExitVideoRoomCommand extends BaseCommand {  
  
    public Boolean isHost = false;  
    public String videoRoomId;  
    public Long roomId;  
  
    public ExitVideoRoomCommand() {  
        super(Action.EXIT_VIDEO_ROOM);  
    }  
  
    public static ExitVideoRoomCommand fromJson(String json) throws Exception {  
        return fromJson(json, ExitVideoRoomCommand.class);  
    }  
}  
  
</document_content>  
</document>  
<document index="12">  
<source>app/src/main/java\com\teamnova\assa\command\GetVideoRoomParticipantCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import com.teamnova.assa.data.dto.data.SimpleUser;  
  
import java.util.List;  
  
/**  
 * 영상통화 방 참가 요청 커맨드  
 */  
public class GetVideoRoomParticipantCommand extends ResponseCommand {  
  
    public String videoRoomId;  
    public String profileImage;  
    public String nickname;  
    public List<SimpleUser> userList;   // 전체 멤버리스트(본인포함)  
  
    public GetVideoRoomParticipantCommand(String videoRoomId) {  
        super(Action.GET_VIDEO_ROOM_PARTICIPANT, 0L);  
        this.videoRoomId = videoRoomId;  
    }  
  
    public static GetVideoRoomParticipantCommand fromJson(String json) throws Exception {  
        return fromJson(json, GetVideoRoomParticipantCommand.class);  
    }  
}  
  
  
</document_content>  
</document>  
<document index="13">  
<source>app/src/main/java\com\teamnova\assa\command\IceCandidateCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import org.webrtc.IceCandidate;  
  
public class IceCandidateCommand extends ResponseCommand {  
  
    public String videoRoomId;  
    public IceCandidate iceCandidate;  
    public long targetId;  
  
    public IceCandidateCommand(String videoRoomId, long targetId, IceCandidate iceCandidate) {  
        super(Action.ICE_CANDIDATE, 0L);  
        this.videoRoomId = videoRoomId;  
        this.targetId = targetId;  
        this.iceCandidate = iceCandidate;  
    }  
  
    public static IceCandidateCommand fromJson(String json) throws Exception {  
        return fromJson(json, IceCandidateCommand.class);  
    }  
}  
  
</document_content>  
</document>  
<document index="14">  
<source>app/src/main/java\com\teamnova\assa\command\InviteCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import android.util.Log;  
  
import com.google.gson.Gson;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
  
import java.util.ArrayList;  
import java.util.List;  
  
// 요청시 필요한 데이터 - 방 id,  요청자 id, 피초대자 id 들  
// 응답시 필요한 데이터 - roomInfo, 메시지 id, 요청자 기본정보, 피초대자 기본정보  
// 멤버리스트에 요청자, 피초대자 모두 들어간다.  
// 기본정보 = id, nickname, profileImage  
public class InviteCommand extends RoomInfoCommand {  
  
    private static final String TAG = InviteCommand.class.getSimpleName();  
  
    public Long messageId; // 문구를 출력하기 위한 id  
    public List<Long> invitedIdList;  
    public boolean isNewOpenChatMember = false; // 외부 인원이 검색을 통해 오픈채팅에 입장할 때만 true  
  
    public InviteCommand(Long recipientId, Long roomId, List<SimpleUser> memberList, List<Long> invitedIdList,  
                         Long messageId) {  
        super(Action.INVITE, recipientId, roomId, memberList);  
        this.messageId = messageId;  
        this.invitedIdList = invitedIdList;  
    }  
  
    public static InviteCommand fromJson(String json) throws Exception {  
        return fromJson(json, InviteCommand.class);  
    }  
  
    public SendMessageCommand getMessageCommand() {  
        Log.i(TAG, "getMessageCommand: START");  
  
        SendMessageCommand c = null;  
        // requesterId 가 제거된 리스트 (있는 경우)  
        List<Long> notRequesterIds = new ArrayList<>(this.invitedIdList);  
        notRequesterIds.remove(this.requesterId);  
        Log.d(TAG, "getMessageCommand: notRequesterIds = " + notRequesterIds);  
        String invitedIdsJson = new Gson().toJson(notRequesterIds);  
  
        if (roomType == CreateRoomCommand.RoomType.NORMAL) {  
  
            String content = "INVITE:" + this.requesterId + ":" + invitedIdsJson;  
  
            c = new SendMessageCommand(roomId, content, SendMessageCommand.Type.TEXT);  
            c.messageId = this.messageId;  
            c.requesterId = 0L;  
            c.recipientId = this.recipientId;  
            c.createdAT = this.createdAT;  
  
        } else if (roomType == CreateRoomCommand.RoomType.OPEN) {  
            // 오픈 채팅방의 경우  
  
            if (isNewOpenChatMember) {  
                Log.i(TAG, "getMessageCommand: 오픈 채팅방에 신규 입장한 경우의 메시지 생성");  
  
                if (notRequesterIds.size() > 0) {  
                    Log.i(TAG, "getMessageCommand: 기존 멤버의 의해 초대받음");  
  
                    String content = "INVITE:" + this.requesterId + ":" + invitedIdsJson;  
                    Log.d(TAG, "getMessageCommand: content = " + content);  
                    c = new SendMessageCommand(roomId, content, SendMessageCommand.Type.TEXT);  
                } else {  
                    c = new SendMessageCommand(roomId, "ENTER:" + this.requesterId, SendMessageCommand.Type.TEXT);  
                }  
            } else {  
                Log.i(TAG, "getMessageCommand: 오픈 채팅방을 생성한 경우의 메시지 생성");  
                c = new SendMessageCommand(roomId, "오픈 채팅방이 생성되었습니다.", SendMessageCommand.Type.TEXT);  
            }  
            c.messageId = this.messageId;  
            c.requesterId = 0L;  
            c.recipientId = this.recipientId;  
            c.createdAT = this.createdAT;  
        }  
  
        Log.i(TAG, "getMessageCommand: return - 생성된 메시지 커맨드 = " + c.toJson());  
        return c;  
    }  
  
}  
</document_content>  
</document>  
<document index="15">  
<source>app/src/main/java\com\teamnova\assa\command\JoinVideoRoomCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import com.teamnova.assa.data.dto.data.SimpleUser;  
  
import java.util.List;  
  
/**  
 * 영상통화 방 참가 요청 커맨드  
 */  
public class JoinVideoRoomCommand extends ResponseCommand {  
  
    public String videoRoomId;  
    public String profileImage;  
    public String nickname;  
    public List<SimpleUser> userList;   // 전체 멤버리스트(본인포함)  
    public boolean videoEnabled;  
    public boolean audioEnabled;  
  
    public JoinVideoRoomCommand(String videoRoomId) {  
        super(Action.JOIN_VIDEO_ROOM, 0L);  
        this.videoRoomId = videoRoomId;  
    }  
  
    public static JoinVideoRoomCommand fromJson(String json) throws Exception {  
        return fromJson(json, JoinVideoRoomCommand.class);  
    }  
}  
  
  
</document_content>  
</document>  
<document index="16">  
<source>app/src/main/java\com\teamnova\assa\command\MediaStatusCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
/**  
 * 영상회의중 카메라, 마이크 on / off 상태를 전달하기 위한 커맨드  
 */  
public class MediaStatusCommand extends ResponseCommand {  
  
    public String videoRoomId;  
    public boolean isEnabled;  
    public MediaType mediaType;  
  
    public MediaStatusCommand(String videoRoomId, MediaType mediaType, boolean isEnabled) {  
        super(Action.MEDIA_STATUS, 0L);  
        this.videoRoomId = videoRoomId;  
        this.isEnabled = isEnabled;  
        this.mediaType = mediaType;  
    }  
  
    public static MediaStatusCommand fromJson(String json) throws Exception {  
        return fromJson(json, MediaStatusCommand.class);  
    }  
  
    public enum MediaType {  
        VIDEO,  
        AUDIO  
    }  
  
}  
  
</document_content>  
</document>  
<document index="17">  
<source>app/src/main/java\com\teamnova\assa\command\ResponseCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
public abstract class ResponseCommand extends BaseCommand {  
  
    public Long recipientId; // 수신자 id  
    public TransmissionStatus transmissionStatus; // 전송상태  
    public Long roomId;  
  
    public ResponseCommand(Action action, Long recipientId) {  
        super(action);  
        this.recipientId = recipientId;  
        this.transmissionStatus = TransmissionStatus.NOT_SENT;  
    }  
  
    public enum TransmissionStatus{  
        SENT,  
        NOT_SENT  
    }  
}  
  
  
</document_content>  
</document>  
<document index="18">  
<source>app/src/main/java\com\teamnova\assa\command\RoomInfoCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import com.teamnova.assa.data.dto.data.SimpleUser;  
  
import java.util.List;  
  
// 요청시 필요한 데이터 - roomId, 요청자  
// 응답시 필요한 데이터 - roomId, 요청자, 현재 멤버현황  
public class RoomInfoCommand extends ResponseCommand {  
  
    public Long masterId = 0L;  
    public List<SimpleUser> memberList;  
    public String roomName = "";  
    public String description = "";  
    public CreateRoomCommand.RoomType roomType = CreateRoomCommand.RoomType.NORMAL;  
  
    public RoomInfoCommand(Long recipientId, Long roomId, List<SimpleUser> memberList) {  
        super(Action.ROOM_INFO, recipientId);  
        this.roomId = roomId;  
        this.memberList = memberList;  
    }  
  
    // 자식 생성시 사용  
    public RoomInfoCommand(Action action, Long recipientId, Long roomId,  List<SimpleUser> memberList) {  
        super(action, recipientId);  
        this.roomId = roomId;  
        this.memberList = memberList;  
    }  
  
    public static RoomInfoCommand fromJson(String json) throws Exception {  
        return fromJson(json, RoomInfoCommand.class);  
    }  
  
    public SendMessageCommand getMessageCommand() {  
        return null;  
    }  
}  
  
</document_content>  
</document>  
<document index="19">  
<source>app/src/main/java\com\teamnova\assa\command\SDPCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import org.webrtc.SessionDescription;  
  
public class SDPCommand extends ResponseCommand {  
  
    public String videoRoomId;  
    public Long targetId;  
    public SessionDescription sdp;  
  
    public SDPCommand(String videoRoomId, Long targetId, SessionDescription sdp) {  
        super(Action.SDP, 0L);  
        this.videoRoomId = videoRoomId;  
        this.targetId = targetId;  
        this.sdp = sdp;  
    }  
  
    public static SDPCommand fromJson(String json) throws Exception {  
        return fromJson(json, SDPCommand.class);  
    }  
}  
  
</document_content>  
</document>  
<document index="20">  
<source>app/src/main/java\com\teamnova\assa\command\SendMessageCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
public class SendMessageCommand extends ResponseCommand {  
    public Long messageId;  
    public String content;  
    public Type type;  
    public ReadStatus readStatus;  
    public boolean isTimeShow = true;  // 채팅방에서 메시지 시간을 표시할지 여부  
    public boolean isProfileShow = true; // 채팅방에서 프로필 사진을 표시할지 여부  
  
    public SendMessageCommand(Long roomId, String content, Type type) {  
        super(Action.SEND_MESSAGE, 0L); // 수신자 id는 0(서버) 로 설정  
        this.roomId = roomId;  
        this.content = content;  
        this.type = type;  
        this.readStatus = ReadStatus.UNREAD;  
    }  
  
    public static SendMessageCommand fromJson(String json) throws Exception {  
        return fromJson(json, SendMessageCommand.class);  
    }  
  
    public enum Type {  
        TEXT,  
        IMAGE,  
        VIDEO,  
        VIDEO_ROOM_OPEN,  
        VIDEO_ROOM_CLOSE  
    }  
  
    public enum ReadStatus {  
        READ,  
        UNREAD  
    }  
  
    @Override  
    public String toString() {  
        return "SendMessageCommand{" +  
                "messageId=" + messageId +  
                ", content='" + content + '\'' +  
                ", type=" + type +  
                ", readStatus=" + readStatus +  
                ", isTimeShow=" + isTimeShow +  
                ", isProfileShow=" + isProfileShow +  
                ", recipientId=" + recipientId +  
                ", transmissionStatus=" + transmissionStatus +  
                ", roomId=" + roomId +  
                ", id=" + id +  
                ", action=" + action +  
                ", requesterId=" + requesterId +  
                ", createdAT='" + createdAT + '\'' +  
                '}';  
    }  
}  
  
</document_content>  
</document>  
<document index="21">  
<source>app/src/main/java\com\teamnova\assa\command\VideoRoomCommand.java</source>  
<document_content>  
package com.teamnova.assa.command;  
  
import org.webrtc.IceCandidate;  
import org.webrtc.SessionDescription;  
  
import java.util.List;  
  
public class VideoRoomCommand extends BaseCommand{  
  
    public Long roomId;  
    public String videoRoomId; // UUID  
    public SessionDescription sdp;  
    public List<IceCandidate> iceCandidates;  
    public TYPE type;  
  
    public VideoRoomCommand(Long roomId, TYPE type) {  
        super(Action.VIDEO_ROOM);  
        this.roomId = roomId;  
        this.type = type;  
    }  
  
    public static VideoRoomCommand fromJson(String json) throws Exception {  
        return fromJson(json, VideoRoomCommand.class);  
    }  
  
    public enum TYPE{  
        CREATE, JOIN, EXIT  
    }  
}  
  
</document_content>  
</document>  
<document index="22">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\ChatRoom.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
import android.util.Log;  
  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.command.CreateRoomCommand;  
import com.teamnova.assa.data.helper.SPHelper;  
  
import java.util.List;  
  
public class ChatRoom {  
    public static final String TAG = ChatRoom.class.getSimpleName();  
    public Long id;  
    public String roomName; // 따로 설정하지 않으면 "" 또는 null 이다.  
    public String localName; // 로컬에서 변경한 이름  
    public String description;  
    public String updatedAt;  
    public Integer notiOn;  
    public Long masterId;  
    public CreateRoomCommand.RoomType roomType;  
    public int memberCount;  
  
    // 멤버이름을 조합해 채팅방 이름을 생성한다.  
    // user1, user2, ...  
    public String getDefaultRoomName() {  
        Log.d(TAG, "getDefaultRoomName: START");  
  
        List<SimpleUser> memberList = GlobalApplication.dbHelper.getChatRoomMembers(this.id, true);  
        Log.d(TAG, "getDefaultRoomName: 현재 회원 수 = " + memberList.size());  
  
        if (memberList.size() > 1) {  
            StringBuilder sb = new StringBuilder();  
            for (SimpleUser user : memberList) {  
                // 사용자 본인, 나간 사람 제외하고 방 이름으로 만듬  
                if (!user.id.equals(SPHelper.getUserId()) && !user.isExit) {  
                    sb.append(user.nickname).append(", ");  
                }  
            }  
            int newLength = sb.length() - 2;  
            if (newLength >= 0) sb.setLength(newLength);// 마지막 ", " 제거  
  
  
            // StringBuilder의 길이가 50자 이상인 경우  
            if (sb.length() > 50) {  
                sb.setLength(50); // 길이를 50으로 설정  
            }  
            roomName = sb.toString();  
        }  
  
        // 다른 사용자가 없을 때 기본 생성되는 채팅방 이름  
        if (roomName == null || roomName.isEmpty()) roomName = "(빈 채팅방)";  
  
        Log.d(TAG, "getDefaultRoomName: END - return: roomName=" + roomName);  
        return roomName;  
    }  
  
    public String getRoomName() {  
        // 로컬 이름이 null 또는 "" 이면 원래 이름 반환  
        if (localName == null || localName.isEmpty()) {  
            // 일반 방이면 기본 방 이름 반환  
            if (roomType == CreateRoomCommand.RoomType.NORMAL) return getDefaultRoomName();  
            return roomName;  
        }  
  
        return localName;  
    }  
}  
  
</document_content>  
</document>  
<document index="23">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\ChatRoom2.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
public class ChatRoom2 {  
    public Long id;  
    public String title;  
    public String description;  
    public int memberCount;  
    public String lastMessage;  
    public String lastMessageTime;  
    public int notReadCount;  
}  
  
</document_content>  
</document>  
<document index="24">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\ChatRoomItem.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
import java.util.List;  
  
/**  
 * 채팅방 목록의 각 아이템 정보를 담는 클래스  
 * 채팅방 목록조회시 보이는 데이터만 담는다.  
 */  
public class ChatRoomItem {  
    public Long id; // 채팅방 id  
//    public String chatRoomImage; // 채팅방 이미지  
    public String roomName; // 채팅방 이름  
//    public int memberCount; // 채팅방 인원 수  
    public List<UserData> members; // 멤버  
    public String lastMessage; // 마지막 메시지  
    public String lastMessageTime; // 마지막 메시지 시간  
    public int unReadCount; // 안읽은 메시지 수  
  
    public ChatRoomItem(){}  
  
    public ChatRoomItem(Long id, String roomName, List<UserData> members, String lastMessage, String lastMessageTime, int unReadCount) {  
        this.id = id;  
        this.roomName = roomName;  
        this.members = members;  
        this.lastMessage = lastMessage;  
        this.lastMessageTime = lastMessageTime;  
        this.unReadCount = unReadCount;  
    }  
  
    @Override  
    public String toString() {  
        return "ChatRoomItem{" +  
                "id=" + id +  
                ", roomName='" + roomName + '\'' +  
                ", members=" + members +  
                ", lastMessage='" + lastMessage + '\'' +  
                ", lastMessageTime='" + lastMessageTime + '\'' +  
                ", unReadCount=" + unReadCount +  
                '}';  
    }  
}  
  
</document_content>  
</document>  
<document index="25">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Comment.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
import com.google.gson.annotations.SerializedName;  
  
import java.time.LocalDateTime;  
import java.time.format.DateTimeFormatter;  
import java.util.List;  
  
/**  
 * 댓글 클래스  
 */  
public class Comment {  
    private Long id;  
    private Long user_id;  
    private UserData user;  
    private Long post_id;  
    private String content;  
    private String image_urls;  
    private LocalDateTime created_at;  
    private LocalDateTime updated_at;  
    private LocalDateTime deleted_at;  
    private List<Reply> replies;  
  
    @SerializedName("is_liked")  
    private boolean isLiked;  
    @SerializedName("like_count")  
    private int likeCount;  
    public boolean isLiked() {  
        return isLiked;  
    }  
  
    public void setLiked(boolean liked) {  
        isLiked = liked;  
    }  
  
    public int getLikeCount() {  
        return likeCount;  
    }  
  
    public void setLikeCount(int likeCount) {  
        this.likeCount = likeCount;  
    }  
  
    public Long getId() {  
        return id;  
    }  
  
    public void setId(Long id) {  
        this.id = id;  
    }  
  
    public Long getUser_id() {  
        return user_id;  
    }  
  
    public void setUser_id(Long user_id) {  
        this.user_id = user_id;  
    }  
  
    public Long getPost_id() {  
        return post_id;  
    }  
  
    public void setPost_id(Long post_id) {  
        this.post_id = post_id;  
    }  
  
    public String getContent() {  
        return content;  
    }  
  
    public void setContent(String content) {  
        this.content = content;  
    }  
  
    public String getImage_urls() {  
        return image_urls;  
    }  
  
    public void setImage_urls(String image_urls) {  
        this.image_urls = image_urls;  
    }  
  
    public LocalDateTime getCreated_at() {  
        return created_at;  
    }  
  
    public void setCreated_at(LocalDateTime created_at) {  
        this.created_at = created_at;  
    }  
  
    public LocalDateTime getUpdated_at() {  
        return updated_at;  
    }  
  
    public void setUpdated_at(LocalDateTime updated_at) {  
        this.updated_at = updated_at;  
    }  
  
    public LocalDateTime getDeleted_at() {  
        return deleted_at;  
    }  
  
    public void setDeleted_at(LocalDateTime deleted_at) {  
        this.deleted_at = deleted_at;  
    }  
  
    public List<Reply> getReplies() {  
        return replies;  
    }  
  
    public void setReplies(List<Reply> replies) {  
        this.replies = replies;  
    }  
  
    public UserData getUser() {  
        return user;  
    }  
  
    public void setUser(UserData user) {  
        this.user = user;  
    }  
  
    public String getDateTimeAsString() {  
        return this.getCreated_at().format(DateTimeFormatter.ofPattern("yyyy년 MM월 dd일"));  
    }  
  
    public int getReplyCount() {  
        if(this.replies == null) {  
            return 0;  
        }  
        return this.replies.size();  
    }  
}  
  
</document_content>  
</document>  
<document index="26">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Email.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
public class Email {  
    public String address;  // 메일 주소  
    public String title;    // 메일 제목  
    public String message;  // 메일 본문  
}  
  
</document_content>  
</document>  
<document index="27">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Follow.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
public class Follow {  
    public Long id;  
    public Long followerId; // 팔로우 신청한 사람  
    public Long followingId; // 팔로우 신청 받은 사람  
  
    public Follow(Long followerId, Long followingId) {  
        this.followerId = followerId;  
        this.followingId = followingId;  
    }  
  
    public Follow() {  
    }  
  
}  
  
</document_content>  
</document>  
<document index="28">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Friend.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
import com.google.gson.annotations.SerializedName;  
  
/**  
 * 두 사용자간 친구 상태를 나타내는 테이터 클래스  
 */  
public class Friend {  
    public Long id;  
    @SerializedName("requester_id")  
    public Long requesterId;  
    @SerializedName("receiver_id")  
    public Long receiverId;  
    public FRIEND_REQUEST_STATE state;  
    @SerializedName("created_at")  
    public String requestAt;  
  
    public UserData requester;  
    public UserData receiver;  
  
    public Friend(Long requesterId, Long receiverId) {  
        this.requesterId = requesterId;  
        this.receiverId = receiverId;  
    }  
  
    public enum FRIEND_REQUEST_STATE {  
        ACCEPT,         // 승인  
        REJECT,         // 거절  
        PENDING,        // 응답 대기  
        NONE            // 기존 요청 없음  
    }  
}  
  
</document_content>  
</document>  
<document index="29">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\LoginData.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
/**  
 * 로그인 응답 데이터 DTO  
 */  
public class LoginData {  
    public String token;  
    public UserData user;  
}  
  
</document_content>  
</document>  
<document index="30">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Member.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
public class Member {  
    public Long roomId;  
    public SimpleUser userData;  
    public String enteredAt;  
    public String exitedAt;  
  
    public Member(Long roomId, SimpleUser userData, String enteredAt, String exitedAt) {  
        this.roomId = roomId;  
        this.userData = userData;  
        this.enteredAt = enteredAt;  
        this.exitedAt = exitedAt;  
    }  
}  
  
</document_content>  
</document>  
<document index="31">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Message.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
// 단일 메시지 데이터 클래스  
public class Message {  
  
    public int messageId; // 메시지 id  
  
    // 전송자 정보  
    public Long senderId;  
    public String senderNickname;  
    public String senderProfileImage;  
  
    // 채팅방 id  
    public Long roomId;  
  
    // 텍스트 메시지  
    public String message;  
  
    // 이미지  
    public String imageUrl;  
    public String imageName;  
  
    // 비디오  
    public String videoUrl; // 서버가 영상을 저장한 경로  
    public String localVideoPath; // 영상을 저장한 로컬 경로  
  
    public String dateTime; // 메시지 전송시간  
  
    public boolean isRead; // 읽음 여부  
  
    public Message(Long senderId, String senderNickname, String senderProfileImage, Long roomId, String message, String dateTime) {  
        this.senderId = senderId;  
        this.senderNickname = senderNickname;  
        this.senderProfileImage = senderProfileImage;  
        this.roomId = roomId;  
        this.message = message;  
        this.imageUrl = imageUrl;  
        this.imageName = imageName;  
        this.videoUrl = videoUrl;  
        this.localVideoPath = localVideoPath;  
        this.dateTime = dateTime;  
    }  
  
    public Message(int messageId, Long senderId, String senderNickname, String senderProfileImage, Long roomId, String message, String dateTime, boolean isRead) {  
        this.messageId = messageId;  
        this.senderId = senderId;  
        this.senderNickname = senderNickname;  
        this.senderProfileImage = senderProfileImage;  
        this.roomId = roomId;  
        this.message = message;  
        this.dateTime = dateTime;  
        this.isRead = isRead;  
    }  
}  
  
</document_content>  
</document>  
<document index="32">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\OauthData.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
import com.google.gson.annotations.SerializedName;  
  
/**  
 * Oauth table 한 행을 표현  
 */  
public class OauthData {  
    public Long id;  
    @SerializedName("user_id")  
    public Long userId;  
    @SerializedName("auth_user_id")  
    public Long authUserId;  
    @SerializedName("provider")  
    public String provider;  
  
    public OauthData() {  
    }  
  
    public OauthData(Long id, Long userId, Long authUserId, String provider) {  
        this.id = id;  
        this.userId = userId;  
        this.authUserId = authUserId;  
        this.provider = provider;  
    }  
}  
  
</document_content>  
</document>  
<document index="33">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Post.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
import com.google.gson.annotations.SerializedName;  
  
import java.time.LocalDateTime;  
import java.time.format.DateTimeFormatter;  
import java.util.List;  
  
/**  
 * 게시물 정보를 담는 클래스  
 */  
public class Post {  
    private Long id;  
    private Long user_id;  
    private String title;  
    private String content;  
    @SerializedName("image_urls")  
    private String imageUrls;  
    private Long view_count;  
    @SerializedName("like_count")  
    private Long likeCount;  
    private Integer commentCount;  
    private LocalDateTime created_at;  
    private LocalDateTime updated_at;  
    private LocalDateTime deleted_at;  
    private String nickname;  
    private String profile_image;  
    private UserData user;  
    private List<Comment> comments;  
    @SerializedName("is_liked")  
    private boolean isLiked;  
  
    public Long getLikeCount() {  
        return likeCount;  
    }  
  
    public void setLikeCount(Long likeCount) {  
        this.likeCount = likeCount;  
    }  
  
    public void setLiked(boolean liked) {  
        this.isLiked = liked;  
    }  
  
    public boolean isLiked() {  
        return isLiked;  
    }  
  
    public Post(Long user_id, String title, String content, String image_urls) {  
        this.user_id = user_id;  
        this.title = title;  
        this.content = content;  
        this.imageUrls = image_urls;  
    }  
  
    public Long getId() {  
        return id;  
    }  
  
    public void setId(Long id) {  
        this.id = id;  
    }  
  
    public Long getUser_id() {  
        return user_id;  
    }  
  
    public void setUser_id(Long user_id) {  
        this.user_id = user_id;  
    }  
  
    public String getTitle() {  
        return title;  
    }  
  
    public void setTitle(String title) {  
        this.title = title;  
    }  
  
    public String getContent() {  
        return content;  
    }  
  
    public void setContent(String content) {  
        this.content = content;  
    }  
  
    public String getImageUrls() {  
        return imageUrls;  
    }  
  
    public void setImageUrls(String imageUrls) {  
        this.imageUrls = imageUrls;  
    }  
  
    public String getNickname() {  
        return nickname;  
    }  
  
    public void setNickname(String nickname) {  
        this.nickname = nickname;  
    }  
  
    public String getProfile_image() {  
        return profile_image;  
    }  
  
    public void setProfile_image(String profile_image) {  
        this.profile_image = profile_image;  
    }  
  
    public int getCommentCount() {  
        if(commentCount == null) {  
            commentCount = 0;  
        }  
        return commentCount;  
    }  
  
    public void setCommentCount(int commentCount) {  
        this.commentCount = commentCount;  
    }  
  
    public Long getView_count() {  
        if (view_count == null) {  
            view_count = 0L;  
        }  
        return view_count;  
    }  
  
    public void setView_count(Long view_count) {  
        this.view_count = view_count;  
    }  
  
    public LocalDateTime getCreated_at() {  
        return created_at;  
    }  
  
    public void setCreated_at(LocalDateTime created_at) {  
        this.created_at = created_at;  
    }  
  
    public LocalDateTime getUpdated_at() {  
        return updated_at;  
    }  
  
    public void setUpdated_at(LocalDateTime updated_at) {  
        this.updated_at = updated_at;  
    }  
  
    public LocalDateTime getDeleted_at() {  
        return deleted_at;  
    }  
  
    public void setDeleted_at(LocalDateTime deleted_at) {  
        this.deleted_at = deleted_at;  
    }  
  
    public UserData getUser() {  
        return user;  
    }  
  
    public void setUser(UserData user) {  
        this.user = user;  
    }  
  
    public String getDateTimeAsString() {  
        return this.getCreated_at().format(DateTimeFormatter.ofPattern("yyyy년 MM월 dd일"));  
    }  
  
    public List<Comment> getComments() {  
        return comments;  
    }  
  
    public void setComments(List<Comment> comments) {  
        this.comments = comments;  
    }  
}  
  
</document_content>  
</document>  
<document index="34">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\PostPreview.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
/**  
 * 게시물 리스트 미리보기 아이템 데이터  
 */  
public class PostPreview {  
  
    private int iv_profile;  
    private String tv_name;  
    private String tv_content;  
  
    public PostPreview(int iv_profile, String tv_name, String tv_content) {  
        this.iv_profile = iv_profile;  
        this.tv_name = tv_name;  
        this.tv_content = tv_content;  
    }  
  
    public int getIv_profile() {  
        return iv_profile;  
    }  
  
    public void setIv_profile(int iv_profile) {  
        this.iv_profile = iv_profile;  
    }  
  
    public String getTv_name() {  
        return tv_name;  
    }  
  
    public void setTv_name(String tv_name) {  
        this.tv_name = tv_name;  
    }  
  
    public String getTv_content() {  
        return tv_content;  
    }  
  
    public void setTv_content(String tv_content) {  
        this.tv_content = tv_content;  
    }  
}  
  
</document_content>  
</document>  
<document index="35">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Reply.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
/**  
 * 대댓글 클래스  
 */  
public class Reply extends Comment {  
    private Long comment_id;  
  
    public Long getComment_id() {  
        return comment_id;  
    }  
  
    public void setComment_id(Long comment_id) {  
        this.comment_id = comment_id;  
    }  
  
}  
  
</document_content>  
</document>  
<document index="36">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\SDP.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
public class SDP {  
    public String type;  
    public String description;  
  
    public SDP(String type, String description) {  
        this.type = type;  
        this.description = description;  
    }  
}  
  
</document_content>  
</document>  
<document index="37">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\SimpleUser.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
public class SimpleUser {  
    public Long id;  
    public String nickname;  
    public String profileImage;  
    public Boolean isExit;  
  
    public SimpleUser(Long id, String nickname, String profileImage) {  
        this.id = id;  
        this.nickname = nickname;  
        this.profileImage = profileImage;  
    }  
  
    @Override  
    public boolean equals(Object o) {  
        if (this == o) return true;  
        if (o == null || getClass() != o.getClass()) return false;  
        SimpleUser user = (SimpleUser) o;  
        return id == user.id;  
    }  
  
    @Override  
    public int hashCode() {  
        return Long.hashCode(id);  
    }  
}  
  
</document_content>  
</document>  
<document index="38">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\Terms.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
/**  
 * 약관데이터 저장 클래스  
 */  
public class Terms {  
    public String title;  
    public String text;  
  
    @Override  
    public String toString() {  
        return "Terms{" +  
                "title='" + title + '\'' +  
                ", text='" + text + '\'' +  
                '}';  
    }  
}  
  
</document_content>  
</document>  
<document index="39">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\UserData.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
import com.google.gson.annotations.SerializedName;  
  
import java.time.LocalDateTime;  
import java.util.List;  
  
/**  
 * 유저 DTO  
 */  
public class UserData{  
    public Long id;  
    public String nickname;  
    public String email;  
    public String password;  
    public String description;  
  
    @SerializedName("profile_image")  
    public String profileImage;  
  
    @SerializedName("login_type")  
    public LOGIN_TYPE loginType; // "default" or "social"  
  
    @SerializedName("created_at")  
    public LocalDateTime createdAt;  
    @SerializedName("updated_at")  
    public LocalDateTime updatedAt;  
    @SerializedName("deleted_at")  
    public LocalDateTime deletedAt;  
    public Boolean isFollowing;  
    public Boolean isFriend;  
    public Friend.FRIEND_REQUEST_STATE friendRequestState;  
    public List<UserData> followers;  
    public List<UserData> followings;  
    public List<UserData> friends;  
    public Boolean friendRequestExist;  
  
    public UserData() {}  
  
    public UserData(String nickname, String email, String password, LOGIN_TYPE loginType) {  
        this.nickname = nickname;  
        this.email = email;  
        this.password = password;  
        this.loginType = loginType;  
    }  
  
    public UserData(Long id, String nickname, String profileImage) {  
        this.id = id;  
        this.nickname = nickname;  
        this.profileImage = profileImage;  
    }  
  
    @Override  
    public String toString() {  
        return "UserData{" +  
                "id=" + id +  
                ", nickname='" + nickname + '\'' +  
                ", email='" + email + '\'' +  
                ", password='" + password + '\'' +  
                ", description='" + description + '\'' +  
                ", profileImage='" + profileImage + '\'' +  
                ", loginType=" + loginType +  
                ", createdAt=" + createdAt +  
                ", updatedAt=" + updatedAt +  
                ", deletedAt=" + deletedAt +  
                '}';  
    }  
  
    public enum LOGIN_TYPE {  
        DEFAULT,  
        SOCIAL,  
        AUTO  
    }  
  
  
}  
  
</document_content>  
</document>  
<document index="40">  
<source>app/src/main/java\com\teamnova\assa\data\dto\data\VideoRoomParticipant.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.data;  
  
import org.webrtc.SurfaceViewRenderer;  
import org.webrtc.VideoTrack;  
  
/**  
 * 영상회의의 각 참여자의 정보를 나타내는 클래스  
 */  
public class VideoRoomParticipant {  
    public SimpleUser userData;  
    public VideoTrack videoTrack;  
    public SurfaceViewRenderer surfaceViewRenderer;  
    public boolean isInitialized;  
  
    // 카메라 마이크 상태  
    public boolean isVideoEnabled = false;  
    public boolean isAudioEnabled = false;  
  
    public VideoRoomParticipant(SimpleUser userData, VideoTrack videoTrack) {  
        this.userData = userData;  
        this.videoTrack = videoTrack;  
    }  
  
}  
  
</document_content>  
</document>  
<document index="41">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\ApiRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
public class ApiRequest<T> {  
    private T payload;  
  
    public ApiRequest(T payload) {  
        this.payload = payload;  
    }  
  
    public T getPayload() {  
        return payload;  
    }  
  
    public void setPayload(T payload) {  
        this.payload = payload;  
    }  
}  
  
</document_content>  
</document>  
<document index="42">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\ChangePasswordRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
public class ChangePasswordRequest {  
    public Long id;  
    public String currentPassword;  
    public String newPassword;  
}  
  
</document_content>  
</document>  
<document index="43">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\CreateChatRoomRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
import java.util.List;  
  
public class CreateChatRoomRequest {  
    public Long hostId; // 생성자 id  
    public String title;   // 채팅방 제목  
    public String description; // 체팅방 설명  
    public List<Long> memberIds; // 멤버 목록  
}  
  
</document_content>  
</document>  
<document index="44">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\FileUploadRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
import com.google.gson.annotations.SerializedName;  
  
public class FileUploadRequest {  
    @SerializedName("target_type")  
    public String targetType; // "POST"  
  
    @SerializedName("target_id")  
    public Long targetId; // 대상의 id  
  
    public FileUploadRequest(String targetType, Long targetId) {  
        this.targetType = targetType;  
        this.targetId = targetId;  
    }  
}  
  
</document_content>  
</document>  
<document index="45">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\LikeRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
import com.google.gson.annotations.SerializedName;  
import com.teamnova.assa.data.helper.PostHelper;  
  
/**  
 * 좋아요 요청  
 */  
public class LikeRequest {  
    @SerializedName("user_id")  
    public Long userId;  
  
    @SerializedName("target_id")  
    public Long targetId;  
  
    public PostHelper.TYPE type;  
  
  
}  
  
</document_content>  
</document>  
<document index="46">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\LoginRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
import com.google.gson.annotations.SerializedName;  
import com.teamnova.assa.data.dto.data.UserData;  
  
public class LoginRequest {  
    public String email;  
    public String password;  
    @SerializedName("login_type")  
    public UserData.LOGIN_TYPE loginType;  
    @SerializedName("auth_user_id")  
    public Long authUserId;  
  
    public String token;  
  
    public LoginRequest(String email, String password, UserData.LOGIN_TYPE loginType, Long authUserId, String token) {  
        this.email = email;  
        this.password = password;  
        this.loginType = loginType;  
        this.authUserId = authUserId;  
        this.token = token;  
    }  
  
}  
  
</document_content>  
</document>  
<document index="47">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\PasswordRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
public class PasswordRequest {  
    public String password;  
  
    public PasswordRequest(String password) {  
        this.password = password;  
    }  
}  
  
</document_content>  
</document>  
<document index="48">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\RefreshTokenRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
public class RefreshTokenRequest {  
    public String token;  
}  
  
</document_content>  
</document>  
<document index="49">  
<source>app/src/main/java\com\teamnova\assa\data\dto\request\RegisterRequest.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.request;  
  
import com.teamnova.assa.data.dto.data.OauthData;  
import com.teamnova.assa.data.dto.data.UserData;  
  
import java.util.List;  
  
/**  
 * 회원가입 요청  
 */  
public class RegisterRequest {  
    public UserData userData;  
    public OauthData OauthData;  
    public List<Integer> agreeList;  
  
    /**  
     *  
     * @param userData  
     * @param oauthData  
     */  
    public RegisterRequest(UserData userData, OauthData oauthData, List<Integer> agreeList) {  
        this.userData = userData;  
        OauthData = oauthData;  
        this.agreeList = agreeList;  
    }  
  
  
}  
  
  
</document_content>  
</document>  
<document index="50">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\ApiResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
public class ApiResponse<T> {  
    public STATUS status;  
    public String message; // status가 error일때만 사용됨  
    public T data;  
  
  
    public enum STATUS {  
        success,  // API 호출 성공  
        fail,   // 잘못된 데이터, 호출조건으로 인한 호출 거부  
        error // 서버 실행 중 에러발생  
    }  
}  
  
</document_content>  
</document>  
<document index="51">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\CheckDuplicationResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
import com.google.gson.annotations.SerializedName;  
import com.teamnova.assa.data.dto.data.UserData;  
  
import java.util.Map;  
  
public class CheckDuplicationResponse {  
    public String status;   // success or error  
    public String type;     // email or nickname  
    public String data;     // 요청 보낸 값  
    public boolean isDuplicated;  
  
    @SerializedName("login_type")  
    public UserData.LOGIN_TYPE loginType;  
    public Map<String, String[]> message;  
}  
  
</document_content>  
</document>  
<document index="52">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\DeleteAccountResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
public class DeleteAccountResponse {  
    public String status;  
    public String message;  
}  
  
</document_content>  
</document>  
<document index="53">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\FriendsRes.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
import com.teamnova.assa.data.dto.data.UserData;  
  
import java.util.List;  
  
public class FriendsRes {  
    public List<UserData> friendList;  
    public boolean noMoreItems;  
}  
  
</document_content>  
</document>  
<document index="54">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\LikeResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
public class LikeResponse {  
    public Boolean isLike;  
    public int likeCount;  
}  
  
</document_content>  
</document>  
<document index="55">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\LoginResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
import java.util.Map;  
  
public class LoginResponse {  
    public String token;  
    public String status;  
    public Map<String, String[]> messages;  
}  
  
</document_content>  
</document>  
<document index="56">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\LogoutResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
public class LogoutResponse {  
    public String status;  
    public String message;  
}  
  
</document_content>  
</document>  
<document index="57">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\PaginatedResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
import java.util.ArrayList;  
  
/**  
 * 게시물 목록 응답  
 */  
public class PaginatedResponse <T> {  
    public int current_page;  
    public ArrayList<T> data;  
    public String first_page_url;  
    public int from;  
    public int last_page;  
    public String last_page_url;  
    public ArrayList<Link> links;  
    public String next_page_url;  
    public String path;  
    public int per_page;  
    public String prev_page_url;  
    public int to;  
    public int total;  
  
  
}  
  
class Link{  
    public String url;  
    public String label;  
    public boolean active;  
}  
  
</document_content>  
</document>  
<document index="58">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\RefreshTokenResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
public class RefreshTokenResponse {  
    public String token;  
}  
  
</document_content>  
</document>  
<document index="59">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\RegisterResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
import com.teamnova.assa.data.dto.data.UserData;  
  
import java.util.Map;  
  
public class RegisterResponse {  
    public String status;                    // 성공, 실패 여부 표시  
    public UserData data;                   // 가입된 유저 정보  
    public String token;                    // access 토큰  
    public Map<String, String[]> messages;  // 에러 메시지  
  
    public String messagesToString(){  
        if(messages == null) return "";  
  
        StringBuilder builder = new StringBuilder();  
        builder.append("{");  
        for (Map.Entry<String, String[]> entry : messages.entrySet()) {  
            builder.append(entry.getKey());  
            builder.append("=");  
            builder.append("[");  
            for (int i = 0; i < entry.getValue().length; i++) {  
                builder.append(entry.getValue()[i]);  
                if (i < entry.getValue().length - 1) {  
                    builder.append(", ");  
                }  
            }  
            builder.append("]");  
            if (!messages.entrySet().iterator().hasNext()) {  
                builder.append("}");  
            } else {  
                builder.append(", ");  
            }  
        }  
        return builder.toString();  
    }  
  
}  
  
  
</document_content>  
</document>  
<document index="60">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\SearchResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
/**  
 * 검색결과 응답  
 */  
public class SearchResponse {  
    public Object data;  
}  
  
</document_content>  
</document>  
<document index="61">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\SingleLongResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
/**  
 * 단일 Long 데이터 받아오는 클래스  
 */  
public class SingleLongResponse {  
    private Long id;  
    public Long getId() {  
        return id;  
    }  
    public void setId(Long id) {  
        this.id = id;  
    }  
}  
  
</document_content>  
</document>  
<document index="62">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\SuccessResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
public class SuccessResponse {  
    public Boolean isSuccess;  
    public String message;  
}  
  
</document_content>  
</document>  
<document index="63">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\UpdateUserResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
import com.teamnova.assa.data.dto.data.UserData;  
  
public class UpdateUserResponse {  
    public UserData original;  
    public UserData updated;  
}  
  
</document_content>  
</document>  
<document index="64">  
<source>app/src/main/java\com\teamnova\assa\data\dto\response\UserIdResponse.java</source>  
<document_content>  
package com.teamnova.assa.data.dto.response;  
  
public class UserIdResponse {  
    public Long id;  
}  
  
</document_content>  
</document>  
<document index="65">  
<source>app/src/main/java\com\teamnova\assa\data\helper\ImagePickerHelper.java</source>  
<document_content>  
package com.teamnova.assa.data.helper;  
  
import android.content.Intent;  
import android.net.Uri;  
import android.provider.MediaStore;  
  
import androidx.activity.result.ActivityResultLauncher;  
import androidx.activity.result.contract.ActivityResultContracts;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.core.content.FileProvider;  
  
import java.io.File;  
import java.io.IOException;  
import java.text.SimpleDateFormat;  
import java.util.Date;  
import java.util.Locale;  
import java.util.function.Consumer;  
  
/**  
 * 이미지 선택(카메라 촬영, 앨범에서 선택)을 돕는 클래스  
 */  
public class ImagePickerHelper {  
    static final String TAG = ImagePickerHelper.class.getSimpleName();  
  
    private final AppCompatActivity activity;  
    private final Consumer<Uri> consumer;   // imageUr를 받고 처리할 콜백  
    private ActivityResultLauncher<Uri> cameraLauncher;  
    private ActivityResultLauncher<Intent> galleryLauncher;  
    private File cameraFile;  
  
    public ImagePickerHelper(AppCompatActivity activity, Consumer<Uri> consumer) {  
        this.activity = activity;  
        this.consumer = consumer;  
        registerLaunchers();  
    }  
  
    // 카메라, 앨범 런처 등록  
    private void registerLaunchers() {  
        cameraLauncher = activity.registerForActivityResult(new ActivityResultContracts.TakePicture(),  
                isSuccess -> {  
                    if (isSuccess) {  
                        Uri imageUri = FileProvider.getUriForFile(activity, activity.getPackageName() + ".provider", cameraFile);  
                        consumer.accept(imageUri);  
                    }  
                });  
  
        galleryLauncher = activity.registerForActivityResult(new ActivityResultContracts.StartActivityForResult(),  
                result -> {  
                    if (result.getResultCode() == AppCompatActivity.RESULT_OK && result.getData() != null) {  
                        Uri imageUri = result.getData().getData();  
                        if (imageUri != null) {  
                            consumer.accept(imageUri);  
                        }  
                    }  
                });  
    }  
  
    // 카메라 실행  
    public void launchCamera() {  
        // 카메라로 찍은 파일을 임시 파일에 저장한 후 그 Uri 사용  
        try {  
            // 현재 시간 기반으로 고유한 파일 이름 생성  
            String timeStamp = new SimpleDateFormat("yyyyMMdd_HHmmss", Locale.getDefault()).format(new Date());  
//            String imagePrefix = "camera_" + timeStamp + "_";  
            String imagePrefix = "camera_";  
            cameraFile = File.createTempFile(imagePrefix, ".jpg", activity.getCacheDir());  
        } catch (IOException e) {  
            e.printStackTrace();  
            return;  
        }  
        Uri photoUri = FileProvider.getUriForFile(activity, activity.getPackageName() + ".provider", cameraFile);  
        cameraLauncher.launch(photoUri);  
    }  
  
    // 앨범에서 선택  
    public void launchGallery() {  
        Intent galleryIntent = new Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);  
        galleryLauncher.launch(galleryIntent);  
    }  
  
}  
</document_content>  
</document>  
<document index="66">  
<source>app/src/main/java\com\teamnova\assa\data\helper\PostHelper.java</source>  
<document_content>  
package com.teamnova.assa.data.helper;  
  
  
import android.util.Log;  
  
import com.teamnova.assa.data.dto.request.LikeRequest;  
import com.teamnova.assa.data.dto.response.LikeResponse;  
import com.teamnova.assa.data.retrofit.clients.PostApiClient;  
  
import java.util.function.Consumer;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 게시물 기능과 관련된 재사용성 높은 메소드 모음  
 */  
public class PostHelper {  
    private static final String TAG = "PostHelper";  
    public enum TYPE {  
        POST,  
        COMMENT,  
        REPLY  
    }  
  
    /**  
     * 좋아요 토글  
     *  
     * @param type - 좋아요를 누르는 대상의 타입  
     * @param targetId   - 대상의 ID  
     */  
    public static void toggleLike(TYPE type, Long targetId, Consumer<LikeResponse> onSuccess) {  
        LikeRequest request = new LikeRequest();  
        request.type = type;  
        request.targetId = targetId;  
        request.userId = SPHelper.getUserId();  
  
        PostApiClient.getInstance().toggleLike(request).enqueue(new Callback<LikeResponse>() {  
            @Override  
            public void onResponse(Call<LikeResponse> call, Response<LikeResponse> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "onResponse: 요청 성공");  
                    onSuccess.accept(response.body());  
                } else {  
                    Log.d(TAG, "onResponse: 요청 에러");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<LikeResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
            }  
        });  
    }  
}  
  
</document_content>  
</document>  
<document index="67">  
<source>app/src/main/java\com\teamnova\assa\data\helper\SPHelper.java</source>  
<document_content>  
package com.teamnova.assa.data.helper;  
  
import android.content.Context;  
import android.content.SharedPreferences;  
import android.util.Log;  
  
/**  
 * SharedPreferences를 사용하기 쉽게 만든 클래스  
 */  
public class SPHelper {  
    private static final String TAG = SPHelper.class.getSimpleName();  
    private static SharedPreferences preferences;  
    private static SharedPreferences.Editor editor;  
  
    public static void init(Context context) {  
        preferences = context.getSharedPreferences("ASSA", Context.MODE_PRIVATE);  
        editor = preferences.edit();  
    }  
  
    /**  
     * 주어진 key 값이 없으면 데이터 추가  
     * 이미 존재하면 update  
     *  
     * @param k  
     * @param v  
     */  
    public static void put(String k, String v) {  
        Log.d(TAG, "put: k = " + k + ", v = " + v);  
        editor.putString(k, v);  
        editor.apply();  
    }  
  
    public static void put(Object k, Object v) {  
        Log.d(TAG, "put: k = " + k + ", v = " + v);  
        editor.putString(String.valueOf(k), String.valueOf(v));  
        editor.apply();  
    }  
  
    /**  
     * key값에 해당하는 value 반환  
     *  
     * @param k  
     * @return 비어있으면 null을 반환  
     */  
    public static String get(String k) {  
        Log.d(TAG, "get: k = " + k);  
        return preferences.getString(k, null);  
    }  
  
    public static String get(Object k) {  
        Log.d(TAG, "get: k = " + k);  
        return preferences.getString(k.toString(), null);  
    }  
  
    public static void remove(String k) {  
        Log.d(TAG, "remove: k = " + k);  
        editor.remove(k);  
        editor.apply();  
    }  
  
    public static void remove(Object k) {  
        Log.d(TAG, "remove: k = " + k);  
        editor.remove(k.toString());  
        editor.apply();  
    }  
  
    public static void setUserId(Long v) {  
        Log.d(TAG, "setUserId: v = " + v);  
        editor.putString(KEY.USER_ID.toString(), String.valueOf(v));  
        editor.apply();  
    }  
  
    public static Long getUserId() {  
        try {  
            Long id = Long.valueOf(preferences.getString(KEY.USER_ID.toString(), null));  
//            Log.d(TAG, "getUserId: id=" + id);  
            return id;  
        } catch (Exception e) {  
            return null;  
        }  
    }  
  
    public enum KEY {  
        USER_ID  
    }  
}  
  
</document_content>  
</document>  
<document index="68">  
<source>app/src/main/java\com\teamnova\assa\data\repository\LoginRepository.java</source>  
<document_content>  
package com.teamnova.assa.data.repository;  
  
public class LoginRepository {  
  
    /**  
     * 자동 로그인 시도  
     */  
    public void tryAutoLogin() {  
        // 서버에 현재 accessToken 달아서 로그인 요청  
  
    }  
  
}  
  
</document_content>  
</document>  
<document index="69">  
<source>app/src/main/java\com\teamnova\assa\data\repository\RegistrationRepository.java</source>  
<document_content>  
package com.teamnova.assa.data.repository;  
  
public class RegistrationRepository {  
}  
  
</document_content>  
</document>  
<document index="70">  
<source>app/src/main/java\com\teamnova\assa\data\repository\TokenRepository.java</source>  
<document_content>  
package com.teamnova.assa.data.repository;  
  
import android.util.Log;  
  
import com.teamnova.assa.data.helper.SPHelper;  
  
/**  
 * 액세스 토큰 관리  
 */  
public class TokenRepository {  
    private static final String TAG = "TokenRepository";  
    private static final String KEY = "token";  
  
    // 토큰 set  
    public static void setToken(String token){  
        Log.d(TAG, "setToken: 토큰을 저장함 " + token);  
        SPHelper.put(KEY, token);  
    }  
  
    /**  
     * 저장된 토큰을 가져옴  
     * @return null : 토큰이 없으면  
     */  
    public static String getToken(){  
        String ret = SPHelper.get(KEY);  
        Log.d(TAG, "getToken: 토큰을 꺼냄 " + ret);  
        return ret;  
    }  
  
    /**  
     * 저장된 토큰 제거  
     */  
    public static void removeToken(){  
        Log.d(TAG, "removeToken: 저장된 토큰을 제거함");  
        SPHelper.remove(KEY);  
    }  
  
}  
  
</document_content>  
</document>  
<document index="71">  
<source>app/src/main/java\com\teamnova\assa\data\repository\UserRepository.java</source>  
<document_content>  
package com.teamnova.assa.data.repository;  
  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
  
public class UserRepository {  
    private UsersApiClient userApi = UsersApiClient.getInstance();  
  
    // 로그인 여부 확인  
    public boolean isLogedin() {  
        return false;  
    }  
}  
  
</document_content>  
</document>  
<document index="72">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\LocalDateTimeDeserializer.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit;  
  
import com.google.gson.JsonDeserializationContext;  
import com.google.gson.JsonDeserializer;  
import com.google.gson.JsonElement;  
import com.google.gson.JsonParseException;  
  
import java.lang.reflect.Type;  
import java.time.LocalDateTime;  
import java.time.format.DateTimeFormatter;  
import java.time.format.DateTimeParseException;  
import java.util.Arrays;  
import java.util.List;  
  
public class LocalDateTimeDeserializer implements JsonDeserializer<LocalDateTime> {  
  
    // LocalDateTime 포맷팅 타입 두 가지  
    private static final List<DateTimeFormatter> DATE_TIME_FORMATTERS = Arrays.asList(  
            DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"),  
            DateTimeFormatter.ISO_DATE_TIME  
    );  
  
    // 형식에 맞는 문자열을 LocalDateTime 으로 변환  
    // 서버에서 시간 데이터 받아올 때 필요  
    @Override  
    public LocalDateTime deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context) throws JsonParseException {  
        String dateString = json.getAsString();  
  
        for (DateTimeFormatter formatter : DATE_TIME_FORMATTERS) {  
            try {  
                return LocalDateTime.parse(dateString, formatter);  
            } catch (DateTimeParseException e) {  
                // 에러 발생시 다음 포매터로 넘어감  
            }  
        }  
  
        throw new JsonParseException("Unable to parse date: " + dateString);  
    }  
}  
  
</document_content>  
</document>  
<document index="73">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\LoggingInterceptor.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit;  
  
import java.io.IOException;  
  
import okhttp3.Interceptor;  
import okhttp3.Request;  
import okhttp3.Response;  
import okhttp3.logging.HttpLoggingInterceptor;  
  
// 파일 바이너리는 로그찍지 않는 로거  
public class LoggingInterceptor implements Interceptor {  
  
    private final HttpLoggingInterceptor loggingInterceptor;  
  
    public LoggingInterceptor() {  
        loggingInterceptor = new HttpLoggingInterceptor();  
        loggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY); // 기본 로그 레벨  
    }  
  
    @Override  
    public Response intercept(Chain chain) throws IOException {  
        Request request = chain.request();  
  
        // 특정 조건에서 로그 레벨을 조정  
        if (request.url().encodedPath().contains("/upload")) { // 파일 업로드 경로를 식별  
            loggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BASIC); // 최소 로그만 기록  
        } else {  
            loggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY); // 다른 요청은 BODY 로그 기록  
        }  
  
        return loggingInterceptor.intercept(chain);  
    }  
}  
</document_content>  
</document>  
<document index="74">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\RetrofitInstance.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit;  
  
import com.google.gson.Gson;  
import com.google.gson.GsonBuilder;  
import com.teamnova.assa.BuildConfig;  
import com.teamnova.assa.data.retrofit.intercepter.TokenIntercepter;  
import com.teamnova.assa.data.retrofit.intercepter.TokenRefreshIntercepter;  
  
import java.time.LocalDateTime;  
  
import okhttp3.OkHttpClient;  
import okhttp3.logging.HttpLoggingInterceptor;  
import retrofit2.Retrofit;  
import retrofit2.converter.gson.GsonConverterFactory;  
  
/**  
 * Retrofit 인스턴스 싱글턴 클래스  
 */  
public class RetrofitInstance {  
    private static Retrofit retrofit = null;  
    private static final String BASE_URL = BuildConfig.BASE_URL;  
    public static final HttpLoggingInterceptor logger = new HttpLoggingInterceptor().setLevel(HttpLoggingInterceptor.Level.BODY);  
    private static final OkHttpClient client = new OkHttpClient.Builder()  
//            .addInterceptor(logger)                 // 통신 로그 남기기  
            .addInterceptor(new LoggingInterceptor()) // 파일 바이너리는 로그찍지 않는 로거  
            .addInterceptor(new TokenIntercepter()) // 헤더에 토큰 추가  
            .authenticator  (new TokenRefreshIntercepter()) // 토큰 만료시 재발급  
            .build();  
  
  
    public static Retrofit getInstance() {  
        if (retrofit == null) {  
            // String -> LocaDateTime 컨버터가 부착된 Gson 객체를 생성한다  
            Gson gson = new GsonBuilder()  
                    .registerTypeAdapter(LocalDateTime.class, new LocalDateTimeDeserializer())  
                    .serializeNulls()  
                    .create();  
  
            // 레트로핏 인스턴스 생성  
            retrofit = new Retrofit.Builder()  
                    .baseUrl(BASE_URL)  
                    .client(client)  
                    .addConverterFactory(GsonConverterFactory.create(gson))  
                    .build();  
        }  
        return retrofit;  
    }  
}  
  
</document_content>  
</document>  
<document index="75">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\AuthApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.ChangePasswordRequest;  
import com.teamnova.assa.data.dto.request.LoginRequest;  
import com.teamnova.assa.data.dto.request.RegisterRequest;  
import com.teamnova.assa.data.dto.response.DeleteAccountResponse;  
import com.teamnova.assa.data.dto.response.LoginResponse;  
import com.teamnova.assa.data.dto.response.LogoutResponse;  
import com.teamnova.assa.data.dto.response.RefreshTokenResponse;  
import com.teamnova.assa.data.dto.response.RegisterResponse;  
import com.teamnova.assa.data.dto.response.SuccessResponse;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.AuthService;  
  
import retrofit2.Call;  
  
/**  
 * 회원가입, 로그인, 로그아웃 등의 인증관련 api를 담당하는 클래스  
 */  
public class AuthApiClient {  
    private static AuthApiClient instance;  
    private AuthService service;  
  
    private AuthApiClient(){  
        service = RetrofitInstance.getInstance().create(AuthService.class);  
    }  
  
    public static AuthApiClient getInstance() {  
        if (instance == null) {  
            instance = new AuthApiClient();  
        }  
        return instance;  
    }  
  
    // 회원가입  
    public Call<RegisterResponse> register(RegisterRequest request) {  
        return service.register(request);  
    }  
  
    // 로그인  
    public Call<LoginResponse> login(LoginRequest request){  
        return service.login(request);  
    }  
  
    // 현재 로그인한 유저정보  
    public Call<UserData> me(){  
        return service.me();  
    }  
  
    // 토큰 재발급  
    public Call<RefreshTokenResponse> refresh(String token){  
        return service.refresh();  
    }  
  
    // 로그아웃  
    public Call<LogoutResponse> logout(){  
        return service.logout();  
    }  
  
    // 회원탈퇴  
    public Call<DeleteAccountResponse> deleteAccount(){  
        return service.deleteAccount();  
    }  
  
    // 자동로그인  
    public Call<LoginResponse> autoLogin(LoginRequest request){  
        return service.autoLogin(request);  
    }  
  
    // 비밀번호 변경  
    public Call<SuccessResponse> changePassword(ChangePasswordRequest request){  
        return service.changePassword(request);  
    }  
}  
  
</document_content>  
</document>  
<document index="76">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\BaseApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
/**  
 *  
 * @param <T> 서비스 인터페이스  
 */  
public class BaseApiClient <T> {  
  
    private final String TAG;  
    private BaseApiClient<T> instance;  
  
    protected BaseApiClient(Class<T> clazz){  
        this.TAG = clazz.getSimpleName();  
    }  
  
  
}  
  
</document_content>  
</document>  
<document index="77">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\ChatRoomApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.teamnova.assa.data.dto.data.ChatRoom2;  
import com.teamnova.assa.data.dto.request.CreateChatRoomRequest;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.ChatRoomService;  
  
import java.util.List;  
  
import retrofit2.Call;  
  
public class ChatRoomApiClient {  
    private static final String TAG = ChatRoomApiClient.class.getSimpleName();  
  
    private static ChatRoomApiClient instance;  
    private ChatRoomService service;  
  
    private ChatRoomApiClient(){  
        service = RetrofitInstance.getInstance().create(ChatRoomService.class);  
    }  
  
    public static ChatRoomApiClient getInstance() {  
        if (instance == null) {  
            instance = new ChatRoomApiClient();  
        }  
        return instance;  
    }  
  
    // 채팅방 생성  
    public Call<ChatRoom2> createOpenChatRoom(CreateChatRoomRequest request) {  
        return service.createChatRoom(request);  
    }  
  
    // 채팅방 정보 얻기  
    public Call<ChatRoom2> getChatRoomById(Long id) {  
        return service.getChatRoomById(id);  
    }  
  
    // 내가 속한 채팅방 리스트 얻기  
    public Call<List<ChatRoom2>> getMyChatRoomList(boolean isOpenChat) {  
        if(isOpenChat) return service.getMyOpenChatRooms();  
        else return null;// TODO 나중에 구현  
//        return service.getMyChatRoomList();  
    }  
}  
  
</document_content>  
</document>  
<document index="78">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\CommentApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.teamnova.assa.data.dto.data.Comment;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.CommentService;  
  
import retrofit2.Call;  
  
public class CommentApiClient {  
    private static final String TAG = CommentApiClient.class.getSimpleName();  
  
    private static CommentApiClient instance;  
    private CommentService service;  
  
    private CommentApiClient(){  
        service = RetrofitInstance.getInstance().create(CommentService.class);  
    }  
  
    public static CommentApiClient getInstance() {  
        if (instance == null) {  
            instance = new CommentApiClient();  
        }  
        return instance;  
    }  
  
    // 댓글 생성  
    public Call<Comment> createComment(Comment comment) {  
        return service.createComment(comment);  
    }  
  
    // 댓글 수정  
    public Call<Comment> updateComment(Comment comment) {  
        return service.updateComment(comment.getId(), comment);  
    }  
  
    // 댓글 삭제  
    public Call<Void> deleteComment(Long commentId) {  
        return service.deleteComment(commentId);  
    }  
}  
  
</document_content>  
</document>  
<document index="79">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\EmailApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.EmailService;  
  
import retrofit2.Call;  
  
// 서버에 email 전송 요청 보내기  
public class EmailApiClient {  
    private final String TAG = EmailApiClient.class.getName();  
    private EmailService service;  
  
    public EmailApiClient() {  
        // 인터페이스 구현체 생성  
        service = RetrofitInstance.getInstance().create(EmailService.class);  
    }  
  
    /**  
     * 이메일 전송 요청 메소드  
     * 서버로 사용자가 입력한 이메일 주소로 인증코드를 전송하도록 요청합니다.  
     * 요청과 동시에 발송한 인증코드를 받아옵니다.  
     * @param email 이메일 주소  
     * @return 인증코드  
     */  
    public Call<Integer> sendEmail(String email) {  
        return service.sendEmail(email);  
    }  
}  
  
</document_content>  
</document>  
<document index="80">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\PostApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.request.LikeRequest;  
import com.teamnova.assa.data.dto.response.LikeResponse;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.dto.response.SingleLongResponse;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.PostService;  
  
import retrofit2.Call;  
  
public class PostApiClient {  
    private static final String TAG = PostApiClient.class.getSimpleName();  
  
    private static PostApiClient instance;  
    private final PostService service;  
  
    private PostApiClient() {  
        service = RetrofitInstance.getInstance().create(PostService.class);  
    }  
  
    public static PostApiClient getInstance() {  
        if (instance == null) {  
            instance = new PostApiClient();  
        }  
        return instance;  
    }  
  
    // 게시물 생성  
    public Call<SingleLongResponse> createPost(Post post) {  
        return service.createPost(post);  
    }  
  
    // 게시물 목록 요청  
    public Call<PaginatedResponse<Post>> getPosts() {  
        return service.getPosts();  
    }  
  
    // 게시물 목록 요청  
    public Call<PaginatedResponse<Post>> getFollowingsPosts() {  
        return service.getFollowingsPosts();  
    }  
  
    // 게시물 상세 데이터  
    public Call<Post> getPost(Long id) {  
        return service.getPost(id);  
    }  
  
    // 게시물 수정  
    public Call<Void> updatePost(Post post) {  
        return service.updatePost(post);  
    }  
  
    // 게시물 삭제  
    public Call<Void> deletePost(Long id) {  
        return service.deletePost(id);  
    }  
  
    // 좋아요 토글  
    public Call<LikeResponse> toggleLike(LikeRequest request) {  
        return service.toggleLike(request);  
    }  
}  
  
</document_content>  
</document>  
<document index="81">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\ReplyApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.teamnova.assa.data.dto.data.Reply;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.ReplyService;  
  
import retrofit2.Call;  
  
public class ReplyApiClient {  
    private static final String TAG = ReplyApiClient.class.getSimpleName();  
  
    private static ReplyApiClient instance;  
    private ReplyService service;  
  
    private ReplyApiClient(){  
        service = RetrofitInstance.getInstance().create(ReplyService.class);  
    }  
  
    public static ReplyApiClient getInstance() {  
        if (instance == null) {  
            instance = new ReplyApiClient();  
        }  
        return instance;  
    }  
  
    // 덧글 생성  
    public Call<Reply> createReply(Reply reply) {  
        return service.createReply(reply);  
    }  
  
    // 덧글 수정  
    public Call<Void> updateReply(Reply comment) {  
        return service.updateReply(comment.getId(), comment);  
    }  
  
    // 덧글 삭제  
    public Call<Void> deleteReply(Long commentId) {  
        return service.deleteReply(commentId);  
    }  
}  
  
</document_content>  
</document>  
<document index="82">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\SearchApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.dto.response.SearchResponse;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.SearchService;  
  
import java.util.List;  
  
import retrofit2.Call;  
  
public class SearchApiClient {  
  
    private static final String TAG = SearchApiClient.class.getSimpleName();  
    private SearchService service;  
  
    private static SearchApiClient instance;  
  
    private SearchApiClient() {  
        service = RetrofitInstance.getInstance().create(SearchService.class);  
    }  
  
    public static SearchApiClient getInstance() {  
        if (instance == null) {  
            instance = new SearchApiClient();  
        }  
        return instance;  
    }  
  
    /**  
     * @param type  authorId | post | chatTitle | nickname  
     * @param query  
     * @return  
     */  
    public Call<SearchResponse> search(String type, String query) {  
        return service.search(type, query);  
    }  
  
    public Call<PaginatedResponse<Post>> searchPostsByUserId(String query) {  
        String type = "authorId";  
        return service.searchUserPosts(type, query);  
    }  
  
    public Call<PaginatedResponse<Post>> searchPostsByContent(String query) {  
        String type = "post";  
        if (query == null) query = "";  
        return service.searchUserPosts(type, query);  
    }  
  
    public Call<List<ChatRoom>> searchOpenChatByRoomName(String query) {  
        String type = "roomName";  
        if (query == null) query = "";  
        return service.searchOpenChatByName(type, query);  
    }  
  
    public Call<ChatRoom> searchOpenChatByRoomId(long roomId) {  
        String type = "roomId";  
        if (roomId <= 0) return null;  
        return service.searchOpenChatByRoomId(type, roomId);  
    }  
  
    public Call<PaginatedResponse<UserData>> searchUserByNickname(String query) {  
        String type = "nickname";  
        return service.searchUser(type, query);  
    }  
}  
  
</document_content>  
</document>  
<document index="83">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\TermsApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import android.util.Log;  
import android.view.View;  
import android.widget.TextView;  
  
import com.teamnova.assa.data.dto.data.Terms;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.TermsService;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class TermsApiClient {  
    private String TAG = TermsApiClient.class.getName();  
    private TermsService service;  
  
    public TermsApiClient() {  
        // 인터페이스 구현체 생성  
        service = RetrofitInstance.getInstance().create(TermsService.class);  
    }  
  
    public void loadTerms(View v, String title) {  
  
        // 요청 전송  
        Call<Terms> call = service.loadTerms(title);  
  
        // 응답처리  
        call.enqueue(new Callback<Terms>() {  
            @Override  
            public void onResponse(Call<Terms> call, Response<Terms> response) {  
                if (response.isSuccessful()) {  
                    // 응답코드 code >= 200 && code < 300  
                    Terms terms = response.body();  
                    if (terms == null) terms = new Terms();  
  
                    // 여기서 바로 출력한다  
                    ((TextView) v).setText(terms.text);  
  
                    Log.d(TAG, "onResponse: 성공 - " + terms);  
                } else {  
                    // 응답 코드 200 외  
                    Log.d(TAG, "onResponse: 실패 - " + response);  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Terms> call, Throwable throwable) {  
                // 통신 실패 (인터넷 끊김, 예외 발생 등 시스템적 실패)  
                Log.d(TAG, "onFailure: " + throwable.getMessage());  
            }  
        });  
    }  
}  
  
</document_content>  
</document>  
<document index="84">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\UserDuplicateCheckApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.UserDuplicateeCheckService;  
  
import retrofit2.Call;  
  
/**  
 * 중복된 사용자인지 확인하기 위한 api  
 */  
public class UserDuplicateCheckApiClient {  
  
    private final String TAG = TermsApiClient.class.getName();  
    private UserDuplicateeCheckService service;  
  
    public UserDuplicateCheckApiClient() {  
        // 인터페이스 구현체 생성  
        service = RetrofitInstance.getInstance().create(UserDuplicateeCheckService.class);  
    }  
  
    /**  
     * 중복이면 true 반환  
     * @param colunm "nickname" or "email"  
     * @param input  
     * @return  
     */  
    public Call<Boolean> isDuplicate(String colunm, String input) {  
        return service.isDuplicate(colunm, input);  
    }  
}  
  
</document_content>  
</document>  
<document index="85">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\UserRelationApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.teamnova.assa.data.dto.data.Follow;  
import com.teamnova.assa.data.dto.data.Friend;  
import com.teamnova.assa.data.dto.response.FriendsRes;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.UserRelationService;  
  
import java.util.List;  
  
import retrofit2.Call;  
  
public class UserRelationApiClient {  
    private static final String TAG = UserRelationApiClient.class.getSimpleName();  
    private UserRelationService service;  
  
    private static UserRelationApiClient instance;  
  
    private UserRelationApiClient() {  
        service = RetrofitInstance.getInstance().create(UserRelationService.class);  
    }  
  
    public static UserRelationApiClient getInstance() {  
        if (instance == null) {  
            instance = new UserRelationApiClient();  
        }  
        return instance;  
    }  
  
    public Call<Void> follow(Long userId) {  
        return service.follow(new Follow(SPHelper.getUserId(), userId));  
    }  
  
    public Call<Void> unfollow(Long userId) {  
        return service.unfollow(new Follow(SPHelper.getUserId(), userId));  
    }  
  
    // 친구신청  
    public Call<Friend> requestForFriend(Long userId) {  
        Friend request = new Friend(SPHelper.getUserId(), userId);  
        return service.requestForFriend(request);  
    }  
  
    // 친구신청 취소  
    public Call<Void> cancelRequestForFriend(Long userId) {  
        Friend request = new Friend(SPHelper.getUserId(), userId);  
        return service.cancelRequestForFriend(request);  
    }  
  
    public Call<List<Friend>> getFriendRequests() {  
        return service.getFriendRequests();  
    }  
  
    // 친구신청 수락  
    public Call<Void> acceptFriendRequest(Friend friend) {  
        return service.acceptRequestForFriend(friend);  
    }  
  
    // 친구신청 거부  
    public Call<Void> rejectFriendRequest(Friend friend) {  
        return service.rejectRequestForFriend(friend);  
    }  
  
    // 친구관계 해제  
    public Call<Void> unfriend(Long userId) {  
//        if(userData.friendRequestState == Friend.FRIEND_REQUEST_STATE.NONE){  
//            // 친구인데 요청상태가 none이면 내가 친구 신청을 받아 맺은 관계  
//        }  
        Friend request = new Friend(SPHelper.getUserId(), userId);  
        return service.unFriend(request);  
    }  
  
    // 친구목록 불러오기  
    public Call<FriendsRes> getFriends(Long userId, int nextPosition) {  
        return service.getFriends(userId, nextPosition);  
    }  
}  
  
</document_content>  
</document>  
<document index="86">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\clients\UsersApiClient.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.clients;  
  
import com.google.gson.JsonElement;  
import com.teamnova.assa.data.dto.data.OauthData;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.LoginRequest;  
import com.teamnova.assa.data.dto.request.PasswordRequest;  
import com.teamnova.assa.data.dto.response.CheckDuplicationResponse;  
import com.teamnova.assa.data.dto.response.LoginResponse;  
import com.teamnova.assa.data.dto.response.UpdateUserResponse;  
import com.teamnova.assa.data.dto.response.UserIdResponse;  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.UserService;  
import com.teamnova.assa.util.RetrofitUtils;  
import com.teamnova.assa.util.Utils;  
  
import java.io.File;  
import java.util.Map;  
  
import okhttp3.MediaType;  
import okhttp3.MultipartBody;  
import okhttp3.RequestBody;  
import okhttp3.ResponseBody;  
import retrofit2.Call;  
  
/**  
 * Users와 관련된 서버 통신 담당, 싱글턴  
 */  
public class UsersApiClient {  
    private final String TAG = TermsApiClient.class.getName();  
  
    private static UsersApiClient instance;  
    private final UserService service;  
  
    public static UsersApiClient getInstance() {  
        if (instance == null) {  
            instance = new UsersApiClient();  
        }  
        return instance;  
    }  
  
    private UsersApiClient() {  
        service = RetrofitInstance.getInstance().create(UserService.class);  
    }  
  
    /**  
     * 주어진 값을 가진 유저가 있는지 확인하는 메소드  
     *  
     * @param type - 'email' or 'nickname' or 'oauth'  
     * @param data - 각 타입에 적합한 값  
     * @return  
     */  
    public Call<CheckDuplicationResponse> checkDuplication(String type, String data) {  
        return service.check(type, data);  
    }  
  
    public Call<UserIdResponse> getUserIdByEmail(String email) {  
        return service.getUserIdByEmail(email);  
    }  
  
    public Call<UserData> getUserById(Long id) {  
        return service.getUserById(id);  
    }  
  
    public Call<UserData> getUserByIdSimple(Long id) {  
        return service.getUserByIdSimple(id);  
    }  
  
    /**  
     * 유저 정보 수정  
     *  
     * @param id  
     * @param password  
     * @return  
     */  
    public Call<UpdateUserResponse> resetPassword(Long id, String password) {  
        return service.resetPassword(id, new PasswordRequest(password));  
    }  
  
    /**  
     * 사용자 정보 업데이트  
     *  
     * @param id  
     * @param userData  
     * @return  
     */  
    public Call<UpdateUserResponse> updateUser(Long id, UserData userData, File profileImageFile) {  
  
        // userData를 JSON으로 변환  
        String jsonUserData = Utils.getGsonInstance().toJson(userData);  
  
        // JSON에 대한 RequestBody 만들기  
        RequestBody userDataBody = RequestBody.create(MediaType.parse("application/json; charset=utf-8"), jsonUserData);  
  
        // 파일에 대한 RequestBody 및 MultipartBody.Part 생성  
        MultipartBody.Part filePart = RetrofitUtils.convertFileToPart("profileImageFile", profileImageFile);  
  
        return service.updateUser(id, userDataBody, filePart);  
    }  
  
  
    // 회원가입 메소드  
    public Call<UserData> signUp(UserData userData) {  
        return service.signUp(userData);  
    }  
  
    /**  
     * 로그인  
     *  
     * @param request  
     * @return  
     */  
    public Call<LoginResponse> logIn(LoginRequest request) {  
        return service.logIn(request);  
    }  
  
    /**  
     * 인자로 주어진 값을 가진 유저가 서비스에 이미 존재하는지 확인하는 함수  
     *  
     * @return 찾은 유저 목록  
     */  
    public Call<JsonElement> getUsers(Map<String, String> queryMap) {  
        return service.getUsers(queryMap);  
    }  
  
    /**  
     * oauth 정보 추가  
     *  
     * @param userData  
     * @return  
     */  
    public Call<OauthData> insertOauth(OauthData userData) {  
        return service.insertOauth(userData);  
    }  
  
  
    /**  
     * 카카오 로그인  
     *  
     * @param map authId, provider, email 담은 map  
     * @return  
     */  
    public Call<ResponseBody> authWithKakao(Map<String, String> map) {  
        return service.loginWithKakao(map);  
    }  
  
  
    public Call<ResponseBody> logout() {  
        return service.logout();  
    }  
  
    public Call<ResponseBody> deleteAccount() {  
        return service.deleteAccount();  
    }  
  
}  
  
</document_content>  
</document>  
<document index="87">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\intercepter\TokenIntercepter.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.intercepter;  
  
import android.util.Log;  
  
import androidx.annotation.NonNull;  
  
import com.teamnova.assa.data.repository.TokenRepository;  
import com.teamnova.assa.util.TempStorage;  
  
import java.io.IOException;  
  
import okhttp3.Interceptor;  
import okhttp3.Request;  
import okhttp3.Response;  
  
public class TokenIntercepter implements Interceptor {  
  
    private static final String TAG = "TokenIntercepter";  
    @NonNull  
    @Override  
    public Response intercept(@NonNull Chain chain) throws IOException {  
        String token = TokenRepository.getToken();  
        Request request;  
  
        if(token != null){  
            // 기기에 저장된 토큰이 있으면 요청 헤더에 토큰 추가  
            request = chain.request().newBuilder()  
                    .addHeader("Authorization", "Bearer " + token)  
                    .build();  
            Log.d(TAG, "intercept: 기기에 저장된 토큰 있음 request : " + request);  
        } else {  
            // 토큰 없으면 원래 요청진행  
            request = chain.request();  
            Log.d(TAG, "intercept: 기기에 저장된 토큰 없음 request : " + request);  
        }  
  
        Log.d(TAG, "intercept: 최초 요청 " + request);  
  
        // 최초의 요청정보를 담은 requst 객체는 TokenRefreshIntercepter에서 원래 목적지를 기억할 때 사용됨  
        TempStorage.setItem("intercepter", request);  
        Response response = chain.proceed(request);  
  
        return response;  
    }  
}  
  
</document_content>  
</document>  
<document index="88">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\intercepter\TokenRefreshIntercepter.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.intercepter;  
  
import android.util.Log;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
  
import com.teamnova.assa.BuildConfig;  
import com.teamnova.assa.data.repository.TokenRepository;  
import com.teamnova.assa.util.TempStorage;  
import com.teamnova.assa.util.Utils;  
  
import java.io.IOException;  
import java.util.Map;  
  
import okhttp3.Authenticator;  
import okhttp3.OkHttpClient;  
import okhttp3.Request;  
import okhttp3.Response;  
import okhttp3.Route;  
import okhttp3.logging.HttpLoggingInterceptor;  
  
/**  
 * 만료된 토큰을 재발급하기 위한 인터셉터  
 * HTTP 401 error code를 응답받으면 자동으로 호출된다.  
 */  
public class TokenRefreshIntercepter implements Authenticator {  
    private static final String TAG = TokenRefreshIntercepter.class.getSimpleName();  
  
    @Nullable  
    @Override  
    public Request authenticate(@Nullable Route route, @NonNull Response response) throws IOException {  
        // 요청객체 가져오기  
        // 주의 : unauthrized 라우터에서 응답한 401을 같은주소로 재접속을 시도하므로 계속 unauthrized 라우터로 접속하게 된다.  
//        Request request = response.request();  
        Log.d(TAG, "서버에서 401 응답해서 Authenticator 가 작동함 response : " + response);  
  
        // 인터셉터에서 저장해둔 request정보를 사용한다.  
        Request request = (Request) TempStorage.getItem("intercepter");  
        Log.d(TAG, "authenticate: 원래 요청 " + request);  
  
        // 원래 요청에 Authorization 헤더가 없으면 인증처리 안함  
        if (request.header("Authorization") == null || request.header("Authorization").isEmpty()) {  
            Log.d(TAG, "authenticate: 요청에 Authorization 헤더가 없음");  
            return null;  
        }  
  
        // 저장된 토큰 가져오기  
        String token = TokenRepository.getToken();  
  
        // 기존 토큰으로 토큰 재발급 API 요청 생성  
        // 이것은 서버에서 사용하고 있는 dymon/jwt-auth 라이브러리의 구현방식에 따른 것임  
        Request refreshRequest = new Request.Builder()  
                .url(BuildConfig.BASE_URL + "/api/auth/refresh")  
                .get()  
                .addHeader("Authorization", "Bearer " + token)     // 토큰 추가  
                .build();  
  
        // 토큰 재발급 API 요청  
        // 인터셉터 적용을 피하기 위해 별도의 클라이언트 생성후 요청  
        OkHttpClient client = new OkHttpClient().newBuilder()  
                .addInterceptor(new HttpLoggingInterceptor().setLevel(HttpLoggingInterceptor.Level.BODY))  
                .build();  
  
        Response refreshResponse = client.newCall(refreshRequest).execute();  
        Log.d(TAG, "authenticate: 토큰 재발급 응답 " + refreshResponse);  
  
        // 재발급 성공  
        if (refreshResponse.isSuccessful()) {  
            // responseBody의 token 값 추출  
            Map<String, Object> refreshResponseJson = Utils.getGsonInstance().fromJson(refreshResponse.body().string(), Map.class);  
  
            String newToken = refreshResponseJson.get("token").toString();  
            Log.d(TAG, "authenticate: 재발급 성공 " + newToken);  
  
            // 재발급 성공 시, 저장된 토큰 갱신  
            TokenRepository.setToken(newToken);  
  
            // 기존 토큰은 제거 후 새로운 토큰으로 교체  
            // Request 객체는 불변이기 때문에 기존객체에 변경내역을 반영하여 복사한다  
            Request newRequest = request.newBuilder()  
                    .removeHeader("Authorization")  // 기존 요청 헤더의 토큰 제거  
                    .header("Authorization", "Bearer " + newToken)  
                    .build();  
  
            Log.d(TAG, "authenticate: 새로 생성된 요청 " + newRequest);  
  
            return newRequest;  
        } else {  
            // 재발급 실패 시, 토큰 삭제(요청 무한반복 방지)  
            TokenRepository.removeToken();  
            Log.d(TAG, "authenticate: 재발급 실패");  
        }  
  
        return null;  
    }  
}  
  
</document_content>  
</document>  
<document index="89">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\AuthService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.ChangePasswordRequest;  
import com.teamnova.assa.data.dto.request.LoginRequest;  
import com.teamnova.assa.data.dto.request.RegisterRequest;  
import com.teamnova.assa.data.dto.response.DeleteAccountResponse;  
import com.teamnova.assa.data.dto.response.LoginResponse;  
import com.teamnova.assa.data.dto.response.LogoutResponse;  
import com.teamnova.assa.data.dto.response.RefreshTokenResponse;  
import com.teamnova.assa.data.dto.response.RegisterResponse;  
import com.teamnova.assa.data.dto.response.SuccessResponse;  
  
import retrofit2.Call;  
import retrofit2.http.Body;  
import retrofit2.http.GET;  
import retrofit2.http.POST;  
  
public interface AuthService {  
  
    @GET("/api/auth/me")  
    Call<UserData> me();                                                // 현재 유저 정보  
  
    @GET("/api/auth/refresh")  
    Call<RefreshTokenResponse> refresh();                               // 토큰 재발급  
    @GET("/api/auth/logout")  
    Call<LogoutResponse> logout();                                      // 로그아웃  
  
  
    @POST("/api/auth/register")  
    Call<RegisterResponse> register(@Body RegisterRequest request);     // 회원가입  
  
    @POST("/api/auth/login")  
    Call<LoginResponse> login(@Body LoginRequest loginRequest);         // 로그인  
  
    @POST("/api/auth/deleteAccount")  
    Call<DeleteAccountResponse> deleteAccount();         // 회원탈퇴  
    @POST("/api/auth/autoLogin")  
    Call<LoginResponse> autoLogin(@Body LoginRequest request);         // 자동로그인  
  
    @POST("/api/auth/changePassword")  
    Call<SuccessResponse> changePassword(@Body ChangePasswordRequest request);   // 비밀번호 변경  
  
//    @POST("/api/oauth")  
//    Call<OauthUserData> insertOauth(@Body OauthUserData oauthUserData);  
//  
//    @POST("/api/users/kakao")  
//    Call<ResponseBody> loginWithKakao(@Body Map<String, String> map);  
//    @POST("/api/users/logout")  
//    Call<ResponseBody> logout();  
//    @POST("/api/users/deleteAccount")  
//    Call<ResponseBody> deleteAccount();  
}  
  
</document_content>  
</document>  
<document index="90">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\ChatRoomService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.teamnova.assa.data.dto.data.ChatRoom2;  
import com.teamnova.assa.data.dto.request.CreateChatRoomRequest;  
  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.http.Body;  
import retrofit2.http.GET;  
import retrofit2.http.POST;  
import retrofit2.http.Path;  
  
/**  
 * 채팅방 관련 요청 모음  
 */  
public interface ChatRoomService {  
    // 채팅방 생성  
    @POST("/api/chatroom/create")  
    Call<ChatRoom2> createChatRoom(@Body CreateChatRoomRequest request);  
  
    // 주어진 id의 채팅방 정보 가죠오기  
    @GET("/api/chatroom/{id}")  
    Call<ChatRoom2> getChatRoomById(@Path("id") Long id);  
  
    // 내가 속한 채팅방들의 목록 가져오기  
    @GET("/api/chatroom/open/my")  
    Call<List<ChatRoom2>> getMyOpenChatRooms();  
}  
  
</document_content>  
</document>  
<document index="91">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\CommentService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.teamnova.assa.data.dto.data.Comment;  
  
import retrofit2.Call;  
import retrofit2.http.Body;  
import retrofit2.http.DELETE;  
import retrofit2.http.POST;  
import retrofit2.http.PUT;  
import retrofit2.http.Path;  
  
/**  
 * 댓글 기능과 관련된 api 요청 모음  
 */  
public interface CommentService {  
  
    @POST("/api/comment/create")  
    Call<Comment> createComment(@Body Comment comment);  
  
    @PUT("/api/comment/update/{commentId}")  
    Call<Comment> updateComment(@Path("commentId") Long commentId, @Body Comment comment);  
    @DELETE("/api/comment/delete/{commentId}")  
    Call<Void> deleteComment(@Path("commentId") Long commentId);  
  
}  
  
</document_content>  
</document>  
<document index="92">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\EmailService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import retrofit2.Call;  
import retrofit2.http.Field;  
import retrofit2.http.FormUrlEncoded;  
import retrofit2.http.POST;  
  
public interface EmailService {  
  
    @FormUrlEncoded  
    @POST("/api/emailSend")  
    Call<Integer> sendEmail(@Field("email") String email);  
  
}  
  
</document_content>  
</document>  
<document index="93">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\FileService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import java.util.List;  
  
import okhttp3.MultipartBody;  
import okhttp3.ResponseBody;  
import retrofit2.Call;  
import retrofit2.http.Multipart;  
import retrofit2.http.POST;  
import retrofit2.http.Part;  
  
public interface FileService {  
  
    @Multipart  
    @POST("/api/uploadFiles")  
    Call<ResponseBody> uploadFiles(@Part List<MultipartBody.Part> files);  
}  
  
</document_content>  
</document>  
<document index="94">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\PostService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.request.LikeRequest;  
import com.teamnova.assa.data.dto.response.LikeResponse;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.dto.response.SingleLongResponse;  
  
import retrofit2.Call;  
import retrofit2.http.Body;  
import retrofit2.http.Field;  
import retrofit2.http.FormUrlEncoded;  
import retrofit2.http.GET;  
import retrofit2.http.POST;  
import retrofit2.http.Path;  
  
/**  
 * 게시물 기능과 관련된 api 요청 모음  
 */  
public interface PostService {  
  
    @POST("/api/post/create")  
    Call<SingleLongResponse> createPost(@Body Post post);  
    @GET("/api/post")  
    Call<PaginatedResponse<Post>> getPosts();  
    @GET("/api/post/following")  
    Call<PaginatedResponse<Post>> getFollowingsPosts();  
    @GET("/api/post/{postId}")  
    Call<Post> getPost(@Path("postId") long postId);  
    @POST("/api/post/update")  
    Call<Void> updatePost(@Body Post post);  
    @FormUrlEncoded  
    @POST("/api/post/delete")  
    Call<Void> deletePost(@Field("postId") Long postId);  
    @POST("/api/post/toggle-like")  
    Call<LikeResponse> toggleLike(@Body LikeRequest request);  
}  
  
</document_content>  
</document>  
<document index="95">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\ReplyService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.teamnova.assa.data.dto.data.Reply;  
  
import retrofit2.Call;  
import retrofit2.http.Body;  
import retrofit2.http.DELETE;  
import retrofit2.http.POST;  
import retrofit2.http.PUT;  
import retrofit2.http.Path;  
  
/**  
 * 덧글 기능과 관련된 api 요청 모음  
 */  
public interface ReplyService {  
  
    @POST("/api/reply/create")  
    Call<Reply> createReply(@Body Reply reply);  
  
    @PUT("/api/reply/update/{replyId}")  
    Call<Void> updateReply(@Path("replyId") Long replyId, @Body Reply reply);  
    @DELETE("/api/reply/delete/{replyId}")  
    Call<Void> deleteReply(@Path("replyId") Long replyId);  
  
}  
  
</document_content>  
</document>  
<document index="96">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\SearchService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.dto.response.SearchResponse;  
  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.http.GET;  
import retrofit2.http.Query;  
  
public interface SearchService {  
    @GET("/api/search")  
    Call<SearchResponse> search(@Query("type") String type, @Query("q") String query);  
  
    // 게시물 검색  
    @GET("/api/search")  
    Call<PaginatedResponse<Post>> searchUserPosts(@Query("type") String type, @Query("q") String query);  
  
    // 유저 검색  
    @GET("/api/search")  
    Call<PaginatedResponse<UserData>> searchUser(@Query("type") String type, @Query("q") String query);  
  
    // 오픈 채팅방 검색  
    @GET("/api/search")  
    Call<List<ChatRoom>> searchOpenChatByName(@Query("type") String type, @Query("q") String query);  
  
    @GET("/api/search")  
    Call<ChatRoom> searchOpenChatByRoomId(@Query("type") String type, @Query("q") Long query);  
  
}  
  
</document_content>  
</document>  
<document index="97">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\TermsService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.teamnova.assa.data.dto.data.Terms;  
  
import retrofit2.Call;  
import retrofit2.http.GET;  
import retrofit2.http.Path;  
  
/**  
 * 약관 데이터 불러오기용 Retrofit Interface  
 */  
public interface TermsService {  
    @GET("/api/terms/{title}")  
    Call<Terms> loadTerms(@Path("title") String title);  
}  
  
</document_content>  
</document>  
<document index="98">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\UserDuplicateeCheckService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import retrofit2.Call;  
import retrofit2.http.GET;  
import retrofit2.http.Path;  
  
/**  
 * 사용자 정보 중복 체크용 Retrofit Interface  
 */  
public interface UserDuplicateeCheckService {  
    @GET("/api/duplicate-check/user/{column}/{input}")  
    Call<Boolean> isDuplicate(@Path("column") String column, @Path("input") String input);  
}  
  
</document_content>  
</document>  
<document index="99">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\UserRelationService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.teamnova.assa.data.dto.data.Follow;  
import com.teamnova.assa.data.dto.data.Friend;  
import com.teamnova.assa.data.dto.response.FriendsRes;  
  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.http.Body;  
import retrofit2.http.Field;  
import retrofit2.http.FormUrlEncoded;  
import retrofit2.http.GET;  
import retrofit2.http.POST;  
  
/**  
 * 사용자 간의 관계(팔로우, 친구, 차단) api 정의  
 */  
public interface UserRelationService {  
  
    @POST("/api/follow")  
    Call<Void> follow(@Body Follow request);  
  
    @POST("/api/unfollow")  
    Call<Void> unfollow(@Body Follow request);  
  
    @GET("/api/friend/request")  
    Call<List<Friend>> getFriendRequests();  
  
    @POST("/api/friend/request")  
    Call<Friend> requestForFriend(@Body Friend request);  
  
    @POST("/api/friend/request-cancel")  
    Call<Void> cancelRequestForFriend(@Body Friend request);  
  
    @POST("/api/friend/accept")  
    Call<Void> acceptRequestForFriend(@Body Friend request);  
  
    @POST("/api/friend/reject")  
    Call<Void> rejectRequestForFriend(@Body Friend request);  
  
    @POST("/api/friend/unfriend")  
    Call<Void> unFriend(@Body Friend request);  
  
    @FormUrlEncoded  
    @POST("/api/friend")  
    Call<FriendsRes> getFriends(  
            @Field("userId") Long userId,  
            @Field("nextPosition") int nextPosition  
    );  
}  
  
</document_content>  
</document>  
<document index="100">  
<source>app/src/main/java\com\teamnova\assa\data\retrofit\interfaces\UserService.java</source>  
<document_content>  
package com.teamnova.assa.data.retrofit.interfaces;  
  
import com.google.gson.JsonElement;  
import com.teamnova.assa.data.dto.data.OauthData;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.LoginRequest;  
import com.teamnova.assa.data.dto.request.PasswordRequest;  
import com.teamnova.assa.data.dto.response.CheckDuplicationResponse;  
import com.teamnova.assa.data.dto.response.LoginResponse;  
import com.teamnova.assa.data.dto.response.UpdateUserResponse;  
import com.teamnova.assa.data.dto.response.UserIdResponse;  
  
import java.util.Map;  
  
import okhttp3.MultipartBody;  
import okhttp3.RequestBody;  
import okhttp3.ResponseBody;  
import retrofit2.Call;  
import retrofit2.http.Body;  
import retrofit2.http.GET;  
import retrofit2.http.Multipart;  
import retrofit2.http.POST;  
import retrofit2.http.PUT;  
import retrofit2.http.Part;  
import retrofit2.http.Path;  
import retrofit2.http.Query;  
import retrofit2.http.QueryMap;  
  
/**  
 * 사용자와 관련된 통신을 담당하는 retrofit 서비스  
 */  
public interface UserService {  
    @GET("/api/users/check")  
    Call<CheckDuplicationResponse> check(@Query("type") String type, @Query("data") String data);  
  
    @GET("/api/users")  
    Call<UserIdResponse> getUserIdByEmail(@Query("email") String email);  
  
    @GET("/api/users/{id}")  
    Call<UserData> getUserById(@Path("id") Long id);  
  
    @POST("/api/users/simple")  
    Call<UserData> getUserByIdSimple(Long id);  
  
    @PUT("/api/reset-password/{id}")  
    Call<UpdateUserResponse> resetPassword(@Path("id") Long id, @Body PasswordRequest password);  
  
    @Multipart  
    @POST("/api/users/{id}")  
    Call<UpdateUserResponse> updateUser(  
            @Path("id") Long id,  
            @Part("userData") RequestBody userData,  
            @Part MultipartBody.Part profileImageFile  
    );  
  
    @POST("/api/users/signup")  
        // 회원가입  
    Call<UserData> signUp(@Body UserData userData);  
  
    @POST("/api/users/login")  
        // 로그인  
    Call<LoginResponse> logIn(@Body LoginRequest loginRequest);  
  
  
    @POST("/api/oauth")  
    Call<OauthData> insertOauth(@Body OauthData oauthData);  
  
    @GET("/api/users")  
    Call<JsonElement> getUsers(@QueryMap Map<String, String> queryMap);  
  
  
    @POST("/api/users/kakao")  
    Call<ResponseBody> loginWithKakao(@Body Map<String, String> map);  
  
    @POST("/api/users/logout")  
    Call<ResponseBody> logout();  
  
    @POST("/api/users/deleteAccount")  
    Call<ResponseBody> deleteAccount();  
}  
  
</document_content>  
</document>  
<document index="101">  
<source>app/src/main/java\com\teamnova\assa\domain\Authentication.java</source>  
<document_content>  
package com.teamnova.assa.domain;  
  
import android.app.Activity;  
import android.content.Intent;  
import android.util.Log;  
import android.widget.Toast;  
  
import com.kakao.sdk.user.UserApiClient;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.LoginRequest;  
import com.teamnova.assa.data.dto.request.RegisterRequest;  
import com.teamnova.assa.data.dto.response.DeleteAccountResponse;  
import com.teamnova.assa.data.dto.response.LoginResponse;  
import com.teamnova.assa.data.dto.response.LogoutResponse;  
import com.teamnova.assa.data.dto.response.RegisterResponse;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.repository.TokenRepository;  
import com.teamnova.assa.data.retrofit.clients.AuthApiClient;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.ui.activity.LoginActivity;  
import com.teamnova.assa.util.TempStorage;  
  
import java.util.function.Consumer;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 서비스 인증 처리 메소드 제공 클래스  
 */  
public class Authentication {  
  
    private static final String TAG = Authentication.class.getSimpleName();  
    private static final AuthApiClient client = AuthApiClient.getInstance();  
  
    public static void register(RegisterRequest request, Runnable onSuccess, Runnable onError) {  
        AuthApiClient.getInstance().register(request).enqueue(new Callback<RegisterResponse>() {  
            @Override  
            public void onResponse(Call<RegisterResponse> call, Response<RegisterResponse> response) {  
                if (response.isSuccessful() && response.body().status.equals("success")) {  
                    Log.i(TAG, "onResponse: 회원가입 성공");  
                    onSuccess.run();  
                } else {  
                    Log.i(TAG, "onResponse: 회원가입 실패 " + response.body().messagesToString());  
                    onError.run();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<RegisterResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
            }  
        });  
  
    }  
  
    /**  
     * 서비스 로그인을 진행하는 메소드  
     *  
     * @param request   - 로그인 요청 데이터  
     * @param onSuccess - 로그인 성공시 실행할 Runnable  
     * @param onError   - 로그인 실패시 실행할 Runnable  
     */  
    public static void login(LoginRequest request, Consumer<Response<LoginResponse>> onSuccess, Consumer<Response<LoginResponse>> onError) {  
  
        AuthApiClient client = AuthApiClient.getInstance();  
        Call<LoginResponse> call = client.login(request);  
  
        call.enqueue(new Callback<LoginResponse>() {  
            @Override  
            public void onResponse(Call<LoginResponse> call, Response<LoginResponse> response) {  
                if (response.isSuccessful() && response.body().token != null) {  
                    Log.d(TAG, "onResponse: " + response.body());  
                    // 로그인 성공시 토큰 저장  
                    TokenRepository.setToken(response.body().token);  
  
                    // 로그인한 사용자의 id를 로컬에 저장  
                    Authentication.me(  
                            userData -> {  
                                // onSuccess  
                                SPHelper.setUserId(userData.id);  
                                SPHelper.put("nickname", userData.nickname);  
                                SPHelper.put("profileImage", userData.profileImage);  
                                TempStorage.setMe(userData);  
                                onSuccess.accept(response);  
                            },  
                            userData -> {  
                                // onError  
                            },  
                            throwable -> {  
                                // onFailure  
                            });  
  
  
                } else {  
                    onError.accept(response);  
                }  
            }  
  
            @Override  
            public void onFailure(Call<LoginResponse> call, Throwable throwable) {  
                Log.e(TAG, "로그인 통신 실패", throwable);  
            }  
        });  
    }  
  
    /**  
     * 로그아웃  
     */  
    public static void logout(Activity activity) {  
        AuthApiClient.getInstance().logout().enqueue(new Callback<LogoutResponse>() {  
            @Override  
            public void onResponse(Call<LogoutResponse> call, Response<LogoutResponse> response) {  
                if (response.isSuccessful() && response.body() != null && response.body().status.equals("success")) {  
                    Log.d(TAG, "onResponse: 로그아웃 성공 " + response.body());  
                    Toast.makeText(activity, "로그아웃 되었습니다.", Toast.LENGTH_SHORT).show();  
  
                    // 서비스 토큰제거  
                    TokenRepository.removeToken();  
  
                    // 로컬에 저장된 user id 제거  
                    SPHelper.remove(SPHelper.KEY.USER_ID.toString());  
  
                    // 현재유저의 로그인 방식과 상관없이 카카오 로그인의 액세스 토큰, 리프레시 토큰을 제거한다.  
                    UserApiClient.getInstance().logout(error -> {  
                        if (error != null) {  
                            Log.e(TAG, "로그아웃 실패. SDK에서 토큰 삭제됨", error);  
                        } else {  
                            Log.i(TAG, "로그아웃 성공. SDK에서 토큰 삭제됨");  
                        }  
                        return null;  
                    });  
  
                    // 소켓 서비스 종료  
                    Intent serviceIintent = new Intent(activity, ChattingSocketService.class);  
                    activity.stopService(serviceIintent);  
  
                    // 로그인 화면으로 이동  
                    Intent intent = new Intent(activity, LoginActivity.class);  
                    intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);  
                    activity.startActivity(intent);  
                    activity.finish();  
                } else {  
                    Log.d(TAG, "onResponse: 로그아웃 실패 " + response.body());  
                }  
            }  
  
            @Override  
            public void onFailure(Call<LogoutResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
            }  
        });  
    }  
  
    /**  
     * 회원탈퇴  
     * @param activity  
     */  
    public static void withdraw(Activity activity) {  
        AuthApiClient.getInstance().deleteAccount().enqueue(new Callback<DeleteAccountResponse>() {  
            @Override  
            public void onResponse(Call<DeleteAccountResponse> call, Response<DeleteAccountResponse> response) {  
                if (response.isSuccessful() && response.body() != null && response.body().status.equals("success")) {  
                    Log.d(TAG, "onResponse: 회원탈퇴 성공 " + response.body());  
  
                    Toast.makeText(activity, "회원탈퇴 되었습니다.", Toast.LENGTH_SHORT).show();  
  
                    // 로그인 화면으로 이동, 자동로그인 방지를 위해 토큰도 제거한다.  
                    TokenRepository.removeToken();  
  
                    // 로컬에 저장된 user id 제거  
                    SPHelper.remove(SPHelper.KEY.USER_ID.toString());  
  
                    // 현재유저의 로그인 방식과 상관없이 카카오 계정의 연결 상태를 해제를 시도한다.  
                    UserApiClient.getInstance().unlink(throwable -> {  
                        if (throwable != null) {  
                            Log.e(TAG, "onResponse: 연결 끊기 실패", throwable);  
                        } else {  
                            Log.i(TAG, "onResponse: 연결 끊기 성공. SDK에서 토큰 삭제됨");  
                        }  
                        return null;  
                    });  
  
                    // 소켓 서비스 종료  
                    Intent serviceIintent = new Intent(activity, ChattingSocketService.class);  
                    activity.stopService(serviceIintent);  
  
                    // 로그인 화면으로 이동  
                    Intent intent = new Intent(activity, LoginActivity.class);  
                    intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);  
                    activity.startActivity(intent);  
                    activity.finish();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<DeleteAccountResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
            }  
        });  
    }  
  
    public static void me(Consumer<UserData> onSuccess, Consumer<UserData> onError, Consumer<Throwable> onFailure) {  
        client.me().enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                Log.d(TAG, "onResponse: 현재 사용자 정보 응답 성공 : " + response.body());  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "현재 사용자 정보 정상 응답");  
                    onSuccess.accept(response.body());  
                } else {  
                    Log.d(TAG, "현재 사용자 정보 에러 응답");  
                    onError.accept(response.body());  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.d(TAG, "onFailure: 현재 사용자 정보 응답 실패");  
                onFailure.accept(throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="102">  
<source>app/src/main/java\com\teamnova\assa\domain\CustomPeerConnectionObserver.java</source>  
<document_content>  
package com.teamnova.assa.domain;  
  
import android.util.Log;  
  
import org.webrtc.DataChannel;  
import org.webrtc.IceCandidate;  
import org.webrtc.MediaStream;  
import org.webrtc.PeerConnection;  
  
public class CustomPeerConnectionObserver implements PeerConnection.Observer {  
    public static final String TAG = CustomPeerConnectionObserver.class.getSimpleName();  
  
  
    @Override  
    public void onSignalingChange(PeerConnection.SignalingState signalingState) {  
        Log.d(TAG, "onSignalingChange: START - params: signalingState = " + signalingState);  
    }  
  
    @Override  
    public void onIceConnectionChange(PeerConnection.IceConnectionState iceConnectionState) {  
        Log.d(TAG, "onIceConnectionChange: START");  
    }  
  
    @Override  
    public void onIceConnectionReceivingChange(boolean b) {  
        Log.d(TAG, "onIceConnectionReceivingChange: START");  
    }  
  
    @Override  
    public void onIceGatheringChange(PeerConnection.IceGatheringState iceGatheringState) {  
        Log.d(TAG, "onIceGatheringChange: START");  
    }  
  
    @Override  
    public void onIceCandidate(IceCandidate iceCandidate) {  
//        Log.i(TAG, "onIceCandidate: START - ICE 후보를 찾음 = " + iceCandidate.toString());  
  
    }  
  
    @Override  
    public void onIceCandidatesRemoved(IceCandidate[] iceCandidates) {  
        Log.d(TAG, "onIceCandidatesRemoved: START");  
    }  
  
    @Override  
    public void onAddStream(MediaStream mediaStream) {  
        Log.d(TAG, "onAddStream: START");  
    }  
  
    @Override  
    public void onRemoveStream(MediaStream mediaStream) {  
        Log.d(TAG, "onRemoveStream: START");  
    }  
  
    @Override  
    public void onDataChannel(DataChannel dataChannel) {  
        Log.d(TAG, "onDataChannel: START");  
    }  
  
    @Override  
    public void onRenegotiationNeeded() {  
        Log.d(TAG, "onRenegotiationNeeded: START");  
    }  
}  
  
</document_content>  
</document>  
<document index="103">  
<source>app/src/main/java\com\teamnova\assa\domain\KakaoLogin.java</source>  
<document_content>  
package com.teamnova.assa.domain;  
  
import android.content.Context;  
import android.util.Log;  
  
import com.kakao.sdk.auth.model.OAuthToken;  
import com.kakao.sdk.common.model.AuthError;  
import com.kakao.sdk.common.model.AuthErrorCause;  
import com.kakao.sdk.common.model.ClientError;  
import com.kakao.sdk.common.model.ClientErrorCause;  
import com.kakao.sdk.user.UserApiClient;  
  
import kotlin.Unit;  
import kotlin.jvm.functions.Function2;  
  
public class KakaoLogin {  
  
  
}  
  
</document_content>  
</document>  
<document index="104">  
<source>app/src/main/java\com\teamnova\assa\domain\ServiceManager.java</source>  
<document_content>  
package com.teamnova.assa.domain;  
  
import android.content.Context;  
import android.content.Intent;  
  
/**  
 * 서비스 관리 클래스  
 */  
public class ServiceManager {  
  
    private static ServiceManager instance = null;  
  
    private ServiceManager() {  
    }  
  
    public static ServiceManager getInstance(){  
        if(instance == null){  
            instance = new ServiceManager();  
        }  
        return instance;  
    }  
  
    // 서비스 실행  
    public void startService(Context context, Class<?> cls) {  
        //  
        Intent intent = new Intent(context, cls);  
        context.startService(intent);  
    }  
  
  
  
  
}  
  
</document_content>  
</document>  
<document index="105">  
<source>app/src/main/java\com\teamnova\assa\service\ChattingSocketService.java</source>  
<document_content>  
package com.teamnova.assa.service;  
  
import android.annotation.SuppressLint;  
import android.app.Notification;  
import android.app.NotificationChannel;  
import android.app.NotificationManager;  
import android.app.PendingIntent;  
import android.app.Service;  
import android.content.Context;  
import android.content.Intent;  
import android.os.Build;  
import android.os.IBinder;  
import android.util.Log;  
  
import androidx.core.app.NotificationCompat;  
import androidx.localbroadcastmanager.content.LocalBroadcastManager;  
  
import com.google.gson.JsonObject;  
import com.google.gson.JsonParser;  
import com.teamnova.assa.BuildConfig;  
import com.teamnova.assa.R;  
import com.teamnova.assa.command.Action;  
import com.teamnova.assa.command.BaseCommand;  
import com.teamnova.assa.command.CheckReceiveCommand;  
import com.teamnova.assa.command.ConnectCommand;  
import com.teamnova.assa.command.CreateRoomCommand;  
import com.teamnova.assa.command.CreateVideoRoomCommand;  
import com.teamnova.assa.command.ExitRoomCommand;  
import com.teamnova.assa.command.ExitVideoRoomCommand;  
import com.teamnova.assa.command.GetVideoRoomParticipantCommand;  
import com.teamnova.assa.command.IceCandidateCommand;  
import com.teamnova.assa.command.InviteCommand;  
import com.teamnova.assa.command.JoinVideoRoomCommand;  
import com.teamnova.assa.command.MediaStatusCommand;  
import com.teamnova.assa.command.ResponseCommand;  
import com.teamnova.assa.command.RoomInfoCommand;  
import com.teamnova.assa.command.SDPCommand;  
import com.teamnova.assa.command.SendMessageCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.ui.activity.ChatRoomActivity;  
import com.teamnova.assa.ui.fragment.ChatFragment;  
import com.teamnova.assa.ui.fragment.OpenChatFragment;  
import com.teamnova.assa.util.DBHelper;  
import com.teamnova.assa.util.Utils;  
  
import java.io.BufferedReader;  
import java.io.InputStreamReader;  
import java.io.PrintWriter;  
import java.net.Socket;  
import java.util.List;  
  
/**  
 * 채팅 소켓 연결을 관리하는 서비스  
 */  
public class ChattingSocketService extends Service {  
    public static final String TAG = ChattingSocketService.class.getSimpleName();  
    public static final int FOREGROUND_SERVICE_NOTIFICATION_ID = 1;  
    public static final String FOREGROUND_SERVICE_NOTIFICATION_CHANNEL_ID = "chat_socket";  
    public static final String CHAT_NOTIFICATION_CHANNEL_ID = "chat_notification";  
    public String CHAT_NOTIFICATION_GROUP_ID = "com.teamnova.assa"; // 알림 그룹 아이디  
  
    // 서버랑 연결된 소켓 관리 클래스  
    ClientSocket clientSocket;  
  
    // 로컬 db 유틸  
    DBHelper dbHelper;  
  
    // 현재 사용자 id  
    private final Long currentUserId = SPHelper.getUserId();  
  
    static final int TRUE_INT = 1;  
    static final int FALSE_INT = 0;  
  
    public ChattingSocketService() {  
    }  
  
    @Override  
    public void onCreate() {  
        super.onCreate();  
        Log.i(TAG, "onCreate: 실행");  
  
        // 현재 사용자 정보 가져오기  
  
        // 클라이언트 소켓 스레드 실행  
        clientSocket = new ClientSocket();  
        clientSocket.start();  
  
        // 로컬 db 연결  
        dbHelper = new DBHelper(getApplicationContext());  
    }  
  
    @Override  
    public IBinder onBind(Intent intent) {  
        return null;  
    }  
  
    // startService로 이 서비스를 호출해도 내부적으로 startForeGround() 호출하면 foreGroundService로 동작함  
    @SuppressLint("ForegroundServiceType")  
    @Override  
    public int onStartCommand(Intent intent, int flags, int startId) {  
        Log.i(TAG, "onStartCommand: START - params: intent = " + intent + ", flags = " + flags + ", startId = " + startId);  
  
        // START_STICKY 로 재시작하면 intent가 null이다.  
        if (intent == null) intent = new Intent();  
  
        // 서버로 메시지를 전송하기 위해 서비스를 호출했는지 확인  
        if (intent.hasExtra("message")) {  
            // 맞다면 서버로 메시지를 전송한다.  
            String message = intent.getStringExtra("message");  
            Log.i(TAG, "onStartCommand: 서버로 보내는 message = " + message);  
  
            clientSocket.sendMsgToServer(message);  
        } else {  
            // 아니라면 포그라운드 서비스 세팅  
  
            // 알림 채널 생성  
            NotificationChannel channel = new NotificationChannel(  
                    FOREGROUND_SERVICE_NOTIFICATION_CHANNEL_ID,  
                    "채팅 서비스",  
                    NotificationManager.IMPORTANCE_LOW  
            );  
            Log.d(TAG, "onStartCommand: NotificationChannel=" + channel);  
  
            // 알림 채널 등록  
            getSystemService(NotificationManager.class).createNotificationChannel(channel);  
  
            Notification notification = new NotificationCompat.Builder(this, FOREGROUND_SERVICE_NOTIFICATION_CHANNEL_ID)  
                    .setContentTitle("ASSA 채팅 서비스")  
                    .setContentText("실행 중")  
                    .setSmallIcon(R.drawable.all_logo_assa)  
                    .build();  
            Log.d(TAG, "onStartCommand: notification=" + notification);  
  
            Log.d(TAG, "onStartCommand: startForeground(" + FOREGROUND_SERVICE_NOTIFICATION_ID + "," + notification + ")");  
            startForeground(FOREGROUND_SERVICE_NOTIFICATION_ID, notification);  
        }  
  
        Log.d(TAG, "onStartCommand: END - return = " + START_STICKY);  
        return START_STICKY;  
    }  
  
    @Override  
    public void onDestroy() {  
        super.onDestroy();  
        Log.i(TAG, "onDestroy: 채팅소켓 서비스 종료(서비스 종료)");  
        finishService();  
    }  
  
    @Override  
    public void onTaskRemoved(Intent rootIntent) {  
        super.onTaskRemoved(rootIntent);  
        Log.i(TAG, "onTaskRemoved: 채팅소켓 서비스 종료 (태스크 제거)");  
        finishService();  
    }  
  
    // 서비스 종료시 공통으로 실행되는 코드  
    private void finishService() {  
  
    }  
  
    /**  
     * 클라이언트 소켓 통신 관리 클래스  
     */  
    class ClientSocket extends Thread {  
  
        private Socket socket;  
        private BufferedReader bufferedReader;  
        private PrintWriter printWriter;  
  
        // 채팅창, 또는 앱이 화면에 켜져있는지 나타내는 변수  
        boolean isChatForeground = false;  
        boolean isChatListVisible = false;  
        boolean isOpenChatListVisible = false;  
  
        // 서버에 메시지 보내기  
        public void sendMsgToServer(String message) {  
            Log.i(TAG, "sendMsgToServer: START");  
            Log.i(TAG, "sendMsgToServer 서버로 전송되는 메시지 = " + message);  
  
            // 메시지 보낼 때 서브 스레드 사용  
            new Thread(() -> {  
                try {  
                    printWriter.println(message);  
                } catch (Exception e){  
                    Log.e(TAG, "sendMsgToServer: 소켓 접속이 안 되어 있음", e);  
                }  
            }).start();  
            Log.i(TAG, "sendMsgToServer: END");  
        }  
  
        // 채팅 액티비티로 메시지 보내기  
        private void sendMsgToChat(String message) {  
            Log.i(TAG, "sendMsgToChat: START - params: message = " + message);  
            Intent intent = new Intent("chat_event");  
            intent.putExtra("message", message);  
            LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(intent);  
            Log.i(TAG, "sendMsgToChat: END");  
        }  
  
        // 일반 채팅방 목록 프래그먼트로 메시지 보내기  
        private void sendMsgToRoomList(String message) {  
            Log.i(TAG, "sendMsgToMain: START");  
            Log.d(TAG, "sendMsgToMain: 채팅리스트로 전송되는 메시지 = " + message);  
            Intent intent = new Intent("roomList_event");  
            intent.putExtra("message", message);  
            LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(intent);  
            Log.i(TAG, "sendMsgToMain: END");  
        }  
  
        // 오픈 채팅방 목록 프래그먼트로 메시지 보내기  
        private void sendMsgToOpenChatList(String message) {  
            Log.i(TAG, "sendMsgToOpenChatList: START");  
            Log.d(TAG, "sendMsgToOpenChatList: 오픈 채팅리스트로 전송되는 메시지 = " + message);  
            Intent intent = new Intent("openChatList_event");  
            intent.putExtra("message", message);  
            LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(intent);  
            Log.i(TAG, "sendMsgToOpenChatList: END");  
        }  
  
        // 영상 통화 액티비티로 메시지 보내기  
        private void sendMsgToVideoRoom(String message) {  
            Log.i(TAG, "sendMsgToVideoRoom: START");  
            Log.d(TAG, "sendMsgToVideoRoom: 영상통화 화면으로 전송되는 메시지 = " + message);  
            Intent intent = new Intent("videoRoom_event");  
            intent.putExtra("message", message);  
            LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(intent);  
            Log.i(TAG, "sendMsgToVideoRoom: END");  
        }  
  
        private void checkActivityForeground() {  
            Log.i(TAG, "checkActivityForeground: START");  
            // 채팅 액티비티가 포그라운드인지 확인  
            isChatForeground = Utils.isForegroundActivity(getApplicationContext(), ChatRoomActivity.class);  
  
            // 일반 채팅방 목록이 화면에 보이고 있는지 여부  
            isChatListVisible = ChatFragment.isChatListVisible;  
  
            // 오픈 채팅방 목록이 화면에 보이고 있는지 여부  
            isOpenChatListVisible = OpenChatFragment.isOpenChatVisible;  
  
            Log.d(TAG, "checkActivityForeground: isChatForeground=" + isChatForeground +  
                    ", isChatListVisible=" + isChatListVisible + ", isOpenChatListVisible=" + isOpenChatListVisible);  
  
            Log.i(TAG, "checkActivityForeground: END");  
        }  
  
        @Override  
        public void run() {  
            // 서버 재접속 루프  
            while (true) {  
                try {  
                    // 소켓 객체 얻기  
                    socket = new Socket(BuildConfig.HOST, BuildConfig.CHATTING_SOCKET_PORT);  
                    Log.d(TAG, "run: 소켓 연결됨");  
  
                    // 입출력 스트림 얻기  
                    bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));  
                    printWriter = new PrintWriter(socket.getOutputStream(), true);  
  
                    // 서버에 연결 메시지 전송  
                    // https://www.notion.so/655c0be054e942c19a75f446ee29c84f?pvs=4#787357d16e364a6ebe3ed8c2cc32d98b  
                    ConnectCommand command = new ConnectCommand();  
  
                    sendMsgToServer(command.toJson());  
                } catch (Exception e) {  
                    Log.e(TAG, "run 소켓 연결 에러", e);  
  
                }  
  
                try {  
                    // 서버 메시지 수신 루프  
                    while (true) {  
  
                        // 메시지 수신  
                        if (bufferedReader == null) throw new Exception("bufferedReader == null");  
                        String line = bufferedReader.readLine();  
                        Log.i(TAG, "run: 서버가 보낸 메시지 = " + line);  
  
                        // 서버 연결이 끊기면 재접속 시도한다.  
                        if (line == null) {  
                            Log.d(TAG, "run: line == null 서버 연결 끊김");  
                            throw new Exception("서버 연결 끊김");  
                        }  
  
                        // 메시지 파싱  
                        JsonObject jsonObject = (JsonObject) JsonParser.parseString(line);  
                        String actionStr = jsonObject.get("action").getAsString();  
                        Log.d(TAG, "run: action=" + actionStr);  
  
                        // 문자열 -> enum  
                        Action action = Action.valueOf(actionStr);  
  
                        // 메인, 채팅 액티비티가 포그라운드인지 변수에 기록  
                        checkActivityForeground();  
  
                        // 수신확인 데이터 보낼 때 사용됨  
                        Long commandId;  
  
                        // 메시지 처리  
                        switch (action) {  
                            case ROOM_INFO: // 방 생성 완료 및 방 정보 얻기  
                                handleRoomInfo(RoomInfoCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case SEND_MESSAGE: // 채팅 메시지 수신  
                                handleChatMessage(SendMessageCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case EXIT_ROOM: // 누군가 방을 나갔을 때  
                                handleRoomExit(ExitRoomCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case INVITE: // 추가 멤버 초대 했을 때  
                                roomInvite(InviteCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case CREATE_VIDEO_ROOM: // 영상회의 생성  
                                createVideoRoom(CreateVideoRoomCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case JOIN_VIDEO_ROOM: // 영상회의 참가  
                                joinVideoRoom(JoinVideoRoomCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case SDP: // sdp 받음  
                                handleSDP(SDPCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case ICE_CANDIDATE: // ice candidate 받음  
                                handleIceCandidate(IceCandidateCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case EXIT_VIDEO_ROOM:  
                                ExitVideoRoom(ExitVideoRoomCommand.fromJson(jsonObject.toString()));  
                                break;  
                            case MEDIA_STATUS:  
                                handleMediaStatus(MediaStatusCommand.fromJson(jsonObject.toString()));  
                                break;  
  
                            case GET_VIDEO_ROOM_PARTICIPANT:  
                                getVideoRoomParticipant(GetVideoRoomParticipantCommand.fromJson(jsonObject.toString()));  
                                break;  
                        }  
  
                        commandId = BaseCommand.fromJson(jsonObject.toString(), BaseCommand.class).id;  
                        Log.d(TAG, "run: commandId=" + commandId);  
  
                        // 수신 확인을 원할 때만 전송  
                        if (commandId != null) {  
                            CheckReceiveCommand checkReceiveCommand = new CheckReceiveCommand(commandId);  
  
                            // 서버로 수신확인 메시지 전송  
                            sendMsgToServer(checkReceiveCommand.toJson());  
                        }  
  
                    }  
                } catch (Exception e) {  
                    Log.e(TAG, "run: 서버 연결/메시지 수신 에러, 재접속 시도 중...", e);  
                    try {  
                        Thread.sleep(5000); // 5초 후 재접속 시도  
                    } catch (Exception exception) {  
                        Log.e(TAG, "run: 재접속 시도 중 에러", exception);  
                    }  
                }  
            }  
        }  
  
        private void getVideoRoomParticipant(GetVideoRoomParticipantCommand command){  
            Intent intent = new Intent("videoRoom_participant");  
            intent.putExtra("message", command.toJson());  
            LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(intent);  
        }  
  
        // 다른사람이 카메라, 마이크의 상태를 변경할 때  
        private void handleMediaStatus(MediaStatusCommand command){  
            Log.i(TAG, "handleMediaStatus: START");  
            sendMsgToVideoRoom(command.toJson());  
            Log.i(TAG, "handleMediaStatus: END");  
        }  
  
        // 누군가 회의 방을 나갔을 때  
        private void ExitVideoRoom(ExitVideoRoomCommand command) {  
            Log.d(TAG, "handleExitRoom: START - params: command = " + command);  
            sendMsgToVideoRoom(command.toJson());  
            Log.d(TAG, "handleExitRoom: END");  
        }  
  
        // ice candidate 처리  
        private void handleIceCandidate(IceCandidateCommand command) {  
            Log.d(TAG, "handleIceCandidate: START - params: command = " + command);  
            sendMsgToVideoRoom(command.toJson());  
            Log.d(TAG, "handleIceCandidate: END");  
        }  
  
        // sdp 처리  
        private void handleSDP(SDPCommand command) {  
            Log.d(TAG, "handleSDP: START - params: command = " + command);  
            sendMsgToVideoRoom(command.toJson());  
            Log.d(TAG, "handleSDP: END");  
        }  
  
        // 영상회의 참가  
        private void joinVideoRoom(JoinVideoRoomCommand command) {  
            Log.d(TAG, "joinVideoRoom: START");  
            sendMsgToVideoRoom(command.toJson());  
            Log.d(TAG, "joinVideoRoom: END");  
        }  
  
        // 영상회의 생성했을 때  
        private void createVideoRoom(CreateVideoRoomCommand command) {  
            Log.d(TAG, "createVideoRoom: START - params: command = " + command);  
            sendMsgToVideoRoom(command.toJson());  
            Log.d(TAG, "createVideoRoom: END");  
        }  
  
        // 채팅방에 초대를 받았을 때  
        private void roomInvite(InviteCommand command) {  
            Log.i(TAG, "roomInvite: START");  
  
            CreateRoomCommand.RoomType roomType = command.roomType;  
  
            List<SimpleUser> memberList = command.memberList;  
  
            // 로컬에 방 정보가 없으면 추가  
            // 있으면 업데이트  
            ChatRoom chatRoom = dbHelper.getChatRoomInfo(command.roomId);  
            if (chatRoom == null) {  
                Log.i(TAG, "roomInvite: 로컬에 방정보 없음 - 생성");  
                // 방 생성  
                dbHelper.insertChatRoom(command);  
                // 멤버 추가  
                for (SimpleUser user : memberList) {  
                    dbHelper.insertChatRoomMember(command.roomId, user);  
                }  
            } else {  
                Log.i(TAG, "roomInvite: 로컬에 방정보 있음 - 업데이트");  
                dbHelper.updateChatRoomInfo(command);  
            }  
  
            // 초대 메시지 로그 기록  
            dbHelper.insertChatLog(command.getMessageCommand());  
  
            deliveryEvent(command);  
  
            Log.i(TAG, "roomInvite: END");  
        }  
  
        // 다른 화면으로 이벤트를 전달하는 메소드  
        private void deliveryEvent(ResponseCommand command) {  
            // 사용자가 현재 보고 있는 화면에 따라 이벤트 발생에 따른 UI 변화를 바로 적용할지 결정한다.  
            if (currentUserId == command.requesterId || (isChatForeground && ChatRoomActivity.roomId == command.roomId)) {  
                Log.i(TAG, "deliveryEvent: 사용자는 이벤트가 발생한 채팅방을 보고 있음 roomId = " + command.roomId);  
                sendMsgToChat(command.toJson());  
            } else if (isChatListVisible) {  
                Log.i(TAG, "deliveryEvent: 사용자는 일반 채팅방 목록 화면을 보고 있음");  
                sendMsgToRoomList("list_update");  
            } else if (isOpenChatListVisible) {  
                Log.i(TAG, "deliveryEvent: 사용자는 오픈 채팅방 목록 화면을 보고 있음");  
                sendMsgToOpenChatList("list_update");  
            } else {  
                Log.i(TAG, "deliveryEvent: 사용자는 채팅과 관련된 화면을 보고 있지 않음");  
            }  
        }  
  
        // 누가 방을 나가면 해당 사실을 채팅방에 출력  
        private void handleRoomExit(ExitRoomCommand command) {  
            Log.d(TAG, "handleRoomExit: START");  
            long roomId = command.roomId; // 나간 방 id  
            long exitUserId = command.requesterId; // 나간 사람 id  
            Log.d(TAG, "handleRoomExit: 나간 방 roomId = " + roomId + ", 나간사람 userId = " + exitUserId);  
  
            ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
            if (chatRoom == null) return;  
  
            // 나간 사용자 정보 업데이트  
            SimpleUser exitUser = dbHelper.getUserById(exitUserId);  
            exitUser.isExit = true;  
            dbHelper.updateChatRoomMember(roomId, exitUser);  
  
            // 채팅방 이름 변경(일반채팅에 적용)  
            List<SimpleUser> memberList = dbHelper.getChatRoomMembers(roomId, false);  
  
            // 방 정보 업데이트용 info 객체 생성  
            RoomInfoCommand infoCommand = new RoomInfoCommand(command.recipientId, roomId, memberList);  
            infoCommand.roomName = command.roomName;  
            infoCommand.description = command.description;  
            infoCommand.masterId = command.masterId;  
  
            Log.d(TAG, "handleRoomExit: 나간 사람 id = " + command.requesterId);  
            Log.d(TAG, "handleRoomExit: 방장 id = " + chatRoom.masterId);  
  
            infoCommand.masterId = chatRoom.masterId;  
  
            // 나간사람이 방장이면 해당 사실도 기록  
            if(command.requesterId == chatRoom.masterId){  
                Log.i(TAG, "handleRoomExit: 나간 사람이 방장임");  
                infoCommand.masterId = 0L;  
            }  
  
            // 채팅방 정보 업데이트 - 명단만 수정한다. 방이름은 액티비티에서 생성함  
            dbHelper.updateChatRoomInfo(infoCommand);  
  
            // 사용자 퇴장 메시지 저장  
            dbHelper.insertChatLog(command.getMessageCommand());  
  
            deliveryEvent(command);  
        }  
  
        // 방 정보 처리, (새로운 방 정보를 받거나 업데이트 할 때 사용)  
        void handleRoomInfo(RoomInfoCommand command) {  
            Log.d(TAG, "handleRoomInfo: START");  
  
            Long roomId = command.roomId;  
//            Long masterId = command.masterId;  
            List<SimpleUser> userList = command.memberList;  
  
            // 로컬 db에 방정보가 있는지 확인  
            ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
            boolean isRoomInfoExist = chatRoom != null;  
            Log.d(TAG, "handleRoomInfo: isRoomInfoExist=" + isRoomInfoExist);  
  
            if (isRoomInfoExist) {  
                Log.d(TAG, "handleRoomInfo: 로컬에 방이 존재하여 정보를 업데이트");  
  
                // 방정보 업데이트  
                dbHelper.updateChatRoomInfo(command);  
            } else {  
                Log.d(TAG, "handleRoomInfo: 로컬에 해당 방 없음");  
  
                // 새 채팅방 정보를 로컬에 생성  
                dbHelper.insertChatRoom(command);  
  
                // 멤버 정보 로컬에 추가  
                for (SimpleUser user : userList) {  
                    dbHelper.insertChatRoomMember(roomId, user);  
                }  
  
                // 기존에 방 정보가 없던 상태라면 이미 해당방의 메시지를 받은상태다  
                // 메시지를 받고 해당 메시지의 방정보가 없으면 방정보를 요청하기 때문이다.  
                // 이전에 방이 없어 출력 못 한 메시지의 푸시알림을 출력한다.  
                // 아래 코드는 로컬에 저장되었지만 아직 채팅방이 없어 처리가 안 된 메시지들을 처리한다.  
  
                // 처리 안 된 메시지들을 로컬 db에서 가져옴  
                List<SendMessageCommand> messageList = dbHelper.getUnReadMessages(roomId);  
  
                // 처리 안 된 메시지 리스트 순회하며 처리  
                for (SendMessageCommand msg : messageList) {  
                    handleChatMessage(msg);  
                }  
  
            }  
  
            deliveryEvent(command);  
  
            Log.d(TAG, "handleRoomInfo: END");  
        }  
  
        // 채팅 메시지 수신 처리  
        void handleChatMessage(SendMessageCommand command) {  
            Log.i(TAG, "handleChatMessage: START - params: command = " + command);  
  
            Long senderId = command.requesterId;  
  
            // 내가 작성한 글과 서버가 보낸 메시지는 읽음으로 기록한다.  
            if (senderId == currentUserId || senderId == 0) {  
                Log.d(TAG, "handleChatMessage: 나 또는 서버가 보낸 메시지, 읽음 처리");  
                command.readStatus = SendMessageCommand.ReadStatus.READ;  
            } else {  
                Log.d(TAG, "handleChatMessage: 다른 사람이 보낸 메시지, 안 읽음 처리");  
                command.readStatus = SendMessageCommand.ReadStatus.UNREAD;  
            }  
  
            // 로컬에 없는 채팅이라면 db에 채팅 로그 기록  
            SendMessageCommand message = dbHelper.getChatLogById(command.id);  
            if (message == null) {  
                Log.d(TAG, "handleChatMessage: 로컬 기록에 없는 채팅, 로컬에 저장");  
                dbHelper.insertChatLog(command);  
            }  
  
            // 전달받은 메시지의 채팅방이 로컬에 존재하는지 확인  
            ChatRoom chatRoom = dbHelper.getChatRoomInfo(command.roomId);  
            if (chatRoom == null) {  
                // 존재하지 않으면 해당 방 정보를 요청하고 이 메소드 종료.  
                Log.d(TAG, "handleChatMessage: 메시지의 채팅방이 로컬에 없음, 서버에 채팅방 정보 요청");  
                RoomInfoCommand roomInfo = new RoomInfoCommand(0L, command.roomId, null);  
                sendMsgToServer(roomInfo.toJson());  
                Log.d(TAG, "handleChatMessage: END - 방정보 요청");  
                return;  
            }  
  
            // 이 시점에서는 방이 이미 생성된 상황이다.  
            // 앞서 챗 로그를 먼저 기록했기 때문에 이 unreadCount는 최신 값이다.  
            int unreadCount = dbHelper.getUnreadCount(command.roomId);  
            Log.d(TAG, "handleChatMessage: unreadCount=" + unreadCount);  
  
            long currentUserId = ChattingSocketService.this.currentUserId;  
  
            // 노티를 출력하지 않는 조건  
            // 1. 메시지가 도착한 채팅방 화면을 보고 있을 때, 2. 나, 서버가 보낸 메시지 일 때  
            // 3. 채팅방 알림 설정이 꺼져 있을 때 (이 조건은 showNotification에서 걸러줌)  
            Log.d(TAG, "handleChatMessage: ChatRoomActivity.roomId=" + ChatRoomActivity.roomId +  
                    ", targetRoomId=" + command.roomId +  
                    ", isChatListVisible=" + isChatListVisible +  
                    ", senderId=" + senderId + ", currentUserId=" + currentUserId);  
            Log.d(TAG, "handleChatMessage: 조건식 결과 = " + (ChatRoomActivity.roomId != command.roomId && !isChatListVisible && senderId != 0 && senderId != currentUserId));  
  
            if (ChatRoomActivity.roomId != command.roomId && senderId != 0 && senderId != currentUserId) {  
                // 푸시 알림 출력  
                showNotification(command);  
            }  
  
            // 채팅방 목록 데이터, 화면 업데이트  
            updateChatRoomList(chatRoom, senderId, command.content, command.createdAT, unreadCount);  
  
            // 사용자가 현재 채팅방을 보고 있고, 그 채팅방이 메시지를 받은 채팅방이면  
            deliveryEvent(command);  
//            Log.d(TAG, "handleChatMessage: isChatForeground=" + isChatForeground +  
//                    ", ChatRoomActivity.roomId=" + ChatRoomActivity.roomId + ", roomId=" + command.roomId);  
//            Log.d(TAG, "handleChatMessage: isChatListVisible=" + isChatListVisible);  
//            if (isChatForeground && ChatRoomActivity.roomId == command.roomId) {  
//                Log.i(TAG, "handleChatMessage: 사용자가 현재 메시지를 전송받은 채팅방을 보고 있음");  
//                // read 상태 변경 - 사용자가 메시지가 도착하는 것을 확인 했으므로 읽음 처리한다.  
//                command.readStatus = SendMessageCommand.ReadStatus.READ;  
//                dbHelper.setUnReadMessageToRead(command.roomId);  
//  
//                // 채팅방으로 메시지 전송  
//                sendMsgToChat(command.toJson());  
//            } else if (isChatListVisible) {  
//                Log.i(TAG, "handleChatMessage: 사용자는 현재 일반 채팅 방 목록 화면을 보고 있음");  
//                // 메인 액티비티로 메시지 전송  
//                sendMsgToRoomList("list_update");  
//            }  
  
            Log.i(TAG, "handleChatMessage: END");  
        }  
  
        // 채팅방 목록 데이터, 화면 업데이트  
        private void updateChatRoomList(ChatRoom chatRoom, long senderId, String message, String  
                dateTime, int unreadCount) {  
            Log.i(TAG, "updateChatRoomList: START - params: chatRoom=" + chatRoom +  
                    ", senderId=" + senderId + ", message=" + message +  
                    ", dateTime=" + dateTime + ", unreadCount=" + unreadCount);  
  
            long updateTargetRoomId = chatRoom.id;  
  
            // 채팅방 목록 화면을 업데이트  
            // 서버 메시지는 여기서 처리하지 않는다.  
            if (senderId != 0) {  
  
                // 아이템을 채팅방 목록에 추가  
                List<Long> chatRoomItemList = null;  
                if (chatRoom.roomType == CreateRoomCommand.RoomType.NORMAL) {  
                    chatRoomItemList = ChatFragment.roomItemList;  
                } else if (chatRoom.roomType == CreateRoomCommand.RoomType.OPEN) {  
                    chatRoomItemList = OpenChatFragment.roomItemList;  
                }  
                Log.d(TAG, "updateChatRoomList: 기존정보 가져오기 chatRoomItemList=" + chatRoomItemList);  
                chatRoomItemList.add(0, updateTargetRoomId);  
                Log.d(TAG, "updateChatRoomList: 최상단 아이템 추가 chatRoomItemList=" + chatRoomItemList);  
  
                // 기존 아이템 제거 (만약 있다면)  
                for (int i = 1; i < chatRoomItemList.size(); i++) {  
                    Long prevItemId = chatRoomItemList.get(i);  
                    if (prevItemId == updateTargetRoomId) {  
                        chatRoomItemList.remove(i);  
                        break;  
                    }  
                }  
                Log.d(TAG, "updateChatRoomList: 기존 아이템 제거 chatRoomItemList=" + chatRoomItemList);  
  
                // 방 정보 업데이트 (업데이트 시간 현재로 갱신)  
                Log.d(TAG, "updateChatRoomList: 방 정보 업데이트 dbHelper.updateRoomTime(roomId, dateTime) <- roomId=" + updateTargetRoomId + ", dateTime=" + dateTime);  
                dbHelper.updateRoomTime(updateTargetRoomId, dateTime);  
            }  
            Log.i(TAG, "updateChatRoomList: END");  
        }  
  
        // 메시지가 읽혔는지 여부 반환  
        public boolean isMessageRead(long roomId, long senderId, String senderNickname) {  
            Log.d(TAG, "isMessageRead: START - params: roomId=" + roomId +  
                    ", senderId=" + senderId + ", senderNickname=" + senderNickname);  
  
            boolean isRead = false;  
  
            Log.d(TAG, "isMessageRead: isChatForeground=" + isChatForeground +  
                    ", ChatRoomActivity.roomId=" + ChatRoomActivity.roomId);  
  
            // 사용자가 채팅방에서 바로 메시지를 읽을 수 있는 경우  
            if (isChatForeground && ChatRoomActivity.roomId == roomId) {  
                isRead = true;  
            } else {  
                // 사용자가 채팅방에서 메시지를 읽지 못한 경우  
  
                // 그래도 서버 메시지는 읽음처리한다.  
                if (senderId == 0 && "server".equals(senderNickname)) {  
                    Log.d(TAG, "handleChatMessage: server message read automatically, senderId=" + senderId + ", currentUserId=" + currentUserId);  
                    isRead = true;  
                }  
            }  
  
            Log.d(TAG, "isMessageRead: END - return: isRead=" + isRead);  
            return isRead;  
        }  
  
  
        // 채팅알림 출력  
        public void showNotification(SendMessageCommand command) {  
            Log.d(TAG, "showNotification: START - params: ");  
  
            // 채팅방 알림 on off 확인  
            ChatRoom chatRoom = dbHelper.getChatRoomInfo(command.roomId);  
            String roomName = chatRoom.getRoomName();  
            boolean isNotificationOn = chatRoom.notiOn.equals(TRUE_INT);  
            Log.d(TAG, "showNotification: isNotification=" + isNotificationOn);  
  
  
            // 알림 on 으로 설정됨  
            if (isNotificationOn) {  
                SimpleUser sender = dbHelper.getUserById(command.requesterId);  
  
                String content = "";  
                if (command.type == SendMessageCommand.Type.TEXT) content = command.content;  
  
                if (command.type == SendMessageCommand.Type.IMAGE) {  
                    content = "이미지를 보냈습니다.";  
                }  
  
                if (command.type == SendMessageCommand.Type.VIDEO_ROOM_OPEN) {  
                    content = "영상회의";  
                }  
  
                if (command.type == SendMessageCommand.Type.VIDEO_ROOM_CLOSE) {  
                    content = "영상회의 종료";  
                    return;  
                }  
  
                String message = sender.nickname + " : " + content;  
  
                // 개별 알림 생성  
                NotificationCompat.Builder notificationBuilder =  
                        new NotificationCompat.Builder(ChattingSocketService.this, CHAT_NOTIFICATION_CHANNEL_ID)  
                                .setContentTitle(roomName)  
                                .setContentText(message)  
                                .setSmallIcon(R.drawable.all_logo_assa)  
                                .setAutoCancel(true)  
                                .setGroup(CHAT_NOTIFICATION_GROUP_ID);  
                Log.d(TAG, "showNotification: notificationBuilder=" + notificationBuilder);  
  
                // 알림 클릭시 채팅방으로 이동하는 인텐트 생성  
                Intent openChatRoomIntent = new Intent(ChattingSocketService.this, ChatRoomActivity.class);  
                openChatRoomIntent.putExtra("isNewRoom", false);  
                openChatRoomIntent.putExtra("roomId", command.roomId);  
//                openChatRoomIntent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);  
                Log.d(TAG, "showNotification: openChatRoomIntent=" + openChatRoomIntent);  
  
                Integer pendingIntentId = Math.toIntExact(command.roomId);  
                Log.d(TAG, "showNotification: pendingIntentId=" + pendingIntentId);  
  
                PendingIntent pendingIntent = PendingIntent.getActivity(  
                        ChattingSocketService.this,  
                        pendingIntentId,  
                        openChatRoomIntent,  
                        PendingIntent.FLAG_CANCEL_CURRENT | PendingIntent.FLAG_IMMUTABLE  
                );  
                Log.d(TAG, "showNotification: pendingIntent=" + pendingIntent);  
  
                // 알림 클릭시 작동할 pendingIntent 지정  
                notificationBuilder.setContentIntent(pendingIntent);  
  
                int notificationId = pendingIntentId; // roomId를 notificationId로 사용  
                Log.d(TAG, "showNotification: notificationId=" + notificationId);  
  
                // summary 노티 생성  
                NotificationCompat.Builder summaryNotiBuilder =  
                        new NotificationCompat.Builder(ChattingSocketService.this, CHAT_NOTIFICATION_CHANNEL_ID)  
                                .setContentTitle("ASSA")  
                                .setSmallIcon(R.drawable.all_logo_assa)  
                                .setStyle(new NotificationCompat.InboxStyle()  
                                        .addLine(message)  
                                )  
                                .setAutoCancel(true)  
                                .setGroup(CHAT_NOTIFICATION_GROUP_ID)  
                                .setGroupSummary(true);  
                Log.d(TAG, "showNotification: summaryNotiBuilder=" + summaryNotiBuilder);  
  
                // 노티피케이션 매니저 얻기  
                NotificationManager manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);  
  
                // 일반 알림 생성후 그룹 노티 출력 순서로 출력해야한다.  
                manager.notify(notificationId, notificationBuilder.build());  
                manager.notify(0, summaryNotiBuilder.build());  
  
                Log.d(TAG, "showNotification: notification=" + notificationBuilder.build());  
                Log.d(TAG, "showNotification: summaryNotification=" + summaryNotiBuilder.build());  
            }  
            Log.d(TAG, "showNotification: END");  
        }  
  
        // 알림 채널 생성  
        // TODO 알림 발생마다 채널을 생성하는 것은 뭔가 이상하다. 알아보고 개선점이 있는지 확인할 것  
        public void createChannel(Context context) {  
            if (Build.VERSION.SDK_INT < 26) {  
                return;  
            }  
            NotificationManager notificationManager =  
                    (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);  
            NotificationChannel channel = new NotificationChannel(CHAT_NOTIFICATION_CHANNEL_ID, "name", NotificationManager.IMPORTANCE_HIGH);  
            channel.setDescription("Description");  
            notificationManager.createNotificationChannel(channel);  
        }  
  
    }  
}  
</document_content>  
</document>  
<document index="106">  
<source>app/src/main/java\com\teamnova\assa\service\RestartService.java</source>  
<document_content>  
package com.teamnova.assa.service;  
  
import android.app.Notification;  
import android.app.NotificationChannel;  
import android.app.NotificationManager;  
import android.app.PendingIntent;  
import android.app.Service;  
import android.content.Intent;  
import android.os.Build;  
import android.os.IBinder;  
import android.util.Log;  
  
import androidx.core.app.NotificationCompat;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.ui.activity.MainActivity;  
  
public class RestartService extends Service {  
    public static final String TAG = RestartService.class.getSimpleName();  
  
    public RestartService() {  
    }  
  
    @Override  
    public IBinder onBind(Intent intent) {  
        return null;  
    }  
  
    @Override  
    public int onStartCommand(Intent intent, int flags, int startId) {  
        Log.i(TAG, "onStartCommand: RestartService 실행");  
  
        NotificationCompat.Builder builder = new NotificationCompat.Builder(this, "default");  
        builder.setSmallIcon(R.mipmap.ic_launcher);  
        builder.setContentTitle(null);  
        builder.setContentText(null);  
        Intent notiIntent = new Intent(this, MainActivity.class);  
  
        // pendingIntent란 intent를 당장 수행하지 않고 특정 시점에 수행하도록 만든 인텐트다.  
        PendingIntent pendingIntent = PendingIntent.getActivity(this, 0, notiIntent, PendingIntent.FLAG_UPDATE_CURRENT);  
        builder.setContentIntent(pendingIntent);  
  
        NotificationManager manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);  
        if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {  
            manager.createNotificationChannel(new NotificationChannel("default", "기본 채널", NotificationManager.IMPORTANCE_NONE));  
        }  
  
        Notification notification = builder.build();  
        startForeground(9, notification);  
  
        Intent realServiceIntent = new Intent(this, ChattingSocketService.class);  
        startService(realServiceIntent);  
  
        // 백그라운드 실행하자마자 바로 스스로 종료  
        stopForeground(true);  
        stopSelf();  
  
        return START_NOT_STICKY;  
    }  
}  
</document_content>  
</document>  
<document index="107">  
<source>app/src/main/java\com\teamnova\assa\thread\ReceiveThread.java</source>  
<document_content>  
package com.teamnova.assa.thread;  
  
import android.util.Log;  
  
import java.io.BufferedReader;  
import java.io.IOException;  
import java.net.SocketException;  
import java.util.function.Consumer;  
  
public class ReceiveThread extends Thread{  
    public static final String TAG = ReceiveThread.class.getSimpleName();  
    public BufferedReader in;  
    public String message = null;  
    public Consumer<String> listener = null;  
  
    public ReceiveThread(BufferedReader reader, Consumer<String> listener) {  
        this.in = reader;  
        this.listener = listener;  
    }  
  
    @Override  
    public void run() {  
        String line = null;  
        // 무한 루프를 돌며 서버 메시지를 수신한다.  
        try {  
            while ((line = in.readLine()) != null) {  
                listener.accept(line);  
            }  
        } catch (SocketException e) {  
            Log.e(TAG, "run: 서버로 부터 접속이 끊어졌습니다.", e);  
        } catch (IOException e) {  
            e.printStackTrace();  
        } finally {  
            closeResources();  
        }  
    }  
  
    private void closeResources() {  
        if (in != null) {  
            try {  
                in.close();  
            } catch (IOException e1) {  
                e1.printStackTrace();  
            }  
        }  
    }  
}  
  
</document_content>  
</document>  
<document index="108">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\AccountLinkingActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.graphics.Paint;  
import android.os.Bundle;  
import android.util.Log;  
import android.widget.Toast;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.kakao.sdk.user.UserApiClient;  
import com.kakao.sdk.user.model.User;  
import com.teamnova.assa.data.dto.data.OauthData;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.databinding.ActivityAccountLinkingBinding;  
import com.teamnova.assa.util.TempStorage;  
  
import java.util.HashMap;  
import java.util.Map;  
  
import kotlin.Unit;  
import kotlin.jvm.functions.Function2;  
  
/**  
 * 서비스 계정과 소셜계정 연동하는 액티비티  
 */  
public class AccountLinkingActivity extends AppCompatActivity {  
  
    private final String TAG = AccountLinkingActivity.class.getName();  
  
    ActivityAccountLinkingBinding binding;  
  
    UserData serviceUser;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityAccountLinkingBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        serviceUser = (UserData) getUserData().get("userData");  
  
        setUi();  
        setOnClickListener();  
    }  
  
    /**  
     * TempStorage에서 Map<String, Object> 를 받습니다.  
     * k - v  
     * userData - UserData  
     * oauthData - OauthUserData  
     *  
     * @return  
     */  
    private Map<String, Object> getUserData() {  
        return (Map<String, Object>) TempStorage.getItem("oauthData");  
    }  
  
    private void setUi() {  
  
        binding.description.setText("아래와 같이 " + serviceUser.email + "으로 가입된 계정이 있습니다.\n" +  
                "해당 계정의 비밀번호를 입력하시면\n" +  
                "기존 회원으로 서비스 사용이 가능합니다."  
        );  
  
        String masked = "";  
        String source = serviceUser.nickname;  
  
        // 닉네임이 2자 - 뒤에 * 1개  
        // 닉네임이 3자 -  가운데 글자 * 1개  
        // 닉네임이 4자 -  2번째 글자부터 * 2개  
        // 닉네임이 5자 이상 - 2번째 글자부터 * 3개  
        if (source.length() == 2)  
            masked = "*" + source.substring(1);  
        else if (source.length() == 3)  
            masked = source.substring(0, 1) + "*" + source.substring(2);  
        else if (source.length() == 4)  
            masked = source.substring(0, 1) + "**" + source.substring(3);  
        else if (source.length() >= 5)  
            masked = source.substring(0, 1) + "***" + source.substring(4);  
  
        // 동일한 이메일 가진 계정 보여주기  
        binding.userInfo.setText("닉네임 : " + masked);  
        // 하단 신규가입 글씨에 밑줄 추가  
        binding.tvSignUp.setPaintFlags(binding.tvSignUp.getPaintFlags() | Paint.UNDERLINE_TEXT_FLAG);  
  
    }  
  
  
    private void setOnClickListener() {  
        // 뒤로가기 버튼  
        binding.btnBack.setOnClickListener(v -> {  
            Toast.makeText(this, "계정 연결이 취소되었습니다", Toast.LENGTH_SHORT).show();  
            finish();  
        });  
  
        // 연결하기 버튼  
        binding.btnNext.setOnClickListener(v -> {  
            sendPassword();  
        });  
  
        // 신규회원으로 시작하기  
        binding.tvSignUp.setOnClickListener(v -> {  
            // 경고 창 띄우고 약관동의 화면으로 넘어가기  
            UserApiClient.getInstance().me(new Function2<User, Throwable, Unit>() {  
                @Override  
                public Unit invoke(User user, Throwable throwable) {  
                    String email = user.getKakaoAccount().getEmail();  
                    int atIndex = email.indexOf('@');  
                    String username = email.substring(0, atIndex);  
  
                    // 유저객체 생성후 임시창고에 저장(다음 액티비티에 쓰임)  
//                    TempStorage.object = new UserData(  
//                            user.getId() + username,  
//                            email,  
//                            Util.getSHA256(user.getId() + email)  
//                    );  
  
                    Intent intent = new Intent(getApplicationContext(), AgreeToTermsActivity.class);  
                    intent.putExtra("from", "kakao");  
                    intent.putExtra("kakaoId", user.getId());  
                    Log.i(TAG, "onResponse: 카카오 계정으로 회원가입 진행");  
                    startActivity(intent);  
  
                    return null;  
                }  
            });  
  
  
        });  
    }  
  
    // 1. 이메일과 비밀번호를 서버로 전송한다  
    // 2. 일치하면 연동진행후 로그인 처리  
    private void sendPassword() {  
        // 이전 액티비티에서 보낸 객체 받아오기  
        Map<String, Object> data = getUserData();  
        UserData userData = (UserData) data.get("userData");  
        OauthData oauthData = (OauthData) data.get("oauthData");  
  
        // 로그인에 쓰일 정보 할당  
        String email = userData.email;  
        String pw = binding.passwordTiet.getText().toString();  
  
        // 로그인 정보를 map으로 변환  
        Map<String, String> map = new HashMap<>();  
        map.put("email", email);  
        map.put("password", pw);  
  
  
    }  
}  
</document_content>  
</document>  
<document index="109">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\AgreeToTermsActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.widget.Toast;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.data.dto.request.RegisterRequest;  
import com.teamnova.assa.data.dto.response.RegisterResponse;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.repository.TokenRepository;  
import com.teamnova.assa.data.retrofit.clients.AuthApiClient;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivityAgreeToTermsBinding;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.util.TempStorage;  
import com.teamnova.assa.util.Utils;  
  
import java.util.ArrayList;  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 간편 회원가입 액티비티  
 */  
public class AgreeToTermsActivity extends AppCompatActivity {  
  
    private final String TAG = AgreeToTermsActivity.class.getSimpleName();  
  
    ActivityAgreeToTermsBinding binding;  
  
    UsersApiClient usersApiClient;  
    List<Integer> agreeList;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityAgreeToTermsBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        // 클릭리스너 부착  
        setOnClickListeners();  
  
        // 약관 조회 버튼 활성화  
        setSpannable();  
        usersApiClient = UsersApiClient.getInstance();  
  
    }  
  
    /**  
     * 클릭리스너 세팅  
     */  
    private void setOnClickListeners() {  
        // 뒤로가기  
        binding.btnBack.setOnClickListener(v -> {  
            this.finish();  
        });  
  
        // 약관 모두 동의  
        binding.checkAllTerms.setOnClickListener(v -> {  
  
            // 체크 시 하위항목 모두 체크  
            if (binding.checkAllTerms.isChecked()) {  
                binding.checkServiceTerm.setChecked(true);  
                binding.checkPrivacyTerm.setChecked(true);  
                updateAllTermsCheckState();  
            } else { // 모두 체크 해제  
                binding.checkServiceTerm.setChecked(false);  
                binding.checkPrivacyTerm.setChecked(false);  
                updateAllTermsCheckState();  
            }  
        });  
  
        // 서비스 이용약관 동의  
        binding.checkServiceTerm.setOnClickListener(v -> {  
            updateAllTermsCheckState();  
        });  
  
        // 개인정보 취급방침  
        binding.checkPrivacyTerm.setOnClickListener(v -> {  
            updateAllTermsCheckState();  
        });  
  
        // "동의하고 가입하기" 버튼  
        binding.btnNext.setOnClickListener(v -> {  
            signUp();  
        });  
    }  
  
    /**  
     * 실제 회원가입이 이루어지는 메소드  
     */  
    private void signUp() {  
        // 인텐트 진입점 확인  
        String extraValue = getIntent().getStringExtra("from");  
        String entryPoint = extraValue != null ? extraValue : "";  
        Log.d(TAG, "signUp: 인텐트 진입점 " + entryPoint);  
  
        // 이전화면에서 저장한 회원가입 요청 객체 받아옴  
        RegisterRequest request = (RegisterRequest) TempStorage.getItem("registerRequest");  
        request.agreeList = getAgreeList(); // 약관 동의 목록 추가  
        Log.d(TAG, "이전화면에서 저장한 회원가입 요청 객체 : " + request);  
  
        // 회원가입 api 요청  
        AuthApiClient.getInstance().register(request).enqueue(new Callback<RegisterResponse>() {  
            @Override  
            public void onResponse(Call<RegisterResponse> call, Response<RegisterResponse> response) {  
                if (response.isSuccessful()) {  
  
                    if (response.body().status.equals("success")) {  
                        // 회원가입 성공  
                        Log.d(TAG, "회원가입 성공");  
                        Toast.makeText(AgreeToTermsActivity.this, "회원가입이 완료되었습니다.", Toast.LENGTH_SHORT).show();  
  
                        // 토큰을 쉐어드에 저장  
                        RegisterResponse registerResponse = response.body();  
                        String token = registerResponse.token;  
                        TokenRepository.setToken(token);  
                        Log.d(TAG, "발급받은 토큰 저장함 " + token);  
  
                        // 유저 아이디를 로컬에 저장  
                        SPHelper.setUserId(registerResponse.data.id);  
                        SPHelper.put("nickname", registerResponse.data.nickname);  
                        SPHelper.put("profileImage", registerResponse.data.profileImage);  
                        // 유저정보 저장  
                        TempStorage.setMe(registerResponse.data);  
  
                        // 소켓 서비스 실행  
                        Intent serviceIntent = new Intent(getApplicationContext(), ChattingSocketService.class);  
                        startService(serviceIntent);  
  
                        // 가입 성공시 홈 화면으로  
                        Intent intent = new Intent(AgreeToTermsActivity.this, MainActivity.class);  
                        // 가입 성공후 홈화면에서 뒤로가면 앱이 꺼지도록하기  
                        intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);  
  
                        TempStorage.removeItem("user"); // 더이상 필요 없으므로 제거, 회원가입 단계의 문제는 여기서 발생함  
  
                        startActivity(intent);  
                    } else {  
                        Log.d(TAG, "onResponse: 유효성 체크 실패 " + response.body().messages);  
                    }  
                } else {  
                    Log.d(TAG, "onResponse: 에러 응답 " + response.errorBody());  
                    Toast.makeText(AgreeToTermsActivity.this,  
                            "가입에 실패했습니다. 나중에 시도해 주세요 (fail)",  
                            Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<RegisterResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
                Toast.makeText(AgreeToTermsActivity.this,  
                        "가입에 실패했습니다. 나중에 시도해 주세요 (fail)",  
                        Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    // 약관동의 Spannable 세팅  
    private void setSpannable() {  
        Utils.makeTextSpannable(binding.tvServiceTerm, "[필수] 서비스 이용약관 동의", "서비스 이용약관", v -> {  
            moveTo(FullTermsActivity.class, "서비스 이용약관");  
        });  
  
        Utils.makeTextSpannable(binding.tvPrivacyTerm, "[필수] 개인정보 처리방침 동의", "개인정보 처리방침", v -> {  
            moveTo(FullTermsActivity.class, "개인정보 처리방침");  
        });  
    }  
  
  
  
    /**  
     * 액티비티 이동  
     *  
     * @param cls       이동할 액티비티 클래스.class  
     * @param extraData extra에 담을 데이터  
     */  
    private void moveTo(Class<?> cls, String extraData) {  
        Intent intent = new Intent(this, cls);  
        intent.putExtra("terms", extraData);  
        startActivity(intent);  
    }  
  
    // 모든 항목 동의 시 '모두동의 체크박스' 체크  
    private void updateAllTermsCheckState() {  
        binding.checkAllTerms.setChecked(isCheckedAllTerms());  
        // 약관체크시 다음 버튼 활성화 상태 변경  
        updateNextButtonState();  
    }  
  
    // 회원가입에 필요한 모든 입력을 마치면 '가입하기' 버튼이 활성화  
    private void updateNextButtonState() {  
        //  회원정보 입력 확인 && 약관 동의 확인  
        binding.btnNext.setEnabled(isCheckedAllTerms());  
    }  
  
    // 약관 모두 체크 -> true 반환  
    // 나중에 선택약관이 생긴다면 필수약관만 체크되었는지 확인하는 메소드 필요함  
    private boolean isCheckedAllTerms() {  
        return binding.checkServiceTerm.isChecked() && binding.checkPrivacyTerm.isChecked();  
    }  
  
    // 사용자가 동의한 약관의 목록을 반환하는 메소드  
    private List<Integer> getAgreeList() {  
        List<Integer> agreeList = new ArrayList<>();  
        if (binding.checkServiceTerm.isChecked()) agreeList.add(1);  
        if (binding.checkPrivacyTerm.isChecked()) agreeList.add(2);  
  
        return agreeList;  
    }  
  
  
}  
</document_content>  
</document>  
<document index="110">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\BannedUserListActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.databinding.ActivityBannedUserListBinding;  
  
/**  
 * 차단유저 목록 화면  
 */  
public class BannedUserListActivity extends AppCompatActivity {  
  
    private final String TAG = BannedUserListActivity.class.getSimpleName();  
    ActivityBannedUserListBinding binding;  
  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        setView();  
        setListener();  
    }  
  
    private void setView(){  
        binding = ActivityBannedUserListBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
    }  
  
    private void setListener() {  
        binding.backButton.setOnClickListener(v -> onBackPressed());  
    }  
}  
</document_content>  
</document>  
<document index="111">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\ChangeDescriptionActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.command.RoomInfoCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.databinding.ActivityChangeDescriptionBinding;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.util.DBHelper;  
import com.teamnova.assa.util.TempStorage;  
  
/**  
 * 오픈채팅방 소개글 변경  
 */  
public class ChangeDescriptionActivity extends AppCompatActivity {  
  
    public static final String TAG = ChangeDescriptionActivity.class.getSimpleName();  
    ActivityChangeDescriptionBinding binding;  
  
    DBHelper dbHelper;  
    long roomId;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityChangeDescriptionBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        dbHelper = GlobalApplication.dbHelper;  
  
        initToolbar("오픈채팅방 소개글 변경");  
  
        // 기존 이름을 입력창에 삽입  
        roomId = getIntent().getLongExtra("roomId", 0);  
        ChatRoom chatroom = dbHelper.getChatRoomInfo(roomId);  
        String oldDescription = chatroom.description;  
        binding.tietNewRoomName.setText(oldDescription);  
  
        // 바로 포커싱  
        binding.tilNewRoomName.requestFocus();  
    }  
  
    private void initToolbar(String title) {  
        Log.d(TAG, "initToolbar: START");  
  
        Log.d(TAG, "initToolbar: toolbarTitle=" + title);  
        binding.toolbarRoomNameChange.setTitle(title);  
        setSupportActionBar(binding.toolbarRoomNameChange);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
        getSupportActionBar().setDisplayShowHomeEnabled(true);  
  
        Log.d(TAG, "initToolbar: END");  
    }  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        getMenuInflater().inflate(R.menu.menu_next, menu);  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onPrepareOptionsMenu(Menu menu) {  
        MenuItem item = menu.findItem(R.id.menu_next);  
        item.setTitle("저장");  
        item.setEnabled(true);  
        return super.onPrepareOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int itemId = item.getItemId();  
        if (itemId == android.R.id.home) {  
            onBackPressed();  
        } else if (itemId == R.id.menu_next) {  
  
            String input = binding.tietNewRoomName.getText().toString();  
            Log.d(TAG, "onOptionsItemSelected: 사용자의 입력값 = " + input);  
  
            RoomInfoCommand command = new RoomInfoCommand(0L, roomId, null);  
            command.description = input;  
  
            Intent intent = new Intent(this, ChattingSocketService.class);  
            intent.putExtra("message", command.toJson());  
            startService(intent);  
  
            Toast.makeText(this, "채팅방 소개글이 저장되었습니다.", Toast.LENGTH_SHORT).show();  
            TempStorage.setItem("newDescription", input);  
  
            onBackPressed();  
            return true;  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    @Override  
    public void onBackPressed() {  
        ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
        Intent intent = new Intent();  
        intent.putExtra("roomName", chatRoom.getRoomName());  
        setResult(RESULT_OK, intent);  
  
        super.onBackPressed();  
    }  
}  
</document_content>  
</document>  
<document index="112">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\ChangeOpenChatRoomNameActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.command.RoomInfoCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.databinding.ActivityChangeOpenChatRoomNameBinding;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.util.DBHelper;  
import com.teamnova.assa.util.TempStorage;  
  
/**  
 * 오픈챗 이름 변경  
 */  
public class ChangeOpenChatRoomNameActivity extends AppCompatActivity {  
  
    public static final String TAG = ChangeOpenChatRoomNameActivity.class.getSimpleName();  
    ActivityChangeOpenChatRoomNameBinding binding;  
  
    DBHelper dbHelper;  
    long roomId;  
  
    private int inputLength = 0;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityChangeOpenChatRoomNameBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        dbHelper = GlobalApplication.dbHelper;  
  
        initToolbar("오픈채팅방 이름 변경");  
  
        // 기존 이름을 입력창에 삽입  
        roomId = getIntent().getLongExtra("roomId", 0);  
        ChatRoom chatroom = dbHelper.getChatRoomInfo(roomId);  
        String oldName = chatroom.getRoomName();  
        binding.tietNewRoomName.setText(oldName);  
        inputLength = oldName.length();  
  
        // 공백 입력했는지 검사  
        binding.tietNewRoomName.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String input = s.toString();  
                inputLength = input.length();  
                Log.d(TAG, "afterTextChanged: inputLength = " + inputLength);  
  
                if (input.isEmpty()) {  
                    binding.tilNewRoomName.setError("채팅방 이름을 입력해주세요.");  
                } else {  
                    binding.tilNewRoomName.setError(null);  
                }  
                invalidateOptionsMenu(); // onPrepareOptionsMenu() 호출  
            }  
        });  
  
        // 바로 포커싱  
        binding.tilNewRoomName.requestFocus();  
    }  
  
    private void initToolbar(String title) {  
        Log.d(TAG, "initToolbar: START");  
  
        Log.d(TAG, "initToolbar: toolbarTitle=" + title);  
        binding.toolbarRoomNameChange.setTitle(title);  
        setSupportActionBar(binding.toolbarRoomNameChange);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
        getSupportActionBar().setDisplayShowHomeEnabled(true);  
  
        Log.d(TAG, "initToolbar: END");  
    }  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        getMenuInflater().inflate(R.menu.menu_next, menu);  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onPrepareOptionsMenu(Menu menu) {  
        MenuItem item = menu.findItem(R.id.menu_next);  
        item.setTitle("저장");  
  
        Log.d(TAG, "onPrepareOptionsMenu: inputLength = " + inputLength);  
        if (inputLength <= 0) {  
            item.setEnabled(false);  
        } else {  
            item.setEnabled(true);  
        }  
        return super.onPrepareOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int itemId = item.getItemId();  
        if (itemId == android.R.id.home) {  
            onBackPressed();  
        } else if (itemId == R.id.menu_next) {  
  
            String input = binding.tietNewRoomName.getText().toString();  
            Log.d(TAG, "onOptionsItemSelected: 사용자의 입력값 = " + input);  
  
            RoomInfoCommand command = new RoomInfoCommand(0L, roomId, null);  
            command.roomName = input;  
  
            Intent intent = new Intent(this, ChattingSocketService.class);  
            intent.putExtra("message", command.toJson());  
            startService(intent);  
  
            TempStorage.setItem("newChatName", input);  
  
            Toast.makeText(this, "채팅방 이름이 변경되었습니다.", Toast.LENGTH_SHORT).show();  
  
            onBackPressed();  
            return true;  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    @Override  
    public void onBackPressed() {  
        ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
        Intent intent = new Intent();  
        intent.putExtra("roomName", chatRoom.getRoomName());  
        setResult(RESULT_OK, intent);  
  
        super.onBackPressed();  
    }  
}  
</document_content>  
</document>  
<document index="113">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\ChangePasswordActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.widget.Toast;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.ChangePasswordRequest;  
import com.teamnova.assa.data.dto.response.SuccessResponse;  
import com.teamnova.assa.data.retrofit.clients.AuthApiClient;  
import com.teamnova.assa.databinding.ActivityChangePasswordBinding;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 비밀번호 변경 화면  
 */  
public class ChangePasswordActivity extends AppCompatActivity {  
  
    private static final String TAG = "ChangePasswordActivity";  
    ActivityChangePasswordBinding binding;  
  
    // 각 입력창 플래그  
    boolean isCurrentPasswordValid = false;  
    boolean isNewPasswordValid = false;  
    boolean isReNewPasswordValid = false;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        setView();  
        setListener();  
    }  
  
    private void setView() {  
        binding = ActivityChangePasswordBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
    }  
  
    private void setListener() {  
        // 뒤로가기 버튼  
        binding.backButton.setOnClickListener(v -> onBackPressed());  
  
        // 저장하기 버튼  
        binding.tvSaveEditProfile.setOnClickListener(v -> {  
            save();  
        });  
  
        setTextWatcher();  
    }  
  
    // 변경내용 저장  
    private void save() {  
        // 내부적으론 변경과 재설정이 동일하게 작동함  
        getUserData();  
    }  
  
    private void getUserData(){  
        AuthApiClient.getInstance().me().enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                Log.d(TAG, "onResponse: 사용자 정보 가져오기 응답 성공 " + response);  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "사용자 정보 가져오기 성공" + response.body());  
                    UserData userData = response.body();  
  
                    String currentPassword = binding.tietCurrentPassword.getText().toString();  
                    String newPassword = binding.tietNewPassword.getText().toString();  
  
                    sendChangePasswordRequest(userData.id, currentPassword, newPassword);  
                } else {  
                    Log.d(TAG, "사용자 정보 가져오기 에러 응답");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "사용자 정보 가져오기 실패", throwable);  
            }  
        });  
    }  
  
    // 비밀번호 변경 요청 보냄  
    private void sendChangePasswordRequest(Long userId, String currentPassword, String newPassword) {  
        ChangePasswordRequest changePasswordRequest = new ChangePasswordRequest();  
        changePasswordRequest.id = userId;  
        changePasswordRequest.currentPassword = currentPassword;  
        changePasswordRequest.newPassword = newPassword;  
  
        // 저장하기 버튼 비활성화  
        binding.tvSaveEditProfile.setEnabled(false);  
  
        AuthApiClient.getInstance().changePassword(changePasswordRequest).enqueue(new Callback<SuccessResponse>() {  
            @Override  
            public void onResponse(Call<SuccessResponse> call, Response<SuccessResponse> response) {  
                Log.d(TAG, "비번 변경 응답 도착 - " + response);  
                if (response.isSuccessful() && response.body() != null && response.body().isSuccess) {  
                    Log.d(TAG, "비번 변경 성공");  
                    Toast.makeText(ChangePasswordActivity.this, "비밀번호가 변경되었습니다.", Toast.LENGTH_SHORT).show();  
                    binding.tilCurrentPassword.setError(null);  
  
                } else if(response.body().message.equals("password not match")){  
                    binding.tilCurrentPassword.setError("비밀번호를 올바르게 입력해주세요.");  
                    Toast.makeText(ChangePasswordActivity.this, "비밀번호를 올바르게 입력해주세요.", Toast.LENGTH_SHORT).show();  
  
                } else {  
                    Log.d(TAG, "비번 변경 에러 응답");  
                    Toast.makeText(ChangePasswordActivity.this, "비밀번호 변경에 실패했습니다.(에러)", Toast.LENGTH_SHORT).show();  
                }  
  
                // 저장하기 버튼 활성화  
                binding.tvSaveEditProfile.setEnabled(true);  
            }  
  
            @Override  
            public void onFailure(Call<SuccessResponse> call, Throwable throwable) {  
                Log.e(TAG, "비밀번호 변경 실패", throwable);  
                Toast.makeText(ChangePasswordActivity.this, "비밀번호 변경에 실패했습니다.(실패)", Toast.LENGTH_SHORT).show();  
                // 저장하기 버튼 활성화  
                binding.tvSaveEditProfile.setEnabled(true);  
            }  
        });  
    }  
  
  
    private void setTextWatcher() {  
        // 각 텍스트 와쳐는 자기들의 조건에 따라 플래그를 크고 끼며. 다른 메소드에서 해당 프래그를 참조하여  
        // 저장버튼을 활성화하거나 비활성화 한다.  
  
        // 현재 비밀번호 eidtText  
        binding.tietCurrentPassword.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                isCurrentPasswordValid = !s.toString().isEmpty();  
                trySaveButtonEnable();  
            }  
        });  
  
        // 새 비밀번호  
        binding.tietNewPassword.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String input = s.toString();  
  
                // 최소길이 검사  
                if (input.length() < 8) {  
                    binding.tilNewPassword.setError("비밀번호는 8자리 이상이어야 합니다");  
                    isNewPasswordValid = false;  
                    return;  
                }  
  
                // 형식확인 (영문, 숫자, 특수문자(!@#$%^&*()-_=+\\|[]{};:'",<.>/?) 조합)  
                // 각 문자 최소 1개는 포함  
                if (!input.matches("^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*()\\-_=+\\\\|\\[\\]{};:'\",<.>/?]).*$")) {  
                    binding.tilNewPassword.setError("올바르지 않은 비밀번호 형식입니다\n"  
                            + "영문, 숫자, 특수문자가 모두 포함되어야 합니다.\n"  
                            + "허용된 특수문자(!@#$%^&*()-_=+\\\\|[]{};:'\",<.>/?)");  
                    isNewPasswordValid = false;  
                    return;  
                }  
  
                // 기존 비번과 다른지 확인  
                if(input.equals(binding.tietCurrentPassword.getText().toString())){  
                    binding.tilNewPassword.setError("새 비밀번호는 기존 비밀번호와 같을 수 없습니다");  
                    isNewPasswordValid = false;  
                    return;  
                }  
  
  
                // 정상입력 확인  
                binding.tilNewPassword.setError(null);  
                isNewPasswordValid = true;  
                trySaveButtonEnable();  
            }  
        });  
  
        // 새 비밀번호 재입력  
        binding.tietReNewPassword.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String input = s.toString();  
  
                // 새 비밀번호와 불일치  
                if(!input.equals(binding.tietNewPassword.getText().toString())){  
                    binding.tilReNewPassword.setError("새 비밀번호가 일치하지 않습니다");  
                    isReNewPasswordValid = false;  
                    return;  
                }  
  
                // 정상입력 확인  
                binding.tilReNewPassword.setError(null);  
                isReNewPasswordValid = true;  
                trySaveButtonEnable();  
            }  
        });  
    }  
  
    // 저장버튼 활성화 시도  
    private void trySaveButtonEnable() {  
        binding.tvSaveEditProfile.setEnabled(isSavable());  
    }  
  
    // 저장버튼 활성화 가능 여부 판별  
    private boolean isSavable() {  
        // 모든 플래그가 true이면 저장버튼 활성화  
        return isCurrentPasswordValid && isNewPasswordValid && isReNewPasswordValid;  
    }  
  
}  
</document_content>  
</document>  
<document index="114">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\ChangeRoomNameActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.databinding.ActivityChangeRoomNameBinding;  
import com.teamnova.assa.util.DBHelper;  
  
public class ChangeRoomNameActivity extends AppCompatActivity {  
  
    public static final String TAG = ChangeRoomNameActivity.class.getSimpleName();  
    ActivityChangeRoomNameBinding binding;  
  
    DBHelper dbHelper;  
    long roomId;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityChangeRoomNameBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        dbHelper = GlobalApplication.dbHelper;  
  
        initToolbar("채팅방 표시이름 변경");  
  
        // 기존 이름을 입력창에 삽입  
        roomId = getIntent().getLongExtra("roomId", 0);  
        ChatRoom chatroom = dbHelper.getChatRoomInfo(roomId);  
        String oldName = chatroom.getRoomName();  
        binding.tietNewRoomName.setText(oldName);  
  
        // 바로 포커싱  
        binding.tilNewRoomName.requestFocus();  
    }  
  
    private void initToolbar(String title) {  
        Log.d(TAG, "initToolbar: START");  
  
        Log.d(TAG, "initToolbar: toolbarTitle=" + title);  
        binding.toolbarRoomNameChange.setTitle(title);  
        setSupportActionBar(binding.toolbarRoomNameChange);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
        getSupportActionBar().setDisplayShowHomeEnabled(true);  
  
        Log.d(TAG, "initToolbar: END");  
    }  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        getMenuInflater().inflate(R.menu.menu_next, menu);  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onPrepareOptionsMenu(Menu menu) {  
        MenuItem item = menu.findItem(R.id.menu_next);  
        item.setTitle("저장");  
        item.setEnabled(true);  
        return super.onPrepareOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int itemId = item.getItemId();  
        if (itemId == android.R.id.home) {  
            onBackPressed();  
        } else if (itemId == R.id.menu_next) {  
  
            String input = binding.tietNewRoomName.getText().toString();  
            Log.d(TAG, "onOptionsItemSelected: 사용자의 입력값 = " + input);  
            ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
  
            dbHelper.updateLocalRoomName(roomId, input);  
  
            Toast.makeText(this, "채팅방 이름이 저장되었습니다.", Toast.LENGTH_SHORT).show();  
  
            onBackPressed();  
            return true;  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    @Override  
    public void onBackPressed() {  
        ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
        Intent intent = new Intent();  
        intent.putExtra("roomName", chatRoom.getRoomName());  
        setResult(RESULT_OK, intent);  
  
        super.onBackPressed();  
    }  
}  
</document_content>  
</document>  
<document index="115">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\ChatRoomActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.Manifest;  
import android.content.BroadcastReceiver;  
import android.content.Context;  
import android.content.Intent;  
import android.content.IntentFilter;  
import android.content.pm.PackageManager;  
import android.net.Uri;  
import android.os.Bundle;  
import android.os.Handler;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.view.View;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.appcompat.app.AlertDialog;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.core.view.GravityCompat;  
import androidx.drawerlayout.widget.DrawerLayout;  
import androidx.localbroadcastmanager.content.LocalBroadcastManager;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.google.gson.Gson;  
import com.google.gson.JsonObject;  
import com.google.gson.JsonParser;  
import com.google.gson.reflect.TypeToken;  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.command.Action;  
import com.teamnova.assa.command.CreateRoomCommand;  
import com.teamnova.assa.command.ExitRoomCommand;  
import com.teamnova.assa.command.InviteCommand;  
import com.teamnova.assa.command.RoomInfoCommand;  
import com.teamnova.assa.command.SendMessageCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.databinding.ActivityChatRoomBinding;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.ui.adapter.ChatMemberAdapter;  
import com.teamnova.assa.ui.adapter.MessageAdapter;  
import com.teamnova.assa.util.DBHelper;  
import com.teamnova.assa.util.FileUploader;  
import com.teamnova.assa.util.ImageCompressor;  
  
import java.io.File;  
import java.io.IOException;  
import java.lang.reflect.Type;  
import java.util.ArrayList;  
import java.util.List;  
import java.util.concurrent.ExecutorService;  
import java.util.concurrent.Executors;  
  
import gun0912.tedimagepicker.builder.TedImagePicker;  
import gun0912.tedimagepicker.builder.type.MediaType;  
  
/**  
 * 채팅방 화면 액티비티 (일반 채팅, 오픈 채팅 공통)  
 */  
public class ChatRoomActivity extends AppCompatActivity {  
    private static final String TAG = ChatRoomActivity.class.getSimpleName();  
    public ActivityChatRoomBinding binding;  
  
    List<SendMessageCommand> messageList = new ArrayList<>();  
    public static List<SimpleUser> memberList = new ArrayList<>();  // 0번은 항상 자기 자신임  
    public boolean isNewRoom = false;  
    public boolean isOpenChat = false;  
    public boolean isNewMember = false;  
  
    // 리사이클러 뷰  
    RecyclerView chatRecyclerView;  
    MessageAdapter messageAdapter;  
    ChatMemberAdapter chatMemberAdapter;  
    LinearLayoutManager ChatLayoutManager;  
  
    // 채팅방 정보  
    public static long roomId = 0;    // 현재 화면에 나타난 방 id 번호  
    private long savedRoomId;  
    String roomName;  
    String chatTitle; // 상단 툴바에 나오는 채팅방 제목 표시 (채팅방 목록에서 보는 제목과는 조금 다름)  
  
    // startActivityForResult를 위한 코드  
    public static final int INVITATION_REQUEST_CODE = 100;  
    public static final int NAME_CHANGE_REQUEST_CODE = 200;  
  
    Handler mHandler;  
    DBHelper dbHelper;  
  
    int CAMERA_PERMISSION_CODE = 1001;  
  
  
    private final String[] permissionList = {  
            Manifest.permission.CAMERA  
    };  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        Log.i(TAG, "onCreate: START");  
        super.onCreate(savedInstanceState);  
        binding = ActivityChatRoomBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        mHandler = new Handler();  
        dbHelper = GlobalApplication.dbHelper;  
        roomId = getIntent().getLongExtra("roomId", 0);  
  
        // 새 채팅방 여부 저장  
        isNewRoom = getIntent().getBooleanExtra("isNewRoom", false);  
        Log.d(TAG, "initDataFromIntent: isNewRoom=" + isNewRoom);  
  
        // 오픈 채팅 여부  
        isOpenChat = getIntent().getBooleanExtra("isOpenChat", false);  
        Log.d(TAG, "initDataFromIntent: isOpenChat=" + isOpenChat);  
  
        // 오픈 채팅 신규입장 여부  
        isNewMember = getIntent().getBooleanExtra("isNewMember", false);  
        Log.d(TAG, "initDataFromIntent: isNewMember=" + isNewMember);  
  
        initChatRecyclerView(); // 첫 번째로 고정 (멤버 변수 초기화 때문)  
        initSideRecyclerView(); // 두 번째로 고정  
        initDataFromIntent();  
        initDrawerLayout();  
        initListeners();  
  
        Log.i(TAG, "onCreate: END");  
    }  
  
    // 인텐트로 받아온 데이터 저장 (멤버리스트, 새 채팅방 여부)  
    private void initDataFromIntent() {  
        Log.i(TAG, "initDataFromIntent: start");  
  
        if (!isOpenChat) {  
            // 오픈 채팅이 아닌 경우  
            if (isNewRoom) {  
                // 새 채팅방이면 채팅방 멤버정보를 서버로 전송한다.  
  
                // 초대한 멤버 목록 저장  
                String invitedMemberJson = getIntent().getStringExtra("invited_member");  
                Log.d(TAG, "initDataFromIntent: invitedMemberJson=" + invitedMemberJson);  
  
                // json 문자열을 리스트로 변환  
                assert invitedMemberJson != null;  
                Type listType = new TypeToken<List<Long>>() {  
                }.getType();  
                List<Long> userIdList = new Gson().fromJson(invitedMemberJson, listType);  
  
                // 방 생성자도 멤버에 추가  
                userIdList.add(SPHelper.getUserId());  
                Log.d(TAG, "initDataFromIntent: 전체 멤버리스트 : " + userIdList);  
  
                // 커맨드 생성  
                CreateRoomCommand command = new CreateRoomCommand(userIdList);  
  
                // 메시지 전송  
                sendMessage(command.toJson());  
            } else {  
                // 기존에 있던 방에 참여한 것이라면  
  
                savedRoomId = roomId;  
                Log.d(TAG, "initDataFromIntent: roomId = " + roomId);  
  
                // 채팅방 정보 불러오기  
                requestRoomData(roomId);  
  
                // 채팅 기록 불러오기  
                loadMessages(roomId, 0);  
  
                // unread Count 초기화  
                dbHelper.setUnReadMessageToRead(roomId);  
            }  
        } else {  
            Log.i(TAG, "initDataFromIntent: 오픈채팅");  
            // 오픈 채팅인 경우  
            if (isNewRoom) {  
                Log.i(TAG, "initDataFromIntent: 생성");  
                // 새 채팅방 생성  
  
                // 이전화면에서 데이터 받아오기  
                String roomName = getIntent().getStringExtra("roomName");  
                String description = getIntent().getStringExtra("description");  
                Log.d(TAG, "initDataFromIntent: roomName=" + roomName + ", description=" + description);  
  
                // 커맨드 생성  
                CreateRoomCommand command = new CreateRoomCommand(roomName, description, CreateRoomCommand.RoomType.OPEN);  
  
                // 멤버에 생성자 포함 시키기  
                command.invitedIdList = new ArrayList<>();  
                command.invitedIdList.add(SPHelper.getUserId());  
                Log.d(TAG, "initDataFromIntent: 전체 멤버리스트 : " + command.invitedIdList);  
  
                // 커맨드 전송  
                sendMessage(command.toJson());  
            } else if (isNewMember) {  
                // 외부 인원 신규 입장  
                Log.i(TAG, "initDataFromIntent: 외부 인원 신규 입장");  
  
                Long roomId = getIntent().getLongExtra("roomId", 0);  
  
                // 신규 진입은 자기 자신을 초대한 것과 동일하게 처리한다.  
                List<Long> userIdList = new ArrayList<>();  
                userIdList.add(SPHelper.getUserId());  
  
                // 커맨드 전송  
                InviteCommand command = new InviteCommand(0L, roomId, null, userIdList, 0L);  
                command.roomType = CreateRoomCommand.RoomType.OPEN;  
                command.isNewOpenChatMember = true;  
                sendMessage(command.toJson());  
            } else {  
                Log.i(TAG, "initDataFromIntent: 로컬에 저장된 방 참여");  
  
                // 기존에 있던 방에 참여한 것이라면  
                roomId = getIntent().getLongExtra("roomId", 0);  
                savedRoomId = roomId;  
                Log.d(TAG, "initDataFromIntent: roomId = " + roomId);  
  
                // 채팅방 정보 불러오기  
                requestRoomData(roomId);  
  
                // 채팅 기록 불러오기  
                loadMessages(roomId, 0);  
  
                // unread Count 초기화  
                dbHelper.setUnReadMessageToRead(roomId);  
  
                // 방장 없으며 채팅방 비활성화  
                blockSendMsgWhenHostExit();  
            }  
        }  
  
        Log.i(TAG, "initDataFromIntent: end");  
    }  
  
    private boolean chatRoomDeactivate = false;  
  
    private void blockSendMsgWhenHostExit() {  
        Log.i(TAG, "blockSendMsgWhenHostExit: START");  
        // 오픈채팅방에서 방장이 나가면 더이상 메시지 입력이 불가  
        ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
  
        runOnUiThread(() -> {  
            if (chatRoom.roomType == CreateRoomCommand.RoomType.OPEN  
                    && chatRoom.masterId == 0) {  
                chatRoomDeactivate = true;  
                binding.llChatroomBottom.setVisibility(View.GONE);  
                binding.tvIndicator.setText("방장이 퇴장하여 채팅방이 비활성화 되었습니다.");  
                binding.tvIndicator.setVisibility(View.VISIBLE);  
                chatMemberAdapter.setShowHeader(false);  
//                invalidateOptionsMenu();  
            }  
  
        });  
        Log.i(TAG, "blockSendMsgWhenHostExit: END");  
    }  
  
    /**  
     * 로컬에 저장된 채팅 기록 불러오기  
     *  
     * @param roomId  
     * @param offset - 불러올 채팅 기록 시작점  
     */  
    private void loadMessages(long roomId, int offset) {  
        Log.d(TAG, "loadMessages: START - params: roomId = " + roomId);  
  
        int firstSize = messageAdapter.getItemCount();  
  
        // 한 오프셋에 채팅기록 100개씩 가져온다.  
        List<SendMessageCommand> messageList = dbHelper.getChatLog(roomId, offset);  
        messageAdapter.addAll(messageList);  
        messageAdapter.notifyDataSetChanged();  
  
        // 첫 진입 시 최 하단으로 스크롤  
        if (offset == 0 && firstSize == 0) {  
            runOnUiThread(() -> {  
                chatRecyclerView.scrollToPosition(messageAdapter.getItemCount() - 1);  
            });  
        }  
  
        Log.d(TAG, "loadMessages: END");  
    }  
  
    // 툴바 설정  
    private void initToolbar(String title) {  
        Log.i(TAG, "initToolbar: START");  
  
        Log.d(TAG, "initToolbar: toolbarTitle=" + title);  
        binding.toolbarChatroom.setTitle(title);  
        setSupportActionBar(binding.toolbarChatroom);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
        getSupportActionBar().setDisplayShowHomeEnabled(true);  
  
        Log.i(TAG, "initToolbar: END");  
    }  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        getMenuInflater().inflate(R.menu.menu_chatroom, menu);  
  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int itemId = item.getItemId();  
        if (itemId == android.R.id.home) {  
            onBackPressed();  
        } else if (itemId == R.id.item_chatroom_search) {  
            // 메시지 검색 칸 열림  
            Toast.makeText(this, "메시지 검색", Toast.LENGTH_SHORT).show();  
            return true;  
        } else if (itemId == R.id.item_chatroom_videoCall) {  
  
            if(chatRoomDeactivate){  
                Toast.makeText(this, "비활성화 된 채팅방에서는 영상통화가 불가합니다.", Toast.LENGTH_LONG).show();  
            } else {  
                Log.d(TAG, "onOptionsItemSelected: 영상회의 생성");  
                // 영상통화 화면으로 이동  
                Intent intent = new Intent(this, VideoCallActivity.class);  
                intent.putExtra("roomId", roomId);  
                intent.putExtra("isHost", true);  
                startActivity(intent);  
            }  
  
            return true;  
        } else if (itemId == R.id.item_chatroom_sideDrawer) {  
            // 측면 서랍 열기  
            DrawerLayout drawer = binding.dlChatroom;  
            if (!drawer.isDrawerOpen(binding.llChatroomSidemenu.getRoot())) {  
                drawer.openDrawer(binding.llChatroomSidemenu.getRoot());  
            }  
            return true;  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    @Override  
    public void onBackPressed() {  
        Log.d(TAG, "onBackPressed: START");  
        List<SendMessageCommand> messageList = dbHelper.getChatLog(roomId, 0);  
  
        // 방을 생성한 다음 아무런 채팅을 입력하지 않고 뒤로 나간다면, 채팅방 퇴장과 동일하게 처리한다.  
        if (messageList.isEmpty()) {  
            Log.i(TAG, "onBackPressed: 아무 메시지를 생성하지 않은 상태에서 뒤로 갔음");  
            exitRoom();  
        }  
        super.onBackPressed();  
        Log.d(TAG, "onBackPressed: END");  
    }  
  
    // 채팅방 메시지 목록 리사이클러뷰 초기화  
    private void initChatRecyclerView() {  
        chatRecyclerView = binding.rvChat;  
        chatRecyclerView.setHasFixedSize(true);  
  
        ChatLayoutManager = new LinearLayoutManager(this);  
        ChatLayoutManager.setStackFromEnd(true);  
        chatRecyclerView.setLayoutManager(ChatLayoutManager);  
  
        messageAdapter = new MessageAdapter(this, messageList, roomId);  
        chatRecyclerView.setAdapter(messageAdapter);  
    }  
  
    // 채팅방 멤버 리사이클러 뷰 초기화  
    private void initSideRecyclerView() {  
        // 맨 상단에는 + 멤버초대 칸이 있어야 함 해당버튼은 추가 대화상대를 초대할 때 사용된다.  
  
        RecyclerView rv = binding.llChatroomSidemenu.rvMember;  
        rv.setHasFixedSize(true);  
        rv.setLayoutManager(new LinearLayoutManager(this));  
        rv.addItemDecoration(new DividerItemDecoration(this, DividerItemDecoration.VERTICAL));  
  
        // 어댑터  
        chatMemberAdapter = new ChatMemberAdapter(this, roomId, savedRoomId -> {  
            // 대화 상대 초대 클릭 시 실행되는 코드  
  
            // 인텐트 생성  
            Intent intent = new Intent(ChatRoomActivity.this, SelectFriendsActivity.class);  
            intent.putExtra("roomId", savedRoomId);  
            intent.putExtra("isNewRoom", false);  
  
            Log.d(TAG, "HeaderViewHolder: roomId=" + savedRoomId);  
  
            SPHelper.put("roomId", String.valueOf(savedRoomId));  
  
            startActivityForResult(intent, INVITATION_REQUEST_CODE);  
  
            // 드로어 닫기  
            binding.dlChatroom.closeDrawer(GravityCompat.END);  
        });  
        rv.setAdapter(chatMemberAdapter);  
    }  
  
    // 오른쪽 드로어 설정  
    private void initDrawerLayout() {  
        DrawerLayout dl = binding.dlChatroom;  
        // 드로어 뒤쪽 터치 방지  
        binding.llChatroomSidemenu.getRoot().setOnClickListener(v -> {  
        });  
  
        // 드로어 상태에 따른 제스처 온 오프  
        dl.addDrawerListener(new DrawerLayout.DrawerListener() {  
            @Override  
            public void onDrawerSlide(@NonNull View drawerView, float slideOffset) {  
  
            }  
  
            @Override  
            public void onDrawerOpened(@NonNull View drawerView) {  
                // 제스처로 닫을 수 있게 하기  
                dl.setDrawerLockMode(DrawerLayout.LOCK_MODE_UNLOCKED);  
            }  
  
            @Override  
            public void onDrawerClosed(@NonNull View drawerView) {  
                // 제스처로 열 수 없게 하기  
                dl.setDrawerLockMode(DrawerLayout.LOCK_MODE_LOCKED_CLOSED);  
            }  
  
            @Override  
            public void onDrawerStateChanged(int newState) {  
  
            }  
        });  
  
        // 방 생성 직후에는 로컬에 정보가 없으므로 걸러준다.  
        if (roomId != 0) {  
            // noti on / off 설정에 따른 아이콘 결정  
  
            Integer isNotiOn = dbHelper.getNotiOn(roomId);  
            if (isNotiOn == null) return;  
            if (isNotiOn == 0) {  
                binding.llChatroomSidemenu.ibChatroomToggleNotification.setImageResource(R.drawable.ic_notification);  
            } else {  
                binding.llChatroomSidemenu.ibChatroomToggleNotification.setImageResource(R.drawable.ic_bell_on);  
            }  
        }  
  
    }  
  
    // 방 정보 받아오기  
    private void requestRoomData(long roomId) {  
        Log.d(TAG, "loadRoomData: START - params: roomId = " + roomId);  
  
        // 메시지 제작  
        RoomInfoCommand command = new RoomInfoCommand(0L, roomId, null);  
        sendMessage(command.toJson());  
  
        Log.d(TAG, "loadRoomData: END");  
    }  
  
    @Override  
    protected void onResume() {  
        Log.i(TAG, "onResume: START");  
        super.onResume();  
        Log.d(TAG, "onResume: roomId = " + roomId);  
        // roomId가 세팅 된 이후에 실행  
        if (roomId != 0) updateRoomInfo(roomId);  
        Log.i(TAG, "onResume: END");  
    }  
  
    @Override  
    protected void onPause() {  
        Log.i(TAG, "onPause: START");  
        super.onPause();  
        Log.i(TAG, "onPause: END");  
    }  
  
    @Override  
    protected void onStart() {  
        super.onStart();  
        if (savedRoomId != 0) roomId = savedRoomId;  
        Log.d(TAG, "onStart: roomId = " + roomId);  
        LocalBroadcastManager.getInstance(this).registerReceiver(messageReceiver, new IntentFilter("chat_event"));  
  
        messageList.clear();  
        // 채팅 기록 불러오기  
        loadMessages(roomId, 0);  
    }  
  
    @Override  
    protected void onStop() {  
        super.onStop();  
        Log.i(TAG, "onStop: START");  
  
        // 안 읽은 메시지 전체 읽음 처리  
        dbHelper.setUnReadMessageToRead(roomId);  
  
        // 이 화면 나갈 때는 roomId를 초기화 해줘야 한다.  
        Log.d(TAG, "onStop: roomId=" + 0 + "으로 초기화");  
        roomId = 0;  
  
        LocalBroadcastManager.getInstance(this).unregisterReceiver(messageReceiver);  
        Log.i(TAG, "onStop: END");  
    }  
  
    private void initListeners() {  
        Log.i(TAG, "initListeners: START");  
  
        // 메시지 보내기 버튼  
        binding.btnSend.setOnClickListener(v -> {  
            Log.d(TAG, "initListeners: 메시지 보내기 버튼 클릭리스너 START");  
            String message = binding.etMessage.getText().toString();  
  
            SendMessageCommand command = new SendMessageCommand(roomId, message, SendMessageCommand.Type.TEXT);  
            String realMessage = command.toJson();  
            Log.d(TAG, "initListeners: message=" + message + ", realMessage=" + realMessage);  
  
            sendMessage(realMessage);  
            binding.etMessage.setText("");  
            Log.d(TAG, "initListeners: 메시지 보내기 버튼 클릭리스너 END");  
        });  
  
        // 메시지 공백 입력 방지  
        binding.etMessage.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                int length = s.length();  
                Log.d(TAG, "afterTextChanged: 메시지 입력 글자 개수 = " + length);  
                if (length > 0) {  
                    binding.btnSend.setEnabled(true);  
                } else {  
                    binding.btnSend.setEnabled(false);  
                }  
            }  
        });  
  
        // 채팅방 나가기 버튼  
        binding.llChatroomSidemenu.ibChatroomExit.setOnClickListener(v -> {  
            Log.d(TAG, "initListeners: 채팅방 나가기 버튼 클릭");  
            showExitDialog();  
        });  
  
        // 알림 on off 버튼  
        binding.llChatroomSidemenu.ibChatroomToggleNotification.setOnClickListener(v -> {  
            Log.d(TAG, "initListeners: 알림 on off 버튼 클릭");  
            int isNotiOn = dbHelper.getNotiOn(roomId);  
            Log.d(TAG, "initListeners: isNotiOn=" + isNotiOn);  
  
            if (isNotiOn == 0) {  
                // off -> on  
                // db값 변경  
                dbHelper.updateNotiOn(roomId, 1);  
                // ui변경  
                binding.llChatroomSidemenu.ibChatroomToggleNotification.setImageResource(R.drawable.ic_bell_on);  
                Toast.makeText(this, "알림이 켜졌습니다.", Toast.LENGTH_SHORT).show();  
            } else {  
                // on -> off  
                dbHelper.updateNotiOn(roomId, 0);  
                binding.llChatroomSidemenu.ibChatroomToggleNotification.setImageResource(R.drawable.ic_notification);  
                Toast.makeText(this, "알림이 꺼졌습니다.", Toast.LENGTH_SHORT).show();  
            }  
        });  
  
        // 이미지 선택 버튼  
        binding.ibSelectImage.setOnClickListener(v -> {  
            // 카메라 권한 확인  
            if (isPermissionGranted(permissionList)) {  
                // 권한이 이미 있다면, TedImagePicker를 사용해서 이미지 선택 후 가져오기  
                selectImage();  
            } else {  
                // 권한이 없다면, 권한 요청하기  
                requestPermissions(permissionList, CAMERA_PERMISSION_CODE);  
            }  
  
        });  
  
        Log.i(TAG, "initListeners: END");  
    }  
  
    // 이미 권한이 부여되어 있는지 여부를 확인하는 메서드  
    private boolean isPermissionGranted(String[] permissions) {  
        for (String permission : permissions) {  
            if (checkSelfPermission(permission) != PackageManager.PERMISSION_GRANTED) {  
                return false;  
            }  
        }  
        return true;  
    }  
  
    // 권한 요청에 대해 사용자가 허용했을 경우, selectImage() 메서드 실행  
    @Override  
    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {  
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);  
        if (requestCode == CAMERA_PERMISSION_CODE) {  
            Log.i("권한", "카메라 권한 허용됨");  
            selectImage();  
        }  
    }  
  
    //TedImagePicker를 사용해서 이미지 선택하거나 카메라로 사진 찍어서 가져오기  
    private void selectImage() {  
        TedImagePicker.with(this)  
                .mediaType(MediaType.IMAGE)  
                .max(10, "최대 10장의 사진만 선택 가능합니다")  
                .startMultiImage(uris -> {  
                    Log.d(TAG, "selectImage: 선택된 이미지 uri : " + uris);  
  
                    Log.d(TAG, "selectImage: roomId = " + roomId + ", savedRoomId = " + savedRoomId);  
                    roomId = savedRoomId;  
                    Log.d(TAG, "selectImage: roomId 복구 roomId = " + roomId);  
  
                    // 이미지가 1개 이상일 때 이미지 업로드 진행  
                    if (!uris.isEmpty()) {  
                        uploadImages(uris);  
                    }  
                });  
    }  
  
    // 주어진 uri의 이미지들을 서버로 업로드  
    private void uploadImages(List<? extends Uri> uris) {  
        Log.d(TAG, "uploadImages: START - prams: uris=" + uris);  
  
        // 이미지 업로드는 서브 스레드에서 진행  
        ExecutorService executorService = Executors.newSingleThreadExecutor();  
        executorService.execute(() -> {  
            Log.d(TAG, "uploadImages: 시작");  
            runOnUiThread(() -> {  
                binding.tvIndicator.setText("이미지 업로드 중 (" + 0 + "/" + uris.size() + ")");  
                binding.tvIndicator.setVisibility(View.VISIBLE);  
            });  
            uploadImagesSequentially(uris, 0);  
        });  
        Log.d(TAG, "uploadImages: END");  
    }  
  
    // 순차적으로 이미지를 업로드 하기 위해 재귀호출을 사용했다.  
    private void uploadImagesSequentially(List<? extends Uri> uris, int currentIndex) {  
        if (currentIndex >= uris.size()) {  
            // 모든 이미지 업로드 완료  
            binding.tvIndicator.setText("이미지 업로드 완료");  
            binding.tvIndicator.postDelayed(() -> {  
                binding.tvIndicator.setVisibility(View.GONE);  
            }, 1000);  
            return;  
        }  
  
        Uri uri = uris.get(currentIndex);  
  
        // Uri객체를 File 로 변환  
        List<File> fileList = new ArrayList<>();  
        File file = null;  
        try {  
            file = ImageCompressor.compressImage(this, uri, 85);  
        } catch (IOException e) {  
            throw new RuntimeException(e);  
        }  
        fileList.add(file);  
  
        // 파일을 서버로 업로드  
        FileUploader.uploadFiles(this, fileList, imageUrls -> {  
            Log.d(TAG, "uploadImages: 서버 응답 imageUrls = " + imageUrls);  
  
            // 결과에 대한 UI 처리  
            runOnUiThread(() -> {  
                // 메시지 커맨드 생성  
                for (String url : imageUrls) {  
                    SendMessageCommand messageCommand = new SendMessageCommand(savedRoomId, url, SendMessageCommand.Type.IMAGE);  
                    sendMessage(messageCommand.toJson());  
  
                    binding.tvIndicator.setText("이미지 업로드 중 (" + currentIndex + "/" + uris.size() + ")");  
                }  
  
                // 다음 이미지 업로드 호출  
                uploadImagesSequentially(uris, currentIndex + 1);  
            });  
        });  
    }  
  
  
    // 나가기 다이얼로그 버튼  
    private void showExitDialog() {  
        Log.d(TAG, "showExitDialog: START");  
  
        new AlertDialog.Builder(this)  
                .setTitle("채팅방 나가기")  
                .setMessage("채팅방에서 나가시겠습니까?\n모든 메시지가 삭제됩니다.")  
                .setPositiveButton("예", (dialog, which) -> {  
                    Log.d(TAG, "showExitDialog: 예 클릭");  
  
                    // 채팅방 나감 처리  
                    exitRoom();  
  
                    // 채팅방 나가기  
                    finish();  
                })  
                .setNegativeButton("아니오", (dialog, which) -> {  
                    Log.d(TAG, "showExitDialog: 이니오 클릭");  
                    dialog.dismiss();  
                })  
                .show();  
  
        Log.d(TAG, "showExitDialog: END");  
    }  
  
    // 방 나가기  
    public void exitRoom() {  
        Log.i(TAG, "exitRoom: START");  
  
        // 로컬 데이터 제거 (채팅방 데이터, 채팅 기록 제거, 채팅방 - 멤버 관계 테이블)  
        dbHelper.exitRoom(roomId);  
        Log.i(TAG, "exitRoom: 이 채팅방은 로컬에서 제거됨");  
  
        // 서버에 채팅방 나간 사실을 알림  
        ExitRoomCommand command = new ExitRoomCommand(roomId);  
        sendMessage(command.toJson());  
        Log.i(TAG, "exitRoom: END");  
    }  
  
  
    @Override  
    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {  
        super.onActivityResult(requestCode, resultCode, data);  
  
        roomId = savedRoomId;  
  
        if (requestCode == INVITATION_REQUEST_CODE && resultCode == RESULT_OK) {  
            // 초대자 목록을 서버로 전송  
            Log.d(TAG, "onActivityResult: 초대 완료");  
  
            String invited = data.getStringExtra("invited_member");  
            Log.d(TAG, "initDataFromIntent: invited=" + invited + ", roomId=" + roomId);  
  
            // json을 List<Long>으로 변환  
            Type listType = new TypeToken<List<Long>>() {  
            }.getType();  
            List<Long> userIdList = new Gson().fromJson(invited, listType);  
  
            // 명령 객체 생성  
            InviteCommand command = new InviteCommand(0L, roomId, memberList, userIdList, 0L);  
            command.isNewOpenChatMember = true;  
  
            // 서버로 메시지 전송  
            sendMessage(command.toJson());  
            return;  
        }  
        if (requestCode == NAME_CHANGE_REQUEST_CODE && resultCode == RESULT_OK) {  
            String roomName = data.getStringExtra("roomName");  
            Log.d(TAG, "onActivityResult: roomName=" + roomName);  
            binding.toolbarChatroom.setTitle(roomName);  
            Log.d(TAG, "onActivityResult: 채팅방 이름 변경 완료");  
        }  
  
    }  
  
    // 소켓 서비스에서 전송된 인텐트 감지용 리시버  
    private BroadcastReceiver messageReceiver = new BroadcastReceiver() {  
        @Override  
        public void onReceive(Context context, Intent intent) {  
            Log.i(TAG, "onReceive: START");  
            String message = intent.getStringExtra("message");  
            Log.d(TAG, "onReceive: 소켓서비스에서 전송된 메시지 = " + message);  
  
            // 메시지 파싱  
            JsonObject jsonObject = (JsonObject) JsonParser.parseString(message);  
            String actionStr = jsonObject.get("action").getAsString();  
            Log.d(TAG, "onReceive: jsonObject=" + jsonObject);  
            Log.d(TAG, "onReceive: action = " + actionStr);  
  
            Action action = Action.valueOf(actionStr);  
  
            try {  
                switch (action) {  
                    case ROOM_INFO:   // 방정보 업데이트  
                        RoomInfoCommand command = RoomInfoCommand.fromJson(jsonObject.toString());  
                        updateRoomInfo(command.roomId);  
                        break;  
                    case SEND_MESSAGE: // 채팅 메시지 수신  
                        addMessageView(SendMessageCommand.fromJson(jsonObject.toString()));  
                        break;  
                    case EXIT_ROOM: // 누군가 방을 나갔을 때  
                        roomExit(ExitRoomCommand.fromJson(jsonObject.toString()));  
                        break;  
                    case INVITE:  // 사용자를 추가적으로 초대했을 때  
                        invite(InviteCommand.fromJson(jsonObject.toString()));  
                        break;  
                    default:  
                        break;  
                }  
            } catch (Exception e) {  
                Log.e(TAG, "onReceive: " + e.getMessage(), e);  
            }  
  
  
            Log.i(TAG, "onReceive: END");  
        }  
    };  
  
    // 사용자 정보의 변화 화면 연동  
    void notifyMemberInfoChange(RoomInfoCommand command) {  
        Log.d(TAG, "updateRoomInfo: START");  
  
        // 서버 메시지 출력  
        addMessageView(command.getMessageCommand());  
  
        // 채팅방 정보 화면 업데이트  
        updateRoomInfo(command.roomId);  
  
        Log.d(TAG, "updateRoomInfo: END");  
    }  
  
  
    // 사용자를 추가적으로 초대했을 때  
    void invite(InviteCommand command) {  
        Log.d(TAG, "invite: START");  
        // 초대 메시지 출력  
        addMessageView(command.getMessageCommand());  
  
        // 채팅방 정보 화면 업데이트  
        updateRoomInfo(command.roomId);  
  
        Log.d(TAG, "invite: END");  
    }  
  
    // 누군가 방을 나갔을 때  
    void roomExit(ExitRoomCommand command) {  
        Log.d(TAG, "roomExit: START");  
  
        // 퇴장 메시지 출력  
        addMessageView(command.getMessageCommand());  
  
        // 채팅방 정보 화면 업데이트  
        updateRoomInfo(roomId);  
  
        // 오픈채팅방에서 방장이 나가면 더이상 메시지 입력이 불가  
        blockSendMsgWhenHostExit();  
  
        Log.d(TAG, "roomExit: END");  
    }  
  
    // 로컬 db에 저장된 정보 가져와서 화면에 반영  
    void updateRoomInfo(Long roomId) {  
        Log.i(TAG, "updateRoomInfo: START - params: roomId=" + roomId);  
  
        savedRoomId = roomId;  
  
        // 로컬 db에서 이 채팅방 정보 가져온다.  
        ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
        if(chatRoom == null) return;  
        // 현재 들어와 있는 유저 정보만 가져올 것  
        List<SimpleUser> users = dbHelper.getChatRoomMembers(roomId, true);  
  
        // roomId 변경  
        ChatRoomActivity.roomId = roomId;  
        Log.d(TAG, "updateRoomInfo: roomId 변경 : " + roomId);  
  
        // 새 멤버 목록으로 교체  
        memberList = users;  
  
        // 툴바 변경  
        initToolbar(chatRoom.getRoomName());  
        // 사이드바 변경  
        chatMemberAdapter.setItems(memberList);  
  
        // 사이드 바 상단 버튼 세팅  
        if (chatRoom.roomType == CreateRoomCommand.RoomType.OPEN && chatRoom.masterId == SPHelper.getUserId()) {  
            Log.i(TAG, "initListeners: 현재 채팅방은 오픈 채팅이면서 내가 관리자다");  
  
            binding.llChatroomSidemenu.btnChangeRoomName.setText("오픈 채팅 관리");  
            binding.llChatroomSidemenu.btnChangeRoomName.setOnClickListener(v -> {  
                Log.i(TAG, "initListeners: 오픈채팅 관리 화면으로 이동 버튼 클릭");  
                Intent intent = new Intent(this, OpenChatSettingActivity.class);  
                intent.putExtra("roomId", roomId);  
                intent.putExtra("roomName", chatRoom.getRoomName());  
                intent.putExtra("roomDescription", chatRoom.description);  
                startActivity(intent);  
            });  
  
        } else {  
            Log.i(TAG, "initListeners: 일반 채팅이거나 게스트다.");  
            binding.llChatroomSidemenu.btnChangeRoomName.setText("채팅방 표시 이름 변경");  
            binding.llChatroomSidemenu.btnChangeRoomName.setOnClickListener(v -> {  
                Log.d(TAG, "initListeners: 채팅방 이름 변경 화면으로 이동 버튼 클릭");  
                Intent intent = new Intent(this, ChangeRoomNameActivity.class);  
                intent.putExtra("roomId", roomId);  
                startActivityForResult(intent, NAME_CHANGE_REQUEST_CODE);  
            });  
  
        }  
  
        Log.i(TAG, "updateRoomInfo: END");  
    }  
  
    void addMessageView(SendMessageCommand command) {  
  
        // 화면에 메시지 출력  
        runOnUiThread(() -> {  
            messageAdapter.add(0, command);  
  
            chatRecyclerView.smoothScrollToPosition(messageAdapter.getItemCount() - 1);  
  
            // 여기서 수신 받은 메시지를 read 처리한다.  
            dbHelper.setUnReadMessageToRead(roomId);  
        });  
  
    }  
  
    void sendMessage(String message) {  
        Log.i(TAG, "sendMessage: START - params: message=" + message);  
        Intent intent = new Intent(this, ChattingSocketService.class);  
        intent.putExtra("message", message);  
        Log.d(TAG, "sendMessage: intent=" + intent);  
        startService(intent);  
        Log.i(TAG, "sendMessage: END");  
    }  
}  
</document_content>  
</document>  
<document index="116">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\CommentUpdateActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AlertDialog;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Comment;  
import com.teamnova.assa.data.dto.data.Reply;  
import com.teamnova.assa.data.retrofit.clients.CommentApiClient;  
import com.teamnova.assa.data.retrofit.clients.ReplyApiClient;  
import com.teamnova.assa.databinding.ActivityCommentUpdateBinding;  
import com.teamnova.assa.util.TempStorage;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 댓글 덧글 수정  
 */  
public class CommentUpdateActivity extends AppCompatActivity {  
  
    private static final String TAG = CommentUpdateActivity.class.getSimpleName();  
    ActivityCommentUpdateBinding binding;  
  
    Comment comment;  
    Boolean isComment;  
    Long id;  
    String content;  
    MenuItem saveItem;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivityCommentUpdateBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        setIntentData();  
        setToolbar();  
        setView();  
    }  
  
    private void setIntentData() {  
        Intent intent = getIntent();  
        comment = (Comment) TempStorage.getItem("comment");  
        isComment = !(comment instanceof Reply);  
        id = comment.getId();  
        content = comment.getContent();  
    }  
  
    private void setView() {  
        // 기존 본문데이터  
        binding.etContentComment.setText(content);  
  
        binding.etContentComment.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                if (s.toString().isEmpty()) saveItem.setEnabled(false);  
                else saveItem.setEnabled(true);  
  
            }  
        });  
    }  
  
    private void setToolbar() {  
        setSupportActionBar(binding.toolbarCommentUpdate);  
  
        // 뒤로가기 버튼 활성화  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        // 툴바 타이틀  
        String title = isComment ? "댓글 수정" : "덧글 수정";  
        getSupportActionBar().setTitle(title);  
    }  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        getMenuInflater().inflate(R.menu.menu_create_post_toolbar, menu);  
  
        // 화면 켜질 땐 게시하기 버튼 비활성화  
        saveItem = menu.findItem(R.id.menu_item_post);  
        saveItem.setTitle("저장하기");  
        saveItem.setEnabled(true);  
  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
        Log.d(TAG, "onOptionsItemSelected:  현재 클릭된 메뉴 id = " + id);  
  
        if (id == android.R.id.home) {  
            // 뒤로가기 버튼 눌렀을 때  
            showBackButtonPressedDialog();  
  
        } else if (id == R.id.menu_item_post) {  
            // 서버로 업데이트  
            updateComment();  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void updateComment() {  
        comment.setContent(binding.etContentComment.getText().toString());  
  
        if(isComment) {  
            CommentApiClient.getInstance().updateComment(comment).enqueue(new Callback<Comment>() {  
                @Override  
                public void onResponse(Call<Comment> call, Response<Comment> response) {  
                    if(response.isSuccessful()) {  
                        Log.d(TAG, "onResponse: 댓글 수정 성공");  
                        finish();  
                    } else {  
                        Log.d(TAG, "onResponse: 댓글 수정 오류");  
                        Toast.makeText(CommentUpdateActivity.this, "댓글 수정 오류", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<Comment> call, Throwable throwable) {  
                    Log.d(TAG, "onFailure: 댓글 수정 실패");  
                    Toast.makeText(CommentUpdateActivity.this, "댓글 수정 실패", Toast.LENGTH_SHORT).show();  
                }  
            });  
        } else {  
            ReplyApiClient.getInstance().updateReply((Reply) comment).enqueue(new Callback<Void>() {  
                @Override  
                public void onResponse(Call<Void> call, Response<Void> response) {  
                    if(response.isSuccessful()) {  
                        Log.d(TAG, "onResponse: 덧글 수정 성공");  
                        finish();  
                    }else{  
                        Log.d(TAG, "onResponse: 덧글 수정 오류");  
                        Toast.makeText(CommentUpdateActivity.this, "덧글 수정 오류", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<Void> call, Throwable throwable) {  
                    Log.d(TAG, "onFailure: 덧글 수정 실패");  
                    Toast.makeText(CommentUpdateActivity.this, "덧글 수정 실패", Toast.LENGTH_SHORT).show();  
                }  
            });  
        }  
    }  
  
    /**  
     * 백버튼 눌렀을 때 다이얼로그 생성  
     *  
     * @return  
     */  
    private void showBackButtonPressedDialog() {  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setMessage("지금 나가면 변경된 정보가 저장되지 않습니다.\n나가시겠습니까?");  
        builder.setPositiveButton("확인", (dialog, which) -> {  
            dialog.dismiss();  
            finish();  
        });  
        builder.setNegativeButton("취소", (dialog, which) -> {  
            dialog.dismiss();  
        });  
  
        builder.show();  
    }  
  
  
  
}  
</document_content>  
</document>  
<document index="117">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\EditAccountActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
  
import androidx.appcompat.app.AlertDialog;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.databinding.ActivityEditAccountBinding;  
import com.teamnova.assa.domain.Authentication;  
  
/**  
 * 계정설정 화면  
 */  
public class EditAccountActivity extends AppCompatActivity {  
  
    private static final String TAG = "EditAccountActivity";  
    ActivityEditAccountBinding binding;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        setRootView();  
        setOnClickListeners();  
    }  
  
    private void setRootView() {  
        binding = ActivityEditAccountBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
    }  
  
    private void setOnClickListeners() {  
        // 뒤로가기 버튼  
        binding.backButton.setOnClickListener(v -> onBackPressed());  
  
        // 비밀번호 변경 버튼  
        binding.changePassword.setOnClickListener(v -> {  
            Intent intent = new Intent(this, ChangePasswordActivity.class);  
            startActivity(intent);  
        });  
  
        // 회원탈퇴 버튼  
        binding.withdraw.setOnClickListener(v -> {  
            generateDialog("회원탈퇴", "회원탈퇴 하시겠습니까?", () -> {  
                Authentication.withdraw(EditAccountActivity.this);  
            }).show();  
        });  
    }  
  
    /**  
     * 인자에 따라 다른 메시지를 가지는 다이얼로그를 생성하는 메소드  
     *  
     * @return  
     */  
    private AlertDialog generateDialog(String title, String message, Runnable runnable) {  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setTitle("회원탈퇴")  
                .setMessage(message)  
                .setPositiveButton("확인", (dialog, which) -> {  
                    Log.d(TAG, "generateDialog: 확인버튼 선택");  
                    runnable.run();  
                })  
                .setNegativeButton("취소", (dialog, which) -> {  
                    Log.d(TAG, "generateDialog: 취소버튼 선택");  
                    dialog.cancel();  
                });  
        return builder.create();  
    }  
  
}  
</document_content>  
</document>  
<document index="118">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\EditProfileActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.graphics.Bitmap;  
import android.graphics.drawable.BitmapDrawable;  
import android.net.Uri;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.widget.Toast;  
  
import androidx.activity.OnBackPressedCallback;  
import androidx.appcompat.app.AlertDialog;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.load.engine.DiskCacheStrategy;  
import com.bumptech.glide.request.RequestOptions;  
import com.teamnova.assa.BuildConfig;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.CheckDuplicationResponse;  
import com.teamnova.assa.data.dto.response.UpdateUserResponse;  
import com.teamnova.assa.data.helper.ImagePickerHelper;  
import com.teamnova.assa.data.retrofit.clients.AuthApiClient;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivityEditProfileBinding;  
import com.teamnova.assa.util.FileUtils;  
  
import java.io.File;  
import java.util.Objects;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 프로필 편집 액티비티  
 */  
public class EditProfileActivity extends AppCompatActivity {  
  
    private static final String TAG = "EditProfileActivity";  
    ActivityEditProfileBinding binding;  
  
    // 기본 프로필 이미지 경로  
    final String defaultimagePath = BuildConfig.BASE_URL + "/storage/profile_image/default.jpg";  
  
    // 초기 프로필 정보  
    UserData originUserData;  
  
    private ImagePickerHelper imagePickerHelper;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityEditProfileBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        getUserData();  
        setOnClickListener();  
        addOnbackPressedCallback();  
        imagePickerHelper = new ImagePickerHelper(this, this::setProfileImage);  
    }  
  
    /**  
     * 클릭리스너들 세팅  
     */  
    private void setOnClickListener() {  
          
        // 뒤로가기 버튼  
        binding.backButton.setOnClickListener(v -> {  
            // 뒤로가기 버튼을 누르면 뒤로가기 이벤트를 발생시킨다.  
            // 뒤로가기 처리는 뒤로가기 이벤트 리스너에서 처리한다.  
            getOnBackPressedDispatcher().onBackPressed();  
        });  
  
        // 프로필 이미지 변경 버튼  
        binding.ivCameraIcon.setOnClickListener(v -> {  
            // 이미지 변경 다이얼로그  
            profileImageListDialog();  
        });  
  
  
        // 저장하기 버튼  
        binding.tvSaveEditProfile.setOnClickListener(v -> {  
            saveChanged();  
        });  
  
    }  
  
    /**  
     * 뒤로가기 이벤트 리스너  
     */  
    private void addOnbackPressedCallback() {  
        getOnBackPressedDispatcher().addCallback(this, new OnBackPressedCallback(true) {  
            @Override  
            public void handleOnBackPressed() {  
                // 저장하기 버튼을 누르지 않은 상태에서 뒤로가기 이벤트가 발생하면 다이얼로그 출력  
                if (isDirty()) {  
                    createBackButtonPressedDialog().show();  
                } else {  
                    finish();  
                }  
            }  
        });  
    }  
  
    /**  
     * 백버튼 눌렀을 때 다이얼로그 생성  
     *  
     * @return  
     */  
    private AlertDialog createBackButtonPressedDialog() {  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setMessage("지금 나가면 변경된 정보가 저장되지 않습니다.\n나가시겠습니까?");  
        builder.setPositiveButton("확인", (dialog, which) -> {  
            dialog.dismiss();  
            finish();  
        });  
        builder.setNegativeButton("취소", (dialog, which) -> {  
            dialog.dismiss();  
        });  
  
        return builder.create();  
    }  
  
  
    /**  
     * 서버에서 프로필 정보 가져오기  
     */  
    private void getUserData() {  
  
        AuthApiClient.getInstance().me().enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                Log.d(TAG, "onResponse: 프로필 정보 가져오기 응답 성공 " + response);  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "프로필 정보 가져오기 성공" + response.body());  
  
                    originUserData = response.body();  
                    setProfileData(originUserData);  
  
                    // 초기값이 저장된 이후 텍스트 변경 리스너 추가  
                    addTextChangedListeners();  
                } else {  
                    Log.d(TAG, "프로필 정보 가져오기 에러 응답");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "프로필 가져오기 실패", throwable);  
            }  
        });  
    }  
  
    /**  
     * 프로필 데이터를 화면에 설정  
     * @param userData  
     */  
    private void setProfileData(UserData userData){  
        // 실제 프로필 이미지 URL  
        String profileImageURL = userData.profileImage;  
  
        // 프로필 정보 출력  
        Glide.with(EditProfileActivity.this)  
                .asBitmap()  
                .load(profileImageURL)  
                .apply(new RequestOptions()  
                        .skipMemoryCache(true)  
                        .diskCacheStrategy(DiskCacheStrategy.NONE))  
                .into(binding.ivProfileImage);  
  
        // 둥굴게 출력  
        binding.ivProfileImage.setClipToOutline(true);  
  
        // imageView tag에 프로필 이미지 URL 저장  
        binding.ivProfileImage.setTag(userData.profileImage);  
        binding.tietNicknameEditProfile.setText(userData.nickname);  
        binding.tietDescriptionEditProfile.setText(userData.description);  
    }  
  
  
    private void profileImageListDialog() {  
        String[] items = {"사진찍기", "기존 사진 선택", "초기화"};  
  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setItems(items, (dialog, which) -> {  
            Log.d(TAG, "이미지 변경 다이얼로그 - 선택한 항목번호 : " + which);  
            // which 변수에 선택한 아이템의 인덱스가 할당된다.  
            switch (which) {  
                case 0:  
                    // 사진찍기  
                    imagePickerHelper.launchCamera();  
                    break;  
                case 1:  
                    // 앨범에서 사진선택  
                    imagePickerHelper.launchGallery();  
                    break;  
                case 2:  
                    // 프로필 이미지 초기화(기본값으로)  
                    resetProfileImage();  
                    break;  
                default:  
                    break;  
            }  
        }).show();  
    }  
  
  
    // 화면에 선택한 이미지를 출력  
    private void setProfileImage(Uri imageUri) {  
        binding.ivProfileImage.setTag(imageUri.toString());  
        binding.ivProfileImage.setImageURI(imageUri);  
        binding.ivProfileImage.setClipToOutline(true);  
        updateSaveButtonState();  
    }  
  
    /**  
     * 프로필 이미지 초기화  
     */  
    private void resetProfileImage(){  
        Glide.with(EditProfileActivity.this)  
                .asBitmap()  
                .load(defaultimagePath)  
                .apply(new RequestOptions()  
                        .skipMemoryCache(true)  
                        .diskCacheStrategy(DiskCacheStrategy.NONE))  
                .into(binding.ivProfileImage);  
  
        binding.ivProfileImage.setTag(defaultimagePath);  
        binding.ivProfileImage.setClipToOutline(true);  
        updateSaveButtonState();  
    }  
  
    /**  
     * isDirty() 여부에 따라 save버튼 상태 변경  
     */  
    private void updateSaveButtonState() {  
        if (isDirty()) {  
            binding.tvSaveEditProfile.setEnabled(true);  
        } else {  
            binding.tvSaveEditProfile.setEnabled(false);  
        }  
    }  
  
    /**  
     * 변경된 프로필 정보 저장  
     */  
    private void saveChanged() {  
        // 저장하는 동안 버튼 비활성화  
        setClickEnabled(false);  
  
        // 입력값들을 유저 객체에 담음  
        originUserData.profileImage = getCurrentImagePath();  
        originUserData.nickname = getCurrentNickname();  
        originUserData.description = getCurrentDescription();  
  
        // 현재 입력값들을 서버로 전송  
        sendUpdatedProfileToServer();  
    }  
  
    /**  
     * 서버로 변경된 프로필 정보 전송  
     */  
    private void sendUpdatedProfileToServer() {  
        // 비트맵을 파일로 변환  
        Bitmap bitmap = ((BitmapDrawable) binding.ivProfileImage.getDrawable()).getBitmap();  
        File imageFile = FileUtils.bitmapToFile(this, bitmap, "profile_image.jpg");;  
  
        UsersApiClient.getInstance().updateUser(originUserData.id, originUserData, imageFile).enqueue(new Callback<UpdateUserResponse>() {  
            @Override  
            public void onResponse(Call<UpdateUserResponse> call, Response<UpdateUserResponse> response) {  
                Log.d(TAG, "프로필 편집 응답 성공 - " + response);  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "프로필 편집 성공 - " + response.body());  
                    // 저장하기 버튼 빼고 활성화  
                    binding.ivCameraIcon.setEnabled(true);  
                    binding.tietNicknameEditProfile.setEnabled(true);  
                    binding.tietDescriptionEditProfile.setEnabled(true);  
                    // 결과가 응답되면 토스트 메시지 출력  
                    Toast.makeText(EditProfileActivity.this, "저장되었습니다.", Toast.LENGTH_SHORT).show();  
                    // 저장하기 버튼은 다시 비활성화  
                    updateSaveButtonState();  
  
                } else {  
                    Log.d(TAG, "프로필 편집 - 에러응답 " + response.errorBody());  
                    Toast.makeText(EditProfileActivity.this, "저장에 실패했습니다(오류)", Toast.LENGTH_SHORT).show();  
                    setClickEnabled(true);  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UpdateUserResponse> call, Throwable throwable) {  
                Log.e(TAG, "프로필 편집 - 통신 실패", throwable);  
                Toast.makeText(EditProfileActivity.this, "저장에 실패했습니다(실패)", Toast.LENGTH_SHORT).show();  
                setClickEnabled(true);  
            }  
        });  
    }  
  
    // 현재 프로필 이미지 경로를 가져오는 메서드  
    private String getCurrentImagePath() {  
        Object tag = binding.ivProfileImage.getTag();  
        return tag != null ? tag.toString() : null;  
    }  
  
    // 현재 닉네임을 가져오는 메서드 - 빈 문자열은 null 반환  
    private String getCurrentNickname() {  
        String nickname = binding.tietNicknameEditProfile.getText().toString();  
        return nickname.isEmpty() ? null : nickname;  
    }  
  
    // 현재 설명을 가져오는 메서드 - 빈 문자열은 null 반환  
    private String getCurrentDescription() {  
        String description = binding.tietDescriptionEditProfile.getText().toString();  
        return description.isEmpty() ? null : description;  
    }  
  
    // 원래 데이터와 현재 데이터를 비교하여 변경 여부를 반환하는 메서드  
    private boolean isDirty() {  
        // 현재 데이터 가져오기  
        String currentImagePath = getCurrentImagePath();  
        String currentNickname = getCurrentNickname();  
        String currentDescription = getCurrentDescription();  
  
        // 디버그 로그 출력  
        Log.d(TAG, String.format("imagePath - %s currentImagePath - %s originNickname - %s currentNickname - %s originDescription - %s currentDescription - %s",  
                originUserData.profileImage, currentImagePath,  
                originUserData.nickname, currentNickname,  
                originUserData.description, currentDescription));  
  
        // 원래 데이터와 현재 데이터를 비교하여 다르면 true 반환  
        // 원본과 현재 입력한 데이터의 불일치가 한가지라도 존재한다면  
        return !Objects.equals(originUserData.profileImage, currentImagePath) ||  
                !Objects.equals(originUserData.nickname, currentNickname) ||  
                !Objects.equals(originUserData.description, currentDescription);  
    }  
  
    private void addTextChangedListeners() {  
        // 닉네임 입력창  
        binding.tietNicknameEditProfile.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String input = s.toString();  
  
                // 이 시점에서는 orginNickname은 초기값  
                Log.d(TAG, "초기값, 현재입력값 비교 - " + binding.tietNicknameEditProfile.getText().toString() + " " + originUserData.nickname);  
  
                // 변동이 있으면 저장하기 버튼 활성화  
                updateSaveButtonState();  
  
                // 형식확인 (영문, 한글, 숫자, 밑줄(_)의 조합)  
                if (!input.matches("^[a-zA-Z가-힣0-9_]*$")) {  
                    binding.tilNicknameEditProfile.setError("올바르지 않은 닉네임 형식입니다");  
                    binding.tvSaveEditProfile.setEnabled(false);  
                    return;  
                }  
                if(input.isEmpty()){  
                    binding.tilNicknameEditProfile.setError("닉네임을 입력해주세요");  
                    binding.tvSaveEditProfile.setEnabled(false);  
                    return;  
                }  
  
                // 문제 없으면 에러메시지 제거  
                binding.tilNicknameEditProfile.setError(null);  
  
                // 중복검사 - 현재값이 최초값과 다를때만 검사함  
                if (!binding.tietNicknameEditProfile.getText().toString().equals(originUserData.nickname))  
                    checkNicknameDuplication(input);  
            }  
        });  
  
        // 소개글 입력창  
        binding.tietDescriptionEditProfile.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                // 변동이 있으면 저장하기 버튼 활성화  
                updateSaveButtonState();  
            }  
        });  
    }  
  
    /**  
     * 닉네임 중복체크  
     *  
     * @param input 입력값  
     */  
    private void checkNicknameDuplication(String input) {  
        // 중복확인 요청 전송  
        Call<CheckDuplicationResponse> call = UsersApiClient.getInstance().checkDuplication("nickname", input);  
  
        call.enqueue(new Callback<CheckDuplicationResponse>() {  
            @Override  
            public void onResponse(Call<CheckDuplicationResponse> call, Response<CheckDuplicationResponse> response) {  
                if (response.isSuccessful()) {  
  
                    if (response.body().status.equals("success")) {  
                        boolean isDuplicate = response.body().isDuplicated;  
                        String nickname = response.body().data;  
  
                        // 중복이면 에러 메시지 줄력  
                        if (isDuplicate) {  
                            binding.tilNicknameEditProfile.setError("이미 사용 중인 닉네임입니다");  
                            binding.tvSaveEditProfile.setEnabled(false);  
                            return;  
                        }  
  
                        // 중복아니면 기존의 에러메시지 제거 후 다음 버튼 활성화  
                        binding.tilNicknameEditProfile.setError(null);  
                        binding.tvSaveEditProfile.setEnabled(true);  
  
  
                    } else {  
                        // status : error -> 유효성검사 통과 실패  
                        binding.tilNicknameEditProfile.setError("잘못된 닉네임 형식입니다");  
                        binding.tvSaveEditProfile.setEnabled(false);  
                    }  
  
                } else {  
                    Log.d(TAG, "onResponse: 중복 확인 에러" + response.errorBody());  
                }  
            }  
  
            @Override  
            public void onFailure(Call<CheckDuplicationResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
            }  
        });  
    }  
  
    private void setClickEnabled(boolean enabled) {  
        binding.tvSaveEditProfile.setEnabled(enabled);  
        binding.ivCameraIcon.setEnabled(enabled);  
        binding.tietNicknameEditProfile.setEnabled(enabled);  
        binding.tietDescriptionEditProfile.setEnabled(enabled);  
    }  
  
  
  
  
  
}  
</document_content>  
</document>  
<document index="119">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\EmailActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.view.View;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.CheckDuplicationResponse;  
import com.teamnova.assa.data.retrofit.clients.UserDuplicateCheckApiClient;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivityEmailBinding;  
import com.teamnova.assa.util.TempStorage;  
  
import java.util.Objects;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 이메일 입력 액티비티  
 */  
public class EmailActivity extends AppCompatActivity {  
  
    private static final String TAG = EmailActivity.class.getSimpleName();  
    UserDuplicateCheckApiClient userDuplicateCheckApiClient;  
    ActivityEmailBinding binding;  
    String purpose;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityEmailBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        userDuplicateCheckApiClient = new UserDuplicateCheckApiClient();  
  
        // 클릭리스너 부착  
        setOnClickListeners();  
  
        // 텍스트 입력 리스너 부착  
        addTextChangedListeners();  
  
        // 이전 액티비티에서 넘어온 값 - 액티비티 접근 목적  
        purpose = getIntent().getStringExtra("purpose");  
        Log.d(TAG, "onCreate: purpose : " + purpose);  
  
        if(purpose.equals("resetPw")){  
            binding.title.setText("비밀번호를 잊었습니까?");  
            binding.description.setText("비밀번호를 재설정해야 합니다.\n가입할 때 사용한 이메일을 입력하세요");  
            binding.tvEmailTitle.setVisibility(View.VISIBLE);  
        }  
    }  
  
    private void addTextChangedListeners() {  
        binding.email.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            // 입력 후 실행  
            @Override  
            public void afterTextChanged(Editable s) {  
                String inputText = s.toString();  
  
                // 공백 확인  
                if (inputText.isEmpty()) {  
                    binding.emailLayout.setError("필수 입력 항목입니다");  
                    binding.btnNext.setEnabled(false);  
                    return;  
                }  
  
                // 형식확인  
                if (!inputText.matches("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$")) {  
                    binding.emailLayout.setError("올바르지 않은 이메일 형식입니다");  
                    binding.btnNext.setEnabled(false);  
                    return;  
                }  
  
                // 위에 것들이 문제없으면 에러 메시지 제거  
                binding.emailLayout.setError(null);  
  
                // 이메일 중복 체크  
                checkEmailDuplication(inputText);  
            }  
        });  
    }  
  
    /**  
     * 클릭리스너 세팅  
     */  
    private void setOnClickListeners() {  
        // 뒤로가기  
        binding.btnBack.setOnClickListener(v -> {  
            this.finish();  
        });  
  
        // 다음버튼  
        binding.btnNext.setOnClickListener(v -> {  
            Intent intent = new Intent(this, EmailConfirmationActivity.class);  
            intent.putExtra("purpose", purpose);  
  
            UserData user = new UserData();  
            user.email = Objects.requireNonNull(binding.email.getText()).toString();  
            user.loginType = UserData.LOGIN_TYPE.DEFAULT;  
  
            TempStorage.setItem("user", user);  
  
            Log.d(TAG, "setOnClickListeners: 이동 " + user.toString());  
            startActivity(intent);  
        });  
    }  
  
    /**  
     * 이메일 중복 체크  
     */  
    private void checkEmailDuplication(String inputText) {  
        // 중복확인 요청 전송  
        Call<CheckDuplicationResponse> call = UsersApiClient.getInstance().checkDuplication("email", inputText);  
  
        call.enqueue(new Callback<CheckDuplicationResponse>() {  
            @Override  
            public void onResponse(Call<CheckDuplicationResponse> call, Response<CheckDuplicationResponse> response) {  
                Log.d(TAG, "onResponse: 이메일 중복 체크 응답 성공 " + response);  
                if (response.isSuccessful()) {  
  
                    if (response.body().status.equals("success")) {  
                        boolean isExists = response.body().isDuplicated;  
                        String email = response.body().data;  
  
                        if (purpose.equals("registration")) {  
                            Log.d(TAG, "onResponse: 회원가입 목적, 이메일 중복결과 - " + isExists);  
  
                            // 중복이면 에러 메시지 줄력  
                            if (isExists) {  
                                binding.emailLayout.setError("이미 사용 중인 이메일입니다");  
                                binding.btnNext.setEnabled(false);  
                                return;  
                            }  
  
                            // 중복아니면 기존의 에러메시지 제거 후 다음 버튼 활성화  
                            binding.emailLayout.setError(null);  
                            binding.btnNext.setEnabled(true);  
  
                        } else if (purpose.equals("resetPw")) {  
                            Log.d(TAG, "onResponse: 비밀번호 재설정 목적, 이메일 중복결과 - " + isExists);  
  
                            // 해당 이메일을 가진 계정이 존재하지 않는다면  
                            if (!isExists) {  
                                Log.d(TAG, "계정이 존재하지 않음");  
                                binding.emailLayout.setError("가입된 사용자가 아닙니다.");  
                                binding.btnNext.setEnabled(false);  
                                return;  
                            }  
  
                            // 해당 이메일을 가진 계정이 존재하면  
                            // 해당 계정이 소셜 로그인 계정인지 확인  
//                            if(response.body().loginType  == UserData.LOGIN_TYPE.SOCIAL){  
//                                Log.d(TAG, "소셜 로그인 계정임");  
//                                // 소셜 로그인 계정이면 다음 버튼 활성화  
//                                binding.emailLayout.setError("소셜 로그인 계정은 비밀번호 변경이 불가능 합니다.");  
//                                binding.btnNext.setEnabled(false);  
//                                return;  
//                            }  
  
                            //'다음'버튼 활성화  
                            binding.emailLayout.setError(null);  
                            binding.btnNext.setEnabled(true);  
                        }  
  
  
                    } else {  
                        // status : error -> 유효성검사 통과 실패  
                        binding.emailLayout.setError("잘못된 이메일 형식입니다");  
                        binding.btnNext.setEnabled(false);  
                    }  
  
                } else {  
                    Log.d(TAG, "onResponse: 중복 확인 에러" + response.errorBody());  
                }  
            }  
  
            @Override  
            public void onFailure(Call<CheckDuplicationResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="120">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\EmailConfirmationActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.widget.Toast;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.databinding.ActivityEmailConfirmationBinding;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.retrofit.clients.EmailApiClient;  
import com.teamnova.assa.util.TempStorage;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 이메일 인증번호 입력 액티비티  
 */  
public class EmailConfirmationActivity extends AppCompatActivity {  
    private static final String TAG = EmailConfirmationActivity.class.getSimpleName();  
    ActivityEmailConfirmationBinding binding;  
    EmailApiClient emailApiClient = new EmailApiClient();  
    boolean isResponse = false; // 인증이 왔는지 여부 기록  
    Integer mCode = null;  
    UserData user;  
    String purpose;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        Log.i(TAG, "onCreate: START");  
  
        binding = ActivityEmailConfirmationBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        user = (UserData) TempStorage.getItem("user");  
  
        // TODO 수업 중 에러 터진 지점 - 2024-10-10  
        // Caused by: java.lang.NullPointerException: Attempt to read from field 'java.lang.String com.teamnova.assa.data.dto.data.UserData.email' on a null object reference  
        // user 가 null인지 email 이 null 인지 확인할 것  
        Log.d(TAG, "onCreate: user = " + user);  
        sendConfirmationCode(user.email);  
//        binding.description.setText(user.email + "로 인증코드를 전송했습니다.\n전송받은 인증코드를 입력해주세요. ");  
  
        setOnClickListeners();  
        addTextChagedListeners();  
  
        // 액티비티 접근 목적 알아내기  
        purpose = getIntent().getStringExtra("purpose");  
        Log.d(TAG, "onCreate: purpose - " + purpose);  
  
        Log.i(TAG, "onCreate: END");  
    }  
  
    // 텍스트 체인지 리스너 세팅  
    private void addTextChagedListeners() {  
        binding.code.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String input = s.toString();  
                binding.codeLayout.setError(null);  
                // 입력 창이 공백이면 다음버튼 비활성화  
                binding.btnNext.setEnabled(!input.isEmpty());  
            }  
        });  
  
    }  
  
  
    // 클릭리스너 세팅  
    private void setOnClickListeners() {  
        // 뒤로가기  
        binding.btnBack.setOnClickListener(v -> finish());  
  
        // 재전송  
        binding.btnResend.setOnClickListener(v -> {  
            sendConfirmationCode(user.email);  
            Toast.makeText(this, "인증코드를 재전송했습니다", Toast.LENGTH_SHORT).show();  
            // 연속 전송요청 방지  
            v.setEnabled(false);  
            // 인증코드 수신상태 초기화  
            isResponse = false;  
        });  
  
        // 다음 버튼  
        binding.btnNext.setOnClickListener(v -> {  
            String input = binding.code.getText().toString();  
  
            // 인증코드와 일치하면 다음 화면으로  
            if (isResponse && input.equals(mCode.toString())) {  
                Log.d(TAG, "setOnClickListeners: 인증코드 일치, 목적 : " + purpose);  
  
                Intent intent = null;  
                if(purpose.equals("resetPw")){  
                    // 비밀번호 재설정 목적인 경우 - 비밀번호를 변경할 계정을 선택하는 화면으로 이동  
                    intent = new Intent(this, SetPasswordActivity.class);  
                } else {  
                    // 회원가입 목적인 경우가 기본설정 - 비밀번호 지정화면으로 이동  
                    intent = new Intent(this, SetPasswordActivity.class);  
                }  
  
                intent.putExtra("purpose", purpose);  
                startActivity(intent);  
            } else { // 틀리면 에러메시지  
                binding.codeLayout.setError("잘못된 인증코드입니다. 다시 확인하시고 입력해주세요.");  
            }  
        });  
    }  
  
    // 인증코드 메일 발송 요청  
    private void sendConfirmationCode(String emailAddress) {  
  
        Call<Integer> call = emailApiClient.sendEmail(emailAddress);  
        call.enqueue(new Callback<Integer>() {  
            @Override  
            public void onResponse(Call<Integer> call, Response<Integer> response) {  
                if (response.isSuccessful()) {  
                    Integer code = response.body();  
                    mCode = code;  
                    isResponse = true;  
                    binding.btnResend.setEnabled(true);  
                    Log.d(TAG, "onResponse: 생성된 인증코드 - " + code);  
                } else {  
                    Log.d(TAG, "onResponse: 서버 처리 실패");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Integer> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="121">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\FollowerActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.MenuItem;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivityFollowingBinding;  
import com.teamnova.assa.ui.adapter.UserPreviewAdapter;  
  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class FollowerActivity extends AppCompatActivity {  
  
    private static final String TAG = "FollowerActivity";  
    ActivityFollowingBinding binding;  
    UserPreviewAdapter adapter;  
    Long userId;  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivityFollowingBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        userId =  getIntent().getLongExtra("userId", 0);  
        setToolbar();  
        setRecyclerView();  
    }  
  
    @Override  
    public void onStart() {  
        super.onStart();  
        Log.d(TAG, "onStart getUserInfo 실행");  
        // 서버에서 사용자 데이터 받아오기  
        getFollowing();  
    }  
  
  
    private void setToolbar() {  
        setSupportActionBar(binding.tbFollowing);  
  
        // 뒤로가기 버튼 활성화  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        getSupportActionBar().setDisplayShowTitleEnabled(true);  
        getSupportActionBar().setTitle("팔로워");  
    }  
  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
  
        if (id == android.R.id.home) {  
            onBackPressed();  
        }  
  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void setRecyclerView(){  
        this.adapter= new UserPreviewAdapter(this);  
        binding.rvFollowing.setAdapter(this.adapter);  
        binding.rvFollowing.setLayoutManager(new LinearLayoutManager(getApplicationContext()));  
        binding.rvFollowing.addItemDecoration(  
                new DividerItemDecoration(getApplicationContext(), DividerItemDecoration.VERTICAL));  
          
    }  
  
    private void getFollowing(){  
        UsersApiClient.getInstance().getUserById(userId).enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                List<UserData> following = response.body().followers;  
                adapter.setItems(following);  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 팔로워 정보 불러오기 실패", throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="122">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\FollowingActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.MenuItem;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivityFollowingBinding;  
import com.teamnova.assa.ui.adapter.UserPreviewAdapter;  
  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class FollowingActivity extends AppCompatActivity {  
    private static final String TAG = FollowingActivity.class.getSimpleName();  
    ActivityFollowingBinding binding;  
    UserPreviewAdapter adapter;  
    Long userId;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivityFollowingBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        userId = getIntent().getLongExtra("userId", 0);  
  
        setToolbar();  
        setRecyclerView();  
    }  
  
    @Override  
    public void onStart() {  
        super.onStart();  
        Log.d(TAG, "onStart getUserInfo 실행");  
        // 서버에서 사용자 데이터 받아오기  
        getFollowing();  
    }  
  
  
    private void setToolbar() {  
        setSupportActionBar(binding.tbFollowing);  
  
        // 뒤로가기 버튼 활성화  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        // 타이틀 숨기기  
        getSupportActionBar().setDisplayShowTitleEnabled(true);  
        getSupportActionBar().setTitle("팔로잉");  
    }  
  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
  
        if (id == android.R.id.home) {  
            onBackPressed();  
        }  
  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void setRecyclerView() {  
        this.adapter = new UserPreviewAdapter(this);  
        binding.rvFollowing.setAdapter(this.adapter);  
        binding.rvFollowing.setLayoutManager(new LinearLayoutManager(getApplicationContext()));  
        binding.rvFollowing.addItemDecoration(  
                new DividerItemDecoration(getApplicationContext(), DividerItemDecoration.VERTICAL));  
    }  
  
    private void getFollowing() {  
        UsersApiClient.getInstance().getUserById(userId).enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                List<UserData> following = response.body().followings;  
                adapter.setItems(following);  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 팔로잉 불러오기 실패", throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="123">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\FriendsActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.MenuItem;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivityFriendsBinding;  
import com.teamnova.assa.ui.adapter.UserPreviewAdapter;  
  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class FriendsActivity extends AppCompatActivity {  
    private static String TAG = FriendsActivity.class.getSimpleName();  
    private ActivityFriendsBinding binding;  
    UserPreviewAdapter adapter;  
    Long userId;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivityFriendsBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        userId = getIntent().getLongExtra("userId", 0);  
  
        setToolbar();  
        setRecyclerView();  
    }  
  
    @Override  
    public void onStart() {  
        super.onStart();  
        Log.d(TAG, "onStart getUserInfo 실행");  
        // 서버에서 사용자 데이터 받아오기  
        getFriends();  
    }  
  
  
    private void setToolbar() {  
        setSupportActionBar(binding.tbFriends);  
  
        // 뒤로가기 버튼 활성화  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        // 타이틀 출력  
        getSupportActionBar().setDisplayShowTitleEnabled(true);  
        getSupportActionBar().setTitle("친구목록");  
    }  
  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
  
        if (id == android.R.id.home) {  
            onBackPressed();  
        }  
  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void setRecyclerView() {  
        this.adapter = new UserPreviewAdapter(this);  
        binding.rvFriends.setAdapter(this.adapter);  
        binding.rvFriends.setLayoutManager(new LinearLayoutManager(getApplicationContext()));  
        binding.rvFriends.addItemDecoration(  
                new DividerItemDecoration(getApplicationContext(), DividerItemDecoration.VERTICAL));  
    }  
  
    private void getFriends() {  
        UsersApiClient.getInstance().getUserById(userId).enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                List<UserData> friends = response.body().friends;  
                adapter.setItems(friends);  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 친구목록 불러오기 실패", throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="124">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\FullTermsActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.databinding.ActivityFullTermsBinding;  
import com.teamnova.assa.data.retrofit.clients.TermsApiClient;  
  
/**  
 * 약관전문 조회 액티비티  
 */  
public class FullTermsActivity extends AppCompatActivity {  
    private final String TAG = "FullTermsActivity";  
  
    private ActivityFullTermsBinding binding;  
  
    TermsApiClient termsApiClient;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityFullTermsBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        // 인텐트 받아오기 (어떤 약관을 보여줘야 하는지 알아내기)  
        String termsTitle = getIntentExtra("terms");  
  
        termsApiClient = new TermsApiClient();  
  
        // 약관 불러오기  
        loadTerms(termsTitle);  
  
        // 뒤로가기  
        binding.btnBack.setOnClickListener(v -> {  
            this.finish();  
        });  
    }  
  
  
    // 1. 이전화면에서 인텐트로 어떤 약관인지 알아내기  
    private String getIntentExtra(String key) {  
        Intent intent = getIntent();  
        if (intent != null) return intent.getStringExtra(key);  
        else return "";  
    }  
  
    // 2. 약관 불러오기 + 출력하기  
    private void loadTerms(String termsTitle) {  
        // retrofit 인스턴스 생성  
        binding.tvTermsTitle.setText(termsTitle);  
        termsApiClient.loadTerms(binding.terms, termsTitle);  
    }  
}  
  
  
</document_content>  
</document>  
<document index="125">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\HttpPractice.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.os.Handler;  
import android.widget.Button;  
import android.widget.TextView;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.android.volley.Request;  
import com.android.volley.RequestQueue;  
import com.android.volley.Response;  
import com.android.volley.VolleyError;  
import com.android.volley.toolbox.StringRequest;  
import com.android.volley.toolbox.Volley;  
import com.teamnova.assa.R;  
  
import java.io.BufferedReader;  
import java.io.IOException;  
import java.io.InputStream;  
import java.io.InputStreamReader;  
import java.net.HttpURLConnection;  
import java.net.MalformedURLException;  
import java.net.URL;  
  
import okhttp3.ResponseBody;  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Retrofit;  
import retrofit2.http.GET;  
  
public class HttpPractice extends AppCompatActivity {  
  
    // 요청 전송버튼  
    Button btn_send_HttpURLConnection;  
    Button btn_send_Volley;  
    Button btn_send_Retrofit;  
  
    // 통신 결과값 출력 TextView  
    TextView tv_res_HttpURLConnection;  
    TextView tv_res_Volley;  
    TextView tv_res_Retrofit;  
  
    // 리셋버튼  
    Button btnReset;  
  
    // 워커쓰레드의 요청 응답을 화면에 출력하기 위한 핸들러  
    Handler handler = new Handler();  
  
    // Volley의 RequestQueue  
    public RequestQueue requestQueue;  
  
    // Retrofit의 retrofit 객체, 인터페이스  
    Retrofit retrofit;  
    TestService testService;  
  
    private static final String baseUrl = "http://192.168.55.159/request_test.php";  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        setContentView(R.layout.activity_http_practice);  
  
        // rq 초기화  
        requestQueue = Volley.newRequestQueue(this);  
  
        // Retrofit 객체 생성  
        retrofit = new Retrofit.Builder()  
                .baseUrl(baseUrl + "/")  
                .build();  
        // API 인터페이스 구현체 생성  
        testService = retrofit.create(TestService.class);  
  
        findViewByIds();  
        setOnClickListners();  
  
    }  
  
    // xml 뷰 로드  
    private void findViewByIds() {  
        // 리셋버튼  
        btnReset = findViewById(R.id.btn_main_reset);  
  
        // 전송버튼 매핑  
        btn_send_HttpURLConnection = findViewById(R.id.btn_main_send_httpUrlConnection);  
        btn_send_Volley = findViewById(R.id.btn_main_send_volley);  
        btn_send_Retrofit = findViewById(R.id.btn_main_send_retrofit);  
  
        // 출력 TextView 매핑  
        tv_res_HttpURLConnection = findViewById(R.id.tv_main_response_httpUrlConnection);  
        tv_res_Volley = findViewById(R.id.tv_main_response_volley);  
        tv_res_Retrofit = findViewById(R.id.tv_main_response_retrofit);  
    }  
  
    // 클릭리스너 부착  
    private void setOnClickListners() {  
        // 리셋버튼 - 응답결과 출력 지우기  
        btnReset.setOnClickListener(v -> {  
            tv_res_HttpURLConnection.setText(null);  
            tv_res_Volley.setText(null);  
            tv_res_Retrofit.setText(null);  
        });  
  
        // HttpURLConnection 요청 전송  
        btn_send_HttpURLConnection.setOnClickListener(v -> {  
            new RequestThread().start();  
        });  
  
        // Volley 요청 전송  
        btn_send_Volley.setOnClickListener(v -> {  
            sendRequestWithVolley();  
        });  
  
        // Retrofit 요청 전송  
        btn_send_Retrofit.setOnClickListener(v -> {  
            sendRequestWithRetrofit();  
        });  
  
    }  
  
    // 메인 쓰레드에서 네트워킹은 금지되어 있어서 워커쓰레드에서 네트워킹한다.  
    class RequestThread extends Thread {  
        @Override  
        public void run() {  
            // 서버로 요청 전송 시도  
            try {  
                // URL 객체 생성  
                URL url = new URL(baseUrl + "?lib=HttpURLConnection");  
  
                // URL 객체에서 URLConnection 객체 생성 후 바로 HttpURLConnection 객체로 캐스팅  
                HttpURLConnection connection = (HttpURLConnection) url.openConnection();  
  
                if (connection != null) {  
                    connection.setConnectTimeout(5000); // 응답 대기  
                    connection.setRequestMethod("GET");  
                    connection.setDoOutput(true);   // connection 객체를 서버로 데이터를 보내는데 사용할 수 있는지 여부  
  
                    // getResponseCode 내부적으로 getInputStream()이 호출되면서  요청을 전송함  
                    int resCode = connection.getResponseCode();  
                    if (resCode == HttpURLConnection.HTTP_OK) {  
                        // 요청 보내기, 결과값 받기가 같은 메소드에서 실행됨  
                        InputStream inputStream = connection.getInputStream();  
                        // 응답 데이터를 문자열로 읽기위해 BufferedReader로 InputStream을 감싼다  
                        BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));  
                        String line = reader.readLine();  
  
                        printData(line);  
  
                        reader.close();  
                    } else {  
                        printData("ERROR");  
                    }  
                    connection.disconnect();  
                }  
            } catch (MalformedURLException e) { // 잘못된 URL 형식일 때 catch  
                printData("ERROR");  
            } catch (IOException e) { // Stream 읽을 때 발생하는 에러 catch  
                printData("ERROR");  
            }  
        }  
    }  
  
    // Retorfit에서 사용하는 API 인터페이스  
    interface TestService {  
        @GET("?lib=Retrofit")  
        Call<ResponseBody> getData();  
    }  
  
    // UI 작업은 메인쓰레드에서 해야하기 때문에 핸들러 사용  
    public void printData(String data) {  
        handler.post(() -> tv_res_HttpURLConnection.setText(data));  
    }  
  
    // Volley로 요청보내기  
    public void sendRequestWithVolley() {  
        // 요청객체 생성  
        StringRequest stringRequest =  
                new StringRequest(  
                        Request.Method.GET,  
                        baseUrl + "?lib=Volley",  
                        // 응답 처리 리스너  
                        new Response.Listener<String>() {  
                            @Override  
                            public void onResponse(String response) {  
                                tv_res_Volley.setText(response);  
                            }  
                        },  
                        // 에러 처리 리스너  
                        new Response.ErrorListener() {  
                            @Override  
                            public void onErrorResponse(VolleyError volleyError) {  
                                tv_res_Volley.setText("ERROR");  
                            }  
                        }  
                );  
  
        // requestQueue에 request 객체 추가  
        requestQueue.add(stringRequest);  
    }  
  
    // Retrofit으로 요청보내기  
    public void sendRequestWithRetrofit() {  
        Call<ResponseBody> data = testService.getData();  
        // enqueue 하는 시점에 네트워킹 시작  
        data.enqueue(new Callback<ResponseBody>() {  
            // 정상처리  
            @Override  
            public void onResponse(Call<ResponseBody> call, retrofit2.Response<ResponseBody> response) {  
                ResponseBody ResponseBody = response.body();  
                if (ResponseBody != null) {  
                    try {  
                        tv_res_Retrofit.setText(ResponseBody.string());  
                    } catch (IOException e) {  
                        throw new RuntimeException(e);  
                    }  
                } else {  
                    tv_res_Retrofit.setText("ERROR");  
                }  
            }  
  
            // 에러처리  
            @Override  
            public void onFailure(Call<ResponseBody> call, Throwable throwable) {  
                call.cancel();  
                tv_res_Retrofit.setText("ERROR");  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="126">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\LoginActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.widget.Toast;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.kakao.sdk.auth.model.OAuthToken;  
import com.kakao.sdk.auth.model.Prompt;  
import com.kakao.sdk.common.model.AuthError;  
import com.kakao.sdk.common.model.AuthErrorCause;  
import com.kakao.sdk.common.model.ClientError;  
import com.kakao.sdk.common.model.ClientErrorCause;  
import com.kakao.sdk.user.UserApiClient;  
import com.kakao.sdk.user.model.User;  
import com.teamnova.assa.data.dto.data.OauthData;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.LoginRequest;  
import com.teamnova.assa.data.dto.request.RegisterRequest;  
import com.teamnova.assa.data.dto.response.CheckDuplicationResponse;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivityLoginBinding;  
import com.teamnova.assa.domain.Authentication;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.util.TempStorage;  
  
import java.util.Collections;  
  
import kotlin.Unit;  
import kotlin.jvm.functions.Function2;  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class LoginActivity extends AppCompatActivity {  
  
    private final String TAG = LoginActivity.class.getSimpleName();  
    private ActivityLoginBinding binding;  
  
    private boolean isPasswordVisible = true; // 기본 값으로 비밀번호가 보이지 않도록 설정  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        // 화면 설정  
        binding = ActivityLoginBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        setOnClickListeners();  
    }  
  
    @Override  
    protected void onResume() {  
        super.onResume();  
        // 회원가입 버튼 활성화  
        if (binding != null) binding.btnLoginSignup.setEnabled(true);  
    }  
  
    // 클릭 리스너 설정  
    private void setOnClickListeners() {  
        // 로그인 버튼  
        binding.btnLoginLogin.setOnClickListener(v -> defaultLogin());  
  
        // 카카오 로그인 버튼  
        binding.btnLoginKakao.setOnClickListener(v -> callKakaoLoginApi());  
  
  
  
        // 회원가입 버튼  
        binding.btnLoginSignup.setOnClickListener(v -> {  
            // 중복 클릭 방지를 위해 버튼 비활성화  
            v.setEnabled(false);  
            // 회원가입 화면으로 이동  
            Intent intent = new Intent(this, EmailActivity.class);  
            intent.putExtra("purpose", "registration");  
            startActivity(intent);  
        });  
  
        // 비밀번호 재설정 버튼  
        binding.tvLoginForgotpw.setOnClickListener(v -> {  
            // 이메일 입력화면으로 이동  
            Intent intent = new Intent(this, EmailActivity.class);  
            intent.putExtra("purpose", "resetPw");  
            startActivity(intent);  
        });  
    }  
  
    // 일반로그인  
    private void defaultLogin() {  
        // 입력된 이메일과 비밀번호 가져오기  
        String email = binding.tietLoginEamil.getText().toString();  
        String pw = binding.tietLoginPw.getText().toString();  
  
        // 로그인 정보 객체 생성  
        LoginRequest request = new LoginRequest(email, pw, UserData.LOGIN_TYPE.DEFAULT, null, null);  
  
        // 로그인 요청  
        Authentication.login(request,  
                (response) -> {  
                    Intent intent = new Intent(getApplicationContext(), ChattingSocketService.class);  
                    startService(intent);  
                    moveToMainActivity();  
                },  
                (response) -> Toast.makeText(this, "이메일 혹은 비밀번호를 잘못 입력했습니다", Toast.LENGTH_SHORT).show()  
        );  
    }  
  
    // 카카오 로그인 API 호출  
    private void callKakaoLoginApi() {  
        // 카카오톡 설치 확인  
        if (UserApiClient.getInstance().isKakaoTalkLoginAvailable(this)) {  
            // 설치 시 카카오톡 로그인  
            Log.d(TAG, "callKakaoLoginApi: 카카오톡으로 로그인");  
            UserApiClient.getInstance().loginWithKakaoTalk(this, kakaoLoginResultCallback);  
        } else {  
            // 카카오톡 미설치 시 카카오계정으로 로그인  
            Log.d(TAG, "callKakaoLoginApi: 카카오계정으로 로그인");  
            // 매번 로그인을 요구하는 옵션 활성화  
            UserApiClient.getInstance().loginWithKakaoAccount(this, Collections.singletonList(Prompt.LOGIN), kakaoLoginResultCallback);  
        }  
    }  
  
    // 카카오 로그인 콜백 (카카오톡, 카카오계정 공통)  
    Function2<OAuthToken, Throwable, Unit> kakaoLoginResultCallback = new Function2<OAuthToken, Throwable, Unit>() {  
        @Override  
        public Unit invoke(OAuthToken oAuthToken, Throwable throwable) {  
            if (throwable != null) {  
                Log.e(TAG, "invoke: 카카오 사용자 인증 실패", throwable);  
  
                // 사용자가 카카오톡 설치 후 디바이스 권한 요청 화면에서 로그인 취소  
                // 로그인 취소 처리  
                if (throwable instanceof ClientError && ((ClientError) throwable).getReason() == ClientErrorCause.Cancelled) {  
                    return null;  
                }  
  
                // 카카오 로그인 동의화면에서 취소한 경우 (뒤로가기 등)  
                if (throwable instanceof AuthError && ((AuthError) throwable).getReason() == AuthErrorCause.AccessDenied) {  
                    return null;  
                }  
  
                // 그 외의 경우는 카카오톡으로 로그인 시도 할 때, 카카오톡에 카카오계정이 로그인 되어 있지 않은 상황  
                // 이 때, 카카오계정으로 로그인 시도  
                // 매번 로그인을 요구하는 옵션 활성화  
                UserApiClient.getInstance().loginWithKakaoAccount(getApplicationContext(), Collections.singletonList(Prompt.LOGIN), kakaoLoginResultCallback);  
                return null;  
            }  
  
            if (oAuthToken != null) {  
                Log.i(TAG, "invoke: 카카오 사용자 인증 성공" + oAuthToken.getAccessToken());  
  
                // 카카오 유저로 서비스 인증 진행  
                authenticationWithKakao();  
            }  
  
            return null;  
        }  
    };  
  
    /**  
     * 카카오 계정정보 가져오고 다음 화면으로 이동  
     */  
    private void authenticationWithKakao() {  
        // authId 얻어오기  
        UserApiClient.getInstance().me(new Function2<User, Throwable, Unit>() {  
            @Override  
            public Unit invoke(User user, Throwable throwable) {  
                if (throwable != null) {  
                    Log.e(TAG, "invoke: 사용자 정보 요청 실패", throwable);  
                    Toast.makeText(LoginActivity.this, "카카오 사용자 정보 요청 실패", Toast.LENGTH_SHORT).show();  
                    return null;  
                }  
  
                Log.i(TAG, "invoke: 사용자 정보 요청 성공" +  
                        "\n유저 아이디: " + user.getId() +  
                        "\n이메일: " + user.getKakaoAccount().getEmail()  
                );  
  
                // 사용자가 이미 가입된 사용자인지 확인  
                // 가입되었다면 로그인을 하고, 아니라면 회원가입 진행  
                checkUserDuplication(user.getId(), user.getKakaoAccount().getEmail());  
                return null;  
            }  
        });  
    }  
  
    // 사용자 중복 확인  
    private void checkUserDuplication(long kakaoUserId, String email) {  
        UsersApiClient.getInstance().checkDuplication("oauth", "" + kakaoUserId)  
                .enqueue(new Callback<CheckDuplicationResponse>() {  
                    @Override  
                    public void onResponse(Call<CheckDuplicationResponse> call, Response<CheckDuplicationResponse> response) {  
                        Log.d(TAG, "카카오 유저가 이미 존재하는지 확인한 결과 응답 성공 " + response);  
  
                        if (response.isSuccessful()) {  
                            CheckDuplicationResponse res = response.body();  
  
                            if (res.isDuplicated) {  
                                Log.d(TAG, "해당 카카오 유저는 이미 존재함");  
  
                                // 이미 가입된 사용자는 로그인 진행  
                                loginExistingUser(email, kakaoUserId);  
                            } else {  
                                Log.d(TAG, "해당 카카오 유저는 존재하지 않음");  
  
                                // 가입되지 않은 사용자는 회원가입 진행  
                                // 사용자 중복을 한 다음 이메일 중복을 체크하는 이유는 같은 이메일을 사용하는  
                                // 일반계정이 존재한다면, 가입을 막아야 하기 때문이다.  
                                checkEmailDuplication(email, kakaoUserId);  
                            }  
                        }  
                    }  
  
                    @Override  
                    public void onFailure(Call<CheckDuplicationResponse> call, Throwable throwable) {  
                        Log.e(TAG, "onFailure: 사용자 중복 확인 실패", throwable);  
                        Toast.makeText(getApplicationContext(), "사용자 중복 확인 실패", Toast.LENGTH_SHORT).show();  
                    }  
                });  
    }  
  
    // 이메일 중복 확인  
    private void checkEmailDuplication(String email, long kakaoUserId) {  
        UsersApiClient.getInstance()  
                .checkDuplication("email", email)  
                .enqueue(new Callback<CheckDuplicationResponse>() {  
                    @Override  
                    public void onResponse(Call<CheckDuplicationResponse> call, Response<CheckDuplicationResponse> response) {  
                        Log.d(TAG, "이메일 존재여부 확인 응답 성공 " + response);  
  
                        if (response.isSuccessful()) {  
                            CheckDuplicationResponse res = response.body();  
                            Log.d(TAG, "이메일 중복여부: " + res.isDuplicated);  
                            if (res.isDuplicated) {  
                                // 이메일이 이미 사용 중인 경우  
                                Toast.makeText(getApplicationContext(), "해당 계정의 이메일이 이미 사용 중입니다. 다른 계정으로 로그인 해주세요.", Toast.LENGTH_SHORT).show();  
                            } else {  
                                // 이메일이 사용 가능한 경우  
                                moveToAgreeToTerms(email, kakaoUserId);  
                            }  
                        }  
                    }  
  
                    @Override  
                    public void onFailure(Call<CheckDuplicationResponse> call, Throwable throwable) {  
                        Log.e(TAG, "onFailure: 이메일 중복 확인 실패", throwable);  
                        Toast.makeText(getApplicationContext(), "이메일 중복 확인 실패", Toast.LENGTH_SHORT).show();  
                    }  
                });  
    }  
  
    // 약관동의 화면으로 이동  
    private void moveToAgreeToTerms(String email, long kakaoUserId) {  
        // 약관동의 화면으로 이동  
        OauthData oauthData = new OauthData(null, null, kakaoUserId, "kakao");  
        UserData userData = new UserData(null, email, null, UserData.LOGIN_TYPE.SOCIAL);  
        RegisterRequest registerRequest = new RegisterRequest(userData, oauthData, null);  
  
        // RegisterRequest를 다음 액티비티로 넘긴다 (약관동의 화면)  
        TempStorage.setItem("registerRequest", registerRequest);  
        Intent intent = new Intent(getApplicationContext(), AgreeToTermsActivity.class);  
        startActivity(intent);  
    }  
  
    // 이미 가입된 사용자 로그인  
    private void loginExistingUser(String email, long kakaoUserId) {  
        LoginRequest request = new LoginRequest(email, null, UserData.LOGIN_TYPE.SOCIAL, kakaoUserId, null);  
  
        Authentication.login(request,  
                (response) -> {  
                    Intent intent = new Intent(getApplicationContext(), ChattingSocketService.class);  
                    startService(intent);  
                    moveToMainActivity();  
                },  
                (response) -> Toast.makeText(getApplicationContext(), "로그인에 실패했습니다", Toast.LENGTH_SHORT).show());  
    }  
  
    /**  
     * 다음 화면으로 이동, 현재까지의 액티비티 백스택은 제거됩니다.  
     */  
    private void moveToMainActivity() {  
        Intent intent = new Intent(getApplicationContext(), MainActivity.class);  
        Toast.makeText(getApplicationContext(), "로그인 되었습니다", Toast.LENGTH_SHORT).show();  
        startActivity(intent);  
        finish();  
    }  
}  
</document_content>  
</document>  
<document index="127">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\MainActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.MenuItem;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.fragment.app.Fragment;  
import androidx.fragment.app.FragmentTransaction;  
  
import com.google.android.material.navigation.NavigationBarView;  
import com.teamnova.assa.R;  
import com.teamnova.assa.databinding.ActivityMainBinding;  
import com.teamnova.assa.ui.fragment.ChatFragment;  
import com.teamnova.assa.ui.fragment.HomeFragment;  
import com.teamnova.assa.ui.fragment.OpenChatFragment;  
import com.teamnova.assa.ui.fragment.ProfileFragment;  
import com.teamnova.assa.ui.fragment.SearchFragment;  
import com.teamnova.assa.util.TempStorage;  
  
public class MainActivity extends AppCompatActivity {  
  
    private static final String TAG = MainActivity.class.getSimpleName();  
    private ActivityMainBinding binding;  
    private int currnetItemId;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityMainBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        setBottomNav();  
  
        // 앱이 처음 실행 될 때 홈화면이 켜지도록 함  
        if (savedInstanceState == null) {  
            binding.bottomNavigationMain.setSelectedItemId(R.id.fragment_home);  
        }  
  
        // 액티비티 인스턴스 저장 (서비스에서 채팅방 목록 프래그먼트가 화면에 보이고 있는 중인지 판별하기 위해 필요함)  
        TempStorage.setItem("MainActivity_instance", this);  
    }  
  
    /**  
     * 바텀 네비게이션 설정  
     */  
    private void setBottomNav(){  
        binding.bottomNavigationMain.setOnItemSelectedListener(new NavigationBarView.OnItemSelectedListener() {  
            @Override  
            public boolean onNavigationItemSelected(@NonNull MenuItem menuItem) {  
                Fragment selectedFragment = null;  
                int itemId = menuItem.getItemId();  
                Log.d(TAG, "선택한 아이템 itemId : itemId = " + itemId);  
  
                if (itemId == R.id.fragment_home) {  
                    selectedFragment = new HomeFragment();  
                } else if (itemId == R.id.fragment_search) {  
                    selectedFragment = new SearchFragment();  
                } else if (itemId == R.id.fragment_chat) {  
                    selectedFragment = new ChatFragment();  
                } else if (itemId == R.id.fragment_openchat) {  
                    selectedFragment = new OpenChatFragment();  
                } else if (itemId == R.id.fragment_profile) {  
                    selectedFragment = new ProfileFragment();  
                } else {  
                    return false;  
                }  
  
                Log.d(TAG, "생성된 프래그먼트 selectedFragment = " + selectedFragment);  
  
                // 연속 호출 방지  
                if(currnetItemId != itemId){  
                    FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();  
                    transaction.replace(R.id.fragment_container_main, selectedFragment).commit();  
                    currnetItemId = itemId;  
                }  
  
  
                return true;  
            }  
        });  
    }  
  
}  
</document_content>  
</document>  
<document index="128">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\MainActivity2.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.widget.Toast;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.kakao.sdk.user.UserApiClient;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.DeleteAccountResponse;  
import com.teamnova.assa.data.dto.response.LogoutResponse;  
import com.teamnova.assa.data.repository.TokenRepository;  
import com.teamnova.assa.data.retrofit.clients.AuthApiClient;  
import com.teamnova.assa.databinding.ActivityMain2Binding;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class MainActivity2 extends AppCompatActivity {  
  
    private static final String TAG = MainActivity2.class.getSimpleName();  
    private ActivityMain2Binding binding;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivityMain2Binding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        setOnClickListener();  
  
        getMe();  
  
    }  
  
    private void setOnClickListener() {  
        // 로그아웃  
        binding.btnLogout.setOnClickListener(v -> {  
            AuthApiClient.getInstance().logout().enqueue(new Callback<LogoutResponse>() {  
                @Override  
                public void onResponse(Call<LogoutResponse> call, Response<LogoutResponse> response) {  
                    if (response.isSuccessful() && response.body() != null && response.body().status.equals("success")) {  
                        Log.d(TAG, "onResponse: 로그아웃 성공 " + response.body());  
                        Toast.makeText(getApplicationContext(), "로그아웃 되었습니다.", Toast.LENGTH_SHORT).show();  
  
                        // 서비스 토큰제거  
                        TokenRepository.removeToken();  
  
                        // 현재유저의 로그인 방식과 상관없이 카카오 로그인의 액세스 토큰, 리프레시 토큰을 제거한다.  
                        UserApiClient.getInstance().logout(error -> {  
                            if (error != null) {  
                                Log.e(TAG, "로그아웃 실패. SDK에서 토큰 삭제됨", error);  
                            } else {  
                                Log.i(TAG, "로그아웃 성공. SDK에서 토큰 삭제됨");  
                            }  
                            return null;  
                        });  
  
  
                        // 로그인 화면으로 이동  
                        Intent intent = new Intent(MainActivity2.this, LoginActivity.class);  
                        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);  
                        startActivity(intent);  
                        finish();  
                    } else {  
                        Log.d(TAG, "onResponse: 로그아웃 실패 " + response.body());  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<LogoutResponse> call, Throwable throwable) {  
                    Log.e(TAG, "onFailure: 통신 실패", throwable);  
                }  
            });  
        });  
  
        // 회원탈퇴  
        binding.btnDeleteAccount.setOnClickListener(v -> {  
            AuthApiClient.getInstance().deleteAccount().enqueue(new Callback<DeleteAccountResponse>() {  
                @Override  
                public void onResponse(Call<DeleteAccountResponse> call, Response<DeleteAccountResponse> response) {  
                    if (response.isSuccessful() && response.body() != null && response.body().status.equals("success")) {  
                        Log.d(TAG, "onResponse: 회원탈퇴 성공 " + response.body());  
  
                        Toast.makeText(getApplicationContext(), "회원탈퇴 되었습니다.", Toast.LENGTH_SHORT).show();  
  
                        // 로그인 화면으로 이동, 자동로그인 방지를 위해 토큰도 제거한다.  
                        TokenRepository.removeToken();  
  
                        // 현재유저의 로그인 방식과 상관없이 카카오 계정의 연결 상태를 해제를 시도한다.  
                        UserApiClient.getInstance().unlink(throwable -> {  
                            if (throwable != null) {  
                                Log.e(TAG, "onResponse: 연결 끊기 실패", throwable);  
                            } else {  
                                Log.i(TAG, "onResponse: 연결 끊기 성공. SDK에서 토큰 삭제됨");  
                            }  
                            return null;  
                        });  
  
                        // 로그인 화면으로 이동  
                        Intent intent = new Intent(MainActivity2.this, LoginActivity.class);  
                        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);  
                        startActivity(intent);  
                        finish();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<DeleteAccountResponse> call, Throwable throwable) {  
                    Log.e(TAG, "onFailure: 통신 실패", throwable);  
                }  
            });  
        });  
  
  
        // 새로고침 (테스트 용)  
        binding.btnRefresh.setOnClickListener(v -> getMe());  
    }  
  
    private void getMe() {  
        AuthApiClient client = AuthApiClient.getInstance();  
        client.me().enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                if (response.isSuccessful()) {  
                    UserData userData = response.body();  
                    Log.d(TAG, "onResponse: " + userData.toString());  
                    binding.tvUser.setText("접속자 : " + userData.nickname);  
                } else {  
                    Log.i(TAG, "onResponse: 에러 응답");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: ", throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="129">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\NewOpenChatActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.databinding.ActivityNewOpenChatBinding;  
  
/**  
 * 오픈채팅 생성 액티비티  
 * 방 제목, 소개글  
 */  
public class NewOpenChatActivity extends AppCompatActivity {  
    private static final String TAG = NewOpenChatActivity.class.getSimpleName();  
    ActivityNewOpenChatBinding binding;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        Log.i(TAG, "onCreate: START");  
        super.onCreate(savedInstanceState);  
        binding = ActivityNewOpenChatBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        setUpToolbar();  
        setUpEditTexts();  
        setUpCompleteButton();  
        Log.i(TAG, "onCreate: END");  
    }  
  
    public void setUpToolbar() {  
        Log.i(TAG, "setUpToolbar: START");  
        setSupportActionBar(binding.toolbarNewchat);  
  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
        getSupportActionBar().setDisplayShowHomeEnabled(true);  
        binding.toolbarNewchat.inflateMenu(R.menu.menu_next);  
        binding.toolbarNewchat.setNavigationOnClickListener(v -> onBackPressed());  
        Log.i(TAG, "setUpToolbar: END");  
    }  
  
    public void setUpEditTexts() {  
        binding.etNewchatTitle.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                updateCompleteButtonState();  
            }  
        });  
    }  
  
    private void updateCompleteButtonState() {  
        boolean isEnabled = checkCondition();  
        binding.tvNewchatComplete.setEnabled(isEnabled);  
    }  
  
    private boolean checkCondition() {  
        String title = binding.etNewchatTitle.getText().toString().trim();  
        return !title.isEmpty();  
    }  
  
    private void setUpCompleteButton() {  
        binding.tvNewchatComplete.setOnClickListener(v -> {  
            Log.i(TAG, "setUpCompleteButton: 완료 버튼 클릭");  
  
            // 오픈채팅은 이름 정하면 바로 채팅방 생성됨  
  
            // 채팅방 화면으로 이동  
            Intent intent = new Intent(this, ChatRoomActivity.class);  
            intent.putExtra("isNewRoom", true);  
            intent.putExtra("isOpenChat", true);  
            intent.putExtra("roomName", binding.etNewchatTitle.getText().toString().trim());  
            intent.putExtra("description", binding.etNewchatDescription.getText().toString().trim());  
            startActivity(intent);  
            finish();  
        });  
    }  
  
  
}  
</document_content>  
</document>  
<document index="130">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\OpenChatSettingActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.MenuItem;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.databinding.ActivityOpenChatSettingBinding;  
import com.teamnova.assa.util.TempStorage;  
  
public class OpenChatSettingActivity extends AppCompatActivity {  
  
    private static final String TAG = OpenChatSettingActivity.class.getSimpleName();  
    ActivityOpenChatSettingBinding binding;  
  
    Long roomId;  
    String roomName;  
    String description;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        Log.i(TAG, "onCreate: START");  
        super.onCreate(savedInstanceState);  
        binding = ActivityOpenChatSettingBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        roomId = getIntent().getLongExtra("roomId", 0L);  
        roomName = getIntent().getStringExtra("roomName");  
        description = getIntent().getStringExtra("roomDescription");  
  
        Log.d(TAG, "onCreate: roomId = " + roomId + ", roomName = " + roomName + ", description = " + description);  
  
        if (roomName != null) binding.tvSetOpenChatNameValue.setText(roomName);  
        if (description != null) binding.tvSetOpenChatDescriptionValue.setText(description);  
  
        initToolbar("오픈채팅 관리");  
        initListener();  
  
        Log.i(TAG, "onCreate: END");  
    }  
  
    private void initToolbar(String title) {  
        Log.i(TAG, "initToolbar: START - params : title = " + title);  
  
        binding.toolbarOpenChatSetting.setTitle(title);  
        setSupportActionBar(binding.toolbarOpenChatSetting);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
        getSupportActionBar().setDisplayShowHomeEnabled(true);  
  
        Log.i(TAG, "initToolbar: END");  
    }  
  
    private void initListener() {  
        binding.llSetOpenChatNameContainer.setOnClickListener(v -> {  
            Log.i(TAG, "initListener: ll_set_open_chat_name_container 클릭");  
            Intent intent = new Intent(OpenChatSettingActivity.this, ChangeOpenChatRoomNameActivity.class);  
            intent.putExtra("roomId", roomId);  
            startActivity(intent);  
        });  
  
        binding.llSetOpenChatDescriptionContainer.setOnClickListener(v -> {  
            Log.i(TAG, "initListener: ll_set_open_chat_description_container 클릭");  
            Intent intent = new Intent(OpenChatSettingActivity.this, ChangeDescriptionActivity.class);  
            intent.putExtra("roomId", roomId);  
            startActivity(intent);  
        });  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        Log.i(TAG, "onOptionsItemSelected: START - params : item = " + item);  
        int itemId = item.getItemId();  
        if (itemId == android.R.id.home) {  
            Log.i(TAG, "onOptionsItemSelected: 뒤로가기 버튼 클릭");  
            onBackPressed();  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    @Override  
    protected void onResume() {  
        super.onResume();  
  
        String newChatName = (String) TempStorage.getItem("newChatName");  
        String newDesc = (String) TempStorage.getItem("newDescription");  
  
        if (newChatName != null) {  
            binding.tvSetOpenChatNameValue.setText(newChatName);  
        }  
        if (newDesc != null) {  
            binding.tvSetOpenChatDescriptionValue.setText(newDesc);  
        }  
    }  
}  
</document_content>  
</document>  
<document index="131">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\PeerConnectionActivity.java</source>  
<document_content>  
//import android.app.Application;  
//import android.graphics.Bitmap;  
//import android.os.Bundle;  
//import android.util.Log;  
//import android.view.View;  
//import android.widget.Button;  
//  
//import androidx.appcompat.app.AppCompatActivity;  
//  
//import org.json.JSONException;  
//import org.json.JSONObject;  
//import org.webrtc.Camera1Enumerator;  
//import org.webrtc.CameraVideoCapturer;  
//import org.webrtc.DataChannel;  
//import org.webrtc.EglBase;  
//import org.webrtc.EglRenderer;  
//import org.webrtc.IceCandidate;  
//import org.webrtc.MediaConstraints;  
//import org.webrtc.MediaStream;  
//import org.webrtc.MediaStreamTrack;  
//import org.webrtc.PeerConnection;  
//import org.webrtc.PeerConnectionFactory;  
//import org.webrtc.RendererCommon;  
//import org.webrtc.RtpReceiver;  
//import org.webrtc.RtpTransceiver;  
//import org.webrtc.SdpObserver;  
//import org.webrtc.SessionDescription;  
//import org.webrtc.SurfaceTextureHelper;  
//import org.webrtc.SurfaceViewRenderer;  
//import org.webrtc.VideoCapturer;  
//import org.webrtc.VideoSource;  
//import org.webrtc.VideoTrack;  
//  
//import java.net.Socket;  
//import java.net.URI;  
//import java.util.ArrayList;  
//import java.util.List;  
//  
//public class PeerConnectionActivity extends AppCompatActivity {  
//  
////    https://webrtc.github.io/samples/src/content/peerconnection/pc1/  
////    https://webrtc.github.io/samples/src/content/peerconnection/channel/  
//  
//    PeerConnection PC;  
//  
//    PeerConnection.RTCConfiguration rtcConfig;  
//    List<PeerConnection.IceServer> iceServers;  
//  
//    Button 시작,종료;  
//    Application myApp;  
//    PeerConnectionFactory connectionFactory;  
//    MediaConstraints mediaConstraints;  
//  
//    PeerConnection.Observer PCObserver;  
//    SdpObserver sdpObserver;  
//  
//    VideoCapturer videoCapturer;  
//  
//    EglBase rootEglBase;  
//    EglBase.Context eglBaseContext;  
//    SurfaceTextureHelper surfaceTextureHelper;  
//  
//    final String VIDEO_TRACK_ID = "ARDAMSv0";  
//  
//    VideoTrack localTrack;  
//    VideoTrack remoteTrack;  
//  
//    SurfaceViewRenderer localView,remoteView;  
//  
//    Socket socket;  
//  
//    Emitter.Listener onConnect,onMessage;  
//  
//    @Override  
//    protected void onCreate(Bundle savedInstanceState) {  
//        super.onCreate(savedInstanceState);  
//  
//        setContentView(R.layout.activity_peer_connection);  
//  
//        myApp = (Application) getApplicationContext();  
//        connectionFactory = myApp.getPeerConnectionFactory();  
//  
//        시작 = findViewById(R.id.button3);  
//        종료 = findViewById(R.id.button5);  
//        localView = findViewById(R.id.localview);  
//        remoteView = findViewById(R.id.remoteview);  
//  
//        SurfaceViewRendererInit(localView);  
//        SurfaceViewRendererInit(remoteView);  
//  
//        iceServers = new ArrayList<>();  
//        PeerConnection.IceServer stunserver =  
//                PeerConnection.IceServer.builder("stun:stun.l.google.com:19302")  
//                        .createIceServer();  
//        iceServers.add(stunserver);  
//  
//        rtcConfig = new PeerConnection.RTCConfiguration(iceServers);  
//        rootEglBase = EglBase.create();  
//        eglBaseContext= rootEglBase.getEglBaseContext();  
//        surfaceTextureHelper = SurfaceTextureHelper.create(Thread.currentThread().getName(), eglBaseContext);  
//  
//  
//        mediaConstraints = new MediaConstraints();  
//        mediaConstraints.mandatory.add(  
//                new MediaConstraints.KeyValuePair("OfferToReceiveAudio",  Boolean.toString(true)));  
//        mediaConstraints.mandatory.add(new MediaConstraints.KeyValuePair(  
//                "OfferToReceiveVideo", Boolean.toString(true)));//isVideoCallEnabled()  
//  
//        PCObserver = new PeerConnection.Observer() {  
//            @Override  
//            public void onSignalingChange(PeerConnection.SignalingState signalingState) {  
//  
//            }  
//  
//            @Override  
//            public void onIceConnectionChange(PeerConnection.IceConnectionState iceConnectionState) {  
//  
//            }  
//  
//            @Override  
//            public void onIceConnectionReceivingChange(boolean b) {  
//  
//            }  
//  
//            @Override  
//            public void onIceGatheringChange(PeerConnection.IceGatheringState iceGatheringState) {  
//  
//            }  
//  
//            @Override  
//            public void onIceCandidate(IceCandidate iceCandidate) {  
//// const message = {  
////                        type: 'candidate',  
////                        candidate: null,  
////    };  
////                if (e.candidate) {  
////                    message.candidate = e.candidate.candidate;  
////                    message.sdpMid = e.candidate.sdpMid;  
////                    message.sdpMLineIndex = e.candidate.sdpMLineIndex;  
////                }  
////                signaling.postMessage(message)  
//                JSONObject message = new JSONObject();  
//                try {  
//                    message.put("type","candidate");  
//                    message.put("candidate",toJsonCandidate(iceCandidate));  
//                } catch (JSONException e) {  
//                    e.printStackTrace();  
//                    return;  
//                }  
//  
//  
//                socket.emit("message",message);  
//            }  
//  
//            @Override  
//            public void onTrack(RtpTransceiver transceiver) {  
//                PeerConnection.Observer.super.onTrack(transceiver);  
//                PeerConnection.Observer.super.onTrack(transceiver);  
//                PeerConnection.Observer.super.onTrack(transceiver);  
//                Log.i("onTrack","");  
//                PeerConnection.Observer.super.onTrack(transceiver);  
//  
//                RtpReceiver receiver = transceiver.getReceiver();  
//  
//                if(receiver.track().kind().equals(MediaStreamTrack.VIDEO_TRACK_KIND)){  
//                    VideoTrack videoTrack = (VideoTrack) receiver.track();  
//                    Log.i("onTrack","videoTrack");  
//                    videoTrack.addSink(remoteView);  
//                }  
//            }  
//  
//            @Override  
//            public void onConnectionChange(PeerConnection.PeerConnectionState newState) {  
//  
//                PeerConnection.Observer.super.onConnectionChange(newState);  
//  
//                Log.i("onConnectionChange",newState.toString());  
//  
//            }  
//  
//            @Override  
//            public void onIceCandidatesRemoved(IceCandidate[] iceCandidates) {  
//  
//            }  
//  
//            @Override  
//            public void onAddStream(MediaStream mediaStream) {  
//  
//            }  
//  
//            @Override  
//            public void onRemoveStream(MediaStream mediaStream) {  
//  
//            }  
//  
//            @Override  
//            public void onDataChannel(DataChannel dataChannel) {  
//  
//            }  
//  
//            @Override  
//            public void onRenegotiationNeeded() {  
//  
//            }  
//        };  
//        onConnect = new Emitter.Listener() {  
//            @Override  
//            public void call(Object... args) {  
//  
//                Log.i("연결 성공","connect");  
//  
//            }  
//        };  
//        onMessage = new Emitter.Listener() {  
//            @Override  
//            public void call(Object... args) {  
//  
//  
//                JSONObject message = (JSONObject) args[0];  
//                String type;  
//                try {  
//                    type = message.getString("type");  
//                } catch (JSONException e) {  
//                    e.printStackTrace();  
//                    return;  
//                }  
//  
//                switch (type){  
//                    case "ready":  
//                        if(PC != null){  
//                            Log.i("ready : ","already in call, ignoring");  
//                            break;  
//                        }  
//                        makeCall();  
//                        break;  
//                    case "offer" :  
//  
//                        SessionDescription offer;  
//                        try {  
//  
//                            String sdp_description = message.getString("sdp");  
//                            offer = new SessionDescription(SessionDescription.Type.OFFER,sdp_description);  
//                            handleOffer(offer);  
//  
//                        } catch (JSONException e) {  
//                            e.printStackTrace();  
//                            return;  
//                        }  
//  
//                        break;  
//                    case "answer" :  
//                        SessionDescription answer;  
//                        try {  
//  
//                            String sdp_description = message.getString("sdp");  
//                            answer = new SessionDescription(SessionDescription.Type.ANSWER,sdp_description);  
//  
//                        } catch (JSONException e) {  
//                            e.printStackTrace();  
//                            return;  
//                        }  
//                        handleAnswer(answer);  
//                        break;  
//                    case "candidate" :  
//                        IceCandidate candidate;  
//                        try {  
//                            JSONObject msg = (JSONObject) message.get("candidate");  
//                            candidate = new IceCandidate(  msg.getString("sdpMid"),msg.getInt("sdpMLineIndex"), msg.getString("candidate"));  
//  
//                        } catch (JSONException e) {  
//                            e.printStackTrace();  
//                            return;  
//                        }  
//                        handleCandidate(candidate);  
//                        break;  
//                    case "bye" :  
//                        if(PC != null)  
//                            hangup();  
//                        break;  
//                }  
//  
//            }  
//        };  
//  
//  
//        시작.setOnClickListener(new View.OnClickListener() {  
//            @Override  
//            public void onClick(View view) {  
//  
//                // 비디오 트랙 가져오기  
//                localTrack = getLocalVideo(true);  
//                localTrack.addSink(localView);  
//  
////                signaling.postMessage({type: 'ready'});  
//  
//                JSONObject message = new JSONObject();  
//                try {  
//                    message.put("type","ready");  
//                } catch (JSONException e) {  
//                    e.printStackTrace();  
//                }  
//                socket.emit("message",message);  
//  
//            }  
//        });  
//  
//  
//  
//        종료.setOnClickListener(new View.OnClickListener() {  
//            @Override  
//            public void onClick(View view) {  
//  
//                hangup();  
//                JSONObject message = new JSONObject();  
//                try {  
//                    message.put("type","bye");  
//                } catch (JSONException e) {  
//                    e.printStackTrace();  
//                }  
//                socket.emit("message",message);  
//  
//            }  
//        });  
//  
//        socket = IO.socket(URI.create(서버 uri));//"http://chat.socket.io"); //  
//  
//        socket.on(Socket.EVENT_CONNECT, onConnect);  
//  
//        socket.on("onmessage",onMessage);  
//        socket.connect();  
//  
//    }  
//  
//  
//    public void makeCall(){  
//        createPeerConnection();  
//  
//        PC.createOffer(new SdpObserver() {  
//            @Override  
//            public void onCreateSuccess(SessionDescription sessionDescription) {  
//                JSONObject message = new JSONObject();  
//                try {  
//                    message.put("type","offer");  
//                    message.put("sdp",sessionDescription.description);  
//  
//                } catch (JSONException e) {  
//                    e.printStackTrace();  
//                    return;  
//                }  
//                socket.emit("message",message);  
//  
//                PC.setLocalDescription(new SdpObserver() {  
//                    @Override  
//                    public void onCreateSuccess(SessionDescription sessionDescription) {  
//  
//                    }  
//  
//                    @Override  
//                    public void onSetSuccess() {  
//  
//                    }  
//  
//                    @Override  
//                    public void onCreateFailure(String s) {  
//  
//                    }  
//  
//                    @Override  
//                    public void onSetFailure(String s) {  
//  
//                    }  
//                }, sessionDescription);  
//            }  
//  
//            @Override  
//            public void onSetSuccess() {  
//  
//            }  
//  
//            @Override  
//            public void onCreateFailure(String s) {  
//  
//            }  
//  
//            @Override  
//            public void onSetFailure(String s) {  
//  
//            }  
//        },mediaConstraints);  
//  
//  
//    }  
//  
//    public void createPeerConnection(){  
//  
//        PC = connectionFactory.createPeerConnection(rtcConfig,PCObserver);  
//        PC.addTrack(localTrack);  
//  
//    }  
//  
//    // icecandidate를 json형식으로 변환한다.  
//    // Converts a Java candidate to a JSONObject.  
//    private JSONObject toJsonCandidate(final IceCandidate candidate) {  
//        JSONObject json = new JSONObject();  
//        try {  
//            json.put("sdpMLineIndex", candidate.sdpMLineIndex);  
//            json.put("sdpMid", candidate.sdpMid);  
//            json.put("candidate", candidate.sdp);  
//        } catch (JSONException e) {  
//            e.printStackTrace();  
//        }  
////        jsonPut(json, "id", candidate.sdpMid);  
////        jsonPut(json, "candidate", candidate.sdp);  
//        return json;  
//    }  
//  
//    /**내 기기의(카메라 소스로 얻은) video track을 반환한다.  
//     *  
//     *@paramstatus  
//     *@return:내 기기의(카메라 소스로 얻은) video track  
//     */  
//    public VideoTrack getLocalVideo(boolean status){  
//  
//        // localVideo 변수 선언  
//        VideoTrack localVideo;  
//  
//        // videoCapturer : 비디오 소스에서 비디오 프레임을 캡처하고 VideoSource 객체에 전달하는 데 사용됩니다.  
//        videoCapturer = createCameraCapturer(status);  
//        // createCameraCapturer {videoCapturer} 출력  
//        Log.w("createCameraCapturer",videoCapturer.toString());  
//  
//        // VideoSource 객체를 생성합니다. 이 VideoSource 객체는 로컬 미디어 스트림에서 비디오 소스로 사용됩니다.  
//        // 1번째 매개변수는 비디오 소스가 카메라 스트림(실시간 비디오)을 사용하는지 또는 비디오 파일 스트림(미리 녹화된 비디오)을 사용하는지를 나타냅니다.  
//        // videoCapturer.isScreencast() :비디오 캡처기가 화면 녹화 모드에서 동작하는 경우, 즉 사용자가 화면 공유를 수행하는 경우에 true 값을 반환합니다. 반면에 일반적인 카메라 캡처기의 경우, false 값을 반환합니다.  
//        // 즉, VideoCapturer 객체가 현재 어떤 모드로 동작하는지를 나타내는  
//        VideoSource videoSource = connectionFactory.createVideoSource(videoCapturer.isScreencast());  
//  
//  
//        //  비디오 캡처기를 초기화하고 비디오 프레임을 캡처하기 시작하는 데 사용  
//        // 비디오 캡처기의 콜백 함수를 설정하고, 캡처할 비디오 해상도, 비율 및 프레임 속도 등의 속성을 설정  
//        //  videoSource.getCapturerObserver() : 비디오 프레임을 전달할 CapturerObserver 객체  
//        videoCapturer.initialize(surfaceTextureHelper, getApplicationContext(), videoSource.getCapturerObserver());  
//        Log.i("videoSource.getObserver",videoSource.getCapturerObserver().toString());  
//  
//        // 비디오 캡쳐 : getUserMedia 로 스트림 받아오기 시작?  
//        // 비디오 캡처를 시작하고, 캡처된 비디오 프레임을 VideoSink로 전달하기 위해 호출  
//        // 캡처할 비디오 프레임의 너비, 높이, 및 프레임 속도  
//        // 240, 320,30  
//        videoCapturer.startCapture(240, 320, 30);  
//  
//        //        이 메서드는 로컬 비디오 트랙을 생성하는 데 사용됩니다.  
//        //  VideoSource 객체와 연결된 VideoTrack을 만듭니다.  
//        // VIDEO_TRACK_ID은 비디오 트랙 고유 식별자로 사용.  
//        localVideo = connectionFactory.createVideoTrack(VIDEO_TRACK_ID, videoSource);  
//  
//        // 내 기기의 (카메라 소스로 얻은) video track  
//        return localVideo;  
//        // getLocalVideo 함수의 끝.  
//  
//    }  
//  
//    /**  
//     *  
//     *@paramisFront  
//     *@return:생성한videoCapturer반환,생성 실패시null반환.  
//     */  
//    private VideoCapturer createCameraCapturer(boolean isFront) {  
//  
//  
//        // Camera1Enumerator : Android 디바이스의 카메라 목록을 가져오고 선택한 카메라를 열기 위한 클래스  
//        // 매개변수 : true를 전달하면 전면 카메라만 사용하며, false를 전달하거나 이 매개변수를 생략하면 전면 카메라와 후면 카메라 모두 사용  
//        Camera1Enumerator enumerator = new Camera1Enumerator(false);  
//  
//        // Android 디바이스에서 사용 가능한 카메라 디바이스를 열거할 수 있습니다.  
//        // 카메라의 ID와 이름을 갖는 CameraEnumerationAndroid.CaptureDeviceInfo 객체의 목록을 반환합니다.  
//        final String[] deviceNames = enumerator.getDeviceNames();  
//  
//        // First, try to find front facing camera  
//        // deviceNames 요소의수만큼 반복  
//        for (String deviceName : deviceNames) {  
//  
//            Log.i("deviceName : ",deviceName);  
//  
//            // A ? B : C => 조건 연산자, A가 참이면 B를 반환, 거짓이면 C를 반환  
//            // Camera1Enumerator.isFrontFacing() : 전면카메라면 true, 후면 카메라라면 false를 반환  
//            // Camera1Enumerator.isBackFacing() : 후면카메라면 true, 전면 카메라라면 false를 반환  
//            if (isFront ? enumerator.isFrontFacing(deviceName) : enumerator.isBackFacing(deviceName)) {  
//  
//                // 매개변수로는 CameraEnumerationAndroid.CaptureDeviceInfo 객체와 CapturerObserver 객체, CameraEventsHandler 객체를 받습니다.  
//                // deviceName 카메라로 VideoCapturer 객체 생성  
//                //  선택한 카메라를 열기 위한 메소드  
//                VideoCapturer videoCapturer = enumerator.createCapturer(deviceName, new CameraVideoCapturer.CameraEventsHandler() {  
//                    // CameraVideoCapturer에서 발생하는 각 이벤트를 처리하는 기본 구현을 제공하며,  
//                    // 이벤트를 수신하려면 CameraVideoCapturer.setCameraEventsHandler() 메서드를 사용하여 CameraEventsHandler 객체를 등록해야 합니다.  
//  
//                    // 오버라이딩, 함수 재정의  
//                    @Override  
//                    // 카메라에서 오류가 발생할 때 호출됩니다. 오류 메시지를 매개변수로 받습니다.  
//                    public void onCameraError(String s) {  
//                        // onCameraError 메세지 출력.  
//                        Log.w("onCameraError",s);  
//                        // onCameraError 함수의 끝.  
//                    }  
//  
//                    // 오버라이딩, 함수 재정의  
//                    @Override  
//                    // 카메라 연결이 끊어졌을 때 호출됩니다.  
//                    public void onCameraDisconnected() {  
//                        // onCameraDisconnected 메세지 출력.  
//                        Log.w("onCameraDisconnected","");  
//                        // onCameraDisconnected 함수의 끝.  
//                    }  
//  
//                    // 오버라이딩, 함수 재정의  
//                    @Override  
//                    // 카메라가 정지되거나 동결될 때 호출됩니다. 오류 메시지를 매개변수로 받습니다.  
//                    public void onCameraFreezed(String s) {  
//                        // onCameraFreezed 메세지 출력.  
//                        Log.w("onCameraFreezed",s);  
//                        // onCameraFreezed 함수의 끝.  
//                    }  
//  
//                    // 오버라이딩, 함수 재정의  
//                    @Override  
//                    // 카메라를 열고 있는 동안 호출됩니다. 열려고 하는 카메라의 이름을 매개변수로 받습니다.  
//                    public void onCameraOpening(String s) {  
//                        // onCameraOpening 메세지 출력.  
//                        Log.w("onCameraOpening",s);  
//                        // onCameraOpening 함수의 끝.  
//                    }  
//  
//                    // 오버라이딩, 함수 재정의  
//                    @Override  
//                    // 첫 번째 비디오 프레임이 사용 가능할 때 호출됩니다.  
//                    public void onFirstFrameAvailable() {  
//                        // onFirstFrameAvailable 메세지 출력.  
//                        Log.w("onFirstFrameAvailable","");  
//                        // onFirstFrameAvailable 함수의 끝.  
//                    }  
//  
//                    // 오버라이딩, 함수 재정의  
//                    @Override  
//                    // 카메라가 닫혔을 때 호출됩니다.  
//                    public void onCameraClosed() {  
//                        // onCameraClosed 메세지 출력.  
//                        Log.w("onCameraClosed","");  
//                        // onCameraClosed 함수의 끝.  
//                    }  
//                    // createCapturer () 끝.  
//                });  
//  
//                // 생성성공시 {} 안의 코드 실행.  
//                if (videoCapturer != null) {  
//                    // 생성한 videoCapturer 반환  
//                    return videoCapturer;  
//                    // 생성성공시 실행할 코드 끝.  
//                }  
//  
//                // isFront가 true일 때 전면카메라, false일 때 후면 카메라면 실행할 코드 끝.  
//            }  
//            /// 반복하는 코드의 끝.  
//        }  
//  
//        // null 반환  
//        return null;  
//  
//        /// createCameraCapturer 함수 끝.  
//    }  
//  
//    void SurfaceViewRendererInit(SurfaceViewRenderer view){  
//  
//        view.setMirror(false);  
//  
////        rootEglBase = EglBase.create();  
////        eglBaseContext = rootEglBase.getEglBaseContext();  
////        Log.i("eglBaseContext : ",eglBaseContext.toString());  
//  
////        view.setScalingType(RendererCommon.ScalingType.SCALE_ASPECT_BALANCED);  
//        view.setScalingType(RendererCommon.ScalingType.SCALE_ASPECT_FIT);  
//        view.removeFrameListener(new EglRenderer.FrameListener() {  
//            @Override  
//            public void onFrame(Bitmap bitmap) {  
//                Log.i("removeFrameListener :","");  
//            }  
//        });  
//        view.addOnAttachStateChangeListener(new View.OnAttachStateChangeListener() {  
//            @Override  
//            public void onViewAttachedToWindow(View v) {  
//                Log.i("onViewAttached","ToWindow :");  
//  
//            }  
//  
//            @Override  
//            public void onViewDetachedFromWindow(View v) {  
//                Log.i("onViewDetached","FromWindow :");  
//  
//            }  
//        });  
//        view.addOnLayoutChangeListener(new View.OnLayoutChangeListener() {  
//            @Override  
//            public void onLayoutChange(View v, int left, int top, int right, int bottom, int oldLeft, int oldTop, int oldRight, int oldBottom) {  
//  
//            }  
//        });  
//        view.init(eglBaseContext,  new RendererCommon.RendererEvents() {  
//            //            첫 번째 프레임이 렌더링되면 콜백이 실행됩니다.  
//            @Override  
//            public void onFirstFrameRendered() {  
//                Log.i("RendererEvents","onFirstFrameRendered");  
////                box.setVisiProfile(false);  
//  
//            }  
//            //            렌더링된 프레임 해상도 또는 회전이 변경되면 콜백이 실행됩니다.  
//            @Override  
//            public void onFrameResolutionChanged(int i, int i1, int i2) {  
//                Log.i("RendererEvents","onFrameResolutionChanged");  
//  
//  
//            }  
//  
//        });  
//  
//    }  
//  
//    public void hangup(){  
//        // 종료  
//        PC.close();  
//        PC = null;  
//  
//    }  
//    public void handleOffer(SessionDescription offer){  
////        if (pc) {  
////            console.error('existing peerconnection');  
////            return;  
////        }  
//        if (PC != null) {  
//            Log.i("","existing peerconnection");  
//            return;  
//        }  
//  
////        await createPeerConnection();  
//        createPeerConnection();  
////     0   await pc.setRemoteDescription(offer);  
////  
//        Log.i("handleOffer","");  
//        PC.setRemoteDescription(new SdpObserver() {  
//            @Override  
//            public void onCreateSuccess(SessionDescription sessionDescription) {  
//  
//            }  
//  
//            @Override  
//            public void onSetSuccess() {  
//                Log.i("handleOffer","onSetSuccess");  
//  
//                PC.createAnswer(new SdpObserver() {  
//                    @Override  
//                    public void onCreateSuccess(SessionDescription sessionDescription) {  
//                        Log.i("createAnswer","onCreateSuccess");  
//  
//                        JSONObject message = new JSONObject();  
//                        try {  
//                            message.put("type","answer");  
//                            message.put("sdp",sessionDescription.description);  
//                        } catch (JSONException e) {  
//                            e.printStackTrace();  
//                            return;  
//                        }  
//                        socket.emit("message",message);  
//  
//                        PC.setLocalDescription(new SdpObserver() {  
//                            @Override  
//                            public void onCreateSuccess(SessionDescription sessionDescription) {  
//  
//                            }  
//  
//                            @Override  
//                            public void onSetSuccess() {  
//  
//                            }  
//  
//                            @Override  
//                            public void onCreateFailure(String s) {  
//  
//                            }  
//  
//                            @Override  
//                            public void onSetFailure(String s) {  
//  
//                            }  
//                        },sessionDescription);  
//                    }  
//  
//                    @Override  
//                    public void onSetSuccess() {  
//  
//                    }  
//  
//                    @Override  
//                    public void onCreateFailure(String s) {  
//  
//                    }  
//  
//                    @Override  
//                    public void onSetFailure(String s) {  
//  
//                    }  
//                },mediaConstraints);  
//  
//  
//            }  
//  
//            @Override  
//            public void onCreateFailure(String s) {  
//  
//            }  
//  
//            @Override  
//            public void onSetFailure(String s) {  
//  
//                Log.i("handleoffer","onSetFailure");  
//                Log.i("handleoffer",s);  
//  
//            }  
//        },offer);  
//  
////  const answer = await pc.createAnswer();  
////        signaling.postMessage({type: 'answer', sdp: answer.sdp});  
////        await pc.setLocalDescription(answer);  
//    }  
////  
////    async function handleAnswer(answer) {  
////        if (!pc) {  
////            console.error('no peerconnection');  
////            return;  
////        }  
////        await pc.setRemoteDescription(answer);  
////    }  
//  
//    public void handleAnswer(SessionDescription answer){  
//        //        if (!pc) {  
////            console.error('no peerconnection');  
////            return;  
////        }  
//        if(PC == null){  
//            Log.i("Error","no peerconnection");  
//            return;  
//        }  
//  
//        PC.setRemoteDescription(new SdpObserver() {  
//            @Override  
//            public void onCreateSuccess(SessionDescription sessionDescription) {  
//  
//            }  
//  
//            @Override  
//            public void onSetSuccess() {  
//  
//            }  
//  
//            @Override  
//            public void onCreateFailure(String s) {  
//  
//            }  
//  
//            @Override  
//            public void onSetFailure(String s) {  
//  
//            }  
//        },answer);  
//    }  
//  
//    public void handleCandidate(IceCandidate candidate){  
////        if (!pc) {  
////            console.error('no peerconnection');  
////            return;  
////        }  
//        if(PC == null){  
//            Log.i("Error","no peerconnection");  
//            return;  
//        }  
//  
//  
//        if(candidate.sdp == null){  
//            PC.addIceCandidate(null);  
//            Log.i("candidate","null");  
//        }  
//        else{  
//            PC.addIceCandidate(candidate);  
//            Log.i("candidate","not null");  
//  
//        }  
//  
////        if (!candidate.candidate) {  
////            await pc.addIceCandidate(null);  
////        } else {  
////            await pc.addIceCandidate(candidate);  
////        }  
//    }  
//  
//}  
</document_content>  
</document>  
<document index="132">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\PostCreateActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.ContentResolver;  
import android.content.Context;  
import android.content.Intent;  
import android.graphics.Bitmap;  
import android.graphics.drawable.Drawable;  
import android.net.Uri;  
import android.os.Bundle;  
import android.os.FileUtils;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.view.Gravity;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.view.ViewGroup;  
import android.view.ViewParent;  
import android.widget.FrameLayout;  
import android.widget.ImageView;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.appcompat.app.AlertDialog;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.request.target.CustomTarget;  
import com.bumptech.glide.request.transition.Transition;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.response.SingleLongResponse;  
import com.teamnova.assa.data.helper.ImagePickerHelper;  
import com.teamnova.assa.data.retrofit.clients.PostApiClient;  
import com.teamnova.assa.databinding.ActivityPostCreateBinding;  
import com.teamnova.assa.util.FileUploader;  
import com.teamnova.assa.util.StringUtils;  
  
import java.io.File;  
import java.io.FileOutputStream;  
import java.io.IOException;  
import java.io.InputStream;  
import java.io.OutputStream;  
import java.util.ArrayList;  
import java.util.List;  
import java.util.UUID;  
  
import gun0912.tedimagepicker.builder.TedImagePicker;  
import gun0912.tedimagepicker.builder.type.MediaType;  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 게시물 작성 화면  
 */  
public class PostCreateActivity extends AppCompatActivity {  
  
    private static final String TAG = PostCreateActivity.class.getSimpleName();  
    ActivityPostCreateBinding binding;  
    ImagePickerHelper imagePickerHelper;  
    private boolean isContentsChanged = false;  
    private String originalContent;  
    MenuItem saveItem;  
  
    // 이미지 URI 리스트 (갤러리, 카메라에서 선택한 이미지 URI)  
    private List<Uri> imageUriList = new ArrayList<>();  
    private List<File> imageFileList = new ArrayList<>();  
    // 수정할 때 사용되는 변수들  
    private boolean isUpdate = false;  
    private Long postId = -1L;  
  
    private List<String> prevImageList;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        getIntentData();  
        viewBiding();  
        setListeners();  
        setToolbar();  
        originalContent = binding.etContentPost.getText().toString();   // 비어 있으면 ""  
//        setImagePickerHelper();  
    }  
  
    private void getIntentData() {  
        Intent intent = getIntent();  
        if (intent != null) {  
            if (intent.hasExtra("isUpdate")) {  
                isUpdate = intent.getBooleanExtra("isUpdate", false);  
                postId = intent.getLongExtra("postId", -1);  
                originalContent = intent.getStringExtra("content");  
                this.prevImageList = intent.getStringArrayListExtra("imageUrlList");  
                Log.d(TAG, "imageUrlList : " + prevImageList);  
            }  
        }  
    }  
  
    private void viewBiding() {  
        binding = ActivityPostCreateBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        binding.etContentPost.setText(originalContent);  
        setPrevImages();  
    }  
  
    private void setPrevImages() {  
        if (prevImageList == null) return;  
  
        for (String imageUrl : prevImageList) {  
            Log.d(TAG, "imageUrl : " + imageUrl);  
            // 1. 프레임 레이아웃을 생성한다.  
            FrameLayout frameLayout = new FrameLayout(this);  
            frameLayout.setLayoutParams(  
                    new FrameLayout.LayoutParams(  
                            ViewGroup.LayoutParams.MATCH_PARENT,  
                            ViewGroup.LayoutParams.WRAP_CONTENT  
                    )  
            );  
  
            // 2. 프레임 레이아웃에 imageView를 두 개 추가한다.  
            ImageView mainImageView = new ImageView(this);  
            ImageView deleteImageView = new ImageView(this);  
  
            // 2-1. ImageView의 레이아웃을 설정한다.  
            FrameLayout.LayoutParams mainImageViewParams = new FrameLayout.LayoutParams(  
                    ViewGroup.LayoutParams.MATCH_PARENT,  
                    ViewGroup.LayoutParams.WRAP_CONTENT  
            );  
            mainImageView.setLayoutParams(mainImageViewParams);  
            mainImageView.setAdjustViewBounds(true); // 이미지뷰의 크기를 조절한다.  
  
            FrameLayout.LayoutParams deleteImageViewParams = new FrameLayout.LayoutParams(  
                    ViewGroup.LayoutParams.WRAP_CONTENT,  
                    ViewGroup.LayoutParams.WRAP_CONTENT  
            );  
            deleteImageViewParams.gravity = android.view.Gravity.TOP | android.view.Gravity.RIGHT;  
            deleteImageView.setLayoutParams(deleteImageViewParams);  
            mainImageView.setAdjustViewBounds(true);  
  
            // 3. 두 번째 imageView에 x 표시를 출력한다.  
            deleteImageView.setImageResource(R.drawable.ic_cancel);  
            deleteImageView.setScaleType(ImageView.ScaleType.FIT_CENTER);  
  
            // 4. 첫 번째 imageView에 uri를 설정한다.  
            loadImageWithGlide(mainImageView, deleteImageView, imageUrl);  
            mainImageView.setScaleType(ImageView.ScaleType.FIT_CENTER);  
  
            // 5. 는 x 표시에 대한 이벤트 리스너를 설정한다. (loadImageWithGlide() 참고)  
  
            // 6. 생성한 이미지 뷰들을 프레임 레이아웃에 추가한다.  
            frameLayout.addView(mainImageView);  
            frameLayout.addView(deleteImageView);  
  
            frameLayout.setBackgroundColor(getResources().getColor(R.color.grey)); // 디버깅용 배경표시  
  
            // 7. 프레임 레이아웃을 화면에 출력한다. (ll_post_create_image_container 에 추가)  
            binding.llPostCreateImageContainer.addView(frameLayout);  
  
  
        }  
    }  
  
    private void loadImageWithGlide(ImageView mainIv, ImageView deleteIv, String url) {  
        Glide.with(this)  
                .asBitmap()  
                .load(url)  
                .into(new CustomTarget<Bitmap>() {  
                    @Override  
                    public void onResourceReady(@NonNull Bitmap resource, @Nullable Transition<? super Bitmap> transition) {  
                        mainIv.setImageBitmap(resource);  
                        File imageFile = bitmapToTempFile(resource, getLastSegment(url));  
                        imageFileList.add(imageFile);  
                        Uri tempUri = Uri.fromFile(imageFile);  
                        imageUriList.add(tempUri);  
  
                        // 5. x 표시에 대한 이벤트 리스너를 설정한다.  
                        deleteIv.setOnClickListener(v -> {  
                            Log.d(TAG, "이미지 삭제 버튼 클릭");  
                            int idx = imageUriList.indexOf(tempUri);  
                            imageUriList.remove(idx);  
                            imageFileList.remove(idx);  
                            ViewParent parent = deleteIv.getParent();  
                            // 터치한 뷰의 부모 뷰를 찾아서 삭제한다.  
                            binding.llPostCreateImageContainer.removeView((ViewGroup) parent);  
                            setContentsChanged(true);  
                        });  
  
                    }  
  
                    @Override  
                    public void onLoadCleared(@Nullable Drawable placeholder) {  
  
                    }  
                });  
    }  
  
    /**  
     * url에서 마지막 경로를 가져오는 메서드  
     *  
     * @param url  
     * @return  
     */  
    private String getLastSegment(String url) {  
        if (url == null || url.isEmpty()) return null;  
  
        String[] segments = url.split("/");  
        return segments[segments.length - 1];  
    }  
  
    // Bitmap을 바이트 배열로 변환하는 메서드  
    private File bitmapToTempFile(Bitmap bitmap, String fileName) {  
        File tempFile = null;  
        try {  
            // 임시 파일 생성  
            tempFile = File.createTempFile("prev_", ".jpg", getCacheDir());  
  
            // Bitmap을 JPEG 형식으로 압축하여 파일에 저장  
            try (FileOutputStream out = new FileOutputStream(tempFile)) {  
                bitmap.compress(Bitmap.CompressFormat.JPEG, 100, out);  
            }  
        } catch (IOException e) {  
            Log.e(TAG, "Error saving bitmap to file", e);  
        }  
  
        return tempFile;  
    }  
  
  
    private void setToolbar() {  
        setSupportActionBar(binding.toolbarPostCreate);  
  
        // 뒤로가기 버튼 활성화  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        // 툴바 타이틀  
        if(isUpdate){  
            // 게시물을 수정하는 경우  
            getSupportActionBar().setTitle("게시물 수정");  
        } else {  
            // 게시물을 작성하는 경우  
            getSupportActionBar().setTitle("게시물 작성");  
        }  
  
    }  
  
    private void setListeners() {  
        // 사진 첨부 버튼  
        binding.ibAddImage.setOnClickListener(v -> {  
            TedImagePicker.with(this)  
                    .mediaType(MediaType.IMAGE)  
                    .max(10 - imageFileList.size(), "최대 10장의 사진만 선택 가능합니다")  
                    .startMultiImage(selectedUriList -> {  
                        Log.d(TAG, "이미지 선택 결과(Uri 리스트) : " + selectedUriList);  
  
//                        new Thread(new Runnable() {  
//                            @Override  
//                            public void run() {  
////                                for(Uri uri : list){  
////                                    Log.d(TAG, " 처리할 이미지 Uri 객체: " + uri);  
//  
////                                    File compressed = null;  
////                                    compressed = new File(uri.getPath());  
////  
////                                    Log.d(TAG, "파일 리스트 " + imageFileList);  
////                                    Log.d(TAG, "Uri 리스트 " + imageUriList);  
////  
////                                    runOnUiThread(() -> setImageToScreen(uri));  
////                                }  
//  
//                            }  
//                        }).start();  
                        if (selectedUriList != null && !selectedUriList.isEmpty()) {  
                            processSelectedImages((List<Uri>) selectedUriList);  
                        }  
                    });  
        });  
  
        binding.etContentPost.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                boolean isChanged = !originalContent.equals(s.toString());  
                setContentsChanged(isChanged);  
            }  
        });  
    }  
  
    // 선택된 이미지 처리 메소드 (백그라운드 작업)  
    private void processSelectedImages(List<Uri> uriList) {  
        new Thread(() -> {  
            List<File> newlyAddedFiles = new ArrayList<>();  
            List<Uri> newlyAddedOriginalUris = new ArrayList<>(); // 원본 Uri 저장용  
  
            for (Uri uri : uriList) {  
                File tempFile = copyUriToTempFile(this, uri); // Uri -> 임시 파일 변환  
                if (tempFile != null) {  
                    newlyAddedFiles.add(tempFile);  
                    newlyAddedOriginalUris.add(uri); // 원본 Uri 저장  
                } else {  
                    Log.e(TAG, "임시 파일 생성 실패: " + uri);  
                    // UI 스레드에서 사용자에게 실패 알림 등 처리 필요  
                     runOnUiThread(() -> Toast.makeText(this, "이미지 처리 실패: " + uri.getLastPathSegment(), Toast.LENGTH_SHORT).show());  
                }  
            }  
  
            // 모든 파일 처리 후 UI 스레드에서 화면 업데이트  
            runOnUiThread(() -> {  
                // Activity 멤버 리스트에 추가  
                imageFileList.addAll(newlyAddedFiles);  
//                originalImageUriList.addAll(newlyAddedOriginalUris);  
                setContentsChanged(true);  
  
                // 새로 추가된 이미지들을 화면에 표시  
                for (int i = 0; i < newlyAddedFiles.size(); i++) {  
                    addImagePreviewToLayout(newlyAddedOriginalUris.get(i), newlyAddedFiles.get(i));  
                }  
                Log.d(TAG, "처리 후 파일 리스트: " + imageFileList);  
//                Log.d(TAG, "처리 후 원본 URI 리스트: " + originalImageUriList);  
            });  
        }).start();  
    }  
  
    // 이미지 미리보기를 레이아웃에 추가하는 메소드  
    private void addImagePreviewToLayout(Uri originalUri, File imageFile) {  
        // LayoutInflater를 사용하거나 직접 View 생성 (여기서는 직접 생성)  
  
        // 프레임 레이아웃 생성  
        FrameLayout frameLayout = new FrameLayout(this);  
        FrameLayout.LayoutParams frameLayoutParams = new FrameLayout.LayoutParams(  
                ViewGroup.LayoutParams.MATCH_PARENT, // 너비는 MATCH_PARENT 또는 고정 크기 지정 권장  
                ViewGroup.LayoutParams.WRAP_CONTENT, // 높이도 WRAP_CONTENT 또는 고정 크기  
                Gravity.CENTER // 예시: 중앙 정렬  
        );  
        // 여백 등 추가 설정 가능  
        int margin = getResources().getDimensionPixelSize(R.dimen.image_preview_margin); // 예시: dimens.xml 에 정의  
        frameLayoutParams.setMargins(margin, margin, margin, margin);  
        frameLayout.setLayoutParams(frameLayoutParams);  
  
        ImageView mainImageView = new ImageView(this);  
        FrameLayout.LayoutParams mainImageViewParams = new FrameLayout.LayoutParams(  
                ViewGroup.LayoutParams.MATCH_PARENT,  
                ViewGroup.LayoutParams.WRAP_CONTENT  
  
        );  
        mainImageView.setLayoutParams(mainImageViewParams);  
        mainImageView.setAdjustViewBounds(true);  
  
        ImageView deleteImageView = new ImageView(this);  
        FrameLayout.LayoutParams deleteImageViewParams = new FrameLayout.LayoutParams(  
                ViewGroup.LayoutParams.WRAP_CONTENT,  
                ViewGroup.LayoutParams.WRAP_CONTENT,  
                Gravity.TOP | Gravity.END // 오른쪽 상단 (Gravity.RIGHT 보다 END 권장)  
        );  
        deleteImageView.setLayoutParams(deleteImageViewParams);  
        deleteImageView.setImageResource(R.drawable.ic_cancel); // 삭제 아이콘 리소스  
        // 삭제 아이콘 크기/패딩 조절 가능  
        int padding = getResources().getDimensionPixelSize(R.dimen.delete_icon_padding);  
        deleteImageView.setPadding(padding, padding, padding, padding);  
  
        // --- Glide 로딩: 원본 Uri 사용 ---  
        Glide.with(this)  
                .load(originalUri) // 원본 content:// Uri 로드  
                .error(R.drawable.ic_error) // 에러 시 표시할 이미지  
                .placeholder(R.drawable.ic_loading) // 로딩 중 표시할 이미지 (선택 사항)  
                .into(mainImageView);  
  
        // --- 삭제 버튼 리스너 설정 ---  
        // 삭제할 대상(File, Uri)을 태그(Tag)로 저장해두면 편리함  
        deleteImageView.setTag(R.id.tag_file, imageFile);       // File 객체를 태그로 저장 (ID 정의 필요)  
        deleteImageView.setTag(R.id.tag_uri, originalUri);     // Uri 객체를 태그로 저장 (ID 정의 필요)  
        // res/values/ids.xml 파일 생성 후 <item name="tag_file" type="id"/>, <item name="tag_uri" type="id"/> 추가 필요  
  
        deleteImageView.setOnClickListener(v -> {  
            Log.d(TAG, "이미지 삭제 버튼 클릭");  
            // 태그에서 정보 가져오기  
            File fileToRemove = (File) v.getTag(R.id.tag_file);  
            Uri uriToRemove = (Uri) v.getTag(R.id.tag_uri);  
  
            if (fileToRemove != null && uriToRemove != null) {  
                // 1. 리스트에서 제거  
                imageFileList.remove(fileToRemove);  
//                originalImageUriList.remove(uriToRemove);  
  
                // 2. 임시 파일 삭제  
                if (fileToRemove.exists()) {  
                    boolean deleted = fileToRemove.delete();  
                    Log.d(TAG, "임시 파일 삭제 결과: " + deleted + " - " + fileToRemove.getPath());  
                }  
  
                // 3. 화면에서 FrameLayout 제거  
                ViewParent parent = v.getParent(); // deleteImageView의 부모는 FrameLayout  
                if (parent instanceof ViewGroup) {  
                    // binding.llPostCreateImageContainer.removeView((ViewGroup) parent); // ViewBinding 사용 시  
                    // 예시: findViewById 사용  
                    ViewGroup container = findViewById(R.id.ll_post_create_image_container);  
                    container.removeView((ViewGroup) parent);  
                }  
                setContentsChanged(true);  
                Log.d(TAG, "삭제 후 파일 리스트: " + imageFileList);  
            } else {  
                Log.e(TAG, "삭제할 파일 또는 Uri 정보를 태그에서 찾을 수 없음");  
            }  
        });  
  
        // 뷰들을 FrameLayout에 추가  
        frameLayout.addView(mainImageView);  
        frameLayout.addView(deleteImageView);  
  
        // FrameLayout을 최종 컨테이너(LinearLayout 등)에 추가  
         binding.llPostCreateImageContainer.addView(frameLayout); // ViewBinding 사용 시  
    }  
  
  
    // --- Helper Method: Uri를 앱 내부 캐시 디렉토리에 임시 파일로 복사 ---  
    private File copyUriToTempFile(Context context, Uri uri) {  
        if (uri == null) {  
            return null;  
        }  
        InputStream inputStream = null;  
        OutputStream outputStream = null;  
        // 임시 파일 이름 생성 (중복 방지)  
        String tempFileName = "temp_image_" + UUID.randomUUID().toString() + ".jpg"; // 확장자는 실제 타입에 맞게 조정 가능  
        // 앱의 캐시 디렉토리에 파일 생성  
        File tempFile = new File(context.getCacheDir(), tempFileName);  
  
        try {  
            ContentResolver contentResolver = context.getContentResolver();  
            inputStream = contentResolver.openInputStream(uri);  
            if (inputStream == null) {  
                Log.e(TAG, "InputStream 열기 실패: " + uri);  
                return null;  
            }  
            outputStream = new FileOutputStream(tempFile);  
  
            // API 29 (Android 10) 이상 권장 방식  
            if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.Q) {  
                FileUtils.copy(inputStream, outputStream);  
            } else {  
                // API 29 미만 호환 방식  
                byte[] buffer = new byte[4 * 1024]; // 4KB buffer  
                int read;  
                while ((read = inputStream.read(buffer)) != -1) {  
                    outputStream.write(buffer, 0, read);  
                }  
                outputStream.flush();  
            }  
            return tempFile;  
        } catch (Exception e) {  
            Log.e(TAG, "임시 파일 복사 중 오류 발생", e);  
            // 오류 발생 시 생성된 임시 파일 삭제 시도  
            if (tempFile.exists()) {  
                tempFile.delete();  
            }  
            return null;  
        } finally {  
            try {  
                if (inputStream != null) inputStream.close();  
                if (outputStream != null) outputStream.close();  
            } catch (Exception e) {  
                Log.e(TAG, "스트림 닫기 오류", e);  
            }  
        }  
    }  
  
    public void setContentsChanged(boolean contentsChanged) {  
        isContentsChanged = contentsChanged;  
        saveItem.setEnabled(contentsChanged);  
    }  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        getMenuInflater().inflate(R.menu.menu_create_post_toolbar, menu);  
  
        // 화면 켜질 땐 게시하기 버튼 비활성화  
        saveItem = menu.findItem(R.id.menu_item_post);  
        if (isUpdate) {  
            saveItem.setTitle("저장");  
        }  
        setContentsChanged(false);  
  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
        Log.d(TAG, "onOptionsItemSelected:  현재 클릭된 메뉴 id = " + id);  
  
        if (id == android.R.id.home) {  
            // 뒤로가기 버튼 눌렀을 때  
            if (isContentsChanged) {  
                showBackButtonPressedDialog();  
            } else {  
                onBackPressed();  
            }  
        } else if (id == R.id.menu_item_post) {  
            Post post = createPost();  
  
            // 이미지를 서버에 업로드  
            // 업로드가 완료되고 상세조회 화면으로 넘어가야함  
            FileUploader.uploadFiles(this, imageFileList, (uploadedUrlsString) -> {  
                Log.d(TAG, "onOptionsItemSelected: 업로드된 이미지 url 문자열 : "+ uploadedUrlsString);  
  
                // 서버 응답 경로 리스트에서 파일명만 추출  
                List<String> filenamesOnly = new ArrayList<>();  
                for (String fullPath : uploadedUrlsString){  
                    String filename = new File(fullPath).getName();  
                    filenamesOnly.add(filename);  
                }  
  
                String imageNames = StringUtils.extractIamgeNames(filenamesOnly);  
                Log.d(TAG, "onOptionsItemSelected: 업로드된 이미지 이름 문자열 : "+ imageNames);  
  
                post.setImageUrls(imageNames);  
                if (isUpdate) {  
                    // 업데이트 하는 상황이면  
                    post.setId(postId);  
  
                    sendPostToServerForUpdate(post);  
  
                } else {  
                    // 게시하기 버튼 눌렀을 때  
  
                    // 서버로 게시물 전송  
                    // 게시물 전송 성공시 PostDetailActivity로 이동  
                    sendPostToServer(post);  
                }  
            });  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void sendPostToServerForUpdate(Post post) {  
        PostApiClient.getInstance().updatePost(post).enqueue(new Callback<Void>() {  
            @Override  
            public void onResponse(Call<Void> call, Response<Void> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "게시물 수정 성공");  
                    Toast.makeText(PostCreateActivity.this, "게시물 수정 성공", Toast.LENGTH_SHORT).show();  
                    finish();  
                } else {  
                    Log.d(TAG, "게시물 수정 에러");  
                    Toast.makeText(PostCreateActivity.this, "게시물 수정 에러", Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Void> call, Throwable throwable) {  
                Toast.makeText(PostCreateActivity.this, "게시물 수정 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
  
    }  
  
    private Post createPost() {  
        String content = binding.etContentPost.getText().toString();  
  
        // user_id는 서버에서 토큰 참조하여 값을 할당함  
        return new Post(null, null, content, null);  
    }  
  
    private void sendPostToServer(Post post) {  
  
        // 게시물 생성  
        PostApiClient.getInstance().createPost(post).enqueue(new Callback<SingleLongResponse>() {  
            @Override  
            public void onResponse(Call<SingleLongResponse> call, Response<SingleLongResponse> response) {  
                Log.d(TAG, "게시물 등록 응답 " + response);  
                if (response.isSuccessful()) {  
                    SingleLongResponse result = response.body();  
                    Log.d(TAG, "게시물 등록 성공 : " + result.getId());  
                    Toast.makeText(PostCreateActivity.this, "게시물 등록 성공", Toast.LENGTH_SHORT).show();  
  
                    // 게시하기 버튼 누르면 게시물 정보를 서버로 전송하고 생성된 게시물 id를 받아옴  
                    Intent intent = new Intent(PostCreateActivity.this, PostDetailActivity.class);  
                    intent.putExtra("postId", result.getId());  
                    startActivity(intent);  
  
                    finish();  
                } else {  
                    Log.d(TAG, "게시물 등록 에러");  
                    Toast.makeText(PostCreateActivity.this, "게시물 등록 에러", Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<SingleLongResponse> call, Throwable throwable) {  
                Log.e(TAG, "게시물 등록 실패", throwable);  
                Toast.makeText(PostCreateActivity.this, "게시물 등록 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
  
  
    }  
  
    /**  
     * 백버튼 눌렀을 때 다이얼로그 생성  
     *  
     * @return  
     */  
    private void showBackButtonPressedDialog() {  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setMessage("지금 나가면 변경된 정보가 저장되지 않습니다.\n나가시겠습니까?");  
        builder.setPositiveButton("확인", (dialog, which) -> {  
            dialog.dismiss();  
            finish();  
        });  
        builder.setNegativeButton("취소", (dialog, which) -> {  
            dialog.dismiss();  
        });  
  
        builder.show();  
    }  
  
    private void showProfileImageListDialog() {  
        String[] items = {"카메라", "갤러리"};  
  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setTitle("사진 선택");  
        builder.setItems(items, (dialog, which) -> {  
            Log.d(TAG, "이미지 변경 다이얼로그 - 선택한 항목번호 : " + which);  
            // which 변수에 선택한 아이템의 인덱스가 할당된다.  
            switch (which) {  
                case 0:  
                    // 사진찍기  
                    imagePickerHelper.launchCamera();  
                    break;  
                case 1:  
                    // 앨범에서 사진선택  
                    imagePickerHelper.launchGallery();  
                    break;  
                default:  
                    break;  
            }  
        }).show();  
    }  
}  
</document_content>  
</document>  
<document index="133">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\PostDetailActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Context;  
import android.content.Intent;  
import android.graphics.drawable.Drawable;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.view.GestureDetector;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.view.MotionEvent;  
import android.view.View;  
import android.view.ViewGroup;  
import android.view.inputmethod.InputMethodManager;  
import android.widget.EditText;  
import android.widget.FrameLayout;  
import android.widget.ImageView;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AlertDialog;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.core.content.ContextCompat;  
import androidx.recyclerview.widget.LinearLayoutManager;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Comment;  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.data.Reply;  
import com.teamnova.assa.data.helper.PostHelper;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.retrofit.clients.CommentApiClient;  
import com.teamnova.assa.data.retrofit.clients.PostApiClient;  
import com.teamnova.assa.data.retrofit.clients.ReplyApiClient;  
import com.teamnova.assa.databinding.ActivityPostDetailBinding;  
import com.teamnova.assa.ui.adapter.CommentAdapter;  
import com.teamnova.assa.ui.adapter.PostAdapter;  
import com.teamnova.assa.util.StartActivityUtils;  
import com.teamnova.assa.util.TempStorage;  
import com.teamnova.assa.util.Utils;  
  
import java.util.ArrayList;  
import java.util.Arrays;  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 게시물 조회 화면  
 */  
public class PostDetailActivity extends AppCompatActivity {  
  
    private static final String TAG = PostDetailActivity.class.getSimpleName();  
    private ActivityPostDetailBinding binding;  
    private Long postId;  
    private Long newElementId = -1L;  // 새로 생성된 댓글 덧글 id;  
    private CommentAdapter.VIEW_TYPE viewType = CommentAdapter.VIEW_TYPE.COMMENT;  
    private String[] imageUrlList = null;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        bindView();  
        setPostId();  
        setToolbar();  
        setRecyclerView();  
        setCommentEditText();  
        setListeners();  
    }  
  
    @Override  
    protected void onResume() {  
        super.onResume();  
        // 게시물 데이터 받아오기  
        binding.btnPostDetailAddComment.setOnClickListener(v -> createComment());  
        getPostData(postId);  
    }  
  
    private void getPostData(Long postId) {  
        PostApiClient.getInstance().getPost(postId).enqueue(new Callback<Post>() {  
            @Override  
            public void onResponse(Call<Post> call, Response<Post> response) {  
                Log.d(TAG, "게시물 데이터 응답 성공 : " + response.body());  
                if (response.isSuccessful()) {  
                    // 가져온 데이터를 화면에 출력  
                    setPostDataToView(response.body());  
                    // 방금 뭔가 생성했다면 해당 포지션으로 스크롤  
                    if (newElementId == null) return;  
  
                    if (newElementId != -1) {  
                        int position = ((CommentAdapter) binding.rvPostDetailComment.getAdapter()).getPositionById(newElementId, viewType);  
                        scrollTo(position);  
                    } else {  
                        scrollToBottom();  
                    }  
                } else {  
                    Log.e(TAG, "게시물 데이터 에러 응답 " + response.code());  
                    showToast("게시물 데이터 에러 응답");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Post> call, Throwable throwable) {  
                Log.e(TAG, "게시물 데이터 응답 실패", throwable);  
                showToast("게시물 데이터 응답 실패");  
            }  
        });  
    }  
  
    private void setPostDataToView(Post post) {  
        // 현재 접속자가 작성자가 아니면 더보기 버튼 숨김  
        if (post.getUser().id != Long.parseLong(SPHelper.get(SPHelper.KEY.USER_ID.toString()))) {  
            binding.toolbarPostDetail.getMenu().findItem(R.id.menu_item_post_more).setVisible(false);  
        }  
  
        // 프로필 이미지  
        Glide.with(this).load(post.getUser().profileImage)  
                .centerCrop()  
                .into(binding.ivPostDetailAuthorProfileImage);  
        binding.ivPostDetailAuthorProfileImage.setClipToOutline(true);  // 둥굴게 표시  
        binding.tvPostDetailAuthorNickname.setText(post.getUser().nickname);        // 닉네임  
        binding.tvPostDetailDate.setText(post.getDateTimeAsString());        // 작성 날짜  
  
        binding.llPostDetailAuthor.setOnClickListener(v -> moveToProfile(post.getUser().id)); // 작성자 프로필로 이동  
  
        // 게시물 내용  
        binding.tvPostDetailContent.setText(post.getContent());  
  
        // 게시물 이미지  
        showImages(post);  
  
        // 좋아요 선택 여부에 따른 다른 이미지 부여  
        if (post.isLiked()) {  
            Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_true);  
            binding.btnPostDetailLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
        }  
  
        // 좋아요 수  
        binding.btnPostDetailLike.setText(String.valueOf(post.getLikeCount()));  
  
        // 댓글 수  
        binding.btnPostDetailComment.setText(String.valueOf(post.getCommentCount()));  
  
        // 조회 수  
        binding.btnPostDetailView.setText(String.valueOf(post.getView_count()));  
  
        // 댓글 데이터 세팅  
        setRecyclerViewData(post.getComments());  
    }  
  
    private void moveToProfile(Long userId) {  
        StartActivityUtils.moveToProfile(this, userId);  
    }  
  
    private void showImages(Post post) {  
        removeAllImageVIews(); // 기존에 있던 이미지 뷰 제거  
  
        // 이미지 주소를 추출한다  
        // 각 주소별로 iv를 생성한다음  
        // iv에 이미지를 로드한다  
        // ll에 추가한다  
  
        // post객체에서 이미지 주소 추출  
        String imageUrls = post.getImageUrls();  
        if (imageUrls == null) return;  
  
        String[] imageUrlArr = imageUrls.split(",");  
  
        this.imageUrlList = imageUrlArr;// 수정화면에 출력할 이미지 경로들 저장  
        List<String> imageUrlList = Arrays.asList(imageUrlArr);  
        setImageViews(imageUrlList);  
    }  
  
    private void setImageViews(List<String> imageUrlList) {  
  
        // 각 주소별로 iv 생성  
        for (String imageUrl : imageUrlList) {  
  
            ImageView imageView = new ImageView(this);  
  
            // ImageView의 레이아웃을 설정한다.  
            FrameLayout.LayoutParams mainImageViewParams = new FrameLayout.LayoutParams(  
                    ViewGroup.LayoutParams.MATCH_PARENT,  
                    ViewGroup.LayoutParams.WRAP_CONTENT  
            );  
            imageView.setLayoutParams(mainImageViewParams);  
            imageView.setAdjustViewBounds(true); // 이미지뷰의 크기를 이미지에 맞게 조절한다.  
  
            // 이미지 로드  
            Glide.with(this).load(imageUrl).into(imageView);  
  
            // ll에 추가  
            binding.llPostDetailContent.addView(imageView);  
        }  
    }  
  
    private void removeAllImageVIews() {  
        for (int i = 0; i < binding.llPostDetailContent.getChildCount(); i++) {  
            View child = binding.llPostDetailContent.getChildAt(i);  
            if (child instanceof ImageView) {  
                binding.llPostDetailContent.removeView(child);  
                i--; // 요소가 1개 제거되었으므로 인덱스도 조정한다.  
            }  
        }  
    }  
  
  
    private void bindView() {  
        binding = ActivityPostDetailBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
    }  
  
    /**  
     * 이벤트 리스너 세팅  
     */  
    private void setListeners() {  
        binding.btnPostDetailLike.setOnClickListener(v -> toggleLike());  
    }  
  
    /**  
     * 좋아요 토글링  
     */  
    private void toggleLike() {  
        Log.d(TAG, "toggleLike 실행");  
  
        // 반복 터치 방지  
        binding.btnPostDetailLike.setEnabled(false);  
  
        PostHelper.toggleLike(PostHelper.TYPE.POST, postId, likeResponse -> {  
            // 아이콘 변경  
            if (likeResponse.isLike) {  
                // 좋아요 추가  
                Drawable drawable = ContextCompat.getDrawable(this, R.drawable.ic_like_true);  
                binding.btnPostDetailLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            } else {  
                // 좋아요 취소  
                Drawable drawable = ContextCompat.getDrawable(this, R.drawable.ic_like_false);  
                binding.btnPostDetailLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            }  
  
            // 추천수 변경  
            binding.btnPostDetailLike.setText(String.valueOf(likeResponse.likeCount));  
  
            // 버튼 활성화  
            binding.btnPostDetailLike.setEnabled(true);  
        });  
    }  
  
    private void setPostId() {  
        postId = getIntent().getLongExtra("postId", 0);  
    }  
  
    private void setToolbar() {  
        setSupportActionBar(binding.toolbarPostDetail);  
  
        // 뒤로가기 버튼 활성화  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        // 타이틀 숨기기  
        getSupportActionBar().setDisplayShowTitleEnabled(false);  
    }  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        getMenuInflater().inflate(R.menu.menu_post_detail_toolbar, menu);  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
  
        if (id == android.R.id.home) {  
            onBackPressed();  
        } else if (id == R.id.menu_item_post_more) {  
            // 더보기 버튼 클릭  
            showMoreDialog();  
        }  
  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void showMoreDialog() {  
        String[] items = {"수정하기", "삭제하기"};  
  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setItems(items, (dialog, which) -> {  
            Log.d(TAG, "더 보기 다이얼로그 - 선택한 항목번호 : " + which);  
            // which 변수에 선택한 아이템의 인덱스가 할당된다.  
            switch (which) {  
                case 0:  
                    // 수정하기  
                    dialog.dismiss();  
                    Intent intent = new Intent(this, PostCreateActivity.class);  
                    intent.putExtra("isUpdate", true);  
                    intent.putExtra("postId", postId);  
                    intent.putExtra("content", binding.tvPostDetailContent.getText().toString());  
  
                    if (this.imageUrlList != null) {  
                        intent.putExtra("imageUrlList", new ArrayList<>(Arrays.asList(this.imageUrlList)));  
                    }  
  
                    startActivity(intent);  
                    break;  
                case 1:  
                    // 삭제하기  
                    dialog.dismiss();  
                    showDeleteDialog();  
                    break;  
                default:  
                    break;  
            }  
        }).show();  
    }  
  
    private void showDeleteDialog() {  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setTitle("게시물 삭제").setMessage("정말 삭제하시겠습니까?");  
        builder.setPositiveButton("삭제", (dialog, which) -> {  
            // 삭제 요청 전송  
            deletePost();  
            dialog.dismiss();  
            finish();  
        });  
        builder.setNegativeButton("취소", null);  
        builder.show();  
    }  
  
    private void showCommentMoreDialog(CommentAdapter.VIEW_TYPE viewType, Comment comment) {  
        String[] items = {"수정하기", "삭제하기"};  
  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setItems(items, (dialog, which) -> {  
            Log.d(TAG, "댓글, 덧글의 더 보기 다이얼로그 - 선택한 항목번호 : " + which);  
            // which 변수에 선택한 아이템의 인덱스가 할당된다.  
            switch (which) {  
                case 0:  
                    // 수정하기  
                    dialog.dismiss();  
                    Intent intent = new Intent(this, CommentUpdateActivity.class);  
                    intent.putExtra("isComment", viewType == CommentAdapter.VIEW_TYPE.COMMENT);  
                    intent.putExtra("postId", postId); // 수정 마치고 돌아올 곳  
                    TempStorage.setItem("comment", comment);  
                    startActivity(intent);  
                    break;  
                case 1:  
                    // 삭제하기  
                    dialog.dismiss();  
                    showCommentDeleteDialog(viewType, comment.getId());  
                    break;  
                default:  
                    break;  
            }  
        }).show();  
    }  
  
    private void showCommentDeleteDialog(CommentAdapter.VIEW_TYPE viewType, Long id) {  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setTitle("삭제 확인").setMessage("정말 삭제하시겠습니까?");  
        builder.setPositiveButton("삭제", (dialog, which) -> {  
            newElementId = null;  
  
            // 삭제 요청 전송  
            if (viewType == CommentAdapter.VIEW_TYPE.COMMENT) {  
                // 댓글 삭제  
                deleteComment(id);  
            } else {  
                // 덧글 삭제  
                deleteReply(id);  
            }  
            dialog.dismiss();  
        });  
        builder.setNegativeButton("취소", null);  
        builder.show();  
    }  
  
    private void deleteComment(Long id) {  
        CommentApiClient.getInstance().deleteComment(id).enqueue(new Callback<Void>() {  
            @Override  
            public void onResponse(Call<Void> call, Response<Void> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "댓글 삭제 성공");  
                    getPostData(postId);  
                } else {  
                    Log.e(TAG, "댓글 삭제 에러");  
                    showToast("댓글 삭제 에러");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Void> call, Throwable throwable) {  
                showToast("댓글 삭제 실패");  
            }  
        });  
    }  
  
    private void deleteReply(Long id) {  
        ReplyApiClient.getInstance().deleteReply(id).enqueue(new Callback<Void>() {  
            @Override  
            public void onResponse(Call<Void> call, Response<Void> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "덧글 삭제 성공");  
                    getPostData(postId);  
                } else {  
                    Log.e(TAG, "덧글 삭제 에러");  
                    showToast("덧글 삭제 에러");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Void> call, Throwable throwable) {  
                showToast("덧글 삭제 실패");  
            }  
        });  
    }  
  
    private void deletePost() {  
        // 삭제 요청 전송  
        PostApiClient.getInstance().deletePost(postId).enqueue(new Callback<Void>() {  
            @Override  
            public void onResponse(Call<Void> call, Response<Void> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "게시물 삭제 성공");  
                    showToast("게시물 삭제 성공");  
                } else {  
                    Log.e(TAG, "게시물 삭제 에러");  
                    showToast("게시물 삭제 에러");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Void> call, Throwable throwable) {  
                Log.e(TAG, "게시물 삭제 실패", throwable);  
                showToast("게시물 삭제 실패");  
            }  
        });  
    }  
  
    private void setRecyclerView() {  
        // 리사이클러 뷰 세팅  
        binding.rvPostDetailComment.setLayoutManager(new LinearLayoutManager(getApplicationContext()));  
        CommentAdapter adapter = new CommentAdapter(this);  
        adapter.setReplyListener(parentId -> {  
            // 1. 입력창 힌트가 덧글을 남겨주세요. 로 변경되어야함  
            binding.etPostDetailComment.setHint("덧글을 남겨주세요.");  
  
            // 2. 입력창에 포커스 되어야함  
            binding.etPostDetailComment.requestFocus();  
  
            // 키보드 올라오게 하기  
            InputMethodManager imm = (InputMethodManager) binding.etPostDetailComment.getContext().getSystemService(Context.INPUT_METHOD_SERVICE);  
            imm.showSoftInput(binding.etPostDetailComment, InputMethodManager.SHOW_IMPLICIT);  
  
            // 3. 등록버튼이 덧글 등록으로 작동해야함  
            binding.btnPostDetailAddComment.setOnClickListener(v -> createReply(parentId));  
  
        });  
        binding.rvPostDetailComment.setAdapter(adapter);  
  
        // 리사이클러 뷰 내부의 빈 공간 터치시 입력창 포커스 해제  
        binding.rvPostDetailComment.addOnItemTouchListener(new RecyclerView.OnItemTouchListener() {  
            private ClickListener clickListener = new ClickListener() {  
  
                @Override  
                public void onClick(View view, int position) {  
                    Utils.hideKeyboard(PostDetailActivity.this, binding.etPostDetailComment);  
                    binding.etPostDetailComment.clearFocus();  
                }  
  
                @Override  
                public void onLongClick(View view, int position) {  
                    Utils.hideKeyboard(PostDetailActivity.this, binding.etPostDetailComment);  
                    binding.etPostDetailComment.clearFocus();  
  
                    // 권한에 따라 수정 삭제 다이얼로그 출력  
                    Comment comment = ((CommentAdapter) binding.rvPostDetailComment.getAdapter()).comments.  
                            get(position);  
                    Long authorId = comment.getUser_id();  
  
                    // 내가 작성자면 롱 클릭시 수정, 삭제 다이얼로그 출력  
                    if (authorId == Long.parseLong(SPHelper.get(SPHelper.KEY.USER_ID))) {  
                        if (comment instanceof Reply) {  
                            showCommentMoreDialog(CommentAdapter.VIEW_TYPE.REPLY, comment);  
                        } else {  
                            showCommentMoreDialog(CommentAdapter.VIEW_TYPE.COMMENT, comment);  
                        }  
                    }  
                }  
            };  
  
            private GestureDetector gestureDetector = new GestureDetector(PostDetailActivity.this, new GestureDetector.SimpleOnGestureListener() {  
                @Override  
                public boolean onSingleTapUp(@NonNull MotionEvent e) {  
                    return true;  
                }  
  
                @Override  
                public void onLongPress(@NonNull MotionEvent e) {  
                    // 리사이클러 뷰 영역의 롱 클릭 감지  
                    View child = binding.rvPostDetailComment.findChildViewUnder(e.getX(), e.getY());  
                    if (child != null && clickListener != null) {  
                        clickListener.onLongClick(child, binding.rvPostDetailComment.getChildAdapterPosition(child));  
                    }  
                }  
            });  
  
            @Override  
            public boolean onInterceptTouchEvent(@NonNull RecyclerView rv, @NonNull MotionEvent e) {  
                View child = rv.findChildViewUnder(e.getX(), e.getY());  
                if (child != null && clickListener != null && gestureDetector.onTouchEvent(e)) {  
                    clickListener.onClick(child, rv.getChildAdapterPosition(child));  
                }  
                return false;  
            }  
  
            @Override  
            public void onTouchEvent(@NonNull RecyclerView rv, @NonNull MotionEvent e) {  
            }  
  
            @Override  
            public void onRequestDisallowInterceptTouchEvent(boolean disallowIntercept) {  
            }  
        });  
    }  
  
    public interface ClickListener {  
        void onClick(View view, int position);  
  
        void onLongClick(View view, int position);  
    }  
  
    private void setRecyclerViewData(List<Comment> comments) {  
        ((CommentAdapter) binding.rvPostDetailComment.getAdapter()).setComments(comments);  
  
        // 댓글 개수 출력  
        int commentCount = comments.size();  
        for (Comment comment : comments ){  
            commentCount += comment.getReplyCount();  
        }  
  
        binding.btnPostDetailComment.setText(String.valueOf(commentCount));  
    }  
  
    private void setCommentEditText() {  
        // 포커스 이벤트 리스너  
        binding.etPostDetailComment.setOnFocusChangeListener((v, hasFocus) -> {  
            if (hasFocus) {  
                binding.btnPostDetailAddComment.setVisibility(View.VISIBLE);  
            } else {  
                // 포커스를 잃었을 때, 입력창도 빈칸이면 버튼 제거  
                if (((EditText) v).getText().toString().isEmpty()) {  
                    binding.btnPostDetailAddComment.setVisibility(View.GONE);  
                    // 등록버튼도 원래대로 댓글 등록기능으로 작동하도록 변경  
                    binding.btnPostDetailAddComment.setOnClickListener(v1 -> createComment());  
                    binding.etPostDetailComment.setHint("댓글을 남겨주세요.");  
                }  
            }  
        });  
  
        // 텍스트 변경 이벤트 리스너  
        binding.etPostDetailComment.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                // 입력된 글자수가 0이면 버튼 숨김  
                binding.btnPostDetailAddComment.setEnabled(s.length() > 0);  
            }  
        });  
    }  
  
    private void createComment() {  
        String content = binding.etPostDetailComment.getText().toString();  
        Comment comment = new Comment();  
        comment.setUser_id(Long.valueOf(SPHelper.get(SPHelper.KEY.USER_ID)));  
        comment.setPost_id(postId);  
        comment.setContent(content);  
  
        CommentApiClient.getInstance().createComment(comment).enqueue(new Callback<Comment>() {  
            @Override  
            public void onResponse(Call<Comment> call, Response<Comment> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "댓글 생성 성공");  
                    newElementId = response.body().getId();  
                    viewType = CommentAdapter.VIEW_TYPE.COMMENT;  
                    getPostData(postId);  
  
                    // 입력창 비우고  
                    binding.etPostDetailComment.setText("");  
                    // 포커싱 제거  
                    binding.etPostDetailComment.clearFocus();  
                    // 댓글 목록 최하단으로  
                    scrollToBottom();  
                    // 키보드 제거  
                    Utils.hideKeyboard(PostDetailActivity.this, binding.etPostDetailComment);  
                } else {  
                    Log.e(TAG, "댓글 생성 에러");  
                    showToast("댓글 생성 에러");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Comment> call, Throwable throwable) {  
                Log.d(TAG, "댓글 생성 실패");  
                showToast("댓글 생성 실패");  
            }  
        });  
    }  
  
    private void createReply(Long parentId) {  
        Log.d(TAG, "createReply: " + parentId + "하위에 덧글을 작성");  
        Long authorId = Long.valueOf(SPHelper.get(SPHelper.KEY.USER_ID));  
        String content = binding.etPostDetailComment.getText().toString();  
  
        // 덧글 객체 생성  
        Reply reply = new Reply();  
        reply.setUser_id(authorId);  
        reply.setContent(content);  
        reply.setComment_id(parentId);  
  
        // 덧글 생성 요청  
        ReplyApiClient.getInstance().createReply(reply).enqueue(new Callback<Reply>() {  
            @Override  
            public void onResponse(Call<Reply> call, Response<Reply> response) {  
                if (response.isSuccessful()) {  
                    Reply reply = response.body();  
                    newElementId = reply.getId();  
                    viewType = CommentAdapter.VIEW_TYPE.REPLY;  
                    getPostData(postId);  
  
                    // 입력창 비우고  
                    binding.etPostDetailComment.setText("");  
                    // 포커싱 제거  
                    binding.etPostDetailComment.clearFocus();  
  
                    // 키보드 제거  
                    Utils.hideKeyboard(PostDetailActivity.this, binding.etPostDetailComment);  
                } else {  
                    Log.e(TAG, "덧글 생성 에러");  
                    showToast("덧글 생성 에러");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Reply> call, Throwable throwable) {  
                Log.d(TAG, "덧글 생성 실패");  
                Toast.makeText(PostDetailActivity.this, "덧글 생성 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    /**  
     * 리사이클러 뷰의 특정 포지션으로 스크롤  
     * @param position  
     */  
    private void scrollTo(int position) {  
        int itemCount = binding.rvPostDetailComment.getAdapter().getItemCount();  
  
        // 유효한 position이 들어왔는지 확인  
        if (position >= itemCount || position < 0) {  
            return;  
        }  
  
        Log.d(TAG, "scrollTo: " + position);  
        binding.rvPostDetailComment.smoothScrollToPosition(position);  
    }  
  
    private void scrollToBottom() {  
        Log.d(TAG, "scrollToBottom");  
        // 리사이클러뷰는 맨 아래로 이동  
        int lastPosition = binding.rvPostDetailComment.getAdapter().getItemCount() - 1;  
        // 아이템 개수가 0인 경우 마지막 포지션을 0으로  
        if (lastPosition < 0) lastPosition = 0;  
        binding.rvPostDetailComment.smoothScrollToPosition(lastPosition);  
    }  
  
    /**  
     * 다른 뷰 터치시 키보드 숨기기  
     *  
     * @param event The touch screen event being processed.  
     * @return  
     */  
    @Override  
    public boolean onTouchEvent(MotionEvent event) {  
        if (event.getAction() == MotionEvent.ACTION_DOWN) {  
            View view = getCurrentFocus();  
            if (view != null) {  
                Utils.hideKeyboard(PostDetailActivity.this, view);  
                binding.etPostDetailComment.clearFocus();  
            }  
        }  
        return super.onTouchEvent(event);  
    }  
  
    private void showToast(String message) {  
        Toast.makeText(this, message, Toast.LENGTH_SHORT).show();  
    }  
}  
  
  
</document_content>  
</document>  
<document index="134">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\PostNotificationActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
  
import androidx.activity.EdgeToEdge;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.core.graphics.Insets;  
import androidx.core.view.ViewCompat;  
import androidx.core.view.WindowInsetsCompat;  
  
import com.teamnova.assa.R;  
  
/**  
 * 게시글 관련 알림 화면  
 */  
public class PostNotificationActivity extends AppCompatActivity {  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        EdgeToEdge.enable(this);  
        setContentView(R.layout.activity_post_notification);  
        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -> {  
            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());  
            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);  
            return insets;  
        });  
    }  
}  
</document_content>  
</document>  
<document index="135">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\ProfileNotificationActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.MenuItem;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.data.dto.data.Friend;  
import com.teamnova.assa.data.retrofit.clients.UserRelationApiClient;  
import com.teamnova.assa.databinding.ActivityProfileNotificationBinding;  
import com.teamnova.assa.ui.adapter.FriendRequestAdapter;  
  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class ProfileNotificationActivity extends AppCompatActivity {  
  
    private static final String TAG = ProfileNotificationActivity.class.getSimpleName();  
    ActivityProfileNotificationBinding binding;  
    Long userId;    // 현재 사용자의 알림목록  
    FriendRequestAdapter adapter;  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivityProfileNotificationBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        // 사용자 아이디 저장  
        userId = getIntent().getLongExtra("userId", 0);  
  
        setToolbar();  
        setRecyclerView();  
    }  
  
    @Override  
    protected void onStart() {  
        super.onStart();  
        loadData();  
    }  
  
    /**  
     * 상단 툴바 세팅  
     */  
    private void setToolbar(){  
        setSupportActionBar(binding.toolbarProfileNotification);  
  
        // 뒤로가기 버튼 활성화  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        getSupportActionBar().setDisplayShowTitleEnabled(true);  
        getSupportActionBar().setTitle("친구신청");  
    }  
  
    /**  
     * 상단 툴바 버튼 클릭 이벤트 처리  
     * @param item The menu item that was selected.  
     *  
     * @return  
     */  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
  
        if (id == android.R.id.home) {  
            onBackPressed();  
        }  
  
        return super.onOptionsItemSelected(item);  
    }  
  
    /**  
     * 서버에서 데이터 받아오는 메소드  
     */  
    private void loadData(){  
        UserRelationApiClient.getInstance().getFriendRequests().enqueue(new Callback<List<Friend>>() {  
            @Override  
            public void onResponse(Call<List<Friend>> call, Response<List<Friend>> response) {  
                if(response.isSuccessful()){  
                    Log.d(TAG, "onResponse: 친구 신청 받아오기 성공");  
                    adapter.setItems(response.body());  
                }else {  
                    Log.e(TAG, "onResponse: 친구 신청 받아오기 에러");  
                    Toast.makeText(getApplicationContext(), "친구 신청 받아오기 에러", Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<List<Friend>> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 친구 신청 받아오기 실패", throwable);  
                Toast.makeText(getApplicationContext(), "친구 신청 받아오기 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    private void setRecyclerView(){  
        this.adapter= new FriendRequestAdapter(this);  
        binding.rvProfileNotification.setAdapter(this.adapter);  
        binding.rvProfileNotification.setLayoutManager(new LinearLayoutManager(getApplicationContext()));  
        binding.rvProfileNotification.addItemDecoration(  
                new DividerItemDecoration(getApplicationContext(), DividerItemDecoration.VERTICAL));  
  
    }  
}  
</document_content>  
</document>  
<document index="136">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\SearchResultActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.MenuItem;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.appcompat.widget.SearchView;  
import androidx.fragment.app.Fragment;  
import androidx.viewpager2.widget.ViewPager2;  
  
import com.google.android.material.tabs.TabLayoutMediator;  
import com.teamnova.assa.databinding.ActivitySearchResultBinding;  
import com.teamnova.assa.ui.adapter.SearchViewPagerAdapter;  
import com.teamnova.assa.ui.fragment.OpenChatSearchResultFragment;  
import com.teamnova.assa.ui.fragment.PostSearchResultFragment;  
import com.teamnova.assa.ui.fragment.UserSearchResultFragment;  
  
import java.util.Arrays;  
import java.util.List;  
  
/**  
 * 검색결과 출력 액티비티  
 */  
public class SearchResultActivity extends AppCompatActivity {  
    private static String TAG = "SearchResultActivity";  
    ActivitySearchResultBinding binding;  
    String query;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivitySearchResultBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        this.query = getIntent().getStringExtra("query");  
  
        setToolbar();  
        initSearchView();  
        setTabsWithViewPager();  
    }  
  
    private void setToolbar() {  
        setSupportActionBar(binding.tbSearch);  
  
        // 뒤로가기 버튼 활성화  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        // 타이틀 숨기기  
        getSupportActionBar().setDisplayShowTitleEnabled(false);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        if (item.getItemId() == android.R.id.home) {  
            onBackPressed();  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void initSearchView() {  
        binding.svSearch.setQuery(query, false);  
        binding.svSearch.post(() -> {  
            binding.svSearch.clearFocus();  
        });  
  
        // 검색어 제출 이벤트 리스너  
        binding.svSearch.setOnQueryTextListener(new SearchView.OnQueryTextListener() {  
            @Override  
            public boolean onQueryTextSubmit(String query) {  
                Log.d(TAG, "onQueryTextSubmit: 현재 검색어 = " + query);  
                // 검색어를 프래그먼트로 전송해서 프래그먼트에서 실제 검색을 수행한다.  
                if (query != null) {  
                    search(query);  
                }  
                return true;  
            }  
  
            @Override  
            public boolean onQueryTextChange(String newText) {  
                return false;  
            }  
        });  
    }  
  
    private void search(String query) {  
        // 키워드 검색시 현재 출력된 프래그먼트의 데이터를 업데이트  
        this.query = query; // 멤버 변수는 나중에 registerOnChangeChangeCallback 에서 사용됨  
  
        int currentItem = binding.vpSearch.getCurrentItem(); // 현재 출력되고 있는 페이지의 인덱스  
        SearchViewPagerAdapter adapter = (SearchViewPagerAdapter) binding.vpSearch.getAdapter();  
  
        // 현재 출력된 프래그먼트에 대해 검색 updateData 실행  
        Fragment currentFragment = adapter.getFragment(currentItem);  
  
        if (currentFragment instanceof PostSearchResultFragment) {  
            ((PostSearchResultFragment) currentFragment).updateData(query);  
        } else if (currentFragment instanceof OpenChatSearchResultFragment) {  
            ((OpenChatSearchResultFragment) currentFragment).updateData(query);  
        } else if (currentFragment instanceof UserSearchResultFragment) {  
            ((UserSearchResultFragment) currentFragment).updateData(query);  
        }  
  
    }  
  
    // 탭 + 뷰 페이저 세팅  
    private void setTabsWithViewPager() {  
        // 뷰 페이저 세팅  
        List<Fragment> fragmentList = Arrays.asList(  
                new PostSearchResultFragment(),  
                new OpenChatSearchResultFragment(),  
                new UserSearchResultFragment()  
        );  
  
        SearchViewPagerAdapter adapter = new SearchViewPagerAdapter(this, fragmentList);  
        binding.vpSearch.setAdapter(adapter);  
        registerOnChangeChangeCallback(binding.vpSearch, adapter);   // 프래그먼트가 화면에 출력될 때마다 데이터를 서버에 요청  
  
        // 탭 타이틀 세팅  
        List<String> tabTitles = Arrays.asList("게시물", "오픈채팅", "유저");  
  
        // 탭 레이아웃, 뷰 페이저 연동  
        new TabLayoutMediator(binding.tlSearch, binding.vpSearch, (tab, position) -> {  
            tab.setText(tabTitles.get(position));  
        }).attach();  
    }  
  
    /**  
     * 뷰페이저의 페이지가 변경될 때마다 데이터를 서버에 요청  
     * @param viewPager  
     * @param adapter  
     */  
    private void registerOnChangeChangeCallback(ViewPager2 viewPager, SearchViewPagerAdapter adapter) {  
        viewPager.registerOnPageChangeCallback(new ViewPager2.OnPageChangeCallback() {  
            @Override  
            public void onPageSelected(int position) {  
                super.onPageSelected(position);  
  
                Fragment currentFragment = adapter.getFragment(position);  
                if (currentFragment instanceof PostSearchResultFragment) {  
                    ((PostSearchResultFragment) currentFragment).updateData(query);  
                } else if (currentFragment instanceof OpenChatSearchResultFragment) {  
                    ((OpenChatSearchResultFragment) currentFragment).updateData(query);  
                } else if (currentFragment instanceof UserSearchResultFragment) {  
                    ((UserSearchResultFragment) currentFragment).updateData(query);  
                }  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="137">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\SelectAccountActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.databinding.ActivitySelectAccountBinding;  
  
/**  
 * 이전화면에서 제공한 사용자 정보와 매칭되는 사용자 계정을 선택할 수 있는 액티비티  
 */  
public class SelectAccountActivity extends AppCompatActivity {  
    private static final String TAG = SelectAccountActivity.class.getSimpleName();  
    ActivitySelectAccountBinding binding;  
    String purpose;  
  
    // 1. 이메일이 일치하는 사용자 정보를 가져온다.  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivitySelectAccountBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        purpose = getIntent().getStringExtra("purpose");  
  
  
    }  
}  
</document_content>  
</document>  
<document index="138">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\SelectFriendsActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.google.gson.JsonArray;  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.FriendsRes;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.retrofit.clients.UserRelationApiClient;  
import com.teamnova.assa.databinding.ActivitySelectFriendsBinding;  
import com.teamnova.assa.ui.adapter.InviteAdapter;  
import com.teamnova.assa.util.DBHelper;  
  
import java.util.ArrayList;  
import java.util.Comparator;  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 채팅방 생성, 또는 초대 할 때 친구를 선택할 수 있는 액티비티  
 */  
public class SelectFriendsActivity extends AppCompatActivity {  
  
    static final String TAG = SelectFriendsActivity.class.getSimpleName();  
    ActivitySelectFriendsBinding binding;  
    List<UserData> friendList = new ArrayList<>();  
  
    InviteAdapter adapter;  
    Long userId;  
    boolean noMoreFriends = false;  
    public MenuItem inviteItem;  
  
    // 추가 초대할때 기존 멤버를 담을 리스트  
    List<SimpleUser> originMemberList = new ArrayList<>();  
    Long roomId;  
    boolean isNewRoom = false;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivitySelectFriendsBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        DBHelper dbHelper = GlobalApplication.dbHelper;  
  
        userId = SPHelper.getUserId();  
  
        // 추가 초대목적인지 확인  
        isNewRoom = getIntent().getBooleanExtra("isNewRoom", false);  
        Log.d(TAG, "onCreate: isNewRoom = " + isNewRoom);  
  
        if (!isNewRoom) {  
            Log.d(TAG, "onCreate: 추가 멤버 초대를 위한 접근");  
            // 방 목록 가져와서 해당 방의 멤버목록 가져오기  
            roomId = getIntent().getLongExtra("roomId", 0);  
            originMemberList = dbHelper.getChatRoomMembers(roomId, true);  
        }  
        initToolbar();  
        initRecyclerView();  
    }  
  
    // 툴바 설정  
    private void initToolbar() {  
        binding.toolbarSelectFriends.setTitle("대화상대 초대");  
  
        setSupportActionBar(binding.toolbarSelectFriends);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
        getSupportActionBar().setDisplayShowHomeEnabled(true);  
    }  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        getMenuInflater().inflate(R.menu.menu_invite, menu);  
        inviteItem = menu.findItem(R.id.menu_item_invite);  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int itemId = item.getItemId();  
  
        if (itemId == android.R.id.home) { // 뒤로가기  
            onBackPressed();  
            return true;  
        }  
  
        if (itemId == R.id.menu_item_invite) { // 초대 버튼 클릭  
            Log.d(TAG, "onOptionsItemSelected: 초대 버튼 클릭");  
  
            if (adapter.selectList.isEmpty()) {  
                Toast.makeText(this, "친구를 선택해주세요.", Toast.LENGTH_SHORT).show();  
                return true;  
            }  
  
            // TODO 나 포함 초대자들이 구성원으로 있는 채팅방이 이미 있는지 확인  
            // 결과값 : [1,2,3,...]  
            JsonArray resultArr = new JsonArray();  
  
            // 선택한 친구 id 목록을 json으로 변환 (다음 액티비티로 정보를 넘기기 위해)  
            for (UserData user : adapter.selectList) {  
                Long userId = user.id;  
                resultArr.add(userId);  
            }  
            Log.d(TAG, "onOptionsItemSelected: 완성된 json = " + resultArr);  
  
            if (!isNewRoom) {  
                // 기존 방에 새 맴버 초대  
                Log.d(TAG, "onOptionsItemSelected: 추가 초대 할 사람 고르고 초대 버튼 누름");  
                Intent resultIntent = new Intent();  
                resultIntent.putExtra("invited_member", resultArr.toString());  
                resultIntent.putExtra("roomId", roomId);  
                setResult(RESULT_OK, resultIntent);  
                finish();  
            } else {  
                // 새로운 방 생성  
                // 채팅방 액티비티로 이동  
                Intent intent = new Intent(this, ChatRoomActivity.class);  
                intent.putExtra("invited_member", resultArr.toString());  
                intent.putExtra("isNewRoom", true);  
                startActivity(intent);  
                finish();  
            }  
  
        }  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void initRecyclerView() {  
        RecyclerView rv = binding.rvSelectFriends;  
        rv.setHasFixedSize(true);  
        rv.addItemDecoration(new DividerItemDecoration(this, DividerItemDecoration.VERTICAL));  
        rv.setLayoutManager(new LinearLayoutManager(this));  
        adapter = new InviteAdapter(this, friendList);  
        rv.setAdapter(adapter);  
  
        // 무한 스크롤 구현  
        rv.addOnScrollListener(new RecyclerView.OnScrollListener() {  
            @Override  
            public void onScrolled(@NonNull RecyclerView recyclerView, int dx, int dy) {  
                super.onScrolled(recyclerView, dx, dy);  
  
                // 마지막으로 눈에 보이는 아이템의 포지션과 전체 아이템의 개수를 얻어옴  
                int lastItemPosition = ((LinearLayoutManager) rv.getLayoutManager()).findLastCompletelyVisibleItemPosition();  
                int totalItemCount = rv.getAdapter().getItemCount();  
  
                // 리스트의 마지막 아이템에 도착하면 다음 페이지 로드  
                if (dy > 0 && lastItemPosition == totalItemCount - 1) {  
                    Log.d(TAG, "onScrolled: 마지막 아이템 = " + lastItemPosition + " 다음 페이지 로드");  
                    loadMoreFriends(lastItemPosition + 1);  
                }  
            }  
        });  
  
        // 첫 페이지 로드  
        loadFriends(0);  
    }  
  
    // 리스트 최하단에서 친구 목록 더 불러오기  
    private void loadMoreFriends(int nextPosition) {  
        if (!noMoreFriends) {  
            loadFriends(nextPosition);  
        } else {  
            Log.d(TAG, "loadMoreFriends: 더 이상 친구가 없음");  
//            Toast.makeText(this, "더 이상 친구가 없습니다.", Toast.LENGTH_SHORT).show();  
        }  
    }  
  
  
    // 친구목록 로드 메소드  
    private void loadFriends(int nextPosition) {  
        UserRelationApiClient.getInstance().getFriends(userId, nextPosition).enqueue(new Callback<FriendsRes>() {  
            @Override  
            public void onResponse(Call<FriendsRes> call, Response<FriendsRes> response) {  
                if (response.isSuccessful()) {  
                    FriendsRes friendsRes = response.body();  
  
                    List<UserData> filteredFriendList = new ArrayList<>();  
  
                    // 현재 방 멤버가 아닌 친구만 출력 리스트에 담는다.  
                    // 현재 origin 멤버는 들어왔다 나간사람은 제외되어 있다.  
                    if (!isNewRoom) {  
                        for (UserData user : friendsRes.friendList) {  
                            boolean isFind = false;  
                            for (SimpleUser member : originMemberList) {  
                                if (user.id == member.id) {  
                                    isFind = true;  
                                    break;  
                                }  
                            }  
                            if (!isFind) filteredFriendList.add(user);  
                        }  
                        friendList.addAll(filteredFriendList);  
                    } else {  
                        friendList.addAll(friendsRes.friendList);  
                    }  
  
                    // 닉네임 사전순으로 정렬  
                    friendList.sort(Comparator.comparing(user -> user.nickname));  
  
                    adapter.notifyDataSetChanged();  
                    noMoreFriends = friendsRes.noMoreItems;  
                } else {  
                    Log.e(TAG, "onResponse: 친구목록 불러오기 오류");  
                    Toast.makeText(SelectFriendsActivity.this, "친구목록 불러오기 오류", Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<FriendsRes> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 친구목록 불러오기 실패", throwable);  
                Toast.makeText(SelectFriendsActivity.this, "친구목록 불러오기 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
  
    }  
  
}  
</document_content>  
</document>  
<document index="139">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\SetNicknameActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.RegisterRequest;  
import com.teamnova.assa.data.dto.response.CheckDuplicationResponse;  
import com.teamnova.assa.data.retrofit.clients.UserDuplicateCheckApiClient;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivitySetNicknameBinding;  
import com.teamnova.assa.util.TempStorage;  
  
import java.util.Objects;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class SetNicknameActivity extends AppCompatActivity {  
    private static final String TAG = SetNicknameActivity.class.getName();  
    UserDuplicateCheckApiClient userDuplicateCheckApiClient;  
  
    ActivitySetNicknameBinding binding;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivitySetNicknameBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        userDuplicateCheckApiClient = new UserDuplicateCheckApiClient();  
  
        setOnClickListener();  
        addTextChangedListeners();  
    }  
  
    private void setOnClickListener() {  
        // 뒤로가기  
        binding.btnBack.setOnClickListener(v -> finish());  
  
        // 다음으로  
        binding.btnNext.setOnClickListener(v -> {  
            // 유저 정보 저장  
  
            // 약관동의 화면으로 코드 이동함  
//            UserData user = (UserData) TempStorage.removeItem("user"); // 더이상 필요 없으므로 제거, 회원가입 단계의 문제는 여기서 발생함  
            UserData user = (UserData) TempStorage.getItem("user"); //  
            user.nickname = Objects.requireNonNull(binding.nickname.getText()).toString();  
  
            // 요청겍체를 통해서 유저 정보 전송  
            RegisterRequest registerRequest = new RegisterRequest(user, null, null);  
            TempStorage.setItem("registerRequest", registerRequest);  
            startActivity(new Intent(this, AgreeToTermsActivity.class));  
        });  
    }  
  
    private void addTextChangedListeners() {  
        binding.nickname.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String input = s.toString();  
  
                // 입력안하면 비활성화  
                if (input.isEmpty()) binding.btnNext.setEnabled(false);  
  
                // 형식확인 (영문, 한글, 숫자, 밑줄(_)의 조합)  
                if (!input.matches("^[a-zA-Z가-힣0-9_]*$")) {  
                    binding.nicknameLayout.setError("올바르지 않은 닉네임 형식입니다");  
                    binding.btnNext.setEnabled(false);  
                    return;  
                }  
  
                // 문제 없으면 에러메시지 제거  
                binding.nicknameLayout.setError(null);  
  
                // 중복검사  
                checkNicknameDuplication(input);  
            }  
        });  
    }  
  
    /**  
     * 닉네임 중복체크  
     *  
     * @param input 입력값  
     */  
    private void checkNicknameDuplication(String input) {  
        // 중복확인 요청 전송  
        Call<CheckDuplicationResponse> call = UsersApiClient.getInstance().checkDuplication("nickname", input);  
  
        call.enqueue(new Callback<CheckDuplicationResponse>() {  
            @Override  
            public void onResponse(Call<CheckDuplicationResponse> call, Response<CheckDuplicationResponse> response) {  
                if (response.isSuccessful()) {  
  
                    if (response.body().status.equals("success")) {  
                        boolean isDuplicate = response.body().isDuplicated;  
                        String nickname = response.body().data;  
  
                        // 중복이면 에러 메시지 줄력  
                        if (isDuplicate) {  
                            binding.nicknameLayout.setError("이미 사용 중인 닉네임입니다");  
                            binding.btnNext.setEnabled(false);  
                            return;  
                        }  
  
                        // 중복아니면 기존의 에러메시지 제거 후 다음 버튼 활성화  
                        binding.nicknameLayout.setError(null);  
                        binding.btnNext.setEnabled(true);  
  
  
                    } else {  
                        // status : error -> 유효성검사 통과 실패  
                        binding.nicknameLayout.setError("잘못된 닉네임 형식입니다");  
                        binding.btnNext.setEnabled(false);  
                    }  
  
                } else {  
                    Log.d(TAG, "onResponse: 중복 확인 에러" + response.errorBody());  
                }  
            }  
  
            @Override  
            public void onFailure(Call<CheckDuplicationResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 통신 실패", throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="140">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\SetPasswordActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.view.View;  
import android.widget.Toast;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.UpdateUserResponse;  
import com.teamnova.assa.data.dto.response.UserIdResponse;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivitySetPasswordBinding;  
import com.teamnova.assa.util.TempStorage;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class SetPasswordActivity extends AppCompatActivity {  
  
    private static final String TAG = SetPasswordActivity.class.getSimpleName();  
    ActivitySetPasswordBinding binding;  
    UserData user;  
    String purpose;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        Log.i(TAG, "onCreate: START");  
        super.onCreate(savedInstanceState);  
  
        binding = ActivitySetPasswordBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        user = (UserData) TempStorage.getItem("user");  
        Log.d(TAG, "onCreate: user = " + user);  
  
        // 액티비티 접근 목적 알아내기  
        purpose = getIntent().getStringExtra("purpose");  
        Log.d(TAG, "onCreate: purpose - " + purpose);  
  
        // 접근 목적에 따라 ui가 달라진다.  
        setUi();  
  
        setOnClickListeners();  
        addTextChangedListeners();  
  
        Log.i(TAG, "onCreate: END");  
    }  
  
    // purpose에 따른 ui 변경 적용  
    // 기본 화면은 회원가입 목적으로 접근한 화면이다.  
    private void setUi() {  
        // 회원가입 목적으로 접근 했을 경우  
        if (purpose.equals("registration")) {  
            // 비밀번호 입력창 1개만 보인다.  
            // 기본화면 유지  
            binding.tvTilTitle.setVisibility(View.GONE);  
            return;  
        }  
  
        // 비밀번호 재설정 목적으로 접근 했을 경우  
        if (purpose.equals("resetPw")) {  
            // 메시지가 달라진다.  
            binding.title.setText("새 비밀번호 만들기");  
            binding.description.setText("새로운 비밀번호를 입력해주세요.");  
            binding.tvTilTitle.setVisibility(View.VISIBLE);  
            binding.btnNext.setText("비밀번호 재설정");  
            return;  
        }  
  
    }  
  
    @Override  
    protected void onStart() {  
        super.onStart();  
        Log.i(TAG, "onStart: START");  
        Log.i(TAG, "onStart: END");  
    }  
  
    @Override  
    protected void onResume() {  
        Log.i(TAG, "onResume: START");  
        super.onResume();  
  
        Log.i(TAG, "onResume: END");  
    }  
  
    private void setOnClickListeners() {  
        // 뒤로가기  
        binding.btnBack.setOnClickListener(v -> finish());  
  
        // 다음으로  
        binding.btnNext.setOnClickListener(v -> {  
            // java.lang.NullPointerException: Attempt to write to field 'java.lang.String com.teamnova.assa.data.dto.data.UserData.password' on a null object reference  
            user.password = binding.password.getText().toString();  
  
            // 회원가입 목적으로 접근 했을 경우  
            if (purpose.equals("registration")) {  
                // 닉네임 정하는 화면으로 이동  
                Log.d(TAG, "setOnClickListeners: user 객체 상황 - " + user.toString());  
                startActivity(new Intent(this, SetNicknameActivity.class));  
                return;  
            }  
  
            // 비밀번호 재설정 목적으로 접근 했을 경우  
            if (purpose.equals("resetPw")) {  
                // 메시지가 달라진다.  
                binding.title.setText("비밀번호 재설정");  
                binding.description.setText("새로운 비밀번호를 입력해주세요.");  
  
                // 유저정보를 업데이트하고 로그인 화면으로 이동한다.  
  
                // 유저 id 얻어와서  
                // 해당 id의 비밀번호를 업데이트  
                getUserIdByEmail(user.email, user.password);  
  
                return;  
            }  
  
        });  
    }  
  
    // 주어진 이메일에 해당하는 id를 얻어옴  
    private void getUserIdByEmail(String email, String password) {  
  
        UsersApiClient.getInstance().getUserIdByEmail(email).enqueue(new Callback<UserIdResponse>() {  
            @Override  
            public void onResponse(Call<UserIdResponse> call, Response<UserIdResponse> response) {  
                Log.d(TAG, "이메일로 유저 id 얻어오기 응답 성공 + " + response);  
                if (response.isSuccessful()) {  
                    Long userId = response.body().id;  
                    resetPassword(userId, password);  
                } else {  
                    Log.d(TAG, "이메일로 유저 id 얻어오기 에러 응답");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UserIdResponse> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 이메일로 유저 id 얻어오기 통신 실패", throwable);  
            }  
        });  
    }  
  
    // 패스워드 재설정  
    private void resetPassword(Long userId, String password) {  
        UsersApiClient.getInstance().resetPassword(userId, password).enqueue(new Callback<UpdateUserResponse>() {  
            @Override  
            public void onResponse(Call<UpdateUserResponse> call, Response<UpdateUserResponse> response) {  
                Log.d(TAG, "유저 비번 변경 업데이트 응답 성공 + " + response);  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "유저정보 업데이트 성공");  
                    Log.d(TAG, "기존 유저 정보 : " + response.body().original.toString());  
                    Log.d(TAG, "업데이트된 유저 정보 : " + response.body().updated.toString());  
  
                    Toast.makeText(SetPasswordActivity.this, "비밀번호가 변경되었습니다.", Toast.LENGTH_SHORT).show();  
  
                    // 로그인 화면으로 이동  
                    Intent intent = new Intent(SetPasswordActivity.this, LoginActivity.class);  
                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);  
                    startActivity(intent);  
  
                    finish();  
  
                } else {  
                    Log.d(TAG, "유저 비번 변경 업데이트 에러 응답");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UpdateUserResponse> call, Throwable throwable) {  
                Log.e(TAG, "유저 비번 변경 업데이트 통신 실패", throwable);  
  
            }  
        });  
    }  
  
    private void addTextChangedListeners() {  
        binding.password.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String input = s.toString();  
  
                // 최소길이 검사  
                if (input.length() < 8) {  
                    binding.passwordLayout.setError("비밀번호는 8자리 이상이어야 합니다");  
                    binding.btnNext.setEnabled(false);  
                    return;  
                }  
  
                // 형식확인 (영문, 숫자, 특수문자(!@#$%^&*()-_=+\\|[]{};:'",<.>/?) 조합)  
                // 각 문자 최소 1개는 포함  
                if (!input.matches("^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*()\\-_=+\\\\|\\[\\]{};:'\",<.>/?]).*$")) {  
                    binding.passwordLayout.setError("올바르지 않은 비밀번호 형식입니다\n"  
                            + "영문, 숫자, 특수문자가 모두 포함되어야 합니다.\n"  
                            + "허용된 특수문자(!@#$%^&*()-_=+\\\\|[]{};:'\",<.>/?)");  
                    binding.btnNext.setEnabled(false);  
                    return;  
                }  
  
                // 문제 없으면 다음버튼 활성화  
                binding.passwordLayout.setError(null);  
                binding.btnNext.setEnabled(true);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="141">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\SettingActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
  
import androidx.appcompat.app.AlertDialog;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.databinding.ActivitySettingBinding;  
import com.teamnova.assa.domain.Authentication;  
  
public class SettingActivity extends AppCompatActivity {  
  
    private static final String TAG = "SettingActivity";  
    ActivitySettingBinding binding;  
  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        binding = ActivitySettingBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        setOnClickListeners();  
    }  
  
    private void setOnClickListeners() {  
        // 뒤로가기 버튼  
        binding.backButton.setOnClickListener(v -> {  
            onBackPressed();  
        });  
  
        // 프로필 편집 버튼  
        binding.editProfile.setOnClickListener(v -> {  
            Intent intent = new Intent(this, EditProfileActivity.class);  
            startActivity(intent);  
        });  
  
  
        // 계정 설정 버튼  
        binding.editAccount.setOnClickListener(v -> {  
            Intent intent = new Intent(this, EditAccountActivity.class);  
            startActivity(intent);  
        });  
  
        // 로그아웃 버튼  
        binding.logout.setOnClickListener(v -> {  
            // 로그아웃 확인 다이얼로그 생성  
            generateDialog("로그아웃", "로그아웃 하시겠습니까?", () -> {  
                Authentication.logout(SettingActivity.this);  
            }).show();  
  
        });  
    }  
  
    /**  
     * 인자에 따라 다른 메시지를 가지는 다이얼로그를 생성하는 메소드  
     *  
     * @return  
     */  
    private AlertDialog generateDialog(String title, String message, Runnable runnable) {  
        AlertDialog.Builder builder = new AlertDialog.Builder(this);  
        builder.setTitle(title)  
                .setMessage(message)  
                .setPositiveButton("확인", (dialog, which) -> {  
                    Log.d(TAG, "generateDialog: 확인버튼 선택");  
                    runnable.run();  
                })  
                .setNegativeButton("취소", (dialog, which) -> {  
                    Log.d(TAG, "generateDialog: 취소버튼 선택");  
                    dialog.cancel();  
                });  
        return builder.create();  
    }  
}  
</document_content>  
</document>  
<document index="142">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\SignupActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.content.Intent;  
import android.graphics.Color;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.SpannableString;  
import android.text.Spanned;  
import android.text.TextWatcher;  
import android.text.method.LinkMovementMethod;  
import android.text.style.ClickableSpan;  
import android.util.Log;  
import android.view.View;  
import android.widget.TextView;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.google.android.material.textfield.TextInputLayout;  
import com.teamnova.assa.databinding.ActivitySignupBinding;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.data.retrofit.clients.UserDuplicateCheckApiClient;  
  
import java.util.Objects;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class SignupActivity extends AppCompatActivity {  
  
    private final String TAG = SignupActivity.class.getName();  
    private ActivitySignupBinding binding;  
  
    UserDuplicateCheckApiClient userDuplicateCheckApiClient;  
    UsersApiClient usersApiClient;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
  
        binding = ActivitySignupBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
  
        // 클릭리스너 부착  
        setOnClickListeners();  
  
        // 약관 조회 버튼 활성화  
        setSpannable();  
  
        // 회원정보 입력값을 확인하기 위한 리스너 부착  
        addTextChangedListeners();  
  
        // 레트로핏 인스턴스 할당  
        userDuplicateCheckApiClient = new UserDuplicateCheckApiClient();  
        usersApiClient = UsersApiClient.getInstance();  
  
  
    }  
  
    /**  
     * 클릭리스너 세팅  
     */  
    private void setOnClickListeners() {  
        // 뒤로가기  
        binding.btnBack.setOnClickListener(v -> {  
            this.finish();  
        });  
  
        // 약관 모두 동의  
        binding.checkAllTerms.setOnClickListener(v -> {  
  
            // 체크 시 하위항목 모두 체크  
            if (binding.checkAllTerms.isChecked()) {  
                binding.checkServiceTerm.setChecked(true);  
                binding.checkPrivacyTerm.setChecked(true);  
                updateAllTermsCheckState();  
            } else { // 모두 체크 해제  
                binding.checkServiceTerm.setChecked(false);  
                binding.checkPrivacyTerm.setChecked(false);  
                updateAllTermsCheckState();  
            }  
        });  
  
        // 서비스 이용약관 동의  
        binding.checkServiceTerm.setOnClickListener(v -> {  
            updateAllTermsCheckState();  
        });  
  
        // 개인정보 취급방침  
        binding.checkPrivacyTerm.setOnClickListener(v -> {  
            updateAllTermsCheckState();  
        });  
  
        // "동의하고 가입하기" 버튼  
        binding.btnNext.setOnClickListener(v -> {  
            signUp();  
        });  
    }  
  
    /**  
     * 실제 회원가입이 이루어지는 메소드  
     */  
    private void signUp() {  
        String nickname = Objects.requireNonNull(binding.nickname.getText()).toString();  
        String email = Objects.requireNonNull(binding.email.getText()).toString();  
        String password = Objects.requireNonNull(binding.password.getText()).toString();  
        UserData userData = new UserData(nickname, email, password, UserData.LOGIN_TYPE.DEFAULT);  
  
        Call<UserData> call = usersApiClient.signUp(userData);  
        call.enqueue(new Callback<UserData>() {  
  
            // 응답 받음  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                if (response.isSuccessful()) {  
                    // 성공적인 응답  
                    UserData result = response.body();  
                    Log.d(TAG, "onResponse: " + result);  
  
                    // 가입 성공시 홈 화면으로  
                    Intent intent = new Intent(SignupActivity.this, MainActivity.class);  
                    // 가입 성공후 홈화면에서 뒤로가면 앱이 꺼지도록하기  
                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);  
  
                    startActivity(intent);  
                } else {  
                    // 에러 응답  
                    Log.d(TAG, "onResponse: " + response);  
                    Toast.makeText(SignupActivity.this,  
                            "가입에 실패했습니다. 나중에 시도해 주세요",  
                            Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            // 응답을 못 받음  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.d(TAG, "onFailure: " + throwable.getMessage());  
                Toast.makeText(SignupActivity.this,  
                        "가입에 실패했습니다. 나중에 시도해 주세요",  
                        Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    // 약관동의 Spannable 세팅  
    private void setSpannable() {  
        makeTextSpannable(binding.tvServiceTerm, "[필수] 서비스 이용약관 동의", "서비스 이용약관", v -> {  
            moveTo(FullTermsActivity.class, "서비스 이용약관");  
        });  
  
        makeTextSpannable(binding.tvPrivacyTerm, "[필수] 개인정보 처리방침 동의", "개인정보 처리방침", v -> {  
            moveTo(FullTermsActivity.class, "개인정보 처리방침");  
        });  
    }  
  
    /**  
     * 액티비티 이동  
     *  
     * @param cls       이동할 액티비티 클래스.class  
     * @param extraData extra에 담을 데이터  
     */  
    private void moveTo(Class<?> cls, String extraData) {  
        Intent intent = new Intent(this, cls);  
        intent.putExtra("terms", extraData);  
        startActivity(intent);  
    }  
  
    // 회원가입에 필요한 모든 입력을 마치면 '가입하기' 버튼이 활성화  
    private void updateNextButtonState() {  
        //  회원정보 입력 확인 && 약관 동의 확인  
        binding.btnNext.setEnabled(isValidAllInputs() && isCheckedAllTerms());  
    }  
  
    // 모든 항목 동의 시 '모두동의 체크박스' 체크  
    private void updateAllTermsCheckState() {  
        binding.checkAllTerms.setChecked(isCheckedAllTerms());  
        // 약관체크시 다음 버튼 활성화 상태 변경  
        updateNextButtonState();  
    }  
  
    // 약관 모두 체크 -> true 반환  
    // 나중에 선택약관이 생긴다면 필수약관만 체크되었는지 확인하는 메소드 필요함  
    private boolean isCheckedAllTerms() {  
        return binding.checkServiceTerm.isChecked() && binding.checkPrivacyTerm.isChecked();  
    }  
  
    /**  
     * 모든 입력란에 유효한 값 입력 확인  
     *  
     * @return 모든 입력란에 유효한 값 입력 시 true, 그 외엔 false  
     */  
    private boolean isValidAllInputs() {  
        // 각 입력창이 공백이 아니면서 에러표시가 없는지 확인  
  
        // 세 입력 값 중 길이가 하나라도 0 이면 return false;  
        if (binding.nickname.getEditableText().length() *  
                binding.email.getEditableText().length() *  
                binding.password.getEditableText().length() == 0  
        ) return false;  
  
        // 세 입력 값의 에러 메시지가 하나라도 나오면 false  
        if (binding.nicknameLayout.getError() != null ||  
                binding.emailLayout.getError() != null ||  
                binding.passwordLayout.getError() != null  
        ) return false;  
  
        return true;  
    }  
  
    /**  
     * 약관 동의 텍스트 중 일부를 클릭하면 약관조회 버튼으로 작동하게 만듬  
     *  
     * @param v        textview  
     * @param text     텍스트 원문  
     * @param target   클릭이벤트 부여할 부분  
     * @param listener span 클릭이벤트 처리하는 리스터  
     */  
    public void makeTextSpannable(View v, String text, String target, View.OnClickListener listener) {  
        SpannableString spannable = new SpannableString(text);  
  
        // span 텍스트에 리스너 부착  
        ClickableSpan clickableSpan = new ClickableSpan() {  
            @Override  
            public void onClick(@NonNull View widget) {  
                // 인자로 받은 클릭리스너 실행  
                listener.onClick(widget);  
                Log.d(TAG, "onClick: " + target);  
            }  
        };  
  
        // span 범위 지정  
        int startIndex = text.indexOf(target);  
        int endIndex = startIndex + target.length();  
  
        // span을 target 텍스트에 부착  
        spannable.setSpan(clickableSpan, startIndex, endIndex, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  
  
        ((TextView) v).setText(spannable); // textview에 텍스트 할당  
        ((TextView) v).setMovementMethod(LinkMovementMethod.getInstance()); // Spannable 클릭 이벤트 활성화  
        ((TextView) v).setHighlightColor(Color.TRANSPARENT); // span 클릭 여부 표시 제거  
    }  
  
    /**  
     * addTextChangedListener 부착  
     * editText 입력값 변화 감지  
     */  
    private void addTextChangedListeners() {  
        // 닉네임  
        binding.nickname.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String inputText = s.toString();  
  
                // 입력 길이 확인 (입력길이 초과는 layout xml 단에서 방지했음)  
                if (inputText.isEmpty()) {  
                    binding.nicknameLayout.setError("필수 입력 항목입니다");  
                    updateNextButtonState();  
                    return;  
                }  
  
                // 형식확인 (영문, 한글, 숫자, 밑줄(_)의 조합)  
                if (!inputText.matches("^[a-zA-Z가-힣0-9_]*$")) {  
                    binding.nicknameLayout.setError("올바르지 않은 닉네임 형식입니다");  
                    updateNextButtonState();  
                    return;  
                }  
  
                // 문제없으면 에러 메시지 제거  
                binding.nicknameLayout.setError(null);  
  
                // 중복확인  
                // 내부에서 에러메시지를 출력하거나, 다음 버튼을 활성화 한다.  
                checkUserDataDuplicate(binding.nicknameLayout, "nickname", inputText);  
            }  
        });  
  
        // 이메일  
        binding.email.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String inputText = s.toString();  
  
                // 공백 확인  
                if (inputText.isEmpty()) {  
                    binding.emailLayout.setError("필수 입력 항목입니다");  
                    updateNextButtonState();  
                    return;  
                }  
  
                // 형식확인  
                if (!inputText.matches("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$")) {  
                    binding.emailLayout.setError("올바르지 않은 이메일 형식입니다");  
                    updateNextButtonState();  
                    return;  
                }  
  
                // 문제없으면 에러 메시지 제거  
                binding.emailLayout.setError(null);  
  
                // 중복확인  
                // 내부에서 에러메시지를 출력하거나, 다음 버튼을 활성화 한다.  
                checkUserDataDuplicate(binding.emailLayout, "email", inputText);  
            }  
        });  
  
        // 비밀번호  
        binding.password.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                String inputText = s.toString();  
  
                // 공백 확인  
                if (inputText.isEmpty()) {  
                    binding.passwordLayout.setError("필수 입력 항목입니다");  
                    updateNextButtonState();  
                    return;  
                }  
  
                // 최소길이 확인  
                if (inputText.length() < 8) {  
                    binding.passwordLayout.setError("비밀번호는 8자리 이상이어야 합니다");  
                    updateNextButtonState();  
                    return;  
                }  
  
                // 형식확인 (영문, 숫자, 특수문자(!@#$%^&*()-_=+\\|[]{};:'",<.>/?) 조합)  
                // 각 문자 1는 포함  
                if (!inputText.matches("^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*()\\-_=+\\\\|\\[\\]{};:'\",<.>/?]).*$")) {  
                    binding.passwordLayout.setError("올바르지 않은 비밀번호 형식입니다\n"  
                            + "영문, 숫자, 특수문자가 모두 포함되어야 합니다.\n"  
                            + "허용된 특수문자(!@#$%^&*()-_=+\\\\|[]{};:'\",<.>/?)");  
                    updateNextButtonState();  
                    return;  
                }  
  
                // 문제없으면 에러 메시지 제거  
                binding.passwordLayout.setError(null);  
                updateNextButtonState();  
            }  
        });  
    }  
  
    /**  
     * 유저가 입력한 정보가 이미 사용중인 값인지 확인하는 메소드  
     * 검사결과는 TextInputLayout 에 출력한다.  
     *  
     * @param til    결과 메시지 출력 할 TextInputLayout  
     * @param colunm 중복 검사할 값의 DB colunm  
     * @param input  유저의 입력값  
     */  
    private void checkUserDataDuplicate(TextInputLayout til, String colunm, String input) {  
  
        // 요청 전송  
        Call<Boolean> call = userDuplicateCheckApiClient.isDuplicate(colunm, input);  
  
        // 요청에 대한 응답 처리  
        call.enqueue(new Callback<Boolean>() {  
            @Override  
            public void onResponse(Call<Boolean> call, Response<Boolean> response) {  
                if (response.isSuccessful()) {  
                    Boolean isDuplicate = response.body();  
                    Log.d(TAG, "onResponse: 성공 - " + isDuplicate);  
  
                    if (Boolean.TRUE.equals(isDuplicate)) {  
                        // 중복이면 에러메시지 발생  
                        if (colunm.equals("nickname"))  
                            til.setError("이미 사용 중인 닉네임입니다");  
                        else  
                            til.setError("이미 사용 중인 이메일입니다");  
                    } else {  
                        // 중복아니면 기존의 에러메시지 제거  
                        til.setError(null);  
                    }  
  
                    // "다음" 버튼 상태 변경  
                    updateNextButtonState();  
                } else {  
                    // 응답 코드 200 외  
                    Log.d(TAG, "onResponse: 실패 - " + response);  
                }  
            }  
  
            @Override  
            public void onFailure(Call<Boolean> call, Throwable throwable) {  
                Log.d(TAG, "onFailure: " + throwable.getMessage());  
            }  
        });  
    }  
  
  
}  
</document_content>  
</document>  
<document index="143">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\SplashScreenActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.app.Activity;  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.widget.Toast;  
  
import androidx.appcompat.app.AppCompatActivity;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.request.LoginRequest;  
import com.teamnova.assa.data.dto.response.LoginResponse;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.repository.TokenRepository;  
import com.teamnova.assa.data.retrofit.clients.AuthApiClient;  
import com.teamnova.assa.databinding.ActivitySplashScreenBinding;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.util.TempStorage;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class SplashScreenActivity extends AppCompatActivity {  
  
    private final String TAG = "SplashScreenActivity";  
    ActivitySplashScreenBinding binding;  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        setScreen();  
        tryAutoLogin();  
    }  
  
    private void setScreen() {  
        binding = ActivitySplashScreenBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
    }  
  
    /**  
     * 디바이스에 저장된 토큰이 있다면 자동 로그인을 시도합니다.  
     */  
    private void tryAutoLogin() {  
        // 1. 저장된 토큰이 있는지 확인  
        String token = TokenRepository.getToken();  
        Log.d(TAG, "자동 로그인 시도 : 기기에 저장된 토큰 " + token);  
  
        // 2. 토큰이 있으면 자동 로그인 시도  
        if (token != null) {  
  
            // 로그인 요청객체 생성  
            LoginRequest request = new LoginRequest(null, null, UserData.LOGIN_TYPE.AUTO, null, token);  
            Log.d(TAG, "tryAutoLogin: 생성된 로그인 요청 객체 " + request);  
  
            // 로그인 요청  
            AuthApiClient.getInstance().autoLogin(request).enqueue(new Callback<LoginResponse>() {  
                @Override  
                public void onResponse(Call<LoginResponse> call, Response<LoginResponse> response) {  
                    Log.d(TAG, "onResponse: 자동로그인 통신 성공 " + response);  
                    handleAutoLoginResponse(response);  
                }  
  
                @Override  
                public void onFailure(Call<LoginResponse> call, Throwable throwable) {  
                    Log.e(TAG, "onFailure: 자동로그인 통신 실패 ", throwable);  
                    moveToActivity(LoginActivity.class);  
                }  
            });  
        } else {  
            Log.d(TAG, "tryAutoLogin: 토큰 없음");  
            moveToActivity(LoginActivity.class);  
        }  
    }  
  
    // 로그인 요청결과 처리  
    private void handleAutoLoginResponse(Response<LoginResponse> response) {  
        if (response.isSuccessful() && response.body().status.equals("success")) {  
            // 로그인 성공했다면 토큰 저장 후 메인화면으로 이동  
            // 채팅 소켓 서비스 실행  
            Intent intent = new Intent(getApplicationContext(), ChattingSocketService.class);  
            startService(intent);  
  
            // 토큰을 셰어드에 저장  
            TokenRepository.setToken(response.body().token);  
            Log.d(TAG, "tryAutoLogin: 자동로그인 성공 후 새로 발급받은 토큰 저장됨 " + response.body().token);  
  
            // 내 정보 얻어오기  
            loadMyData();  
  
            // 메인화면으로 이동  
            Toast.makeText(getApplicationContext(), "로그인 되었습니다", Toast.LENGTH_SHORT).show();  
            moveToActivity(MainActivity.class);  
        } else {  
            // 실패하면 로그인 화면으로 이동  
            Log.d(TAG, "tryAutoLogin: 자동로그인 실패(유효하지 않은 토큰으로 접근)");  
            moveToActivity(LoginActivity.class);  
        }  
    }  
  
    private void moveToActivity(Class<? extends Activity> activityCls) {  
        Intent intent = new Intent(getApplicationContext(), activityCls);  
        startActivity(intent);  
        finish();  
    }  
  
    // 로그인 성공시 내 정보 얻어오기  
    private void loadMyData() {  
        AuthApiClient.getInstance().me().enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                UserData userData = response.body();  
                Log.d(TAG, "onResponse: 내 정보 얻어오기 성공 " + userData);  
                if (userData != null) {  
                    TempStorage.setMe(userData);  
                    SPHelper.setUserId(userData.id);  
                    SPHelper.put("nickname", userData.nickname);  
                    SPHelper.put("profileImage", userData.profileImage);  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 내 정보 얻어오기 실패", throwable);  
            }  
        });  
    }  
}  
</document_content>  
</document>  
<document index="144">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\UserProfileActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.recyclerview.widget.ConcatAdapter;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.retrofit.clients.SearchApiClient;  
import com.teamnova.assa.data.retrofit.clients.UsersApiClient;  
import com.teamnova.assa.databinding.ActivityUserProfileBinding;  
import com.teamnova.assa.ui.adapter.PostAdapter;  
import com.teamnova.assa.ui.adapter.UserProfileInfoAdapter;  
import com.teamnova.assa.util.StartActivityUtils;  
  
import java.util.ArrayList;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 다른 사용자의 프로필 화면  
 */  
public class UserProfileActivity extends AppCompatActivity {  
    private static final String TAG = "UserProfileActivity";  
    ActivityUserProfileBinding binding;  
    private Long userId;                                    // 현재 프로필 화면에 출력할 사용자의 userId  
    private UserProfileInfoAdapter userProfileInfoAdapter;  // 사용자 정보 뷰홀더 어댑터  
    private PostAdapter postAdapter;                        // 사용자 게시글 뷰홀더 어댑터  
    private ConcatAdapter concatAdapter;                    // 사용자 정보 + 게시글 어댑터  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        super.onCreate(savedInstanceState);  
        Log.d(TAG, "onCreate: ");  
        binding = ActivityUserProfileBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        getIntentData();  
        initAdapters();  
        initUis();  
    }  
  
    /**  
     * 이전 화면에서 인텐트로 받은 userId 저장  
     */  
    private void getIntentData() {  
        userId = getIntent().getLongExtra("userId", -1);  
        Log.d(TAG, "받은 userID : " + userId);  
    }  
  
    /**  
     * 리사이클러 뷰에 사용되는 어댑터 초기화  
     */  
    private void initAdapters() {  
        userProfileInfoAdapter = new UserProfileInfoAdapter(this);  
        postAdapter = new PostAdapter(this);  
        concatAdapter = new ConcatAdapter(userProfileInfoAdapter, postAdapter);  
  
        binding.rvProfileContainer.setAdapter(concatAdapter);  
        binding.rvProfileContainer.setLayoutManager(new LinearLayoutManager(this));  
    }  
  
    /**  
     * UI 초기화  
     */  
    private void initUis() {  
        setToolbar();  
        setOnClickListeners();  
    }  
  
    /**  
     * 클릭 이벤트 설정  
     */  
    private void setOnClickListeners() {  
        return;  
    }  
  
    /**  
     * 툴바 초기화  
     */  
    private void setToolbar() {  
        setSupportActionBar(binding.toolbarUserProfile);  
  
        getSupportActionBar().setHomeButtonEnabled(true);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
  
        getSupportActionBar().setDisplayShowTitleEnabled(false);  
    }  
  
    @Override  
    protected void onResume() {  
        super.onResume();  
        Log.d(TAG, "onResume: ");  
        loadUserProfile();  
    }  
  
    /**  
     * 툴바 메뉴 초기화  
     */  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        Log.d(TAG, "onCreateOptionsMenu: ");  
  
        getMenuInflater().inflate(R.menu.menu_user_profile_toolbar, menu);  
  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onPrepareOptionsMenu(Menu menu) {  
        Log.d(TAG, "onPrepareOptionsMenu: ");  
  
        // 현재 접속자와 프로필 대상이 같으면 추가 설정 툴바 버튼 생성  
        if(SPHelper.getUserId().equals(userId)){  
            menu.findItem(R.id.menu_item_profile_settings).setVisible(true);  
            menu.findItem(R.id.menu_item_profile_notificatinon).setVisible(true);  
        }  
  
        return super.onPrepareOptionsMenu(menu);  
    }  
  
    /**  
     * 툴바 메뉴 클릭 이벤트 설정  
     */  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        Log.d(TAG, "onOptionsItemSelected: ");  
        int id = item.getItemId();  
  
        if (id == android.R.id.home) {  
            onBackPressed();  
        } else if (id == R.id.menu_item_profile_notificatinon) {  
            // TODO 사용자 알림 on / off  
        } else if (id == R.id.menu_item_profile_settings){  
            StartActivityUtils.move(this, SettingActivity.class, null);  
        }  
  
        return super.onOptionsItemSelected(item);  
    }  
  
    /**  
     * 사용자 프로필 정보 얻어오기  
     */  
    private void loadUserProfile() {  
        UsersApiClient.getInstance().getUserById(userId).enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "사용자 정보 얻어오기 성공");  
                    UserData userData = response.body();  
                    setUserProfileData(userData);  
                    loadUserPosts(userData.id);  
                } else {  
                    Log.d(TAG, "사용자 정보 얻어오기 에러");  
                    Toast.makeText(UserProfileActivity.this, "사용자 정보 얻어오기 에러", Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "사용자 정보 얻어오기 실패", throwable);  
                Toast.makeText(UserProfileActivity.this, "사용자 정보 얻어오기 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    /**  
     * 사용자 프로필 데이터를 화면에 출력  
     */  
    private void setUserProfileData(UserData userData) {  
        userProfileInfoAdapter.setUserData(userData);  
    }  
  
    /**  
     * 사용자가 작성한 게시글 얻어오기  
     *  
     * @param userId  
     */  
    private void loadUserPosts(Long userId) {  
        SearchApiClient.getInstance().searchPostsByUserId(userId.toString()).enqueue(new Callback<PaginatedResponse<Post>>() {  
            @Override  
            public void onResponse(Call<PaginatedResponse<Post>> call, Response<PaginatedResponse<Post>> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "게시글 받아오기 응답 성공 : " + response);  
                    PaginatedResponse<Post> searchResponse = response.body();  
                    Log.d(TAG, "받아온 게시글 : " + searchResponse);  
                    setPostsData(searchResponse.data);  
                } else {  
                    Log.d(TAG, "게시글 받아오기 에러 응답");  
                    Toast.makeText(getApplicationContext(), "게시글 받아오기 에러 응답", Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<PaginatedResponse<Post>> call, Throwable throwable) {  
                Log.d(TAG, "게시글 받아오기 통신 실패");  
                Toast.makeText(getApplicationContext(), "게시글 받아오기 통신 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    /**  
     * 게시글 데이터를 화면에 출력  
     */  
    private void setPostsData(ArrayList<Post> posts) {  
        Log.d(TAG, "setPostsData: 게시글 데이터 설정 posts = " + posts);  
        postAdapter.setItems(posts);  
    }  
  
}  
</document_content>  
</document>  
<document index="145">  
<source>app/src/main/java\com\teamnova\assa\ui\activity\VideoCallActivity.java</source>  
<document_content>  
package com.teamnova.assa.ui.activity;  
  
import android.Manifest;  
import android.content.BroadcastReceiver;  
import android.content.Context;  
import android.content.Intent;  
import android.content.IntentFilter;  
import android.content.pm.PackageManager;  
import android.os.Bundle;  
import android.os.Handler;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.util.Log;  
import android.view.Menu;  
import android.view.MenuItem;  
import android.view.View;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.core.app.ActivityCompat;  
import androidx.core.content.ContextCompat;  
import androidx.localbroadcastmanager.content.LocalBroadcastManager;  
import androidx.recyclerview.widget.GridLayoutManager;  
import androidx.recyclerview.widget.LinearLayoutManager;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.google.gson.JsonObject;  
import com.google.gson.JsonParser;  
import com.teamnova.assa.R;  
import com.teamnova.assa.command.Action;  
import com.teamnova.assa.command.CreateVideoRoomCommand;  
import com.teamnova.assa.command.ExitVideoRoomCommand;  
import com.teamnova.assa.command.IceCandidateCommand;  
import com.teamnova.assa.command.JoinVideoRoomCommand;  
import com.teamnova.assa.command.MediaStatusCommand;  
import com.teamnova.assa.command.SDPCommand;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.dto.data.VideoRoomParticipant;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.databinding.ActivityVideoCallBinding;  
import com.teamnova.assa.domain.CustomPeerConnectionObserver;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.ui.adapter.SimpleChatAdapter;  
import com.teamnova.assa.ui.adapter.VideoRoomAdapter;  
import com.teamnova.assa.ui.fragment.VideoChatBottomSheet;  
import com.teamnova.assa.util.TempStorage;  
import com.teamnova.assa.util.TimeUtils;  
  
import org.webrtc.AudioSource;  
import org.webrtc.AudioTrack;  
import org.webrtc.Camera1Enumerator;  
import org.webrtc.CameraVideoCapturer;  
import org.webrtc.DataChannel;  
import org.webrtc.DefaultVideoDecoderFactory;  
import org.webrtc.DefaultVideoEncoderFactory;  
import org.webrtc.EglBase;  
import org.webrtc.IceCandidate;  
import org.webrtc.MediaConstraints;  
import org.webrtc.MediaStream;  
import org.webrtc.MediaStreamTrack;  
import org.webrtc.PeerConnection;  
import org.webrtc.PeerConnectionFactory;  
import org.webrtc.RtpSender;  
import org.webrtc.RtpTransceiver;  
import org.webrtc.SdpObserver;  
import org.webrtc.SessionDescription;  
import org.webrtc.SurfaceTextureHelper;  
import org.webrtc.SurfaceViewRenderer;  
import org.webrtc.VideoCapturer;  
import org.webrtc.VideoDecoderFactory;  
import org.webrtc.VideoEncoderFactory;  
import org.webrtc.VideoSource;  
import org.webrtc.VideoTrack;  
  
import java.nio.ByteBuffer;  
import java.nio.charset.StandardCharsets;  
import java.util.ArrayList;  
import java.util.HashMap;  
import java.util.List;  
import java.util.Map;  
  
/**  
 * 영상 회의 화면  
 */  
public class VideoCallActivity extends AppCompatActivity {  
  
    private static final String TAG = VideoCallActivity.class.getSimpleName();  
  
    ActivityVideoCallBinding binding;  
  
    private final Long myId = SPHelper.getUserId();  
  
    PeerConnectionFactory peerConnectionFactory;  
    Map<Long, PeerConnection> peerConnectionMap = new HashMap<>();  
    Map<Long, DataChannel> dataChannelMap = new HashMap<>();  
    EglBase eglBase;  
  
    public static final String LOCAL_VIDEO_TRACK_ID = "LOCAL_VIDEO_TRACK";  
    public static final String LOCAL_AUDIO_TRACK_ID = "LOCAL_AUDIO_TRACK";  
    private static final int PERMISSION_REQUEST_CODE = 1;  
  
    private VideoCapturer videoCapturer;  
    private MediaStream localMediaStream;  
    private VideoSource localVideoSource;  
  
    SurfaceTextureHelper surfaceTextureHelper;  
  
    List<VideoRoomParticipant> userList = new ArrayList<>();  
  
    String videoRoomId; // UUID임  
    Long roomId;  
    Boolean isHost;  
  
    // 필요한 권한 리스트  
    String[] permissions = {  
            Manifest.permission.CAMERA,  
            Manifest.permission.RECORD_AUDIO  
    };  
  
    VideoTrack localVideoTrack;  
    AudioTrack localAudioTrack;  
  
    // 카메라 마이크는 기본적으로 꺼져 있음  
    private boolean isVideoEnabled = false;  
    private boolean isAudioEnabled = false;  
  
    public static List<SurfaceViewRenderer> renderers = new ArrayList<>();  
  
    // 리사이클러 뷰  
    RecyclerView recyclerView;  
    VideoRoomAdapter adapter;  
  
    // 채팅 어댑터  
    SimpleChatAdapter simpleChatAdapter;  
    List<SimpleChatAdapter.Message> messages = new ArrayList<>();  
  
    @Override  
    protected void onCreate(Bundle savedInstanceState) {  
        Log.i(TAG, "onCreate: START");  
        super.onCreate(savedInstanceState);  
  
        initializeComponents();  
        initializeViews();  
        getIntentExtras();  
        checkAndRequestPermissions();  
  
        Log.i(TAG, "onCreate: END");  
    }  
  
    private void initializeViews() {  
        binding = ActivityVideoCallBinding.inflate(getLayoutInflater());  
        setContentView(binding.getRoot());  
        initToolbar();  
        initRecyclerView();  
        initChat();  
    }  
  
    private void getIntentExtras() {  
        roomId = getIntent().getLongExtra("roomId", 0);  
        isHost = getIntent().getBooleanExtra("isHost", false);  
        videoRoomId = getIntent().getStringExtra("videoRoomId");  
        Log.d(TAG, "getIntentExtras: roomId = " + roomId + ", isHost = " + isHost + ", videoRoomId = " + videoRoomId);  
    }  
  
    private void initializeComponents() {  
        eglBase = EglBase.create();  
        peerConnectionFactory = initPeerConnectionFactory();  
        // 리시버 등록  
        LocalBroadcastManager.getInstance(this).registerReceiver(messageReceiver, new IntentFilter("videoRoom_event"));  
    }  
  
    private void checkAndRequestPermissions() {  
        if (hasPermissions()) {  
            startVideoRoom();  
        } else {  
            requestPermissions();  
        }  
    }  
  
    private void startVideoRoom() {  
        if (isHost) {  
            createVideoRoom();  
        } else {  
            joinVideoRoom();  
        }  
    }  
  
    private void initChat() {  
        Log.i(TAG, "initChatRecyclerView: START");  
  
        // 채팅 리사이클러 뷰 설정  
        simpleChatAdapter = new SimpleChatAdapter(this);  
        LinearLayoutManager layoutManager = new LinearLayoutManager(this);  
        layoutManager.setStackFromEnd(true);  
        binding.rvChatLog.setLayoutManager(layoutManager);  
        binding.rvChatLog.setAdapter(simpleChatAdapter);  
  
        // 맨 처음에는 오늘의 날짜 출력  
        SimpleUser serverUser = new SimpleUser(0L, null, null);  
        SimpleChatAdapter.Message messageObj =  
                new SimpleChatAdapter.Message(serverUser, TimeUtils.getCurrentTimeInUTC(), TimeUtils.getCurrentTimeInUTC(), "SERVER");  
        simpleChatAdapter.addMessage(messageObj);  
  
        // 텍스트 와쳐 부착  
        binding.etMessage.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                binding.btnSend.setEnabled(s.length() > 0);  
            }  
        });  
  
        // 채팅 전송 버튼 클릭 리스너  
        binding.btnSend.setOnClickListener(v -> {  
            String message = binding.etMessage.getText().toString();  
            if (!message.isEmpty()) {  
                Long targetId = 0L; // 0 이면 전체, 0이 아니면 특정 인물에게만 전송  
                StringBuilder sb = new StringBuilder();  
                Long senderId = TempStorage.getSimpleMe().id;  
                // 메시지 타입(TEXT, IMAGE)|전송자 id|보낸날짜|메시지 내용  
                sb.append("TEXT").append("|")  
                        .append(senderId).append("|")  
                        .append(TimeUtils.getCurrentTimeInUTC()).append("|")  
                        .append(message);  
                sendChat(sb.toString()); // 데이터 채널로 메시지 전송  
                binding.etMessage.setText(""); // 입력창 초기화  
            }  
        });  
  
        Log.i(TAG, "initChatRecyclerView: END");  
    }  
  
    /**  
     * 회의 내부 채팅 메시지 전송  
     * <p>  
     * //     * @param targetId - 0 이면 전체 발송, 0이 아니면 특정 인물에게 전송  
     *  
     * @param message  
     */  
    public void sendChat(String message) {  
        Log.i(TAG, "sendChat: START - message = " + message);  
  
        loggingCurrentUserList();  
  
        for (int i = 0; i < userList.size(); i++) {  
            SimpleUser user = userList.get(i).userData;  
            Long userId = user.id;  
  
            Log.d(TAG, "sendChat: userId = " + userId);  
            if (userId == myId) continue; // 자기 자신은 넘어감  
  
            DataChannel dataChannel = dataChannelMap.get(userId);  
  
            // 데이터 채널이 OPEN 인지 확인하고 전송  
            if (dataChannel != null && dataChannel.state() == DataChannel.State.OPEN) {  
                Log.d(TAG, "sendChat: targetId = " + userId + " 에게 메시지 전송 : " + message);  
                // 데이터 버퍼 생성  
                DataChannel.Buffer buffer = new DataChannel.Buffer(  
                        ByteBuffer.wrap(message.getBytes(StandardCharsets.UTF_8)), false);  
                dataChannel.send(buffer); // 전송  
            } else {  
                Log.e(TAG, "sendChat: 데이터 채널이 열려있지 않거나 존재하지 않음 - targetId = " + userId + ", dataChannel.state() = " + (dataChannel != null ? dataChannel.state() : "null"));  
                Toast.makeText(this, "메시지를 보낼 수 없습니다.", Toast.LENGTH_SHORT).show();  
            }  
        }  
  
        // 자기 자신에게도 메시지 추가  
        runOnUiThread(() -> {  
            String[] result = message.split("\\|", 5);  
            String type = result[0];  
            String senderId = result[1];  
            String datetime = result[2];  
            String msg = result[3];  
  
            simpleChatAdapter.addMessage(new SimpleChatAdapter.Message(TempStorage.getSimpleMe(), msg, datetime, type));  
            binding.rvChatLog.smoothScrollToPosition(simpleChatAdapter.getItemCount() - 1);  
        });  
  
  
        Log.i(TAG, "sendChat: END");  
    }  
  
    private void loggingCurrentUserList() {  
        // 디버깅  
        List<Long> ids = new ArrayList<>();  
        for (VideoRoomParticipant user : userList) {  
            ids.add(user.userData.id);  
        }  
        Log.d(TAG, "loggingCurrentUserList: 현재 유저 id 목록 : " + ids);  
    }  
  
    private void initRecyclerView() {  
        Log.i(TAG, "initRecyclerView: START");  
        this.recyclerView = binding.rvParticipants;  
        this.adapter = new VideoRoomAdapter(this, this.eglBase, this.recyclerView, this.userList);  
        recyclerView.setLayoutManager(new GridLayoutManager(this, 2));  
        this.recyclerView.setAdapter(adapter);  
  
        Log.i(TAG, "initRecyclerView: END");  
    }  
  
    // 호스트일 경우 방 생성 메소드  
    private void createVideoRoom() {  
        Log.i(TAG, "creteVideoRoom: START");  
  
        try {  
            startLocalVideoCapture();  
            sendCreateRoomCommand();  
        } catch (Exception e) {  
            Log.e(TAG, "createVideoRoom: 회의방 생성 오류: " + e.getMessage(), e);  
            handleRoomCreationError();  
        }  
  
        Log.i(TAG, "creteVideoRoom: END");  
    }  
  
    private void sendCreateRoomCommand() {  
        Log.i(TAG, "sendCreateRoomCommand: START");  
  
        Intent messageIntent = new Intent(this, ChattingSocketService.class);  
        CreateVideoRoomCommand command = new CreateVideoRoomCommand(roomId);  
        Log.d(TAG, "createVideoRoom: 회의 생성 요청 필수정보 roomId = " + command.roomId + ", requesterId = " + command.requesterId);  
        messageIntent.putExtra("message", command.toJson());  
        startService(messageIntent);  
  
        Log.i(TAG, "sendCreateRoomCommand: END");  
    }  
  
    private void handleRoomCreationError() {  
        runOnUiThread(() -> {  
            Toast.makeText(this, "방 생성에 실패했습니다. 다시 시도해주세요.", Toast.LENGTH_SHORT).show();  
            finish();  
        });  
    }  
  
    // 영상회의 참가 처리 메소드  
    private void joinVideoRoom() {  
        Log.d(TAG, "joinVideoRoom: START");  
  
        // 카메라 영상 출력  
        startLocalVideoCapture();  
  
        // 소켓 서버에 영상회의 참가 커맨드 날리기  
        Intent messageIntent = new Intent(this, ChattingSocketService.class);  
        JoinVideoRoomCommand command = new JoinVideoRoomCommand(this.videoRoomId);  
        Log.d(TAG, "joinVideoRoom: 회의참가 필수정보 - videoRoomId = " + command.videoRoomId + ", 참가자 id = " + command.requesterId);  
        messageIntent.putExtra("message", command.toJson());  
        startService(messageIntent);  
  
        Log.d(TAG, "joinVideoRoom: END");  
    }  
  
    /**  
     * PeerConnectionFactory 초기화  
     */  
    private PeerConnectionFactory initPeerConnectionFactory() {  
        Log.i(TAG, "initPeerConnectionFactory: START");  
  
        PeerConnectionFactory ret = null;  
  
        // WebRTC 라이브러리 초기화  
        // PeerConnectionFactory 초기화  
        // 네트워크, 미디어 처리 관리하는 객체다  
        // 여기선 InitializationOptions를 생성 및 초기화 하여 옵션을 세팅해주고 있다.  
        PeerConnectionFactory.initialize(PeerConnectionFactory.InitializationOptions  
                .builder(getApplicationContext())  
                .setEnableInternalTracer(false) // 내부로깅 활성화  
                .createInitializationOptions());  
  
        // PeerConnectionFactory 옵션 객체 얻기  
        PeerConnectionFactory.Options options = new PeerConnectionFactory.Options();  
  
        // 인코더, 디코더 설정  
        VideoEncoderFactory encoderFactory;  
        VideoDecoderFactory decoderFactory;  
  
        // 소프트웨어 인코더, 디코더  
//        encoderFactory = new SoftwareVideoEncoderFactory();  
//        decoderFactory = new SoftwareVideoDecoderFactory();  
  
        // 하드웨어 인코더, 디코더  
        encoderFactory = new DefaultVideoEncoderFactory(eglBase.getEglBaseContext(), true, true);  
        decoderFactory = new DefaultVideoDecoderFactory(eglBase.getEglBaseContext());  
  
        // 팩토리 객체 생성  
        ret = PeerConnectionFactory.builder()  
                .setOptions(options)  
                .setVideoEncoderFactory(encoderFactory)  
                .setVideoDecoderFactory(decoderFactory)  
                .createPeerConnectionFactory();  
  
        if (ret == null) {  
            Log.e(TAG, "PeerConnectionFactory 생성 실패");  
            throw new RuntimeException("PeerConnectionFactory 생성에 실패했습니다.");  
        }  
  
        Log.i(TAG, "initPeerConnectionFactory: END - return PeerConnectionFactory = " + ret);  
        return ret;  
    }  
  
    /**  
     * PeerConnection 생성  
     * 여기서 ice후보 전송, 상대방 트랙 수신 콜백까지 작성된다.  
     *  
     * @param targetId 커넥션 상대방 id  
     * @return PeerConnection  
     */  
    private PeerConnection createPeerConnection(Long targetId) {  
        Log.i(TAG, "createPeerConnection: START");  
  
        // ICE 서버 리스트 (예: Google의 STUN 서버 사용)  
        List<PeerConnection.IceServer> iceServers = new ArrayList<>();  
        iceServers.add(PeerConnection.IceServer.builder("stun:stun.l.google.com:19302").createIceServer());  
        iceServers.add(PeerConnection.IceServer.builder("turn:15.165.183.83:3478")  
                .setUsername("assa")  
                .setPassword("assapw")  
                .createIceServer());  
  
        // PeerConnection 객체 생성  
        PeerConnection peerConnection = peerConnectionFactory.createPeerConnection(  
                iceServers,  
                new CustomPeerConnectionObserver() {  
                    @Override  
                    public void onIceCandidate(IceCandidate iceCandidate) {  
                        super.onIceCandidate(iceCandidate);  
                        // ICE Candidate를 참가자에게 전송  
                        sendIceCandidateToServer(targetId, iceCandidate);  
                    }  
  
                    @Override  
                    public void onTrack(RtpTransceiver transceiver) {  
                        super.onTrack(transceiver);  
                        Log.i(TAG, "onTrack: 상대방의 미디어 트랙이 추가되거나 변경되었음, targetId = " + targetId);  
  
                        MediaStreamTrack track = transceiver.getReceiver().track();  
  
                        if (track instanceof VideoTrack) {  
                            VideoTrack remoteVideoTrack = (VideoTrack) track;  
                            Log.d(TAG, "onTrack: 비디오 트랙이 수신됨");  
                            Log.d(TAG, "onTrack: remoteVideoTrack = " + remoteVideoTrack);  
  
                            // 새로 들어온 사용자를 화면에 추가  
                            int i = 0;  
                            for (i = 0; i < userList.size(); i++) {  
                                if (userList.get(i).userData.id == targetId) {  
                                    userList.get(i).videoTrack = remoteVideoTrack;  
                                    Log.d(TAG, "onTrack: " + i + " 번째 유저에 비디오 트랙 설정");  
                                    break;  
                                }  
                            }  
                            Log.d(TAG, "onTrack: notifyItemInserted");  
                            int finalI = i;  
                            // handleJoinVideoRoom에서 이미 아답터에 추가했기 때문에  
                            // 여기에서는 비디오 트랙만 해당 뷰홀더에 연결해준다.  
                            runOnUiThread(() -> adapter.notifyItemChanged(finalI));  
                        } else if (track instanceof AudioTrack) {  
                            AudioTrack remoteAudioTrack = (AudioTrack) track;  
                            Log.d(TAG, "onTrack: 오디오 트랙이 수신됨");  
                            //오디오는 별도의 처리를 할 것이 없음  
                        }  
                    }  
  
                    @Override  
                    public void onIceConnectionChange(PeerConnection.IceConnectionState  
                                                              iceConnectionState) {  
                        super.onIceConnectionChange(iceConnectionState);  
                        Log.d(TAG, "onIceConnectionChange: " + iceConnectionState);  
                    }  
  
                    @Override  
                    public void onDataChannel(DataChannel dataChannel) {  
                        super.onDataChannel(dataChannel);  
                        Log.d(TAG, "onDataChannel: 상대방이 생성한 데이터 채널 획득: " + dataChannel);  
                        dataChannelMap.put(targetId, dataChannel);  
                        dataChannel.registerObserver(new DataChannel.Observer() {  
                            @Override  
                            public void onBufferedAmountChange(long l) {  
  
                            }  
  
                            @Override  
                            public void onStateChange() {  
                                Log.d(TAG, "onStateChange: 데이터 채널 상태 변경 - dataChannel.state() = " + dataChannel.state());  
                                if (dataChannel.state() == DataChannel.State.OPEN) {  
                                    Log.i(TAG, "onStateChange: 데이터 채널 열림 targetId = " + targetId);  
                                } else if (dataChannel.state() == DataChannel.State.CLOSED) {  
                                    Log.i(TAG, "onStateChange: 데이터 채널 닫힘 targetId = " + targetId);  
                                }  
                            }  
  
                            @Override  
                            public void onMessage(DataChannel.Buffer buffer) {  
                                Log.i(TAG, "onMessage: START - buffer = " + buffer);  
  
                                // 메시지 수신 시 ui 업데이트  
                                // buffer를 String으로 변환  
                                ByteBuffer data = buffer.data;  
                                byte[] bytes = new byte[data.remaining()];  // 버퍼 크기만큼 바이트 배열 생성  
                                data.get(bytes);                            // 바이트 버퍼 내용을 바이트 배열에 복사  
                                String message = new String(bytes, StandardCharsets.UTF_8); // 바이트 배열을 UTF-8 인코딩으로 문자열로 변환  
  
                                runOnUiThread(() -> {  
                                    for (VideoRoomParticipant user : userList) {  
                                        if (user.userData.id == targetId) {  
  
                                            String[] splitStr = message.split("\\|", 5);  
                                            String type = splitStr[0];  
                                            String senderId = splitStr[1];  
                                            String datetime = splitStr[2];  
                                            String msg = splitStr[3];  
  
                                            SimpleChatAdapter.Message messageObj =  
                                                    new SimpleChatAdapter.Message(user.userData, msg, datetime, type);  
                                            simpleChatAdapter.addMessage(messageObj);  
                                            break;  
                                        }  
                                    }  
  
                                    binding.rvChatLog.smoothScrollToPosition(simpleChatAdapter.getItemCount() - 1);  
  
                                    // 채팅창이 닫혀있으면 알람을 띄운다.  
                                    if (binding.chatLayout.getVisibility() == View.GONE) {  
                                        chatAlert.setVisibility(View.VISIBLE);  
                                    }  
  
                                    Log.d(TAG, "onMessage: 채팅 메시지 출력 : " + message);  
                                });  
                            }  
                        });  
                    }  
                }  
        );  
  
        // 미디어 트랙, 데이터 채널 추가  
        Log.d(TAG, "createPeerConnection: localMediaStream.videoTracks = " + localMediaStream.videoTracks);  
        Log.d(TAG, "createPeerConnection: localMediaStream.audioTracks = " + localMediaStream.audioTracks);  
  
        // 비디오 및 오디오 트랙을 개별적으로 추가  
        for (VideoTrack videoTrack : localMediaStream.videoTracks) {  
            peerConnection.addTrack(videoTrack);  
        }  
        for (AudioTrack audioTrack : localMediaStream.audioTracks) {  
            peerConnection.addTrack(audioTrack);  
        }  
  
        Log.i(TAG, "createPeerConnection: END - return : PeerConnection = " + peerConnection);  
        return peerConnection;  
    }  
  
    /**  
     * DataChannel 생성  
     *  
     * @return dataChannel  
     */  
    private DataChannel createDataChannel(PeerConnection peerConnection, Long targetId) {  
        Log.i(TAG, "createDataChannel: START - targetId = " + targetId);  
  
        DataChannel.Init init = new DataChannel.Init();  
        init.ordered = true; // 전송 메시지 순서보장  
        DataChannel dataChannel = peerConnection.createDataChannel("chat_" + targetId, init);  
        Log.d(TAG, "createDataChannel: 데이터 채널 생성 완료 targetId = " + targetId + ", dataChannel = " + dataChannel);  
  
        dataChannel.registerObserver(new DataChannel.Observer() {  
            @Override  
            public void onBufferedAmountChange(long l) {  
  
            }  
  
            @Override  
            public void onStateChange() {  
                Log.d(TAG, "onStateChange: 데이터 채널 상태 변경 - dataChannel.state() = " + dataChannel.state());  
                if (dataChannel.state() == DataChannel.State.OPEN) {  
                    Log.i(TAG, "onStateChange: 데이터 채널 열림 targetId = " + targetId);  
                } else if (dataChannel.state() == DataChannel.State.CLOSED) {  
                    Log.i(TAG, "onStateChange: 데이터 채널 닫힘 targetId = " + targetId);  
                }  
            }  
  
            @Override  
            public void onMessage(DataChannel.Buffer buffer) {  
                Log.i(TAG, "createDataChannel - onMessage: START - buffer = " + buffer);  
  
                // 메시지 수신 시 ui 업데이트  
  
                // buffer를 String으로 변환  
                ByteBuffer data = buffer.data;  
                byte[] bytes = new byte[data.remaining()];  // 버퍼 크기만큼 바이트 배열 생성  
                data.get(bytes);                            // 바이트 버퍼 내용을 바이트 배열에 복사  
                String message = new String(bytes, StandardCharsets.UTF_8); // 바이트 배열을 UTF-8 인코딩으로 문자열로 변환  
  
                runOnUiThread(() -> {  
                    for (VideoRoomParticipant user : userList) {  
                        if (user.userData.id == targetId) {  
  
                            String[] splitStr = message.split("\\|", 5);  
                            String type = splitStr[0];  
                            String senderId = splitStr[1];  
                            String datetime = splitStr[2];  
                            String msg = splitStr[3];  
  
                            SimpleChatAdapter.Message messageObj =  
                                    new SimpleChatAdapter.Message(user.userData, msg, datetime, type);  
                            simpleChatAdapter.addMessage(messageObj);  
                            break;  
                        }  
                    }  
  
                    binding.rvChatLog.smoothScrollToPosition(simpleChatAdapter.getItemCount() - 1);  
  
                    // 채팅창이 닫혀있으면 알람을 띄운다.  
                    if (binding.chatLayout.getVisibility() == View.GONE) {  
                        chatAlert.setVisibility(View.VISIBLE);  
                    }  
  
                    Log.d(TAG, "createDataChannel - onMessage: 채팅 메시지 출력 : " + message);  
                });  
  
  
            }  
        });  
  
        Log.d(TAG, "createDataChannel: END - return dataChannel = " + dataChannel);  
        return dataChannel;  
    }  
  
    private void handleExitRoom(ExitVideoRoomCommand command) {  
        Log.i(TAG, "handleExitRoom: START - 나간사람 id = " + command.requesterId);  
        Long exitId = command.requesterId;  
  
        runOnUiThread(() -> {  
            adapter.removeParticipant(exitId);  
  
            // 스트림 제거  
            PeerConnection peerConnection = peerConnectionMap.get(exitId);  
            if (peerConnection != null) { // null 확인 추가  
                for (RtpSender sender : peerConnection.getSenders()) {  
                    peerConnection.removeTrack(sender);  
                }  
                peerConnection.close();  
                peerConnectionMap.remove(exitId);  
            }  
  
            userList.removeIf(user -> user.userData.id == exitId);  
  
            // 호스트 종료 시, 모든 참가자 종료 처리  
            if (command.isHost) {  
                finish();  
            }  
        });  
  
        Log.i(TAG, "handleExitRoom: END");  
    }  
  
    boolean isRestart = false;  
  
    /**  
     * 카메라로 촬영된 영상을 화면에 출력  
     */  
    private void startLocalVideoCapture() {  
        Log.i(TAG, "startLocalVideoCapture: START - isRestart = " + isRestart);  
  
        try {  
            initializeVideoCapturer();  
            createVideoAndAudioTracks();  
  
            // 로컬 비디오 트랙을 리사이클러 뷰에 추가  
            if (!isRestart) {  
                Log.i(TAG, "startLocalVideoCapture: 카메라 최초 출력");  
  
                VideoRoomParticipant participant = new VideoRoomParticipant(TempStorage.getSimpleMe(), localVideoTrack);  
                participant.isVideoEnabled = isVideoEnabled;  
                participant.isAudioEnabled = isAudioEnabled;  
  
                // 리사이클러 뷰에 추가  
                userList.add(participant);  
                adapter.notifyItemInserted(0);  
                isRestart = true;  
                Log.d(TAG, "startLocalVideoCapture: 사용자 자신의 카메라 영상 출력");  
            } else {  
                // 기존 참가자 업데이트 로직  
                updateExistingParticipant();  
            }  
  
            createAndAddLocalMediaStream();  
            if (isRestart) {  
                updatePeerConnections();  
            }  
        } catch (Exception e) {  
            Log.e(TAG, "startLocalVideoCapture: 에러 발생 : " + e.getMessage(), e);  
            handleVideoCapturerError();  
        }  
  
        Log.i(TAG, "startLocalVideoCapture: END");  
    }  
  
    private void initializeVideoCapturer() {  
        Log.i(TAG, "initializeVideoCapturer: START");  
  
        videoCapturer = getCameraCapturer(true);  
        if (videoCapturer == null) {  
            throw new RuntimeException("카메라를 사용할 수 없습니다");  
        }  
        Log.d(TAG, "카메라 캡처러 생성 성공");  
  
        if (surfaceTextureHelper != null) {  
            surfaceTextureHelper.dispose();  
        }  
        surfaceTextureHelper = SurfaceTextureHelper.create(Thread.currentThread().getName(), eglBase.getEglBaseContext());  
        if (surfaceTextureHelper == null) {  
            Log.e(TAG, "SurfaceTextureHelper를 생성할 수 없습니다.");  
            throw new RuntimeException("SurfaceTextureHelper 생성 실패");  
        }  
        Log.d(TAG, "SurfaceTextureHelper 생성 성공");  
  
        localVideoSource = peerConnectionFactory.createVideoSource(videoCapturer.isScreencast());  
        videoCapturer.initialize(surfaceTextureHelper, getApplicationContext(), localVideoSource.getCapturerObserver());  
        videoCapturer.startCapture(640, 360, 30);  
  
        Log.i(TAG, "initializeVideoCapturer: END");  
    }  
  
    private void createVideoAndAudioTracks() {  
        // videoSource 는 initializeVideoCapturer() 에서 초기화 됨  
        Log.d(TAG, "createVideoAndAudioTracks: isVideoEnabled = " + isVideoEnabled + ", isAudioEnabled = " + isAudioEnabled);  
        localVideoTrack = peerConnectionFactory.createVideoTrack(LOCAL_VIDEO_TRACK_ID, localVideoSource);  
        localVideoTrack.setEnabled(isVideoEnabled);  
  
        AudioSource audioSource = peerConnectionFactory.createAudioSource(new MediaConstraints());  
        localAudioTrack = peerConnectionFactory.createAudioTrack("LOCAL_AUDIO_TRACK", audioSource);  
        localAudioTrack.setEnabled(isAudioEnabled);  
    }  
  
    private void updateExistingParticipant() {  
        runOnUiThread(() -> {  
            VideoRoomParticipant target = userList.stream()  
                    .filter(p -> p.userData.id == myId)  
                    .findFirst()  
                    .orElse(null);  
  
            if (target != null) {  
                updateParticipantTracks(target);  
            }  
        });  
    }  
  
    private void updateParticipantTracks(VideoRoomParticipant target) {  
        if (target.videoTrack != localVideoTrack && target.surfaceViewRenderer != null) {  
            target.videoTrack.removeSink(target.surfaceViewRenderer);  
        }  
        if (target.surfaceViewRenderer != null) {  
            localVideoTrack.addSink(target.surfaceViewRenderer);  
        }  
        target.videoTrack = localVideoTrack;  
        target.isVideoEnabled = isVideoEnabled;  
        target.isAudioEnabled = isAudioEnabled;  
    }  
  
    private void createAndAddLocalMediaStream() {  
        localMediaStream = peerConnectionFactory.createLocalMediaStream("LOCAL_STREAM");  
        localMediaStream.addTrack(localVideoTrack);  
        localMediaStream.addTrack(localAudioTrack);  
    }  
  
    private void updatePeerConnections() {  
        for (Map.Entry<Long, PeerConnection> entry : peerConnectionMap.entrySet()) {  
            PeerConnection peerConnection = entry.getValue();  
            peerConnection.getSenders().forEach(peerConnection::removeTrack);  
            peerConnection.addStream(localMediaStream);  
            createAndSendOffer(peerConnection, entry.getKey());  
        }  
    }  
  
    private void handleVideoCapturerError() {  
        runOnUiThread(() -> {  
            Toast.makeText(this, "카메라 초기화에 실패했습니다.", Toast.LENGTH_SHORT).show();  
            finish();  
        });  
    }  
  
    // 비디오 소스로 사용할 카메라 캡처 객체 생성 후 반환  
    private VideoCapturer getCameraCapturer(boolean isFront) {  
        Log.i(TAG, "getCameraCapturer: START - params : isFront=" + isFront);  
  
        // 안드로이드에서 제공하는 카메라 관리 클래스  
        Camera1Enumerator enumerator = new Camera1Enumerator(false);  
        final String[] deviceNames = enumerator.getDeviceNames();  
  
        // 카메라 목록중 카메라 찾기  
        for (String deviceName : deviceNames) {  
            // 전 후면 선택 여부에 따라, 현재 카메라를 사용할지 결정  
            if (isFront ? enumerator.isFrontFacing(deviceName) : enumerator.isBackFacing(deviceName)) {  
                VideoCapturer videoCapturer = enumerator.createCapturer(deviceName, new CameraVideoCapturer.CameraEventsHandler() {  
                    @Override  
                    public void onCameraError(String s) {  
                        Log.e(TAG, "onCameraError: 카메라 에러 - " + s);  
                    }  
  
                    @Override  
                    public void onCameraDisconnected() {  
                        Log.i(TAG, "onCameraDisconnected: 카메라 연결 끊김");  
                    }  
  
                    @Override  
                    public void onCameraFreezed(String s) {  
                        Log.w(TAG, "onCameraFreezed: 카메라 멈춤 - " + s);  
                        restartCamera();  
                    }  
  
                    @Override  
                    public void onCameraOpening(String s) {  
                        Log.i(TAG, "onCameraOpening: 카메라 열림 - " + s);  
                    }  
  
                    @Override  
                    public void onFirstFrameAvailable() {  
                        Log.i(TAG, "onFirstFrameAvailable: 첫번째 프레임 생성됨");  
                    }  
  
                    @Override  
                    public void onCameraClosed() {  
                        Log.i(TAG, "onCameraClosed: 카메라 닫힘");  
                    }  
                });  
                if (videoCapturer != null) {  
                    // 카메라 캡처 찾으면 반환  
                    Log.i(TAG, "getCameraCapturer: END - return videoCapturer = " + videoCapturer);  
                    return videoCapturer;  
                }  
            }  
        }  
        // 카메라 못 찾으면 null  
        Log.i(TAG, "getCameraCapturer: END - return = null");  
        return null;  
    }  
  
    private void restartCamera() {  
        Log.i(TAG, "restartCamera: START");  
  
        // 기존 카메라 정지  
        if (this.videoCapturer != null) {  
            try {  
                this.videoCapturer.stopCapture();  
                this.videoCapturer.dispose();  
                this.videoCapturer = null;  
            } catch (InterruptedException e) {  
                throw new RuntimeException(e);  
            }  
        }  
  
        // 짧은 지연 후 카메라 다시 시작  
        // 카메라가 완전히 해제되고 실행하기  
        new Handler().postDelayed(() -> {  
            startLocalVideoCapture();  
        }, 1000);  
  
        Log.i(TAG, "restartCamera: END");  
    }  
  
    /**  
     * SDP Offer 생성 후 전송  
     *  
     * @param peerConnection  
     * @param targetId  
     */  
    private void createAndSendOffer(PeerConnection peerConnection, Long targetId) {  
        Log.i(TAG, "createAndSendOffer: START");  
  
        // 겉에 있는 SdpObserver 는 sdp Offer 를 생성하는 작업 콜백  
        // 안에 있는 SdpObserver 는 로컬에 sdp 를 설정하는 작업 콜백  
        peerConnection.createOffer(new SdpObserver() {  
            @Override  
            public void onCreateSuccess(SessionDescription sessionDescription) {  
                Log.d(TAG, "onCreateSuccess: SDP Offer 생성됨");  
  
                // SDP Offer 로컬 설정  
                peerConnection.setLocalDescription(new SdpObserver() {  
                    @Override  
                    public void onCreateSuccess(SessionDescription sessionDescription) {  
                        Log.d(TAG, "onCreateSuccess: 로컬 SDP Offer 생성 성공");  
                    }  
  
                    @Override  
                    public void onSetSuccess() {  
                        Log.d(TAG, "onSetSuccess: 로컬 SDP Offer 설정 성공");  
                        sendOfferToServer(videoRoomId, targetId, sessionDescription);  
                    }  
  
                    @Override  
                    public void onCreateFailure(String s) {  
                        Log.e(TAG, "onCreateFailure: " + s);  
                    }  
  
                    @Override  
                    public void onSetFailure(String s) {  
                        Log.e(TAG, "onSetFailure: " + s);  
  
                    }  
                }, sessionDescription);  
            }  
  
            @Override  
            public void onSetSuccess() {  
  
            }  
  
            @Override  
            public void onCreateFailure(String s) {  
  
            }  
  
            @Override  
            public void onSetFailure(String s) {  
  
            }  
        }, new MediaConstraints());  
  
        Log.i(TAG, "createAndSendOffer: END");  
    }  
  
    private void sendOfferToServer(String videoRoomId, Long targetId, SessionDescription sdp) {  
        Log.d(TAG, "sendOfferToServer: START");  
  
        Intent messageIntent = new Intent(this, ChattingSocketService.class);  
        SDPCommand command = new SDPCommand(videoRoomId, targetId, sdp);  
        messageIntent.putExtra("message", command.toJson());  
        startService(messageIntent);  
  
        Log.d(TAG, "sendOfferToServer: END");  
    }  
  
    /**  
     * SDP OFFER 수신 처리  
     *  
     * @param command  
     */  
    private void handleSdpOfferFromServer(SDPCommand command) {  
        Log.d(TAG, "handleSdpOfferFromServer: START");  
  
        // 새로운 PeerConnection 생성  
        PeerConnection peerConnection = createPeerConnection(command.requesterId);  
  
        // PeerConnection을 맵에 저장  
        peerConnectionMap.put(command.requesterId, peerConnection);  
  
        // 서버로부터 SDP Offer 수신, 처리  
        // 수신된 SDP Offer를 remoteDescription으로 설정  
        peerConnection.setRemoteDescription(new SdpObserver() {  
            @Override  
            public void onCreateSuccess(SessionDescription sessionDescription) {  
            }  
  
            @Override  
            public void onSetSuccess() {  
                Log.d(TAG, "onSetSuccess: remote SDP 설정 성공");  
                // Remote SDP 설정 성공 시 Answer 생성 및 전송  
                createAndSendAnswer(peerConnection, command.requesterId);  
            }  
  
            @Override  
            public void onCreateFailure(String s) {  
                Log.e(TAG, "onCreateFailure: " + s);  
            }  
  
            @Override  
            public void onSetFailure(String s) {  
                Log.e(TAG, "onSetFailure: " + s);  
            }  
        }, command.sdp);  
  
        Log.d(TAG, "handleSdpOfferFromServer: END");  
    }  
  
    // answer 처리  
    private void handleSdpAnswerFromServer(SDPCommand command) {  
  
        PeerConnection peerConnection = peerConnectionMap.get(command.requesterId);  
  
        // 서버로부터 SDP answer 수신 및 처리  
        peerConnection.setRemoteDescription(new SdpObserver() {  
            @Override  
            public void onCreateSuccess(SessionDescription sessionDescription) {  
  
            }  
  
            @Override  
            public void onSetSuccess() {  
                // SDP answer가 성공적으로 설정됨  
                Log.i(TAG, "SDP answer가 성공적으로 설정됨");  
            }  
  
            @Override  
            public void onCreateFailure(String s) {  
                Log.e(TAG, "onCreateFailure: " + s);  
            }  
  
            @Override  
            public void onSetFailure(String error) {  
                // 오류 처리  
                Log.e(TAG, "SDP answer 설정 실패" + error);  
            }  
        }, command.sdp);  
    }  
  
    private void createAndSendAnswer(PeerConnection peerConnection, Long requesterId) {  
        Log.d(TAG, "createAndSendAnswer: START");  
  
        peerConnection.createAnswer(new SdpObserver() {  
            @Override  
            public void onCreateSuccess(SessionDescription sessionDescription) {  
                // SDP answer 생성 성공 시  
                Log.i(TAG, "onCreateSuccess: SDP ANSWER 생성 성공");  
  
                peerConnection.setLocalDescription(new SdpObserver() {  
                    @Override  
                    public void onCreateSuccess(SessionDescription sessionDescription) {  
  
                    }  
  
                    @Override  
                    public void onSetSuccess() {  
                        Log.i(TAG, "onSetSuccess: 로컬 SDP 설정 성공 - SDP Answer를 서버로 전송");  
                        sendAnswerToServer(videoRoomId, requesterId, sessionDescription);  
                    }  
  
                    @Override  
                    public void onCreateFailure(String s) {  
  
                    }  
  
                    @Override  
                    public void onSetFailure(String s) {  
  
                    }  
                }, sessionDescription);  
            }  
  
            @Override  
            public void onSetSuccess() {  
            }  
  
            @Override  
            public void onCreateFailure(String s) {  
                Log.e(TAG, "onCreateFailure: " + s);  
            }  
  
            @Override  
            public void onSetFailure(String s) {  
                Log.e(TAG, "onSetFailure: " + s);  
            }  
        }, new MediaConstraints());  
  
        Log.d(TAG, "createAndSendAnswer: END");  
    }  
  
    // 서버로 Answer SDP 전송  
    private void sendAnswerToServer(String videoRoomId, Long targetId, SessionDescription sdp) {  
        Log.d(TAG, "sendAnswerToServer: START");  
  
        // 서버로 Answer SDP 전송  
        Intent messageIntent = new Intent(this, ChattingSocketService.class);  
        SDPCommand command = new SDPCommand(videoRoomId, targetId, sdp);  
        messageIntent.putExtra("message", command.toJson());  
        startService(messageIntent);  
  
        Log.d(TAG, "sendAnswerToServer: END");  
    }  
  
    // 서버로 ICE 후보 전송  
    private void sendIceCandidateToServer(Long targetId, IceCandidate iceCandidate) {  
//        Log.i(TAG, "sendIceCandidateToServer: START");  
//        Log.i(TAG, "sendIceCandidateToServer: " + targetId + "으로 Ice 후보 전송");  
  
        if (iceCandidate == null) {  
            Log.w(TAG, "ICE 후보가 없음");  
  
        } else {  
            // 서버로 ICE 후보 전송  
            Intent messageIntent = new Intent(this, ChattingSocketService.class);  
            IceCandidateCommand command = new IceCandidateCommand(videoRoomId, targetId, iceCandidate);  
//            Log.d(TAG, "sendIceCandidateToServer: ice후보 전송 필수 값 - videoRoomId = " + videoRoomId  
//                    + ", targetId = " + targetId + ", iceCandidate = " + iceCandidate);  
            messageIntent.putExtra("message", command.toJson());  
            startService(messageIntent);  
        }  
  
//        Log.i(TAG, "sendIceCandidateToServer: END");  
    }  
  
    // 전송받은 ICE 후보 처리  
    public void handleIceCandidateFromServer(IceCandidateCommand command) {  
        Log.i(TAG, "handleIceCandidateFromServer: START");  
        Log.d(TAG, "handleIceCandidateFromServer: ice 후보 보낸 유저 id = " + command.requesterId);  
  
        IceCandidate candidate = command.iceCandidate;  
        // 유저 목록의 PeerConnection을 가져옴  
        PeerConnection peerConnection = peerConnectionMap.get(command.requesterId);  
  
        if (peerConnection == null) {  
            Log.e(TAG, "handleIceCandidateFromServer: PeerConnection이 null");  
        } else {  
            peerConnection.addIceCandidate(candidate);  
        }  
        Log.i(TAG, "handleIceCandidateFromServer: END");  
    }  
  
    private boolean hasPermissions() {  
  
        for (String permission : permissions) {  
            if (ContextCompat.checkSelfPermission(this, permission) != PackageManager.PERMISSION_GRANTED) {  
                return false;  
            }  
        }  
        return true;  
    }  
  
    private void requestPermissions() {  
        ActivityCompat.requestPermissions(this, permissions, PERMISSION_REQUEST_CODE);  
    }  
  
    @Override  
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions,  
                                           @NonNull int[] grantResults) {  
        Log.i(TAG, "onRequestPermissionsResult: START");  
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);  
  
        if (requestCode == PERMISSION_REQUEST_CODE) {  
            boolean allPermissionsGranted = true;  
  
            // 모든 권한이 승인되었는지 확인  
            for (int result : grantResults) {  
                if (result != PackageManager.PERMISSION_GRANTED) {  
                    allPermissionsGranted = false;  
                    break;  
                }  
            }  
            Log.d(TAG, "onRequestPermissionsResult: allPermissoinGranted = " + allPermissionsGranted);  
  
  
            if (allPermissionsGranted) {  
                if (isHost) {  
                    // 호스트는 방 생성  
                    createVideoRoom();  
                } else {  
                    // 게스트면 방 참가  
                    joinVideoRoom();  
                }  
            } else {  
                // 권한이 거부된 경우  
                Toast.makeText(this, "카메라와 마이크 권한이 필요합니다.", Toast.LENGTH_SHORT).show();  
                finish();  
            }  
        }  
        Log.i(TAG, "onRequestPermissionsResult: END");  
    }  
  
    // 툴바 설정  
    private void initToolbar() {  
        Log.i(TAG, "initToolbar: START");  
  
        binding.toolbarVideoCall.setTitle("");  
        setSupportActionBar(binding.toolbarVideoCall);  
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);  
        getSupportActionBar().setDisplayShowHomeEnabled(true);  
  
        Log.i(TAG, "initToolbar: END");  
    }  
  
    // 채팅 수신시 이 것의 visibility를 true 변경해야함  
    public View chatAlert;  
  
    @Override  
    public boolean onCreateOptionsMenu(Menu menu) {  
        Log.i(TAG, "onCreateOptionsMenu: START");  
        getMenuInflater().inflate(R.menu.menu_video_call, menu);  
  
        // 채팅 아이콘에만 커스텀 뷰 적용  
        MenuItem chatMenuItem = menu.findItem(R.id.item_video_call_chat_toggle);  
  
        if (chatMenuItem != null) {  
            View actionView = getLayoutInflater().inflate(R.layout.menu_icon_with_badge, null);  
            chatMenuItem.setActionView(actionView);  
  
            Log.d(TAG, "onPrepareOptionsMenu: actionview = " + actionView);  
  
            // 아이콘 뷰와 빨간 점 뷰 가져오기  
            chatAlert = actionView.findViewById(R.id.chat_red_dot);  
  
            // 클릭 이벤트 처리  
            actionView.setOnClickListener(v -> {  
                onOptionsItemSelected(chatMenuItem);  // 메뉴 클릭 이벤트 처리  
            });  
        }  
        Log.i(TAG, "onCreateOptionsMenu: END");  
        return super.onCreateOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onPrepareOptionsMenu(Menu menu) {  
        Log.i(TAG, "onPrepareOptionsMenu: START");  
        updateCameraIcon(isVideoEnabled);  
        updateMicIcon(isAudioEnabled);  
        Log.i(TAG, "onPrepareOptionsMenu: END");  
        return super.onPrepareOptionsMenu(menu);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        Log.i(TAG, "onOptionsItemSelected: START");  
        int itemId = item.getItemId();  
        if (itemId == android.R.id.home) {  
            onBackPressed();  
        } else if (itemId == R.id.item_cam_toggle) {  
            // 메시지 검색 칸 열림  
            toggleVideo();  
            return true;  
        } else if (itemId == R.id.item_mic_toggle) {  
            toggleAudio();  
            return true;  
        } else if (itemId == R.id.item_video_call_chat_toggle) {  
            toggleChatLayout(); // 채팅 레이아웃 필치기/접기  
//            showChatDialog();  
            return true;  
        }  
        Log.i(TAG, "onOptionsItemSelected: END");  
        return super.onOptionsItemSelected(item);  
    }  
  
  
  
    // 바텀 시트 다이얼로그 출력  
    private void showChatDialog() {  
        Log.i(TAG, "showChatDialog: START");  
        VideoChatBottomSheet chatDialog = new VideoChatBottomSheet(this, messages);  
        chatDialog.show(getSupportFragmentManager(), "VideoChatBottomSheet");  
        Log.i(TAG, "showChatDialog: END");  
    }  
  
    // 숨겨져 있던 레이아웃 출력  
    private void toggleChatLayout() {  
        Log.i(TAG, "toggleChatLayout: START");  
        binding.chatLayout.setVisibility(binding.chatLayout.getVisibility() == View.VISIBLE ? View.GONE : View.VISIBLE);  
  
        // 채팅창 열면 채팅알람 제거  
        if (binding.chatLayout.getVisibility() == View.VISIBLE) {  
            chatAlert.setVisibility(View.INVISIBLE);  
        }  
  
        Log.i(TAG, "toggleChatLayout: END");  
    }  
  
    private void toggleVideo() {  
        Log.i(TAG, "toggleVideo: START : 비디오 토글 버튼 클릭");  
        isVideoEnabled = !isVideoEnabled;  
        Log.d(TAG, "toggleVideo: localVideoTrack = " + localVideoTrack + ", isVideoEnabled = " + isVideoEnabled);  
        if (localVideoTrack != null) {  
            localVideoTrack.setEnabled(isVideoEnabled);  
            updateCameraIcon(isVideoEnabled);  
        }  
  
        Log.i(TAG, "toggleVideo: END - isVideoEnabled = " + isVideoEnabled);  
    }  
  
    private void toggleAudio() {  
        Log.i(TAG, "toggleAudio: START : 오디오 토글 버튼 클릭");  
        isAudioEnabled = !isAudioEnabled;  
        if (localAudioTrack != null) {  
            localAudioTrack.setEnabled(isAudioEnabled); // 마이크 끄기  
            updateMicIcon(isAudioEnabled);  
        }  
  
        Log.i(TAG, "toggleAudio: END - isAudioEnabled = " + isAudioEnabled);  
    }  
  
    // 카메라 아이콘 업데이트  
    private void updateCameraIcon(boolean isVideoEnabled) {  
        Log.i(TAG, "updateCameraIcon: START - isVideoEnabled = " + isVideoEnabled);  
  
        runOnUiThread(() -> {  
            if (isVideoEnabled) {  
                binding.toolbarVideoCall.getMenu().findItem(R.id.item_cam_toggle).setIcon(R.drawable.ic_cam_on);  
                Toast.makeText(this, "카메라가 켜졌습니다.", Toast.LENGTH_SHORT).show();  
            } else {  
                binding.toolbarVideoCall.getMenu().findItem(R.id.item_cam_toggle).setIcon(R.drawable.ic_cam_off);  
                Toast.makeText(this, "카메라가 꺼졌습니다.", Toast.LENGTH_SHORT).show();  
            }  
        });  
  
        setUiByMediaStatus(MediaStatusCommand.MediaType.VIDEO, isVideoEnabled);  
        sendMediaStatusToServer(MediaStatusCommand.MediaType.VIDEO, isVideoEnabled);  
        Log.i(TAG, "updateCameraIcon: END");  
    }  
  
    // 마이크 아이콘 업데이트  
    private void updateMicIcon(boolean isAudioEnabled) {  
        Log.i(TAG, "updateMicIcon: START - isAudioEnabled = " + isAudioEnabled);  
  
        runOnUiThread(() -> {  
            if (isAudioEnabled) {  
                binding.toolbarVideoCall.getMenu().findItem(R.id.item_mic_toggle).setIcon(R.drawable.ic_mic_on);  
                Toast.makeText(this, "마이크가 켜졌습니다.", Toast.LENGTH_SHORT).show();  
            } else {  
                binding.toolbarVideoCall.getMenu().findItem(R.id.item_mic_toggle).setIcon(R.drawable.ic_mic_off);  
                Toast.makeText(this, "마이크가 꺼졌습니다.", Toast.LENGTH_SHORT).show();  
            }  
        });  
  
        setUiByMediaStatus(MediaStatusCommand.MediaType.AUDIO, isAudioEnabled);  
        sendMediaStatusToServer(MediaStatusCommand.MediaType.AUDIO, isAudioEnabled);  
        Log.i(TAG, "updateMicIcon: END");  
    }  
  
    // 서버로 상태 정보 전송 (본인 제외 나머지 인원에게 데이터 전송됨)  
    private void sendMediaStatusToServer(MediaStatusCommand.MediaType mediaType, boolean isEnabled) {  
        Log.i(TAG, "sendMediaStatusToServer: START - mediaType = " + mediaType + ", isEnabled = " + isEnabled);  
        Intent intent = new Intent(this, ChattingSocketService.class);  
        MediaStatusCommand command = new MediaStatusCommand(videoRoomId, mediaType, isEnabled);  
        intent.putExtra("message", command.toJson());  
        startService(intent);   // 다른 멤버들에게 전송  
        Log.i(TAG, "sendMediaStatusToServer: END");  
    }  
  
    // 마이크 카메라 상태에 따른 화면 ui 변경  
    private void setUiByMediaStatus(MediaStatusCommand.MediaType mediaType, boolean isEnabled) {  
        MediaStatusCommand command = new MediaStatusCommand(videoRoomId, mediaType, isEnabled);  
        handleMediaStatus(command); // 나 자신에게 전송  
    }  
  
    @Override  
    public void onBackPressed() {  
        Log.d(TAG, "onBackPressed: START");  
  
        if(binding.chatLayout.getVisibility() == View.VISIBLE){  
            binding.chatLayout.setVisibility(View.GONE);  
        } else {  
            // 퇴장 메시지 서버로 전송  
            sendExitCommand();  
            super.onBackPressed();  
        }  
        Log.d(TAG, "onBackPressed: END");  
    }  
  
    // 퇴장 메시지 서버로 전송  
    private void sendExitCommand() {  
        Log.d(TAG, "sendExitCommand: START");  
        // 퇴장 메시지 서버로 전송  
        Intent socketIntent = new Intent(this, ChattingSocketService.class);  
        ExitVideoRoomCommand command = new ExitVideoRoomCommand();  
        command.videoRoomId = videoRoomId;  
        command.roomId = roomId;  
        Log.d(TAG, "sendExitCommand: videoRoomId = " + videoRoomId + ", roomId = " + roomId);  
  
        // 나가는 사람이 방장이면 화상회의 전체를 종료한다.  
        Log.d(TAG, "onBackPressed: isHost = " + isHost);  
        if (isHost) {  
            command.isHost = true;  
        } else {  
            // 서버로 나감 알림  
            command.isHost = false;  
        }  
        socketIntent.putExtra("message", command.toJson());  
        startService(socketIntent);  
        Log.d(TAG, "sendExitCommand: END");  
    }  
  
    @Override  
    protected void onStop() {  
        releaseResources();  
        super.onStop();  
        Log.d(TAG, "onStop: ");  
    }  
  
    @Override  
    protected void onDestroy() {  
        Log.i(TAG, "onDestroy: START - 리소스 해제");  
        releaseResources();  
        super.onDestroy();  
  
        Log.i(TAG, "onDestroy: END");  
    }  
  
    // 리소스 해제 메소드  
    private void releaseResources() {  
        Log.i(TAG, "releaseResources: START - 리소스 해제");  
  
        if (videoCapturer != null) {  
            try {  
                videoCapturer.stopCapture();  
            } catch (InterruptedException e) {  
                Log.e(TAG, "releaseResources: " + e.getMessage(), e);  
            } finally {  
                videoCapturer.dispose();  
                videoCapturer = null;  
            }  
        }  
  
        for (DataChannel dataChannel : dataChannelMap.values()) {  
            if (dataChannel != null) {  
                dataChannel.close();  
                dataChannel.dispose();  
            }  
        }  
        dataChannelMap.clear();  
  
        for (PeerConnection peerConnection : peerConnectionMap.values()) {  
            if (peerConnection != null) {  
                peerConnection.close();  
            }  
        }  
        peerConnectionMap.clear();  
  
        for (SurfaceViewRenderer renderer : renderers) {  
            if (renderer != null) {  
                renderer.release();  
            }  
        }  
        renderers.clear();  
  
        if (peerConnectionFactory != null) {  
            peerConnectionFactory.dispose();  
            peerConnectionFactory = null;  
        }  
  
        if (messageReceiver != null) {  
            LocalBroadcastManager.getInstance(this).unregisterReceiver(messageReceiver);  
            messageReceiver = null;  
        }  
        Log.i(TAG, "releaseResources: END");  
    }  
  
    private void handleJoinVideoRoom(JoinVideoRoomCommand command) {  
        Log.i(TAG, "handleJoinVideoRoom: START");  
        long joinerId = command.requesterId;  
        Log.d(TAG, "handleJoinVideoRoom: joinerId = " + joinerId);  
  
        SimpleUser joiner = new SimpleUser(joinerId, command.nickname, command.profileImage);  
  
        if (joinerId == myId) {  
            Log.i(TAG, "handleJoinVideoRoom: 내가 새로운 참가자다.  참가자 목록을 저장");  
  
            // 내가 새로운 참가자면 참가자 목록을 저장한다.  
            // 자기 자신은 무조건 0번 인덱스임  
            for (SimpleUser user : command.userList) {  
                if (user.id == myId) continue; // 자기 자신은 0번에 이미 추가되어 있음  
  
                Log.d(TAG, "handleJoinVideoRoom: userList.size() before adding = " + userList.size());  
                this.userList.add(new VideoRoomParticipant(user, null));  
                Log.d(TAG, "handleJoinVideoRoom: userList.size() after adding = " + userList.size());  
  
                runOnUiThread(() -> {  
                    adapter.notifyItemInserted(adapter.getItemCount() - 1);  
                });  
            }  
  
//            runOnUiThread(() -> {  
//                adapter.notifyDataSetChanged();  
//            });  
  
            for (VideoRoomParticipant user : this.userList) {  
                // 자기 자신은 패스  
                if (user.userData.id == myId) continue;  
  
                // 유저별로 1:1 PeerConnection 생성  
                PeerConnection pc = createPeerConnection(user.userData.id);  
                this.peerConnectionMap.put(user.userData.id, pc);  
  
                // 데이터 채널 생성  
                DataChannel dataChannel = createDataChannel(pc, user.userData.id);  
                dataChannelMap.put(user.userData.id, dataChannel);  
                Log.i(TAG, "createPeerConnection: 데이터 채널 생성 및 맵에 저장");  
  
                // 유저 별로 SDP Offer 전송  
                createAndSendOffer(pc, user.userData.id);  
            }  
        } else {  
            Log.i(TAG, "handleJoinVideoRoom: 내가 기존 참가자다. 새로운 참가자를 참여자 목록에 추가");  
            // 내가 기존 참가자면 새로운 참가자를 참여자 목록에 추가한다.  
  
            Log.d(TAG, "handleJoinVideoRoom: userList.size() before adding = " + userList.size());  
            this.userList.add(new VideoRoomParticipant(joiner, null));  
            Log.d(TAG, "handleJoinVideoRoom: userList.size() after adding = " + userList.size());  
  
            Log.i(TAG, "handleJoinVideoRoom: notifyItemInserted");  
            runOnUiThread(() -> {  
                adapter.notifyItemInserted(userList.size() - 1);  
            });  
        }  
  
//        // 새참가자, 기존참가자 모두, 다른 유저들에게 자신의 카메라 마이크 상태 전달  
        Log.i(TAG, "handleJoinVideoRoom: 다른 참가자들에게 자신의 마이크 카메라 상태 전달");  
        sendMediaStatusToServer(MediaStatusCommand.MediaType.VIDEO, this.isVideoEnabled);  
        sendMediaStatusToServer(MediaStatusCommand.MediaType.AUDIO, this.isAudioEnabled);  
  
        List<Long> userIdList_debug = new ArrayList<>();  
        for (VideoRoomParticipant user : this.userList) {  
            userIdList_debug.add(user.userData.id);  
        }  
        Log.d(TAG, "handleJoinVideoRoom: 변경된 유저 id 목록 userIdList_debug = " + userIdList_debug);  
        Log.i(TAG, "handleJoinVideoRoom: END");  
    }  
  
    // 소켓 서비스에서 전송된 인텐트 감지용 리시버  
    private BroadcastReceiver messageReceiver = new BroadcastReceiver() {  
        @Override  
        public void onReceive(Context context, Intent intent) {  
            Log.d(TAG, "onReceive: START");  
            String message = intent.getStringExtra("message");  
            Log.d(TAG, "onReceive: 소켓서비스에서 전송된 메시지 = " + message);  
  
            // 메시지 파싱  
            JsonObject jsonObject = (JsonObject) JsonParser.parseString(message);  
            String actionStr = jsonObject.get("action").getAsString();  
            Log.d(TAG, "onReceive: jsonObject=" + jsonObject);  
            Log.d(TAG, "onReceive: action = " + actionStr);  
  
            Action action = Action.valueOf(actionStr);  
  
            try {  
                switch (action) {  
                    case CREATE_VIDEO_ROOM: // 방 생성 응답  
                        Log.i(TAG, "onReceive: 방 생성 응답 받음");  
                        CreateVideoRoomCommand command = CreateVideoRoomCommand.fromJson(jsonObject.toString());  
                        VideoCallActivity.this.videoRoomId = command.videoRoomId;  
                        Log.d(TAG, "onReceive: 서버에 생성된 videoRoomId = " + videoRoomId);  
                        loggingCurrentUserList();  
                        break;  
  
                    case JOIN_VIDEO_ROOM: // 방 참가 응답  
                        Log.i(TAG, "onReceive:  방 참가 응답 받음");  
                        JoinVideoRoomCommand joinCommand = JoinVideoRoomCommand.fromJson(jsonObject.toString());  
                        handleJoinVideoRoom(joinCommand);  
                        loggingCurrentUserList();  
                        break;  
  
                    case SDP: // sdp 처리  
                        SDPCommand sdpCommand = SDPCommand.fromJson(jsonObject.toString());  
                        Log.d(TAG, "onReceive: 수신받은 sdp type = " + sdpCommand.sdp.type);  
  
                        // 수신된 offer 처리  
                        if (sdpCommand.sdp.type == SessionDescription.Type.OFFER) {  
                            Log.i(TAG, "onReceive: SDP OFFER 수신");  
                            handleSdpOfferFromServer(sdpCommand);  
                            return;  
                        }  
  
                        // 수신된 answer 처리  
                        if (sdpCommand.sdp.type == SessionDescription.Type.ANSWER) {  
                            Log.i(TAG, "onReceive: SDP ANSWER 수신");  
                            handleSdpAnswerFromServer(sdpCommand);  
                            return;  
                        }  
                        break;  
  
                    case ICE_CANDIDATE: // ice 후보 처리  
                        IceCandidateCommand iceCandidateCommand = IceCandidateCommand.fromJson(jsonObject.toString());  
                        handleIceCandidateFromServer(iceCandidateCommand);  
                        break;  
  
                    case EXIT_VIDEO_ROOM: // 퇴장 이벤트  
                        ExitVideoRoomCommand exitCommand = ExitVideoRoomCommand.fromJson(jsonObject.toString());  
                        handleExitRoom(exitCommand);  
                        loggingCurrentUserList();  
                        break;  
  
                    case MEDIA_STATUS: // 카메라, 마이크 상태 변화  
                        MediaStatusCommand mediaStatusCommand = MediaStatusCommand.fromJson(jsonObject.toString());  
                        handleMediaStatus(mediaStatusCommand);  
                        break;  
                    default:  
                        break;  
                }  
            } catch (Exception e) {  
                Log.e(TAG, "onReceive: " + e.getMessage(), e);  
            }  
        }  
    };  
  
    private void handleMediaStatus(MediaStatusCommand command) {  
        Log.i(TAG, "handleMediaStatus: START");  
  
        Log.d(TAG, "handleMediaStatus: requester = " + command.requesterId);  
        Log.d(TAG, "handleMediaStatus: userList.size() = " + userList.size());  
  
        // 전달받은 사용자의 상태 업데이트  
        runOnUiThread(() -> {  
            for (int i = 0; i < userList.size(); i++) {  
                VideoRoomParticipant participant = userList.get(i);  
                if (participant.userData.id == command.requesterId) {  
                    Log.i(TAG, "handleMediaStatus: 현재 사용자 목록에서 requester 찾음");  
  
                    List<Object> payloads = new ArrayList<>();  
                    if (command.mediaType == MediaStatusCommand.MediaType.VIDEO) {  
                        Log.i(TAG, "handleMediaStatus: 비디오 상태 변경 = " + command.isEnabled);  
                        participant.isVideoEnabled = command.isEnabled;  
                        payloads.add("video");  
                        payloads.add(command.isEnabled);  
                    } else {  
                        Log.i(TAG, "handleMediaStatus: 오디오 상태 변경 = " + command.isEnabled);  
                        participant.isAudioEnabled = command.isEnabled;  
                        payloads.add("audio");  
                        payloads.add(command.isEnabled);  
                    }  
  
                    // 아답터에 변경 알림  
                    Log.d(TAG, "handleMediaStatus: notifyItemChanged");  
                    adapter.notifyItemChanged(i, payloads);  
                }  
            }  
        });  
  
  
        // 새로 입장한 유저에 대해 처리될 때 adapter.participants에 는 새 유저가 추가되어 있지 않음  
//        runOnUiThread(() -> {  
//            for (VideoRoomParticipant participant : userList) {  
//                Log.d(TAG, "handleMediaStatus: participant.userData.id = " + participant.userData.id);  
//                if (participant.userData.id == command.requesterId) {  
//                    Log.d(TAG, "handleMediaStatus: 상태 바뀐 유저 찾음");  
//                    if (command.mediaType == MediaStatusCommand.MediaType.VIDEO) {  
//                        Log.d(TAG, "handleMediaStatus: 비디오 상태 변경 = " + command.isEnabled);  
//                        participant.isVideoEnabled = command.isEnabled;  
//  
//                        // videoTrack활성화 비활성화  
//                        if (participant.videoTrack != null) {  
//                            participant.videoTrack.setEnabled(command.isEnabled);  
//                        }  
//  
//                        int position = userList.indexOf(participant);  
//                        Log.d(TAG, "handleMediaStatus: 상태를 변경할 participant의 userList 포지션 = " + position);  
//                        VideoRoomAdapter.ParticipantViewHolder viewHolder = (VideoRoomAdapter.ParticipantViewHolder) recyclerView.findViewHolderForAdapterPosition(position);  
//                        Log.d(TAG, "handleMediaStatus: viewHolder = " + viewHolder);  
//  
//                        // TODO 참가자 입장시 화면을 가릴 때 viewholder가 null 임  
//                        if(viewHolder == null){  
//                            // 아직 화면이 생성되지 않으면 상태 정보만 저장  
//                            participant.isVideoEnabled = command.isEnabled;  
//                            break;  
//                        } else {  
//                            if (command.isEnabled) {  
//                                viewHolder.binding.llIvWrapper.setVisibility(View.GONE);  
//                            } else {  
//                                viewHolder.binding.llIvWrapper.setVisibility(View.VISIBLE);  
//                            }  
//                        }  
//  
//                        // 로컬 참가자인 경우 추가 처리  
//                        Log.d(TAG, "handleMediaStatus: participant id = " + participant.userData.id + ", myId = " + myId);  
//                        if (participant.userData.id == myId) {  
//                            isVideoEnabled = command.isEnabled;  
//                            localVideoTrack.setEnabled(isVideoEnabled);  
//                        }  
//                    } else {  
//                        Log.d(TAG, "handleMediaStatus: 오디오 상태 변경 = " + command.isEnabled);  
//                        participant.isAudioEnabled = command.isEnabled;  
//  
//                        // 마이크 아이콘 직접 업데이트  
//                        int position = userList.indexOf(participant);  
//                        VideoRoomAdapter.ParticipantViewHolder viewHolder = (VideoRoomAdapter.ParticipantViewHolder) recyclerView.findViewHolderForAdapterPosition(position);  
//  
//                        if(viewHolder == null){  
//                            // 아직 화면이 생성되지 않으면 상태 정보만 저장  
//                            participant.isAudioEnabled = command.isEnabled;  
//                            break;  
//                        } else {  
//                            if (command.isEnabled) {  
//                                viewHolder.binding.ivMicStatus.setVisibility(View.GONE);  
//                            } else {  
//                                viewHolder.binding.ivMicStatus.setVisibility(View.VISIBLE);  
//                            }  
//                        }  
//  
//                    }  
//  
//                    break;  
//                }  
//            }  
//        });  
        Log.i(TAG, "handleMediaStatus: END");  
    }  
  
}  
</document_content>  
</document>  
<document index="146">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\ChatMemberAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.app.Activity;  
import android.content.Context;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.load.engine.DiskCacheStrategy;  
import com.bumptech.glide.request.RequestOptions;  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.command.CreateRoomCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.databinding.HeaderChatSideBinding;  
import com.teamnova.assa.databinding.ItemChatMemberBinding;  
import com.teamnova.assa.ui.activity.ChatRoomActivity;  
import com.teamnova.assa.util.StartActivityUtils;  
  
import java.util.List;  
  
/**  
 * 채팅창 사이드 드로어에서 멤버 목록을 나타내는 리사이클러뷰 어댑터  
 */  
public class ChatMemberAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder> {  
  
    private static final String TAG = ChatMemberAdapter.class.getSimpleName();  
    private List<SimpleUser> memberList;  
    private static Context context;     //  액티비티 컨텍스트여야함  
  
    public static final int TYPE_HEADER = 0;  
    public static final int TYPE_ITEM = 1;  
  
    public onInviteClickListener onInviteClickListener;  
    public Long roomId;  
  
    private boolean showHeader = true; // 기본적으로 헤더를 보이도록 설정  
  
    public ChatMemberAdapter(Activity context, Long roomId, onInviteClickListener listener) {  
        Log.i(TAG, "ChatMemberAdapter: roomId = " + roomId);  
        ChatMemberAdapter.context = context;  
        this.onInviteClickListener = listener;  
        this.roomId = roomId;  
    }  
  
    public interface onInviteClickListener {  
        void onInviteClick(Long savedRoomId);  
    }  
  
    @Override  
    public int getItemViewType(int position) {  
        if (position == 0 && showHeader) return TYPE_HEADER;  
        else return TYPE_ITEM;  
    }  
  
    public void setItems(List<SimpleUser> userData) {  
        // 리스트에서 사용자 본인을 찾아 리스트 맨 앞으로 이동  
        for (int i = 0; i < userData.size(); i++) {  
            SimpleUser user = userData.get(i);  
            if (user.id == SPHelper.getUserId()) {  
                userData.remove(i);  
                userData.add(0, user);  
                break;  
            }  
        }  
  
        this.memberList = userData;  
        notifyDataSetChanged();  
    }  
  
    @NonNull  
    @Override  
    public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view;  
  
        if (viewType == TYPE_HEADER) {  
            // 헤더 뷰  
            view = LayoutInflater.from(parent.getContext()).inflate(R.layout.header_chat_side, parent, false);  
            return new HeaderViewHolder(view);  
        } else {  
            // 친구 아이템 뷰  
            view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_chat_member, parent, false);  
            return new MemberViewHolder(view);  
        }  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position) {  
        Log.d(TAG, "onBindViewHolder: viewType = " + holder.getItemViewType());  
        if (holder.getItemViewType() == TYPE_HEADER) {  
            // 헤더 데이터 바인딩  
            HeaderViewHolder headerViewHolder = (HeaderViewHolder) holder;  
        } else {  
            // 친구 아이템 데이터 바인딩  
            MemberViewHolder memberViewHolder = (MemberViewHolder) holder;  
            int itemPosition = showHeader ? position - 1 : position; // 헤더가 있으면 position 조정  
            memberViewHolder.bind(this.memberList.get(itemPosition)); // 헤더 반영  
        }  
    }  
  
    @Override  
    public int getItemCount() {  
        // 헤더가 있으면 아이템 수 + 1  
        if (memberList == null) {  
            return showHeader ? 1 : 0;  
        }  
        return showHeader ? memberList.size() + 1 : memberList.size();  
    }  
  
    // 헤더 가시성을 제어하는 메서드  
    public void setShowHeader(boolean showHeader) {  
        this.showHeader = showHeader;  
        notifyDataSetChanged(); // 어댑터 갱신  
    }  
  
    class MemberViewHolder extends RecyclerView.ViewHolder {  
        public ItemChatMemberBinding binding;  
  
        public MemberViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemChatMemberBinding.bind(itemView);  
        }  
  
        public void bind(SimpleUser userData) {  
            // 프로필 클릭시 이동  
            binding.getRoot().setOnClickListener(v -> StartActivityUtils.moveToProfile(context, userData.id));  
  
            // 닉네임 출력  
            binding.tvUserNickname.setText(userData.nickname);  
  
            // 이 유저가 사용자 본인이면 '나' 를 표시  
            if (userData.id == SPHelper.getUserId()) {  
                binding.meMark.setVisibility(View.VISIBLE);  
                binding.tvUserNickname.setTypeface(null, android.graphics.Typeface.BOLD);  
            }  
  
            // 이 유저가 오픈채팅방의 방장이면 '방장' 을 표시  
            boolean isNewRoom = ((ChatRoomActivity) ChatMemberAdapter.context).isNewRoom;  
            boolean isOpenChat = ((ChatRoomActivity) ChatMemberAdapter.context).isOpenChat;  
  
            // 오픈채팅방일때  
            if (isOpenChat) {  
                // 새로 개설한 방이면 방장 표시 출력  
                if (isNewRoom) {  
                    binding.roomMasterMark.setVisibility(View.VISIBLE);  
                } else {  
                    // 기존에 있던 방이면 방장정보 대조 해봐야함  
                    if (userData.id == GlobalApplication.dbHelper.getChatRoomInfo(roomId).masterId) {  
                        binding.roomMasterMark.setVisibility(View.VISIBLE);  
                    }  
                }  
            }  
  
            // 프로필 이미지 경로 생성  
            String imgUrl = userData.profileImage;  
  
            // 프로필 이미지 출력  
            Glide.with(context.getApplicationContext())  
                    .load(imgUrl)  
                    .circleCrop()  
                    .apply(new RequestOptions()  
                            .skipMemoryCache(true)  
                            .diskCacheStrategy(DiskCacheStrategy.NONE))  
                    .into(binding.ivUserProfileImage);  
        }  
    }  
  
    // 채팅방 대화상대 초대 칸  
    public class HeaderViewHolder extends RecyclerView.ViewHolder {  
        public HeaderChatSideBinding binding;  
  
        public HeaderViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = HeaderChatSideBinding.bind(itemView);  
  
            // 방장이 나간 오픈채팅방이면 이 아이템을 숨김  
            ChatRoom chatRoom = GlobalApplication.dbHelper.getChatRoomInfo(roomId);  
            if (chatRoom != null && chatRoom.roomType == CreateRoomCommand.RoomType.OPEN  
                    && chatRoom.masterId == 0) {  
                Log.d(TAG, "HeaderViewHolder: roomType = " + chatRoom.roomType + ", masterId = " + chatRoom.masterId);  
                binding.getRoot().setVisibility(View.GONE);  
            }  
  
            // 클릭 시 추가 초대 화면으로 이동  
            binding.getRoot().setOnClickListener(v -> {  
                Log.d(TAG, "HeaderViewHolder: 추가 초대 버튼 클릭");  
  
                // 작동코드는 ChatRoomActivity에서 구현  
                onInviteClickListener.onInviteClick(roomId);  
            });  
        }  
  
  
    }  
  
}  
  
  
  
</document_content>  
</document>  
<document index="147">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\ChatRoomAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.app.Activity;  
import android.content.Context;  
import android.content.Intent;  
import android.graphics.Bitmap;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.command.CreateRoomCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.databinding.ItemChatroomBinding;  
import com.teamnova.assa.ui.activity.ChatRoomActivity;  
import com.teamnova.assa.util.DBHelper;  
import com.teamnova.assa.util.ImageUtils;  
import com.teamnova.assa.util.TimeUtils;  
import com.teamnova.assa.util.Utils;  
  
import java.util.ArrayList;  
import java.util.List;  
  
public class ChatRoomAdapter extends RecyclerView.Adapter<ChatRoomAdapter.ChatroomViewHolder> {  
    private static final String TAG = ChatRoomAdapter.class.getSimpleName();  
    DBHelper dbHelper;  
    List<Long> itemList;  
    Context context;  // glide 사용시 컨텍스트 할당에 필요함  
  
    public ChatRoomAdapter(List<Long> itemList, Activity activity) {  
        if (itemList == null) itemList = new ArrayList<>();  
        this.itemList = itemList;  
        this.context = activity; // 액티비티에서 컨텍스트 얻어야 에러 발생 안 함  
        dbHelper = GlobalApplication.dbHelper;  
    }  
  
    public void addItem(Long item) {  
        itemList.add(item);  
        notifyItemInserted(itemList.size() - 1);  
        Log.d(TAG, "addItem: " + (itemList.size() - 1) + " 인덱스에 아이템 추가");  
    }  
  
    public void setItems(List<Long> itemList) {  
        this.itemList = itemList;  
        notifyDataSetChanged();  
        Log.d(TAG, "setItems: " + itemList.size() + " 개의 아이템 set");  
    }  
  
    @NonNull  
    @Override  
    public ChatroomViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        return new ChatroomViewHolder(ItemChatroomBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false));  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull ChatroomViewHolder holder, int position) {  
        holder.bind(itemList.get(position));  
    }  
  
    @Override  
    public int getItemCount() {  
        if (itemList == null) return 0;  
        return itemList.size();  
    }  
  
    class ChatroomViewHolder extends RecyclerView.ViewHolder {  
        final String TAG = ChatroomViewHolder.class.getSimpleName();  
        ItemChatroomBinding binding;  
  
        public ChatroomViewHolder(ItemChatroomBinding binding) {  
            super(binding.getRoot());  
            this.binding = binding;  
        }  
  
        public void bind(Long roomId) {  
            Log.i(TAG, "bind: START 현재 데이터를 바인딩 하는 채팅방의 roomId =" + roomId);  
  
            // db에서 채팅방 정보 얻기  
            ChatRoom chatRoom = dbHelper.getChatRoomInfo(roomId);  
            String roomName = chatRoom.getRoomName();  
            List<SimpleUser> members = dbHelper.getChatRoomMembers(roomId, true);  
            List<String> lastMessageAndTime = dbHelper.getRecentMessage(roomId);  
            String lastMessage = lastMessageAndTime.get(0);  
            String lastMessageTime = lastMessageAndTime.get(1);  
            int unreadCount = dbHelper.getUnreadCount(roomId);  
  
            binding.tvChatroomListTitle.setText(roomName);  
            binding.tvChatroomListMemberCount.setText(String.valueOf(members.size()));  
            binding.tvChatroomListLastMessage.setText(lastMessage);  
  
            String localtime = TimeUtils.convertUTCToLocalMin(lastMessageTime);  
            binding.tvChatroomListLastSendDateTime.setText(localtime);  
  
            // 안 읽은 개수 표시는 100개 이상이면 "99+" 로 표시  
            // 0개면 아예 표시를 안한다.  
            String notReadCountStr = unreadCount >= 100 ? "99+" : String.valueOf(unreadCount);  
            binding.tvChatroomListNotReadCount.setVisibility(unreadCount == 0 ? android.view.View.GONE : android.view.View.VISIBLE);  
            binding.tvChatroomListNotReadCount.setText(notReadCountStr);  
  
            Log.d(TAG, "bind: roomName=" + roomName + ", members=" + members + ", " +  
                    "lastMessage=" + lastMessage + ", lastMessageTime=" + lastMessageTime +  
                    ", unreadCount=" + unreadCount);  
  
            Log.d(TAG, "bind: 현재 바인딩 된 채팅방의 타입 = " + chatRoom.roomType);  
            if (chatRoom.roomType == CreateRoomCommand.RoomType.NORMAL) {  
                // 일반 채팅방이면 채팅방 이미지 생성  
                generateChatRoomImage(members);  
            } else {  
                // 오픈채팅방이면 기본 채팅방 이미지 생성  
                binding.ivChatroomImage.setImageResource(R.drawable.all_logo_assa);  
            }  
  
            // 클릭시 채팅방 화면으로 이동  
            String finalRoomName = roomName;  
            binding.getRoot().setOnClickListener(v -> {  
                Log.d(TAG, "bind: 채팅방 목록에서 클릭됨");  
                Log.d(TAG, "bind: id=" + roomId + ", roomName=" + finalRoomName);  
                Intent intent = new Intent(context, ChatRoomActivity.class);  
                intent.putExtra("roomId", roomId);  
                intent.putExtra("isNewRoom", false);  
                intent.putExtra("roomName", finalRoomName);  
                if(chatRoom.roomType == CreateRoomCommand.RoomType.OPEN){  
                    intent.putExtra("isOpenChat", true);  
                }  
  
                context.startActivity(intent);  
            });  
  
            Log.i(TAG, "bind: END");  
        }  
  
        // 일반 채팅방 이미지 생성 메소드  
        private void generateChatRoomImage(List<SimpleUser> members) {  
            // 나를 제외한 멤버 최대 4명의 프사 경로 리스트 만들기  
            List<String> memberImageUrls = new ArrayList<>();  
            for (SimpleUser user : members) {  
                if (!user.id.equals(SPHelper.getUserId())) {  
                    memberImageUrls.add(user.profileImage);  
                    if (memberImageUrls.size() == 4) break;  
                }  
            }  
            Log.d(TAG, "bind: memberImageUrls=" + memberImageUrls);  
  
            // 프사경로 리스트를 프사 비트맵 배열로 변환  
            ImageUtils.loadBitmapsFromUrls(context, memberImageUrls, bitmaps -> {  
                Log.d(TAG, "onBitmapsLoaded: bitmaps=" + bitmaps);  
  
                // 비트맵 배열로 실제 채팅방 이미지 비트맵 생성  
                Bitmap resultImage = ImageUtils.createChatRoomImage(bitmaps, Utils.dpToPx(context, 40));  
                binding.ivChatroomImage.setImageBitmap(resultImage);  
            });  
        }  
    }  
}  
  
</document_content>  
</document>  
<document index="148">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\CommentAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.content.Context;  
import android.graphics.drawable.Drawable;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.EditText;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.widget.AppCompatButton;  
import androidx.core.content.ContextCompat;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Comment;  
import com.teamnova.assa.data.dto.data.Reply;  
import com.teamnova.assa.data.helper.PostHelper;  
import com.teamnova.assa.databinding.CommentItemBinding;  
import com.teamnova.assa.databinding.ReplyItemBinding;  
import com.teamnova.assa.util.StartActivityUtils;  
  
import java.util.ArrayList;  
import java.util.List;  
import java.util.Objects;  
import java.util.function.Consumer;  
  
/**  
 * 댓글, 대댓글 리사이클러 뷰 아답터  
 */  
public class CommentAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder> {  
  
    private static final String TAG = CommentAdapter.class.getSimpleName();  
    public List<Comment> comments = new ArrayList<>();  
    static Context context;  
    EditText replyEditText; // 덧글 입력용 eidtText  
    public static Consumer<Long> replyListener = null;  
    Long parentCommentId; // 부모 댓글 id  
  
    public CommentAdapter(List<Comment> comments) {  
        setComments(comments);  
    }  
  
    public CommentAdapter(Context context) {  
        CommentAdapter.context = context;  
    }  
  
    public int getPositionById(Long id, VIEW_TYPE type) {  
        // comments 를 순회하며 인자로 주어진 id를 가진 comment 찾기  
        int position = -1;  
  
        for (int i = 0; i < comments.size(); i++) {  
            Comment currentComment = comments.get(i);  
  
            // currentComment의 id가 주어진 인자와 일치하고, 타입이 인자의 type 변수와 일치하면 포지션 반환  
            // reply는 comment의 자식이기 때문에 인스턴스 타입 검사는 reply먼저 한다.  
            if (Objects.equals(currentComment.getId(), id)) {  
                if (type == VIEW_TYPE.REPLY && currentComment instanceof Reply) {  
                    // Reply 타입인 경우  
                    position = i;  
                    break;  
                } else if (type == VIEW_TYPE.COMMENT && !(currentComment instanceof Reply)) {  
                    // Comment 타입인 경우  
                    position = i;  
                    break;  
                }  
            }  
        }  
  
        Log.d(TAG, "getPotionById: comments = " + comments);  
        Log.d(TAG, "getPotionById: position = " + position);  
  
        return position;  
    }  
  
    public void setComments(List<Comment> comments) {  
        this.comments = flatteningData(comments);  
        notifyDataSetChanged();  
    }  
  
    public void setReplyListener(Consumer<Long> listener) {  
        replyListener = listener;  
    }  
  
    // 댓글, 대댓글 계층구조를 1차원 배열로 변환한 새 리스트 반환  
    public List<Comment> flatteningData(List<Comment> commentList) {  
        List<Comment> flattendList = new ArrayList<>();  
        for (Comment comment : commentList) {  
            flattendList.add(comment);  
            flattendList.addAll(comment.getReplies());  
        }  
        return flattendList;  
    }  
  
    public enum VIEW_TYPE {  
        COMMENT,  
        REPLY  
    }  
  
    @Override  
    public int getItemViewType(int position) {  
        // 뷰 홀더의 아이템뷰 타입을 반환  
        if (comments.get(position) instanceof Reply) {  
            return VIEW_TYPE.REPLY.ordinal();  
        } else {  
            return VIEW_TYPE.COMMENT.ordinal();  
        }  
    }  
  
    @NonNull  
    @Override  
    public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        // 뷰 홀더 생성  
        View view;  
  
        // 댓글, 덧글을 구분하여 뷰와 뷰홀더 생성  
        if (viewType == VIEW_TYPE.COMMENT.ordinal()) {  
            view = LayoutInflater.from(parent.getContext()).inflate(R.layout.comment_item, parent, false);  
            return new CommentViewHolder(view);  
        } else {  
            view = LayoutInflater.from(parent.getContext()).inflate(R.layout.reply_item, parent, false);  
            return new ReplyViewHolder(view);  
        }  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position) {  
        if (holder instanceof ReplyViewHolder) {  
            ((ReplyViewHolder) holder).bindItem((Reply) comments.get(position));  
        } else {  
            ((CommentViewHolder) holder).bindItem((Comment) comments.get(position));  
        }  
    }  
  
    // item 제거  
    public void remove(int position) {  
        comments.remove(position);         // 데이터 제거  
        notifyItemRemoved(position);    // 출력 새로고침  
    }  
  
    @Override  
    public int getItemCount() {  
        return (comments != null) ? comments.size() : 0;  
    }  
  
    public static class CommentViewHolder extends RecyclerView.ViewHolder {  
        CommentItemBinding binding;  
  
        public CommentViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = CommentItemBinding.bind(itemView);  
        }  
  
        public void bindItem(Comment comment) {  
            // 프로필 이미지  
            Glide.with(itemView.getContext())  
                    .load(comment.getUser().profileImage)  
                    .centerCrop()  
                    .into(binding.ivCommentItemAuthorProfileImage);  
            binding.ivCommentItemAuthorProfileImage.setClipToOutline(true);  
  
            binding.tvCommentItemAuthorNickname.setText(comment.getUser().nickname);               // 닉네임  
            binding.tvCommentItemDate.setText(comment.getDateTimeAsString());                 // 작성날짜  
  
            binding.llCommentItemAuthor.setOnClickListener(v -> moveToProfile(comment.getUser().id));  
  
            binding.tvCommentItemContent.setText(comment.getContent());                       // 본문  
            binding.btnCommentItemLike.setText(String.valueOf(comment.getLikeCount()));      // 좋아요 수  
  
            // 덧글 입력하기 위한 리스너 설정  
            binding.tvAddReply.setOnClickListener(v -> {  
                setReplyEditText(comment.getId());  
            });  
  
            // 좋아요 선택 여부에 따른 다른 이미지 부여  
            if (comment.isLiked()) {  
                Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_true);  
                binding.btnCommentItemLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            } else {  
                Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_false);  
                binding.btnCommentItemLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            }  
  
            // 좋아요 버튼 이벤트 리스너  
            binding.btnCommentItemLike.setOnClickListener(v -> toggleLike((AppCompatButton) v, PostHelper.TYPE.COMMENT, comment.getId()));  
        }  
  
        // 주어진 아이디의 프로필 화면으로 이동  
        private void moveToProfile(Long userId) {  
            StartActivityUtils.moveToProfile(context, userId);  
        }  
    }  
  
    // 1. 입력창 힌트가 덧글을 남겨주세요. 로 변경되어야함  
    // 2. 입력창에 포커스 되어야함  
    // 2-1. 키보드 올라와야함  
    // 3. 등록버튼이 덧글 등록으로 작동해야함  
    private static void setReplyEditText(Long parentId) {  
        // 외부에서 제공된 이벤트 리스너 실행  
        replyListener.accept(parentId);  
    }  
  
  
    public static class ReplyViewHolder extends RecyclerView.ViewHolder {  
        ReplyItemBinding binding;  
  
        public ReplyViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ReplyItemBinding.bind(itemView);  
        }  
  
        public void bindItem(Reply reply) {  
            // 프로필 이미지  
            Glide.with(itemView.getContext())  
                    .load(reply.getUser().profileImage)  
                    .centerCrop()  
                    .into(binding.ivReplyItemAuthorProfileImage);  
            binding.ivReplyItemAuthorProfileImage.setClipToOutline(true);  
  
            binding.tvReplyItemAuthorNickname.setText(reply.getUser().nickname);               // 닉네임  
            binding.tvReplyItemDate.setText(reply.getDateTimeAsString());                 // 작성날짜  
  
            binding.llReplyItemAuthor.setOnClickListener(v -> moveToProfile(reply.getUser().id));  
  
            binding.tvReplyItemContent.setText(reply.getContent());                       // 본문  
            binding.btnReplyItemLike.setText(String.valueOf(reply.getLikeCount()));      // 좋아요 수  
            // 덧글 입력하기 위한 리스너 설정  
            binding.tvAddReply.setOnClickListener(v -> {  
                setReplyEditText(reply.getComment_id());  
            });  
  
            // 좋아요 선택 여부에 따른 다른 이미지 부여  
            if (reply.isLiked()) {  
                Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_true);  
                binding.btnReplyItemLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            } else {  
                Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_false);  
                binding.btnReplyItemLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            }  
  
            // 좋아요 버튼 이벤트 리스너  
            binding.btnReplyItemLike.setOnClickListener(v -> toggleLike((AppCompatButton) v, PostHelper.TYPE.REPLY, reply.getId()));  
        }  
  
        public static void moveToProfile(Long userId){  
            StartActivityUtils.moveToProfile(context, userId);  
        }  
    }  
  
    /**  
     * 좋아요 토글링  
     */  
    private static void toggleLike(AppCompatButton v, PostHelper.TYPE type, Long targetId) {  
        Log.d(TAG, "toggleLike 실행");  
  
        // 반복 터치 방지  
        v.setEnabled(false);  
  
        PostHelper.toggleLike(type, targetId, likeResponse -> {  
            // 아이콘 변경  
            if (likeResponse.isLike) {  
                // 좋아요 추가  
                Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_true);  
                v.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            } else {  
                // 좋아요 취소  
                Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_false);  
                v.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            }  
  
            // 추천수 변경  
            v.setText(String.valueOf(likeResponse.likeCount));  
  
            // 버튼 활성화  
            v.setEnabled(true);  
        });  
    }  
}  
</document_content>  
</document>  
<document index="149">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\FriendRequestAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.app.Activity;  
import android.content.Context;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.load.engine.DiskCacheStrategy;  
import com.bumptech.glide.request.RequestOptions;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Friend;  
import com.teamnova.assa.data.retrofit.clients.UserRelationApiClient;  
import com.teamnova.assa.databinding.ItemFriendRequestBinding;  
import com.teamnova.assa.util.StartActivityUtils;  
import com.teamnova.assa.util.TimeUtils;  
  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class FriendRequestAdapter extends RecyclerView.Adapter<FriendRequestAdapter.ViewHolder> {  
  
    private static final String TAG = FriendRequestAdapter.class.getSimpleName();  
    private List<Friend> dataList;  
    private static Context context;  
  
    public FriendRequestAdapter(Activity context) {  
        FriendRequestAdapter.context = context;  
    }  
  
    public void setItems(List<Friend> dataList) {  
        this.dataList = dataList;  
        notifyDataSetChanged();  
    }  
  
    @NonNull  
    @Override  
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_friend_request, parent, false);  
        return new ViewHolder(view);  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {  
        holder.bind(this.dataList.get(position));  
    }  
  
    public void removeItem(int position) {  
        this.dataList.remove(position);  
        notifyItemRemoved(position);  
    }  
  
    @Override  
    public int getItemCount() {  
        return this.dataList != null ? dataList.size() : 0;  
    }  
  
    class ViewHolder extends RecyclerView.ViewHolder {  
        ItemFriendRequestBinding binding;  
  
        public ViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemFriendRequestBinding.bind(itemView);  
  
        }  
  
        public void bind(Friend friend) {  
            // 프로필 클릭시 이동  
            binding.getRoot().setOnClickListener(v -> StartActivityUtils.moveToProfile(context, friend.requesterId));  
  
            // 친구 신청 시간 출력  
            if (friend.requestAt != null) {  
                Log.d(TAG, "bind: 신청 시간 = " + friend.requestAt);  
                binding.tvRequestTime.setText(TimeUtils.convertUTCToLocalMin(friend.requestAt));  
            }  
  
            // 닉네임 출력  
            binding.tvUserNickname.setText(friend.requester.nickname);  
  
            // 프로필 이미지 경로 생성  
            String imgUrl = friend.requester.profileImage;  
  
            // 프로필 이미지 출력  
            Glide.with(context.getApplicationContext())  
                    .load(imgUrl)  
                    .circleCrop()  
                    .apply(new RequestOptions()  
                            .skipMemoryCache(true)  
                            .diskCacheStrategy(DiskCacheStrategy.NONE))  
                    .into(binding.ivUserProfileImage);  
  
            binding.btnAccept.setOnClickListener(v -> accept(friend));  
            binding.btnReject.setOnClickListener(v -> reject(friend));  
        }  
  
        public void accept(Friend friend) {  
            UserRelationApiClient.getInstance().acceptFriendRequest(friend).enqueue(new Callback<Void>() {  
                @Override  
                public void onResponse(Call<Void> call, Response<Void> response) {  
                    if (response.isSuccessful()) {  
                        Log.d(TAG, "onResponse: 친구 신청 수락 성공");  
                        Toast.makeText(context, "친구신청 수락 성공", Toast.LENGTH_SHORT).show();  
                        removeItem();  
                    } else {  
                        Log.d(TAG, "onResponse: 친구 신청 수락 에러");  
                        Toast.makeText(context, "친구신청 수락 에러", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<Void> call, Throwable throwable) {  
                    Log.e(TAG, "onFailure: 친구신청 수락 실패", throwable);  
                    Toast.makeText(context, "친구신청 수락 실패", Toast.LENGTH_SHORT).show();  
                }  
            });  
        }  
  
        public void reject(Friend friend) {  
            UserRelationApiClient.getInstance().rejectFriendRequest(friend).enqueue(new Callback<Void>() {  
                @Override  
                public void onResponse(Call<Void> call, Response<Void> response) {  
                    if (response.isSuccessful()) {  
                        Log.d(TAG, "onResponse: 친구 신청 거절 성공");  
                        Toast.makeText(context, "친구신청 거절 성공", Toast.LENGTH_SHORT).show();  
                        removeItem();  
                    } else {  
                        Log.d(TAG, "onResponse: 친구 신청 거절 에러");  
                        Toast.makeText(context, "친구신청 거절 에러", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<Void> call, Throwable throwable) {  
                    Log.e(TAG, "onFailure: 친구신청 거절 실패", throwable);  
                    Toast.makeText(context, "친구신청 거절 실패", Toast.LENGTH_SHORT).show();  
                }  
            });  
        }  
  
        public void removeItem() {  
            FriendRequestAdapter.this.removeItem(getBindingAdapterPosition());  
        }  
    }  
}  
  
  
  
</document_content>  
</document>  
<document index="150">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\InviteAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.content.Context;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.load.engine.DiskCacheStrategy;  
import com.bumptech.glide.request.RequestOptions;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.databinding.ItemUserSelectBinding;  
import com.teamnova.assa.ui.activity.SelectFriendsActivity;  
  
import java.util.ArrayList;  
import java.util.List;  
import java.util.stream.Collectors;  
  
/**  
 * 채팅방 초대시 친구를 선택할 수 있는 어댑터  
 */  
public class InviteAdapter extends RecyclerView.Adapter<InviteAdapter.FriendViewHolder> {  
  
    private static final String TAG = InviteAdapter.class.getSimpleName();  
    List<UserData> mData;  
    public List<UserData> selectList;  
    Context mContext;  
    SelectFriendsActivity selectFriendsActivity;  
  
    public InviteAdapter(Context context, List<UserData> data) {  
        mContext = context;  
        selectFriendsActivity = (SelectFriendsActivity) context;  
        mData = data;  
        selectList = new ArrayList<>();  
    }  
  
    @NonNull  
    @Override  
    public FriendViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_user_select, parent, false);  
        return new FriendViewHolder(view);  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull FriendViewHolder holder, int position) {  
        holder.bind(mData.get(position));  
  
    }  
  
    @Override  
    public int getItemCount() {  
        if (mData == null) return 0;  
        return mData.size();  
    }  
  
    class FriendViewHolder extends RecyclerView.ViewHolder {  
  
        ItemUserSelectBinding binding;  
  
        public FriendViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemUserSelectBinding.bind(itemView);  
        }  
  
        public void bind(UserData data) {  
            binding.tvUserNickname.setText(data.nickname);  
  
            // 프로필 이미지 출력  
            Glide.with(mContext)  
                    .load(data.profileImage)  
                    .circleCrop()  
                    .apply(new RequestOptions()  
                            .skipMemoryCache(true)  
                            .diskCacheStrategy(DiskCacheStrategy.NONE))  
                    .into(binding.ivUserProfileImage);  
  
            // 체크상태 기억  
            if(selectList.contains(data)){  
                binding.rbSelect.setChecked(true);  
            } else {  
                binding.rbSelect.setChecked(false);  
            }  
  
            // 터치시 라디오 버튼 토글, 체크되면 초대 리스트에 포함  
            binding.llFriendsSelect.setOnClickListener((v) -> {  
                Log.d(TAG, "bind: 변경전 선택 리스트" + selectList.stream().map(u -> u.id).collect(Collectors.toList()));  
  
                if(selectList.contains(data)){ // 이미 선택되어 있으면  
                    selectList.remove(data);  
                    binding.rbSelect.setChecked(false);  
                } else {    // 선택 안 된 상태 라면  
                    selectList.add(data);  
                    binding.rbSelect.setChecked(true);  
                }  
                Log.d(TAG, "bind: 변경후 선택 리스트" + selectList.stream().map(u -> u.id).collect(Collectors.toList()));  
            });  
  
            binding.rbSelect.setOnClickListener((v) -> {  
                Log.d(TAG, "bind: 변경전 선택 리스트" + selectList.stream().map(u -> u.id).collect(Collectors.toList()));  
  
                if(selectList.contains(data)){ // 이미 선택되어 있으면  
                    selectList.remove(data);  
                    binding.rbSelect.setChecked(false);  
                } else {    // 선택 안 된 상태 라면  
                    selectList.add(data);  
                    binding.rbSelect.setChecked(true);  
                }  
                Log.d(TAG, "bind: 변경후 선택 리스트" + selectList.stream().map(u -> u.id).collect(Collectors.toList()));  
            });  
  
        }  
  
  
    }  
  
}  
  
</document_content>  
</document>  
<document index="151">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\MessageAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.content.Context;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.google.gson.Gson;  
import com.google.gson.reflect.TypeToken;  
import com.teamnova.assa.command.SendMessageCommand;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.databinding.ItemChatReceivedBinding;  
import com.teamnova.assa.databinding.ItemChatSentBinding;  
import com.teamnova.assa.databinding.ItemChatServerBinding;  
import com.teamnova.assa.databinding.ItemImageReceivedBinding;  
import com.teamnova.assa.databinding.ItemImageSentBinding;  
import com.teamnova.assa.databinding.ItemVideoRoomReceivedBinding;  
import com.teamnova.assa.databinding.ItemVideoRoomSentBinding;  
import com.teamnova.assa.ui.activity.ChatRoomActivity;  
import com.teamnova.assa.ui.fragment.VideoRoomParticipantBottomSheet;  
import com.teamnova.assa.util.DBHelper;  
import com.teamnova.assa.util.TimeUtils;  
  
import java.lang.reflect.Type;  
import java.text.ParseException;  
import java.text.SimpleDateFormat;  
import java.util.ArrayList;  
import java.util.Arrays;  
import java.util.Date;  
import java.util.List;  
import java.util.Locale;  
import java.util.TimeZone;  
  
/**  
 * 채팅방 메시지 출력용 어댑터  
 */  
public class MessageAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder> {  
  
    static final String TAG = MessageAdapter.class.getSimpleName();  
  
    long userId;  
    private List<SendMessageCommand> messageList;  
    Context context;  
    long roomId;  
  
    // 메시지 타입 상수  
    static final int VIEW_TYPE_MESSAGE_SERVER = 0;  
    static final int VIEW_TYPE_MESSAGE_SENT = 1;  
    static final int VIEW_TYPE_MESSAGE_RECEIVED = 2;  
    static final int VIEW_TYPE_IMAGE_SENT = 3;  
    static final int VIEW_TYPE_IMAGE_RECEIVED = 4;  
    static final int VIEW_TYPE_VIDEO_ROOM_SENT = 5;  
    static final int VIEW_TYPE_VIDEO_ROOM_RECEIVED = 6;  
    // static final int VIEW_TYPE_VIDEO_ROOM_CLOSE_SENT = 7;  
    // static final int VIEW_TYPE_VIDEO_ROOM_CLOSE_RECEIVED = 8;  
  
    DBHelper dbHelper;  
  
    SimpleDateFormat utcFormat;  
    SimpleDateFormat localFormat;  
  
    public MessageAdapter(Context context, List<SendMessageCommand> messageList, long roomId) {  
        Log.i(TAG, "MessageAdapter: START - params : messageList size = " + messageList.size());  
        this.messageList = messageList;  
        this.context = context;  
        this.roomId = roomId;  
        userId = SPHelper.getUserId();  
  
        // 로컬 db 연결  
        dbHelper = new DBHelper(context);  
  
        // 변환할 문자열 세팅  
        utcFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm", Locale.getDefault());  
        utcFormat.setTimeZone(TimeZone.getTimeZone("UTC"));  
  
        // 출력할 문자열 포맷 세팅  
        localFormat = new SimpleDateFormat("yyyy년 MM월 dd일 E요일", Locale.KOREA);  
        localFormat.setTimeZone(TimeZone.getDefault());  
    }  
  
    /**  
     * 메시지 리스트를 순회하며 각 메시지의 날짜와 시간을 표시  
     */  
    private void processMessages() {  
        Log.i(TAG, "processMessages: START - 메시지 처리 시작");  
  
        String lastDate = null;  
        String lastTime = null;  
        Long lastUserId = null;  
        String lastDateKor = null;  
  
        Log.d(TAG, "processMessages: 메시지 개수 : " + messageList.size());  
  
        for (int i = 0; i < messageList.size(); i++) {  
            SendMessageCommand currentMessage = messageList.get(i);  
  
            if(currentMessage.requesterId == 0L && currentMessage.content.contains("DATE:")){  
                return;  
            }  
  
            String createdAt = currentMessage.createdAT;  
            String formattedCreatedAt = createdAt.substring(0, 16); // :ss 제거  
  
            String createdDate = createdAt.substring(0, 10);  
            String createDateKor;  
            try {  
                createDateKor = localFormat.format(utcFormat.parse(createdAt));  
            } catch (ParseException e) {  
                throw new RuntimeException(e);  
            }  
  
            if (currentMessage.requesterId == 0L) {  
                continue;  
            }  
  
            // 날짜가 변경되면 이전 날짜 메시지 삽입  
            if (lastDateKor != null && !createDateKor.equals(lastDateKor)) {  
                insertDateMessage(i, lastDateKor);  
                lastDateKor = null;  
                continue;  
            }  
  
            // 현재 메시지 시간, 이전 메시지 시간을 분 까지만 남기기  
            String formattedLastTime = lastTime == null ? "" : lastTime.substring(0, 16);  
  
            // 날짜 출력 판단  
            // 이전 인덱스와 작성자가 동일하고 시간이 동일하면 날짜 숨김  
            boolean isSameUser = currentMessage.requesterId == lastUserId;  
            boolean isSameTime = formattedCreatedAt.equals(formattedLastTime);  
  
            if (isSameUser && isSameTime) {  
                currentMessage.isTimeShow = false;  
            } else {  
                currentMessage.isTimeShow = true;  
            }  
  
            // 프로필 이미지, 닉네임 출력 판단  
  
            // 다음 인덱스가 존재하는지 확인  
            if (i < messageList.size() - 1) {  
                // 다음 인덱스와 작성자가 동일하고 시간이 동일하면 이미지, 닉네임 숨김  
                boolean isNextSameUser = messageList.get(i + 1).requesterId == currentMessage.requesterId;  
                boolean isNextSameTime = messageList.get(i + 1).createdAT.substring(0, 16).equals(formattedCreatedAt);  
  
                if (isNextSameUser && isNextSameTime) {  
                    messageList.get(i).isProfileShow = false;  
                } else {  
                    messageList.get(i).isProfileShow = true;  
                }  
            } else {  
                messageList.get(i).isProfileShow = true;  
            }  
  
            Date date;  
            // UTC 시간을 로컬 날짜로 변환  
            try {  
                date = utcFormat.parse(createdAt);  
            } catch (ParseException e) {  
                Log.e(TAG, "날짜 변환 오류", e);  
                continue;  
            }  
  
            lastDate = createdDate;  
            lastDateKor = localFormat.format(date);  
            lastTime = createdAt;  
            lastUserId = currentMessage.requesterId;  
  
            Log.d(TAG, "processMessages: 인덱스 = " + i +  
                    ", 내용 = " + currentMessage.content +  
                    ", 날짜시간 = " + currentMessage.createdAT +  
                    ", 시간표시 = " + currentMessage.isTimeShow +  
                    ", 프로필표시 = " + currentMessage.isProfileShow);  
        }  
  
        // 채팅기록 최상단에 최초의 날짜 메시지 삽입  
        Log.d(TAG, "processMessages: 최상단 최초 날짜 메시지");  
        insertDateMessage(getItemCount(), lastDateKor);  
    }  
  
    /**  
     * 날짜 메시지 삽입  
     *  
     * @param index 삽입할 인덱스  
     * @param date  날짜  
     */  
    private void insertDateMessage(int index, String date) {  
//        if(date == null){  
//            Date now = new Date();  
//            date = localFormat.format(now);  
//        }  
  
        SendMessageCommand smc = new SendMessageCommand(roomId, "DATE:" + date, SendMessageCommand.Type.TEXT);  
        smc.requesterId = 0L; // 서버 메시지임을 표시  
        this.messageList.add(index, smc);  
        Log.i(TAG, "insertDateMessage: 날짜 메시지 삽입 - " + date);  
    }  
  
    /**  
     * 메시지 리스트에 새로운 메시지 추가  
     *  
     * @param newMessages 새로운 메시지 리스트  
     */  
    public void addAll(List<SendMessageCommand> newMessages) {  
        Log.i(TAG, "addAll: START");  
        this.messageList.addAll(newMessages);  
        processMessages();  
        notifyDataSetChanged();  
        Log.i(TAG, "addAll: END");  
    }  
  
    /**  
     * 메시지 리스트에 새로운 메시지 추가  
     *  
     * @param index   삽입할 인덱스  
     * @param message 새로운 메시지  
     */  
    public void add(int index, SendMessageCommand message) {  
        Log.i(TAG, "add: START");  
        this.messageList.add(index, message);  
        processMessages();  
        notifyDataSetChanged();  
        Log.i(TAG, "add: END");  
    }  
  
    @Override  
    public int getItemViewType(int position) {  
        int reversePos = getItemCount() - 1 - position;  
        SendMessageCommand message = messageList.get(reversePos);  
        Log.d(TAG, "getItemViewType: 메시지 보낸 사람 id = " + message.requesterId);  
        Log.d(TAG, "getItemViewType: 메시지 타입 = " + message.type.toString());  
  
        // 서버 메시지  
        if (message.requesterId == 0) {  
            return VIEW_TYPE_MESSAGE_SERVER;  
        }  
  
        // 내가 보낸 메시지  
        if (message.requesterId == userId) {  
            if (message.type == SendMessageCommand.Type.TEXT)  
                return VIEW_TYPE_MESSAGE_SENT;  
            if (message.type == SendMessageCommand.Type.IMAGE)  
                return VIEW_TYPE_IMAGE_SENT;  
            if (message.type == SendMessageCommand.Type.VIDEO_ROOM_OPEN)  
                return VIEW_TYPE_VIDEO_ROOM_SENT;  
            if (message.type == SendMessageCommand.Type.VIDEO_ROOM_CLOSE)  
                return VIEW_TYPE_VIDEO_ROOM_SENT;  
        }  
  
        // 내가 받은 메시지  
        if (message.type == SendMessageCommand.Type.TEXT)  
            return VIEW_TYPE_MESSAGE_RECEIVED;  
        if (message.type == SendMessageCommand.Type.IMAGE)  
            return VIEW_TYPE_IMAGE_RECEIVED;  
        if (message.type == SendMessageCommand.Type.VIDEO_ROOM_OPEN)  
            return VIEW_TYPE_VIDEO_ROOM_RECEIVED;  
        if (message.type == SendMessageCommand.Type.VIDEO_ROOM_CLOSE)  
            return VIEW_TYPE_VIDEO_ROOM_RECEIVED;  
        return -1;  
    }  
  
    @NonNull  
    @Override  
    public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view;  
  
        switch (viewType) {  
            case VIEW_TYPE_MESSAGE_SERVER:  
                view = ItemChatServerBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false).getRoot();  
                return new ServerMessageHolder(view);  
            case VIEW_TYPE_MESSAGE_SENT:  
                view = ItemChatSentBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false).getRoot();  
                return new SentMessageHolder(view);  
            case VIEW_TYPE_MESSAGE_RECEIVED:  
                view = ItemChatReceivedBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false)  
                        .getRoot();  
                return new ReceivedMessageHolder(view);  
            case VIEW_TYPE_IMAGE_SENT:  
                view = ItemImageSentBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false).getRoot();  
                return new SentImageHolder(view);  
            case VIEW_TYPE_IMAGE_RECEIVED:  
                view = ItemImageReceivedBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false)  
                        .getRoot();  
                return new ReceivedImageHolder(view);  
            case VIEW_TYPE_VIDEO_ROOM_SENT:  
                view = ItemVideoRoomSentBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false)  
                        .getRoot();  
                return new SentVideoRoomHolder(view);  
            case VIEW_TYPE_VIDEO_ROOM_RECEIVED:  
                view = ItemVideoRoomReceivedBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false)  
                        .getRoot();  
                return new ReceivedVideoRoomHolder(view);  
        }  
  
        return null;  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position) {  
        int reversePos = getItemCount() - 1 - position;  
        SendMessageCommand message = messageList.get(reversePos);  
        int viewType = holder.getItemViewType();  
  
        switch (viewType) {  
            case VIEW_TYPE_MESSAGE_SERVER:  
                ((ServerMessageHolder) holder).bind(message);  
                break;  
            case VIEW_TYPE_MESSAGE_SENT:  
                ((SentMessageHolder) holder).bind(message);  
                break;  
            case VIEW_TYPE_MESSAGE_RECEIVED:  
                ((ReceivedMessageHolder) holder).bind(message);  
                break;  
            case VIEW_TYPE_IMAGE_SENT:  
                ((SentImageHolder) holder).bind(message);  
                break;  
            case VIEW_TYPE_IMAGE_RECEIVED:  
                ((ReceivedImageHolder) holder).bind(message);  
                break;  
            case VIEW_TYPE_VIDEO_ROOM_SENT:  
                ((SentVideoRoomHolder) holder).bind(message);  
                break;  
            case VIEW_TYPE_VIDEO_ROOM_RECEIVED:  
                ((ReceivedVideoRoomHolder) holder).bind(message);  
                break;  
        }  
    }  
  
    @Override  
    public int getItemCount() {  
        if (messageList == null)  
            return 0;  
        return messageList.size();  
    }  
  
    // 서버 메시지 뷰 홀더  
    class ServerMessageHolder extends RecyclerView.ViewHolder {  
        ItemChatServerBinding binding;  
  
        public ServerMessageHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemChatServerBinding.bind(itemView);  
        }  
  
        void bind(SendMessageCommand command) {  
            Log.d(TAG, "bind: START - 서버 메시지 뷰 홀더");  
  
            String realMessage;  
            Log.d(TAG, "bind: command : " + command);  
            realMessage = generateServerMessage(command);  
  
            binding.tvMessageServer.setText(realMessage);  
  
            Log.d(TAG, "bind: END - 서버 메시지 뷰 홀더");  
        }  
  
        private @NonNull String generateServerMessage(SendMessageCommand command) {  
            StringBuilder sb = new StringBuilder();  
            String realMessage = command.content;  
  
            // 멤버가 타인을 초대한 것을 알리는 메시지 출력  
            if (realMessage.contains("INVITE:")) {  
                Log.i(TAG, "bind: 초대 메시지 생성");  
                String[] splitMessage = command.content.split(":", 3);  
                Log.d(TAG, "bind: splitMessage = " + splitMessage);  
  
                // 초대자 id  
                Long requesterId = Long.parseLong(splitMessage[1]);  
                SimpleUser requester = dbHelper.getUserById(requesterId);  
  
                // 피 초대자 목록  
                Type listType = new TypeToken<List<Long>>() {  
                }.getType();  
                List<Long> invitedIdList = new Gson().fromJson(splitMessage[2], listType);  
                List<SimpleUser> invitedList = new ArrayList<>();  
                for (Long uId : invitedIdList) {  
                    SimpleUser user = dbHelper.getUserById(uId);  
                    invitedList.add(user);  
                }  
  
                // 메시지 생성  
                // ex : 00 님이 00님, 00님과 00님을 초대했습니다.  
                sb.append(requester.nickname).append(" 님이 ");  
                for (int i = 0; i < invitedList.size() - 1; i++) {  
                    sb.append(invitedList.get(i).nickname).append("님, ");  
                }  
                sb.append(invitedList.get(invitedList.size() - 1).nickname).append("님을 초대했습니다.");  
  
                return sb.toString();  
            }  
  
            // 멤버가 채팅방을 입장했음을 알리는 메시지 출력 (오픈채팅)  
            if (realMessage.contains("ENTER:")) {  
                Log.i(TAG, "generateServerMessage: 멤버 입장 메시지 생성");  
                String[] splitMessage = command.content.split(":", 2);  
                Log.d(TAG, "generateServerMessage: splitMessage = " + Arrays.toString(splitMessage));  
  
                // 입장자 id  
                Long requesterId = Long.parseLong(splitMessage[1]);  
                SimpleUser requester = dbHelper.getUserById(requesterId);  
  
                // 메시지 생성  
                // ex : 00 님이 입장했습니다.  
                sb.append(requester.nickname).append(" 님이 입장했습니다.");  
  
                return sb.toString();  
            }  
  
            // 멤버가 채팅방을 나갔음을 알리는 메시지 출력  
            if (realMessage.contains("EXIT:")) {  
                Log.i(TAG, "bind: 퇴장 메시지 생성");  
                String[] splitMessage = command.content.split(":", 2);  
                Log.d(TAG, "bind: splitMessage = " + splitMessage);  
  
                // 퇴장자 id  
                Long requesterId = Long.parseLong(splitMessage[1]);  
                SimpleUser requester = dbHelper.getUserById(requesterId);  
  
                // 메시지 생성  
                // ex : 00 님이 퇴장했습니다.  
                sb.append(requester.nickname).append(" 님이 퇴장했습니다.");  
  
                return sb.toString();  
            }  
  
            // 날짜 메시지 출력  
            if (realMessage.contains("DATE:")) {  
                Log.i(TAG, "bind: 날짜 메시지 생성");  
                String[] splitMessage = command.content.split(":", 2);  
                Log.d(TAG, "bind: splitMessage = " + splitMessage);  
                return splitMessage[1];  
            }  
  
            return realMessage;  
        }  
    }  
  
    // 내가 보낸 메시지 뷰 홀더  
    class SentMessageHolder extends RecyclerView.ViewHolder {  
        ItemChatSentBinding binding;  
  
        public SentMessageHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemChatSentBinding.bind(itemView);  
        }  
  
        void bind(SendMessageCommand message) {  
            binding.tvMessageSent.setText(message.content);  
  
            // 메시지 전송시간을 클라이언트 시간대로 변환  
            if (message.isTimeShow) {  
                String localtime = TimeUtils.convertUTCToLocalTimeMin(message.createdAT);  
                binding.tvDatetimeSent.setText(localtime);  
                binding.tvDatetimeSent.setVisibility(View.VISIBLE);  
            } else {  
                binding.tvDatetimeSent.setVisibility(View.GONE);  
            }  
  
        }  
    }  
  
    // 내가 받은 메시지 뷰 홀더  
    class ReceivedMessageHolder extends RecyclerView.ViewHolder {  
        ItemChatReceivedBinding binding;  
  
        public ReceivedMessageHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemChatReceivedBinding.bind(itemView);  
        }  
  
        void bind(SendMessageCommand message) {  
  
            SimpleUser sender = dbHelper.getUserById(message.requesterId);  
  
            // 프사 출력  
            Glide.with(context)  
                    .asBitmap()  
                    .load(sender.profileImage)  
                    .circleCrop()  
                    .into(binding.ivProfileReceived);  
  
            // 메시지 닉네임표시  
            binding.tvMessageReceived.setText(message.content);  
            binding.tvSenderNicknameReceived.setText(sender.nickname);  
  
            // 프사 표시 여부  
            if (message.isProfileShow) {  
                binding.ivProfileReceived.setVisibility(View.VISIBLE);  
                binding.tvSenderNicknameReceived.setVisibility(View.VISIBLE);  
            } else {  
                binding.ivProfileReceived.setVisibility(View.INVISIBLE);  
                binding.tvSenderNicknameReceived.setVisibility(View.GONE);  
            }  
  
            // 시간 표시 여부  
            if (message.isTimeShow) {  
                String localtime = TimeUtils.convertUTCToLocalTimeMin(message.createdAT);  
                binding.tvDatetimeReceived.setText(localtime);  
                binding.tvDatetimeReceived.setVisibility(View.VISIBLE);  
            } else {  
                binding.tvDatetimeReceived.setVisibility(View.GONE);  
            }  
  
        }  
    }  
  
    // 내가 보낸 이미지 메시지 뷰 홀더  
    class SentImageHolder extends RecyclerView.ViewHolder {  
        ItemImageSentBinding binding;  
  
        public SentImageHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemImageSentBinding.bind(itemView);  
        }  
  
        void bind(SendMessageCommand message) {  
            Log.d(TAG, "bind: 내가 보낸 이미지 : " + message.content);  
  
            // 이미지 출력  
            Glide.with(context)  
                    .load(message.content)  
                    .into(binding.ivImageSent);  
            binding.ivImageSent.setAdjustViewBounds(true);  
  
            // 메시지 전송시간을 클라이언트 시간대로 변환  
  
            // 시간 표시  
            if (message.isTimeShow) {  
                String localtime = TimeUtils.convertUTCToLocalTimeMin(message.createdAT);  
                binding.tvDatetimeSent.setText(localtime);  
                binding.tvDatetimeSent.setVisibility(View.VISIBLE);  
            } else {  
                binding.tvDatetimeSent.setVisibility(View.GONE);  
            }  
        }  
    }  
  
    // 내가 받은 이미지 뷰 홀더  
    class ReceivedImageHolder extends RecyclerView.ViewHolder {  
        ItemImageReceivedBinding binding;  
  
        public ReceivedImageHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemImageReceivedBinding.bind(itemView);  
        }  
  
        void bind(SendMessageCommand message) {  
            Log.d(TAG, "bind: 내가 받은 이미지 : " + message.content);  
  
            SimpleUser sender = dbHelper.getUserById(message.requesterId);  
  
            // 이미지 출력  
            Glide.with(context)  
                    .load(message.content)  
                    .into(binding.ivImageReceived);  
            binding.ivImageReceived.setAdjustViewBounds(true);  
  
            // 프사 출력  
            Glide.with(context)  
                    .asBitmap()  
                    .load(sender.profileImage)  
                    .circleCrop()  
                    .into(binding.ivProfileReceived);  
  
            // 닉네임표시  
            binding.tvSenderNicknameReceived.setText(sender.nickname);  
  
            // 프사 표시 여부  
            if (message.isProfileShow) {  
                binding.ivProfileReceived.setVisibility(View.VISIBLE);  
                binding.tvSenderNicknameReceived.setVisibility(View.VISIBLE);  
            } else {  
                binding.ivProfileReceived.setVisibility(View.INVISIBLE);  
                binding.tvSenderNicknameReceived.setVisibility(View.GONE);  
            }  
  
            // 시간 표시 여부  
            if (message.isTimeShow) {  
                String localtime = TimeUtils.convertUTCToLocalTimeMin(message.createdAT);  
                binding.tvDatetimeReceived.setText(localtime);  
                binding.tvDatetimeReceived.setVisibility(View.VISIBLE);  
            } else {  
                binding.tvDatetimeReceived.setVisibility(View.GONE);  
            }  
        }  
    }  
  
    // 내가 보낸 영상통화 뷰 홀더  
    class SentVideoRoomHolder extends RecyclerView.ViewHolder {  
        ItemVideoRoomSentBinding binding;  
  
        public SentVideoRoomHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemVideoRoomSentBinding.bind(itemView);  
        }  
  
        void bind(SendMessageCommand message) {  
  
            if (message.type == SendMessageCommand.Type.VIDEO_ROOM_OPEN) {  
                binding.tvVideoRoomSent.setText("영상회의");  
            } else {  
                binding.tvVideoRoomSent.setText("영상회의 종료");  
            }  
            binding.llMessageContainerSent.setOnClickListener(v -> {  
                Toast.makeText(context, "회의가 종료되었습니다.", Toast.LENGTH_SHORT).show();  
            });  
  
            // 시간 표시  
            if (message.isTimeShow) {  
                String localtime = TimeUtils.convertUTCToLocalTimeMin(message.createdAT);  
                binding.tvDatetimeSent.setText(localtime);  
                binding.tvDatetimeSent.setVisibility(View.VISIBLE);  
            } else {  
                binding.tvDatetimeSent.setVisibility(View.GONE);  
            }  
        }  
    }  
  
    // 내가 받은 영상통화 뷰 홀더  
    class ReceivedVideoRoomHolder extends RecyclerView.ViewHolder {  
  
        ItemVideoRoomReceivedBinding binding;  
  
        public ReceivedVideoRoomHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemVideoRoomReceivedBinding.bind(itemView);  
        }  
  
        void bind(SendMessageCommand message) {  
            SimpleUser sender = dbHelper.getUserById(message.requesterId);  
  
            // 영상회의 개설 메시지  
            if (message.type == SendMessageCommand.Type.VIDEO_ROOM_OPEN) {  
                binding.tvVideoRoomReceived.setText("영상회의");  
                binding.llEnterVideoRoomReceived.setOnClickListener(v -> {  
                    Log.d(TAG, "bind: 영상회의 클릭");  
//                    Toast.makeText(context, "영상회의 클릭 " + message.content, Toast.LENGTH_SHORT).show();  
  
//                    // 영상회의 화면으로 이동  
//                    Intent videoRoomIntent = new Intent(context, VideoCallActivity.class);  
//                    videoRoomIntent.putExtra("roomId", ChatRoomActivity.roomId);  
//                    videoRoomIntent.putExtra("isHost", false);  
//                    videoRoomIntent.putExtra("videoRoomId", message.content);  
//                    context.startActivity(videoRoomIntent);  
  
                    // 바텀 시트 다이얼로그 출력  
                    VideoRoomParticipantBottomSheet dialog = new VideoRoomParticipantBottomSheet(context);  
                    Bundle args = new Bundle();  
                    args.putLong("roomId", ChatRoomActivity.roomId);  
                    args.putBoolean("isHost", false);  
                    args.putString("videoRoomId", message.content);  
                    dialog.setArguments(args);  
                    dialog.show(((AppCompatActivity) context).getSupportFragmentManager(), VideoRoomParticipantBottomSheet.TAG);  
  
                });  
            } else {  
                Log.d(TAG, "bind: 회의 종료 메시지 출력");  
                // 영상 회의 종료 메시지  
                binding.tvVideoRoomReceived.setText("영상회의 종료");  
                // Toast.makeText(context, "회의가 종료되었습니다.", Toast.LENGTH_SHORT).show();  
  
                // 기존의 회의 개설 메시지는 터치해도 이동하지 않도록 처리  
                for (SendMessageCommand command : messageList) {  
                    // 과거 회의 열림 메시지 중에 회의 종료 메시지와 대상이 동일한 메시지  
                    if (SendMessageCommand.Type.VIDEO_ROOM_OPEN == command.type  
                            && command.content.equals(message.content)) {  
                        command.content = command.content + " end";  
                        // 레이아웃 계산 후 데이터 업데이트  
                        ((ChatRoomActivity) context).binding.rvChat.post(() -> notifyDataSetChanged());  
                        break;  
                    }  
                }  
  
            }  
  
            // 메시지 content에 end가 껴있으면 끝난 회의라는 토스트 메시지를 출력한다.  
            if (message.content.contains("end")) {  
                binding.llEnterVideoRoomReceived.setOnClickListener(v -> {  
                    Toast.makeText(context, "회의가 종료되었습니다.", Toast.LENGTH_SHORT).show();  
                });  
            }  
  
            // 프사 출력  
            Glide.with(context)  
                    .asBitmap()  
                    .load(sender.profileImage)  
                    .circleCrop()  
                    .into(binding.ivProfileReceived);  
  
            // 닉네임표시  
            binding.tvSenderNicknameReceived.setText(sender.nickname);  
  
            // 프사 표시 여부  
            if (message.isProfileShow) {  
                binding.ivProfileReceived.setVisibility(View.VISIBLE);  
                binding.tvSenderNicknameReceived.setVisibility(View.VISIBLE);  
            } else {  
                binding.ivProfileReceived.setVisibility(View.INVISIBLE);  
                binding.tvSenderNicknameReceived.setVisibility(View.GONE);  
            }  
  
            // 시간 표시 여부  
            if (message.isTimeShow) {  
                String localtime = TimeUtils.convertUTCToLocalTimeMin(message.createdAT);  
                binding.tvDatetimeReceived.setText(localtime);  
                binding.tvDatetimeReceived.setVisibility(View.VISIBLE);  
            } else {  
                binding.tvDatetimeReceived.setVisibility(View.GONE);  
            }  
        }  
    }  
  
}  
</document_content>  
</document>  
<document index="152">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\OpenChatSearchResultAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.app.Activity;  
import android.content.Context;  
import android.content.Intent;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.app.AlertDialog;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.databinding.ItemChatroomSearchBinding;  
import com.teamnova.assa.ui.activity.ChatRoomActivity;  
import com.teamnova.assa.util.DBHelper;  
  
import java.util.ArrayList;  
import java.util.List;  
  
public class OpenChatSearchResultAdapter extends RecyclerView.Adapter<OpenChatSearchResultAdapter.ChatroomViewHolder> {  
    private static final String TAG = OpenChatSearchResultAdapter.class.getSimpleName();  
    DBHelper dbHelper;  
    List<ChatRoom> itemList;  
    Context context;  // glide 사용시 컨텍스트 할당에 필요함  
  
    public OpenChatSearchResultAdapter(List<ChatRoom> itemList, Activity activity) {  
        if (itemList == null) itemList = new ArrayList<>();  
        this.itemList = itemList;  
        this.context = activity; // 액티비티에서 컨텍스트 얻어야 에러 발생 안 함  
        dbHelper = GlobalApplication.dbHelper;  
    }  
  
    public void addItem(ChatRoom item) {  
        itemList.add(item);  
        notifyItemInserted(itemList.size() - 1);  
        Log.d(TAG, "addItem: " + (itemList.size() - 1) + " 인덱스에 아이템 추가");  
    }  
  
    public void setItems(List<ChatRoom> itemList) {  
        this.itemList = itemList;  
        notifyDataSetChanged();  
        Log.d(TAG, "setItems: " + itemList.size() + " 개의 아이템 set");  
    }  
  
    @NonNull  
    @Override  
    public ChatroomViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        return new ChatroomViewHolder(ItemChatroomSearchBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false));  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull ChatroomViewHolder holder, int position) {  
        holder.bind(itemList.get(position));  
    }  
  
    @Override  
    public int getItemCount() {  
        if (itemList == null) return 0;  
        return itemList.size();  
    }  
  
    class ChatroomViewHolder extends RecyclerView.ViewHolder {  
        final String TAG = ChatroomViewHolder.class.getSimpleName();  
        ItemChatroomSearchBinding binding;  
  
        public ChatroomViewHolder(ItemChatroomSearchBinding binding) {  
            super(binding.getRoot());  
            this.binding = binding;  
        }  
  
        public void bind(ChatRoom chatRoom) {  
            Log.i(TAG, "bind: START chatRoom =" + chatRoom);  
            String roomName = chatRoom.getRoomName();  
            String description = chatRoom.description;  
            int memberCount = chatRoom.memberCount;  
  
            binding.tvChatRoomSearchRoomName.setText(roomName);  
            binding.tvChatRoomSearchDiscription.setText(description);  
            binding.tvChatRoomSearchMemberCount.setText(String.valueOf(memberCount) + "명");  
  
            Glide.with(context).load(R.drawable.all_logo_assa).into(binding.ivChatroomImage);  
  
            // 클릭 시 이동 확인 다이얼로그  
            binding.getRoot().setOnClickListener(v -> {  
                Log.i(TAG, "bind: 오픈 채팅 진입 버튼 클릭");  
  
                // 만약 이미 입장된(로컬에 데이터가 있는) 채팅방을 선택한경우 해당 채팅방으로 바로 이동  
                ChatRoom foundRoom = dbHelper.getChatRoomInfo(chatRoom.id);  
                if (foundRoom != null) {  
                    Log.i(TAG, "bind: 선택한 채팅방 (" + foundRoom.id + ")이 이미 로컬에 존재함");  
                    Intent intent = new Intent(context, ChatRoomActivity.class);  
                    intent.putExtra("roomId", chatRoom.id);  
                    intent.putExtra("isOpenChat", true);  
                    context.startActivity(intent);  
                    return;  
                }  
  
                new AlertDialog.Builder(context)  
                        .setTitle("오픈채팅 입장")  
                        .setMessage("선택한 오픈채팅방에 입장 하시겠습니까?")  
                        .setPositiveButton("예", (dialog, which) -> {  
                            Log.d(TAG, "showExitDialog: 예 클릭");  
                            Intent intent = new Intent(context, ChatRoomActivity.class);  
                            intent.putExtra("roomId", chatRoom.id);  
                            intent.putExtra("isOpenChat", true);  
                            intent.putExtra("isNewMember", true); // 입장 알림  
                            context.startActivity(intent);  
                            dialog.dismiss();  
                        })  
                        .setNegativeButton("아니오", (dialog, which) -> {  
                            Log.d(TAG, "showExitDialog: 이니오 클릭");  
                            dialog.dismiss();  
                        })  
                        .show();  
            });  
  
            Log.i(TAG, "bind: END");  
        }  
    }  
}  
  
</document_content>  
</document>  
<document index="153">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\ParticipantAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.app.Activity;  
import android.content.Context;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.load.engine.DiskCacheStrategy;  
import com.bumptech.glide.request.RequestOptions;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.databinding.ItemUserBinding;  
  
import java.util.List;  
  
public class ParticipantAdapter extends RecyclerView.Adapter<ParticipantAdapter.ViewHolder> {  
  
    private static final String TAG = "UserPreviewAdapter";  
    private List<SimpleUser> userDataList;  
    private static Context context;  
  
    public ParticipantAdapter(Activity context) {  
        ParticipantAdapter.context = context;  
    }  
  
    public void setItems(List<SimpleUser> userData) {  
        this.userDataList = userData;  
        notifyDataSetChanged();  
    }  
  
    @NonNull  
    @Override  
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_user, parent, false);  
        return new ViewHolder(view);  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {  
        holder.bind(this.userDataList.get(position));  
    }  
  
    @Override  
    public int getItemCount() {  
        return this.userDataList != null ? userDataList.size() : 0;  
    }  
  
    public static class ViewHolder extends RecyclerView.ViewHolder {  
        ItemUserBinding binding;  
  
        public ViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemUserBinding.bind(itemView);  
  
        }  
  
        public void bind(SimpleUser userData) {  
            // 프로필 클릭시 이동  
//            binding.getRoot().setOnClickListener(v -> StartActivityUtils.moveToProfile(context, userData.id));  
  
            // 닉네임 출력  
            binding.tvUserNickname.setText(userData.nickname);  
  
            // 프로필 이미지 경로 생성  
            String imgUrl = userData.profileImage;  
  
            // 프로필 이미지 출력  
            Glide.with(context.getApplicationContext())  
                    .load(imgUrl)  
                    .circleCrop()  
                    .apply(new RequestOptions()  
                            .skipMemoryCache(true)  
                            .diskCacheStrategy(DiskCacheStrategy.NONE))  
                    .into(binding.ivUserProfileImage);  
  
        }  
  
    }  
}  
  
  
  
</document_content>  
</document>  
<document index="154">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\PostAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.content.Context;  
import android.content.Intent;  
import android.graphics.drawable.Drawable;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.appcompat.widget.AppCompatButton;  
import androidx.core.content.ContextCompat;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.helper.PostHelper;  
import com.teamnova.assa.databinding.PostItemBinding;  
import com.teamnova.assa.ui.activity.PostDetailActivity;  
import com.teamnova.assa.util.StartActivityUtils;  
  
import java.util.ArrayList;  
  
/**  
 * 게시물 리사이클러 뷰 아답터  
 */  
public class PostAdapter extends RecyclerView.Adapter<PostAdapter.ViewHolder> {  
  
    private static final String TAG = "PostAdapter";  
    ArrayList<Post> items;  
  
    public static Context context;  
    public PostAdapter(Context context, ArrayList<Post> items) {  
        PostAdapter.context = context;  
        this.items = items;  
    }  
  
    public PostAdapter(Context context) {  
        PostAdapter.context = context;  
    }  
  
    @NonNull  
    @Override  
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        // 뷰 홀더 생성  
  
        // 뷰 홀더에 뷰 객체 제공  
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.post_item, parent, false);  
  
        return new ViewHolder(view);  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {  
        // 뷰 홀더에서 데이터를 매칭하는 메소드를 구현함  
        holder.bindItem(items.get(position));  
  
        holder.itemView.setOnClickListener(v -> {  
            // 해당 게시물의 상세조회 화면으로 이동  
            Intent intent = new Intent(context, PostDetailActivity.class);  
            intent.putExtra("postId", items.get(position).getId());  
            context.startActivity(intent);  
        });  
  
    }  
  
    public void setItems(ArrayList<Post> items) {  
        this.items = items;  
        notifyDataSetChanged();  
    }  
  
    // item 제거  
    public void remove(int position) {  
        items.remove(position);         // 데이터 제거  
        notifyItemRemoved(position);    // 출력 새로고침  
    }  
  
    @Override  
    public int getItemCount() {  
        return (items != null) ? items.size() : 0;  
    }  
  
  
  
    public static class ViewHolder extends RecyclerView.ViewHolder {  
        PostItemBinding binding;  
  
        public ViewHolder(@NonNull View itemView) {  
            super(itemView);  
            // 기존 뷰 객체에서 바인딩 객체 생성  
            binding = PostItemBinding.bind(itemView);  
        }  
  
        public void bindItem(Post item) {  
            // 프로필 이미지  
            Glide.with(itemView.getContext())  
//                    .load(item.getProfile_image())  
                    .load(item.getUser().profileImage)  
                    .centerCrop()  
                    .into(binding.ivPostItemAuthorProfileImage);  
            binding.ivPostItemAuthorProfileImage.setClipToOutline(true);  
            binding.tvPostItemAuthorNickname.setText(item.getUser().nickname);               // 닉네임  
            binding.tvPostItemDate.setText(item.getDateTimeAsString());                 // 작성날짜  
            binding.llPostItemAuthor.setOnClickListener(v -> moveToProfile(item.getUser().id));  
  
  
            binding.tvPostItemContent.setText(item.getContent());                       // 본문  
  
            binding.btnPostItemLike.setText(String.valueOf(item.getLikeCount()));      // 좋아요 수  
            binding.btnPostItemComment.setText(String.valueOf(item.getCommentCount()));// 댓글 수  
            binding.btnPostItemView.setText(String.valueOf(item.getView_count()).trim());      // 조회 수  
  
            // 좋아요 선택 여부에 따른 다른 이미지 부여  
            if (item.isLiked()) {  
                Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_true);  
                binding.btnPostItemLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            } else {  
                Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_false);  
                binding.btnPostItemLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
            }  
  
            // 좋아요 버튼 이벤트 리스너  
            binding.btnPostItemLike.setOnClickListener(v -> toggleLike((AppCompatButton) v, item));  
  
            // 이미지뷰는 기본적으로 GONE  
            binding.ivPostItemImage.setVisibility(View.GONE);  
  
            // 첨부이미지 미리보기  
            if(item.getImageUrls() != null) {  
                String imageUrl = item.getImageUrls().split(",")[0];  
                Glide.with(itemView.getContext())  
                        .load(imageUrl)  
                        .into(binding.ivPostItemImage);  
  
                // 첨부이미지가 있으면 iv를 출력한다  
                binding.ivPostItemImage.setVisibility(View.VISIBLE);  
            }  
        }  
  
        /**  
         * 인자로 주어진 userId에 해당하는 프로필 화면으로 이동  
         * @param userId  
         */  
        private void moveToProfile(Long userId){  
            StartActivityUtils.moveToProfile(context, userId);  
        }  
  
        /**  
         * 좋아요 토글링  
         */  
        private void toggleLike(AppCompatButton v, Post post) {  
            Log.d(TAG, "toggleLike 실행");  
  
            // 반복 터치 방지  
            v.setEnabled(false);  
  
            PostHelper.toggleLike(PostHelper.TYPE.POST, post.getId(), likeResponse -> {  
                // 아이콘 변경  
                if (likeResponse.isLike) {  
                    // 좋아요 추가  
                    Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_true);  
                    binding.btnPostItemLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
                } else {  
                    // 좋아요 취소  
                    Drawable drawable = ContextCompat.getDrawable(PostAdapter.context, R.drawable.ic_like_false);  
                    binding.btnPostItemLike.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null, null);  
                }  
  
                // 추천수 변경  
                binding.btnPostItemLike.setText(String.valueOf(likeResponse.likeCount));  
  
                // 버튼 활성화  
                binding.btnPostItemLike.setEnabled(true);  
            });  
        }  
    }  
}  
  
</document_content>  
</document>  
<document index="155">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\SearchViewPagerAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import androidx.annotation.NonNull;  
import androidx.fragment.app.Fragment;  
import androidx.fragment.app.FragmentActivity;  
import androidx.viewpager2.adapter.FragmentStateAdapter;  
  
import java.util.List;  
  
public class SearchViewPagerAdapter extends FragmentStateAdapter {  
    private List<Fragment> fragmentList;  
    public SearchViewPagerAdapter(@NonNull FragmentActivity fragmentActivity, List<Fragment> fragmentList) {  
        super(fragmentActivity);  
        this.fragmentList = fragmentList;  
    }  
  
    @NonNull  
    @Override  
    public Fragment createFragment(int position) {  
        return fragmentList.get(position);  
    }  
  
    @Override  
    public int getItemCount() {  
        return fragmentList.size();  
    }  
  
    public void updateFragmentsWithResults(){  
        // TODO 서버의 검색결과를 프래그먼트로 전달한다.  
    }  
  
    public List<Fragment> getFragmentList(){  
        return fragmentList;  
    }  
  
    public Fragment getFragment(int position){  
        if(position < 0 || position >= fragmentList.size()) return null;  
        return fragmentList.get(position);  
    }  
}  
  
</document_content>  
</document>  
<document index="156">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\SimpleChatAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.content.Context;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.databinding.ItemChatReceivedBinding;  
import com.teamnova.assa.databinding.ItemChatSentBinding;  
import com.teamnova.assa.databinding.ItemChatServerBinding;  
import com.teamnova.assa.util.TimeUtils;  
  
import java.text.ParseException;  
import java.text.SimpleDateFormat;  
import java.util.ArrayList;  
import java.util.Date;  
import java.util.List;  
import java.util.Locale;  
import java.util.TimeZone;  
  
public class SimpleChatAdapter extends RecyclerView.Adapter<RecyclerView.ViewHolder> {  
  
    static final String TAG = SimpleChatAdapter.class.getSimpleName();  
  
    private List<Message> messages = new ArrayList<>();  
    private Context context;  
  
    // 메시지 타입 상수  
    static final int VIEW_TYPE_MESSAGE_SERVER = 0;  
    static final int VIEW_TYPE_MESSAGE_SENT = 1;  
    static final int VIEW_TYPE_MESSAGE_RECEIVED = 2;  
    static final int VIEW_TYPE_IMAGE_SENT = 3;  
    static final int VIEW_TYPE_IMAGE_RECEIVED = 4;  
  
    SimpleDateFormat utcFormat;  
    SimpleDateFormat localFormat;  
  
    public SimpleChatAdapter(Context context) {  
        this.context = context;  
  
        // 변환할 문자열 세팅  
        utcFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm", Locale.getDefault());  
        utcFormat.setTimeZone(TimeZone.getTimeZone("UTC"));  
  
        // 출력할 문자열 포맷 세팅  
        localFormat = new SimpleDateFormat("yyyy년 MM월 dd일 E요일", Locale.KOREA);  
        localFormat.setTimeZone(TimeZone.getDefault());  
    }  
  
    @Override  
    public int getItemViewType(int position) {  
        Log.d(TAG, "getItemViewType: START");  
        Message message = messages.get(position);  
  
        // 전송 문자열 규칙 = 메시지 타입(SERVER, TEXT, IMAGE)|전송자 닉네임|전송자 프로필 이미지 URL|보낸날짜|메시지 내용  
  
        // 내 아이디와 메시지 전송자 id 비교  
        Log.d(TAG, "getItemViewType: type = " + message.type);  
  
        String type = message.type;  
        if (type.equals("SERVER")) {  
            return 0;  
        } else if (type.equals("TEXT")) {  
            if (message.userData.id.equals(SPHelper.getUserId())) {  
                return VIEW_TYPE_MESSAGE_SENT;  
            } else {  
                return VIEW_TYPE_MESSAGE_RECEIVED;  
            }  
        } else if (type.equals("IMAGE")) {  
            if (message.userData.id.equals(SPHelper.getUserId())) {  
                return VIEW_TYPE_IMAGE_SENT;  
            } else {  
                return VIEW_TYPE_IMAGE_RECEIVED;  
            }  
        }  
  
        Log.d(TAG, "getItemViewType: END");  
  
        return -1;  
    }  
  
    /**  
     * 메시지 리스트를 순회하며 각 메시지의 날짜와 시간을 표시  
     */  
    private void processMessages() {  
        Log.i(TAG, "processMessages: START - 메시지 처리 시작");  
  
        String lastDate = null;  
        String lastTime = null;  
        Long lastUserId = null;  
        String lastDateKor = null;  
  
        for (int i = messages.size() - 1; i >= 0; i--) {  
            Message currentMessage = messages.get(i);  
  
            if (currentMessage.userData.id == 0L) {  
                return;  
            }  
  
            // 현재 보고 있는 메시지가 이미 날짜 출력이 false면 더 볼 것 없다  
            if (!currentMessage.isTimeShow) {  
                return;  
            }  
  
            String createdAt = currentMessage.datetime;  
            String formattedCreatedAt = createdAt.substring(0, 16); // :ss 제거  
  
            String createdDate = createdAt.substring(0, 10);  
            String createDateKor;  
            try {  
                createDateKor = localFormat.format(utcFormat.parse(createdAt));  
            } catch (ParseException e) {  
                throw new RuntimeException(e);  
            }  
  
            // 날짜가 변경되면 이전 날짜 메시지 삽입  
            if (lastDateKor != null && !createDateKor.equals(lastDateKor)) {  
                insertDateMessage(i, lastDateKor);  
                lastDateKor = null;  
                continue;  
            }  
  
            // 이전 메시지 시간을 분 까지만 남기기  
            String formattedLastTime = lastTime == null ? "" : lastTime.substring(0, 16);  
  
            // 날짜 출력 판단  
            // 이전 인덱스와 작성자가 동일하고 시간이 동일하면 날짜 숨김  
            boolean isSameUser = currentMessage.userData.id == lastUserId;  
            boolean isSameTime = formattedCreatedAt.equals(formattedLastTime);  
  
            if (isSameUser && isSameTime) {  
                currentMessage.isTimeShow = false;  
            } else {  
                currentMessage.isTimeShow = true;  
            }  
  
            // 프로필 이미지, 닉네임 출력 판단  
  
            // 이전 메시지를 봤을때 시간이 다르거나 사용자가 다르면  
            // 현재 메시지의 프로필 사진을 출력함  
            if (i > 0) {  
                Message prevMsg = messages.get(i - 1);  
  
                boolean isSameUser_prev = currentMessage.userData.id == prevMsg.userData.id;  
                String prevFormattedCreatedAt = prevMsg.datetime.substring(0, 16);  
                boolean isSameTime_prev = formattedCreatedAt.equals(prevFormattedCreatedAt);  
  
                Log.d(TAG, "processMessages: formattedCreatedAt = " + formattedCreatedAt + ", prevFormattedCreatedAt = " + prevFormattedCreatedAt);  
  
  
                if (!isSameUser_prev || !isSameTime_prev) {  
                    currentMessage.isProfileShow = true;  
                } else {  
                    currentMessage.isProfileShow = false;  
                }  
            }  
  
            Date date;  
            // UTC 시간을 로컬 날짜로 변환  
            try {  
                date = utcFormat.parse(createdAt);  
            } catch (ParseException e) {  
                Log.e(TAG, "날짜 변환 오류", e);  
                continue;  
            }  
  
            lastDate = createdDate;  
            lastDateKor = localFormat.format(date);  
            lastTime = createdAt;  
            lastUserId = currentMessage.userData.id;  
  
            Log.d(TAG, "processMessages: 인덱스 = " + i +  
                    ", 내용 = " + currentMessage.message +  
                    ", 날짜시간 = " + currentMessage.datetime +  
                    ", 시간표시 = " + currentMessage.isTimeShow +  
                    ", 프로필표시 = " + currentMessage.isProfileShow);  
        }  
  
//        // 채팅기록 최상단에 최초의 날짜 메시지 삽입  
//        insertDateMessage(getItemCount(), lastDateKor);  
    }  
  
    private void insertDateMessage(int index, String date) {  
        SimpleUser server = new SimpleUser(0L, null, null);  
        messages.add(index, new Message(server, "", date, "SERVER"));  
        Log.i(TAG, "insertDateMessage: 날짜 메시지 삽입 - " + date);  
    }  
  
    @NonNull  
    @Override  
    public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view;  
  
        switch (viewType) {  
            case VIEW_TYPE_MESSAGE_SERVER:  
                view = ItemChatServerBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false).getRoot();  
                return new ServerMessageViewHolder(view);  
            case VIEW_TYPE_MESSAGE_SENT:  
                view = ItemChatSentBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false).getRoot();  
                return new SentTextMessageHolder(view);  
            case VIEW_TYPE_MESSAGE_RECEIVED:  
                view = ItemChatReceivedBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false)  
                        .getRoot();  
                return new ReceivedTextMessageHolder(view);  
//            case VIEW_TYPE_IMAGE_SENT:  
//                view = ItemImageSentBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false).getRoot();  
//                return new SentImageMessageHolder(view);  
//            case VIEW_TYPE_IMAGE_RECEIVED:  
//                view = ItemImageReceivedBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false)  
//                        .getRoot();  
//                return new ReceivedImageMessageHolder(view);  
        }  
  
        return null;  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position) {  
  
        Message message = messages.get(position);  
        int viewType = holder.getItemViewType();  
  
        switch (viewType) {  
            case VIEW_TYPE_MESSAGE_SERVER:  
                ((ServerMessageViewHolder) holder).bind(message);  
                break;  
            case VIEW_TYPE_MESSAGE_SENT:  
                ((SentTextMessageHolder) holder).bind(message);  
                break;  
            case VIEW_TYPE_MESSAGE_RECEIVED:  
                ((ReceivedTextMessageHolder) holder).bind(message);  
                break;  
//            case VIEW_TYPE_IMAGE_SENT:  
//                ((SentImageMessageHolder) holder).bind(message);  
//                break;  
//            case VIEW_TYPE_IMAGE_RECEIVED:  
//                ((ReceivedImageMessageHolder) holder).bind(message);  
//                break;  
        }  
    }  
  
    @Override  
    public int getItemCount() {  
        return messages.size();  
    }  
  
    public void addMessage(Message message) {  
        messages.add(message);  
        processMessages();  
        notifyDataSetChanged();  
//        notifyItemInserted(messages.size() - 1);  
    }  
  
    class ServerMessageViewHolder extends RecyclerView.ViewHolder {  
        ItemChatServerBinding binding;  
  
        public ServerMessageViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemChatServerBinding.bind(itemView);  
        }  
  
        void bind(Message message) {  
            Log.d(TAG, "bind: msg = " + message.toString());  
            // YYYY-mm-dd HH:mm 을 YYYY년 mm월 dd일 E요일로 변환  
            try {  
                Date date = utcFormat.parse(message.datetime);  
                String datetimeStr = localFormat.format(date);  
                Log.d(TAG, "bind: datetimeStr = " + datetimeStr);  
                binding.tvMessageServer.setText(datetimeStr);  
            } catch (ParseException e) {  
                throw new RuntimeException(e);  
            }  
        }  
    }  
  
    class SentTextMessageHolder extends RecyclerView.ViewHolder {  
        ItemChatSentBinding binding;  
  
        public SentTextMessageHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemChatSentBinding.bind(itemView);  
        }  
  
        void bind(Message message) {  
            Log.d(TAG, "bind: msg = " + message.toString());  
            binding.tvMessageSent.setText(message.message);  
  
            if (message.isTimeShow) {  
                binding.tvDatetimeSent.setText(TimeUtils.convertUTCToLocalTimeMin(message.datetime));  
                binding.tvDatetimeSent.setVisibility(View.VISIBLE);  
            } else {  
                binding.tvDatetimeSent.setVisibility(View.GONE);  
            }  
        }  
    }  
  
    class ReceivedTextMessageHolder extends RecyclerView.ViewHolder {  
        ItemChatReceivedBinding binding;  
  
        public ReceivedTextMessageHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemChatReceivedBinding.bind(itemView);  
        }  
  
        void bind(Message message) {  
            binding.tvSenderNicknameReceived.setText(message.userData.nickname);  
  
            Glide.with(context)  
                    .asBitmap()  
                    .load(message.userData.profileImage)  
                    .circleCrop()  
                    .into(binding.ivProfileReceived);  
  
            binding.tvMessageReceived.setText(message.message);  
  
            // 프사 표시 여부  
            if (message.isProfileShow) {  
                binding.ivProfileReceived.setVisibility(View.VISIBLE);  
                binding.tvSenderNicknameReceived.setVisibility(View.VISIBLE);  
            } else {  
                binding.ivProfileReceived.setVisibility(View.INVISIBLE);  
                binding.tvSenderNicknameReceived.setVisibility(View.GONE);  
            }  
  
            if (message.isTimeShow) {  
                binding.tvDatetimeReceived.setText(TimeUtils.convertUTCToLocalTimeMin(message.datetime));  
                binding.tvDatetimeReceived.setVisibility(View.VISIBLE);  
            } else {  
                binding.tvDatetimeReceived.setVisibility(View.GONE);  
            }  
        }  
    }  
  
//    static class SentImageMessageHolder extends RecyclerView.ViewHolder {  
//        ItemImageSentBinding binding;  
//  
//        public SentImageMessageHolder(@NonNull View itemView) {  
//            super(itemView);  
//            binding = ItemImageSentBinding.bind(itemView);  
//        }  
//  
//        void bind(String[] msg) {  
//            Log.d(TAG, "bind: msg = " + msg);  
//        }  
//    }  
//  
//    static class ReceivedImageMessageHolder extends RecyclerView.ViewHolder {  
//        ItemImageReceivedBinding binding;  
//  
//        public ReceivedImageMessageHolder(@NonNull View itemView) {  
//            super(itemView);  
//            binding = ItemImageReceivedBinding.bind(itemView);  
//        }  
//  
//        void bind(String[] msg) {  
//            Log.d(TAG, "bind: msg = " + msg);  
//        }  
//    }  
  
    public static class Message {  
        SimpleUser userData;  
        String message;  
        String datetime;  
        String type;  
        public boolean isTimeShow = true;  
        public boolean isProfileShow = true;  
  
        public Message(SimpleUser userData, String message, String datetime, String type) {  
            this.userData = userData;  
            this.message = message;  
            this.datetime = datetime;  
            this.type = type;  
        }  
  
        public String toString() {  
            return type + "|" + userData.id + "|" + datetime + "|" + message;  
        }  
    }  
}  
  
  
  
</document_content>  
</document>  
<document index="157">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\UserPreviewAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.app.Activity;  
import android.content.Context;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.load.engine.DiskCacheStrategy;  
import com.bumptech.glide.request.RequestOptions;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.databinding.ItemUserBinding;  
import com.teamnova.assa.util.StartActivityUtils;  
  
import java.util.List;  
  
public class UserPreviewAdapter extends RecyclerView.Adapter<UserPreviewAdapter.ViewHolder> {  
  
    private static final String TAG = "UserPreviewAdapter";  
    private List<UserData> userDataList;  
    private static Context context;  
  
    public UserPreviewAdapter(Activity context) {  
        UserPreviewAdapter.context = context;  
    }  
  
    public void setItems(List<UserData> userData) {  
        this.userDataList = userData;  
        notifyDataSetChanged();  
    }  
  
    @NonNull  
    @Override  
    public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_user, parent, false);  
        return new ViewHolder(view);  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull ViewHolder holder, int position) {  
        holder.bind(this.userDataList.get(position));  
    }  
  
    @Override  
    public int getItemCount() {  
        return this.userDataList != null ? userDataList.size() : 0;  
    }  
  
    public static class ViewHolder extends RecyclerView.ViewHolder {  
        ItemUserBinding binding;  
  
        public ViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemUserBinding.bind(itemView);  
  
        }  
  
        public void bind(UserData userData) {  
            // 프로필 클릭시 이동  
            binding.getRoot().setOnClickListener(v -> StartActivityUtils.moveToProfile(context, userData.id));  
  
            // 닉네임 출력  
            binding.tvUserNickname.setText(userData.nickname);  
  
            // 프로필 이미지 경로 생성  
            String imgUrl = userData.profileImage;  
  
            // 프로필 이미지 출력  
            Glide.with(context.getApplicationContext())  
                    .load(imgUrl)  
                    .circleCrop()  
                    .apply(new RequestOptions()  
                            .skipMemoryCache(true)  
                            .diskCacheStrategy(DiskCacheStrategy.NONE))  
                    .into(binding.ivUserProfileImage);  
  
        }  
  
    }  
}  
  
  
  
</document_content>  
</document>  
<document index="158">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\UserProfileInfoAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.app.Activity;  
import android.content.Context;  
import android.content.Intent;  
import android.content.res.ColorStateList;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.load.engine.DiskCacheStrategy;  
import com.bumptech.glide.request.RequestOptions;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Friend;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.retrofit.clients.UserRelationApiClient;  
import com.teamnova.assa.databinding.ItemUserProfileInfoBinding;  
import com.teamnova.assa.ui.activity.FollowerActivity;  
import com.teamnova.assa.ui.activity.FollowingActivity;  
import com.teamnova.assa.ui.activity.FriendsActivity;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class UserProfileInfoAdapter extends RecyclerView.Adapter<UserProfileInfoAdapter.UserInfoViewHolder> {  
  
    private static final String TAG = "UserProfileInfoAdapter";  
    private UserData userData;  
    private static Context context;  
  
    public UserProfileInfoAdapter(Activity context) {  
        UserProfileInfoAdapter.context = context;  
    }  
  
    public void setUserData(UserData userData) {  
        this.userData = userData;  
        notifyDataSetChanged();  
    }  
  
    @NonNull  
    @Override  
    public UserInfoViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_user_profile_info, parent, false);  
        return new UserInfoViewHolder(view);  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull UserInfoViewHolder holder, int position) {  
        holder.bind(this.userData);  
    }  
  
    @Override  
    public int getItemCount() {  
        return this.userData != null ? 1 : 0;  
    }  
  
    public static class UserInfoViewHolder extends RecyclerView.ViewHolder {  
        ItemUserProfileInfoBinding binding;  
  
        public UserInfoViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemUserProfileInfoBinding.bind(itemView);  
        }  
  
        public void bind(UserData userData) {  
            // 닉네임 출력  
            binding.textViewNickname.setText(userData.nickname);  
  
            // 소개글 출력  
            binding.textViewDescription.setText(userData.description);  
  
            // 프로필 이미지 경로 생성  
            String imgUrl = userData.profileImage;  
  
            // 프로필 이미지 출력  
            Glide.with(context.getApplicationContext())  
                    .load(imgUrl)  
                    .circleCrop()  
                    .apply(new RequestOptions()  
                            .skipMemoryCache(true)  
                            .diskCacheStrategy(DiskCacheStrategy.NONE))  
                    .into(binding.imageViewProfile);  
  
            // 팔로워 수  
            binding.textViewFollower.setText(userData.followers.size() + " 팔로워");  
            Intent followIntent = new Intent(context, FollowerActivity.class);  
            followIntent.putExtra("userId", userData.id);  
            binding.textViewFollower.setOnClickListener(v -> context.startActivity(followIntent));  
  
            // 팔로잉 수  
            binding.textViewFollowing.setText(userData.followings.size() + " 팔로잉");  
            Intent followingIntent = new Intent(context, FollowingActivity.class);  
            followingIntent.putExtra("userId", userData.id);  
            binding.textViewFollowing.setOnClickListener(v -> context.startActivity(followingIntent));  
  
  
            // 내가 나의 프로필을 볼 때와, 다른 사람의 프로필을 볼 때 화면이 다름  
            if (SPHelper.getUserId().equals(userData.id)) {  
                // 나의 프로필에는 친구 개수와 친구 목록 화면으로 이동하는 버튼 생성  
                binding.llFriendsContainer.setVisibility(View.VISIBLE);  
                binding.btnFriendsList.setOnClickListener(v -> {  
                    Intent intent = new Intent(context, FriendsActivity.class);  
                    intent.putExtra("userId", userData.id);  
                    context.startActivity(intent);  
                });  
  
                // 친구 수 출력  
                binding.textViewFriends.setText("친구 " + userData.friends.size() + " 명");  
            } else {  
                // 남의 프로필인 경우  
  
                setFollowButton(userData.isFollowing);  
                // 남의 프로필에는 팔로우, 친구요청, 차단하기 버튼 생성  
                binding.llButtonsContainer.setVisibility(View.VISIBLE);  
  
                // TODO 팔로우, 친구요청, 차단하기 버튼 기능구현  
                // 팔로우 버튼  
                binding.btnFollow.setOnClickListener(v -> toggleFollowButton(userData));  
  
                // 친구요청 버튼  
                setFriendButton(userData.friendRequestState, userData.isFriend);  // 초기 상태 출력 세팅  
                binding.btnFriend.setOnClickListener(v -> friendButtonBehavior(userData));  
  
                // 차단하기 버튼  
            }  
        }  
  
        /**  
         * 팔로우 상태에 따른 ui 상태 변경 메소드  
         *  
         * @param isFollowing  
         */  
        public void setFollowButton(boolean isFollowing) {  
            if (isFollowing) {  
                binding.btnFollow.setText("팔로잉");  
                binding.btnFollow.setTextColor(context.getResources().getColor(R.color.black));  
                int color = context.getResources().getColor(R.color.inactive);  
                binding.btnFollow.setBackgroundTintList(ColorStateList.valueOf(color));  
            } else {  
                // 버튼 텍스트 변경  
                binding.btnFollow.setText("팔로우");  
                // 버튼 텍스트 색 변경  
                binding.btnFollow.setTextColor(context.getResources().getColor(R.color.white));  
  
                // 버튼 색상 변경  
                int color = context.getResources().getColor(R.color.primary);  
                binding.btnFollow.setBackgroundTintList(ColorStateList.valueOf(color));  
            }  
        }  
  
        public void toggleFollowButton(UserData userData) {  
            // 현재 상태를 확인후 이를 뒤집는 작업 수행  
            boolean isFollowing = userData.isFollowing;  
  
            Callback<Void> followCallback = new Callback<Void>() {  
                @Override  
                public void onResponse(Call<Void> call, Response<Void> response) {  
                    setFollowButton(!isFollowing);  
                    userData.isFollowing = !isFollowing;  
                    if (!isFollowing) {  
                        Toast.makeText(context, "팔로우 되었습니다", Toast.LENGTH_SHORT).show();  
                    } else {  
                        Toast.makeText(context, "언팔로우 되었습니다", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<Void> call, Throwable throwable) {  
                    Log.e(TAG, "팔로우 / 언팔로우 요청 실패", throwable);  
                }  
            };  
  
            // 팔로잉이면 언팔로우,  
            if (isFollowing) {  
                UserRelationApiClient.getInstance().unfollow(userData.id).enqueue(followCallback);  
            } else {  
                // 팔로잉이 아니면 팔로우  
                UserRelationApiClient.getInstance().follow(userData.id).enqueue(followCallback);  
            }  
        }  
  
        public void setFriendButton(Friend.FRIEND_REQUEST_STATE STATE, Boolean isFriend) {  
            if(isFriend){  
                // 내가 친구 신청을 받은 경우를 처리하기 위한 분기문  
                binding.btnFriend.setText("친구해제");  
                return;  
            }  
  
            if (STATE == Friend.FRIEND_REQUEST_STATE.ACCEPT) {  
                // 현재 친구상태인 경우  
                // 버튼을 다시 누르면 친구 취소  
                binding.btnFriend.setText("친구해제");  
  
            } else {  
                if (STATE == Friend.FRIEND_REQUEST_STATE.NONE) {  
                    // 친구 신청 할 수 있는 UI  
                    binding.btnFriend.setText("친구신청");  
  
                } else if (STATE == Friend.FRIEND_REQUEST_STATE.PENDING ||  
                        STATE == Friend.FRIEND_REQUEST_STATE.REJECT) {  
                    // 친구 요청 수락 대기 표시  
                    binding.btnFriend.setText("친구신청 중");  
  
                }  
            }  
        }  
  
        public void friendButtonBehavior(UserData userData) {  
            if (userData.isFriend) {  
                // 현재 친구상태인 경우  
                // 친구 해제한다.  
                unFriend(userData);  
  
            } else {  
                if (userData.friendRequestState == Friend.FRIEND_REQUEST_STATE.NONE) {  
                    // 아직 친구신청을 요청하지 않은 경우  
                    requestForFriend(userData);  
                } else if (userData.friendRequestState == Friend.FRIEND_REQUEST_STATE.PENDING ||  
                        userData.friendRequestState == Friend.FRIEND_REQUEST_STATE.REJECT) {  
                    // 친구신청 수락을 기다리거나, 거부된 경우  
                    // 친구신청중 버튼을 누르면 신청이 취소됨  
                    cancelRequestForFriend(userData);  
                }  
            }  
        }  
  
        public void unFriend(UserData userData){  
            UserRelationApiClient.getInstance().unfriend(userData.id).enqueue(new Callback<Void>() {  
                @Override  
                public void onResponse(Call<Void> call, Response<Void> response) {  
                    if(response.isSuccessful()){  
                        // TODO 친구 해제 처리  
                        Log.d(TAG, "onResponse: 친구 해제 성공");  
                        Toast.makeText(context, "친구 해제 성공", Toast.LENGTH_SHORT).show();  
                        userData.friendRequestState = Friend.FRIEND_REQUEST_STATE.NONE;  
                        userData.isFriend = false;  
                        setFriendButton(Friend.FRIEND_REQUEST_STATE.NONE, false);  
                    }else{  
                        Log.d(TAG, "onResponse: 친구 해제 에러");  
                        Toast.makeText(context, "친구 해제 에러", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<Void> call, Throwable throwable) {  
                    Log.d(TAG, "onResponse: 친구 해제 에러");  
                    Toast.makeText(context, "친구 해제 에러", Toast.LENGTH_SHORT).show();  
  
                }  
            });  
        }  
  
        public void requestForFriend(UserData userData) {  
            UserRelationApiClient.getInstance().requestForFriend(userData.id).enqueue(new Callback<Friend>() {  
                @Override  
                public void onResponse(Call<Friend> call, Response<Friend> response) {  
                    if (response.isSuccessful()) {  
                        Log.d(TAG, "onResponse: 친구 요청 성공");  
  
                        if (response.body().state == Friend.FRIEND_REQUEST_STATE.PENDING) {  
                            Toast.makeText(context, "친구신청 성공", Toast.LENGTH_SHORT).show();  
                            setFriendButton(Friend.FRIEND_REQUEST_STATE.PENDING, false);  
                            userData.friendRequestState = Friend.FRIEND_REQUEST_STATE.PENDING;  
                            return;  
                        }  
  
                    } else {  
                        Log.d(TAG, "onResponse: 친구신청 에러");  
                        Toast.makeText(context, "친구신청 에러", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<Friend> call, Throwable throwable) {  
                    Log.e(TAG, "onFailure: 친구신청 실패", throwable);  
                    Toast.makeText(context, "친구신청 실패", Toast.LENGTH_SHORT).show();  
                }  
            });  
        }  
  
        public void cancelRequestForFriend(UserData userData) {  
            UserRelationApiClient.getInstance().cancelRequestForFriend(userData.id).enqueue(new Callback<Void>() {  
                @Override  
                public void onResponse(Call<Void> call, Response<Void> response) {  
                    if (response.isSuccessful()) {  
                        Log.d(TAG, "onResponse: 친구신청 취소 성공");  
                        Toast.makeText(context, "친구신청 취소 성공", Toast.LENGTH_SHORT).show();  
                        setFriendButton(Friend.FRIEND_REQUEST_STATE.NONE, false);  
                        userData.friendRequestState = Friend.FRIEND_REQUEST_STATE.NONE;  
                    } else {  
                        Log.d(TAG, "onResponse: 친구신청 취소 에러");  
                        Toast.makeText(context, "친구신청 취소 에러", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<Void> call, Throwable throwable) {  
                    Log.e(TAG, "onFailure: 친구신청 취소 실패", throwable);  
                    Toast.makeText(context, "친구신청 취소 실패", Toast.LENGTH_SHORT).show();  
                }  
            });  
        }  
    }  
}  
  
  
  
</document_content>  
</document>  
<document index="159">  
<source>app/src/main/java\com\teamnova\assa\ui\adapter\VideoRoomAdapter.java</source>  
<document_content>  
package com.teamnova.assa.ui.adapter;  
  
import android.content.Context;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.bumptech.glide.Glide;  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.VideoRoomParticipant;  
import com.teamnova.assa.databinding.ItemVideoRoomParticipantBinding;  
  
import org.webrtc.EglBase;  
import org.webrtc.RendererCommon;  
import org.webrtc.SurfaceViewRenderer;  
  
import java.util.ArrayList;  
import java.util.List;  
  
/**  
 * 영상회의 화면에서 참가자 표시 어댑터  
 */  
public class VideoRoomAdapter extends RecyclerView.Adapter<VideoRoomAdapter.ParticipantViewHolder> {  
  
    private static final String TAG = VideoRoomAdapter.class.getSimpleName();  
  
    //    public List<VideoRoomParticipant> participants = new ArrayList<>();  
    private List<VideoRoomParticipant> participants;  
    private Context context;  
    private EglBase eglBase;  
    private RecyclerView recyclerView;  
  
//    public void setParticipants(List<VideoRoomParticipant> participants) {  
//        this.participants = participants;  
//    }  
  
    public VideoRoomAdapter(Context context, EglBase eglBase, RecyclerView recyclerView, List<VideoRoomParticipant> participants) {  
        this.context = context;  
        this.recyclerView = recyclerView;  
        this.eglBase = eglBase;  
        this.participants = participants;  
    }  
  
    @NonNull  
    @Override  
    public ParticipantViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {  
        View view = LayoutInflater.from(context).inflate(R.layout.item_video_room_participant, parent, false);  
        return new ParticipantViewHolder(view);  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull ParticipantViewHolder holder, int position) {  
        Log.i(TAG, "onBindViewHolder: START - position = " + position);  
        VideoRoomParticipant participant = participants.get(position);  
  
        if (participant.videoTrack != null) {  
            holder.bind(participant);  
        }  
        Log.i(TAG, "onBindViewHolder: END");  
    }  
  
    @Override  
    public void onBindViewHolder(@NonNull ParticipantViewHolder holder, int position, @NonNull List<Object> payloads) {  
        Log.d(TAG, "onBindViewHolder: START - 페이로드 ");  
        VideoRoomParticipant participant = participants.get(position);  
        Log.d(TAG, "onBindViewHolder 페이로드: position = " + position + ", participant.id = " + participant.userData.id);  
  
        if (payloads.isEmpty()) {  
            super.onBindViewHolder(holder, position, payloads);  
        } else {  
            List<Object> payload = (List<Object>) payloads.get(0);  
            String type = (String) payload.get(0);  
            boolean status = (boolean) payload.get(1);  
            Log.d(TAG, "onBindViewHolder: type = " + type + ", status = " + status);  
            if (type.equals("video")) {  
                if (status) {  
                    holder.binding.llIvWrapper.setVisibility(View.GONE);  
                } else {  
                    holder.binding.llIvWrapper.setVisibility(View.VISIBLE);  
                }  
            } else {  
                if (status) {  
                    holder.binding.ivMicStatus.setVisibility(View.GONE);  
                } else {  
                    holder.binding.ivMicStatus.setVisibility(View.VISIBLE);  
                }  
            }  
        }  
        Log.d(TAG, "onBindViewHolder: END - 페이로드");  
    }  
  
    @Override  
    public int getItemCount() {  
        if (participants == null) return 0;  
        return participants.size();  
    }  
  
//    public void addParticipant(VideoRoomParticipant participant) {  
//        Log.i(TAG, "addParticipant: START - participant = " + participant);  
//        boolean isExist = false;  
//        for (VideoRoomParticipant prev : participants) {  
//            if (participant.userData.id.equals(prev.userData.id)) {  
//                Log.d(TAG, "addParticipant: 추가하려는 사람은 이미 참가자임");  
//                isExist = true;  
//                break;  
//            }  
//        }  
//  
//        if (!isExist) {  
//            Log.d(TAG, "addParticipant: 기존에 없던 참가자, 새로 화면에 추가");  
////            participants.add(participant);  
//            notifyItemInserted(participants.size() - 1);  
//        }  
//        Log.i(TAG, "addParticipant: END");  
//    }  
  
    // 기존 참가자의 정보를 업데이트하는 메서드  
    public void updateParticipant(VideoRoomParticipant updatedParticipant) {  
        Log.i(TAG, "updateParticipant: START - updatedParticipant = " + updatedParticipant);  
  
        int idx = 0;  
  
        // 사용자 아이디를 비교하여 일치하는 요소를 새것으로 바꿈  
        for (int i = 0; i < participants.size(); i++) {  
            VideoRoomParticipant participant = participants.get(i);  
            if (participant.userData.id.equals(updatedParticipant.userData.id)) {  
                // VideoTrack은 onTrack에서 관리  
//                 participant.videoTrack = updatedParticipant.videoTrack;  
  
                // isVideoEnabled, isAudioEnabled 등 UI 관련 정보만 업데이트  
                participant.userData = updatedParticipant.userData;  
                participant.isVideoEnabled = updatedParticipant.isVideoEnabled;  
                participant.isAudioEnabled = updatedParticipant.isAudioEnabled;  
                notifyItemChanged(i);  
                idx = i;  
                break;  
            }  
        }  
  
        Log.d(TAG, "updateParticipant: 바뀐 화면의 리사이클러 뷰 position = " + idx);  
        Log.i(TAG, "updateParticipant: END");  
    }  
  
    public void removeParticipant(Long participantId) {  
        Log.i(TAG, "removeParticipant: START - params : participantId = " + participantId);  
  
        // 디버그 코드  
        List<Long> ids = new ArrayList<>();  
        for (VideoRoomParticipant participant : participants) {  
            ids.add(participant.userData.id);  
        }  
        Log.d(TAG, "removeParticipant: 퇴장자 삭제전 참가자 id 목록 : " + ids);  
  
        // 삭제하려는 유저 찾아서 제거  
        for (int i = 0; i < participants.size(); i++) {  
            VideoRoomParticipant participant = participants.get(i);  
            if (participant.userData != null && participant.userData.id.equals(participantId)) {  
                participants.remove(i);  
                notifyItemRemoved(i);  
                Log.d(TAG, "removeParticipant: 퇴장자를 찾음");  
                break;  
            }  
        }  
    }  
  
    public class ParticipantViewHolder extends RecyclerView.ViewHolder {  
        public ItemVideoRoomParticipantBinding binding;  
        private SurfaceViewRenderer renderer;  
        private VideoRoomParticipant participant;  
  
        public ParticipantViewHolder(@NonNull View itemView) {  
            super(itemView);  
            binding = ItemVideoRoomParticipantBinding.bind(itemView);  
            renderer = binding.surfaceView;  
        }  
  
        public void bind(VideoRoomParticipant participant) {  
            Log.d(TAG, "bind: participant = " + participant);  
            this.participant = participant;  
  
            Log.d(TAG, "bind: 참가자 id = " + participant.userData.id + ", 참가자 이름 = " + participant.userData.nickname);  
            Log.d(TAG, "bind: videoTrack = " + participant.videoTrack);  
            Log.d(TAG, "bind: renderer = " + participant.surfaceViewRenderer);  
            this.participant = participant;  
  
            // 프로필 이미지 설정  
            Log.d(TAG, "bind: userId = " + participant.userData.id + ", nickname = " + participant.userData.nickname + ", profileImage = " + participant.userData.profileImage);  
            Glide.with(context).load(participant.userData.profileImage).circleCrop().into(binding.ivProfile);  
  
            if (participant.isVideoEnabled) {  
                binding.llIvWrapper.setVisibility(View.GONE);  
            } else {  
                binding.llIvWrapper.setVisibility(View.VISIBLE);  
            }  
  
            // 닉네임 출력  
            binding.tvNickname.setText(participant.userData.nickname);  
            if (participant.isAudioEnabled) {  
                binding.ivMicStatus.setVisibility(View.GONE);  
            } else {  
                binding.ivMicStatus.setVisibility(View.VISIBLE);  
            }  
  
            // SurfaceViewRenderer 설정  
            Log.d(TAG, "bind: participant.isInitialized = " + participant.isInitialized);  
            if (!participant.isInitialized) {  
                initializeSurfaceView();  
                participant.videoTrack.addSink(renderer);  
                participant.isInitialized = true;  
            }  
  
        }  
  
        private void initializeSurfaceView() {  
            binding.surfaceView.init(eglBase.getEglBaseContext(), null);  
            binding.surfaceView.setScalingType(RendererCommon.ScalingType.SCALE_ASPECT_FILL);  
            binding.surfaceView.setMirror(true);  
            binding.surfaceView.setEnableHardwareScaler(true);  
        }  
  
//        public void unbind() {  
//            Log.i(TAG, "unbind: 화면제거 renderer = " + renderer);  
//  
//            // 현재 ViewHolder에 연결된 VideoTrack만 해제  
//            if (participant != null && participant.videoTrack != null && participant.surfaceViewRenderer == renderer) {  
//                participant.videoTrack.removeSink(renderer);  
////                participant.surfaceViewRenderer = null;  
//            }  
//  
//            // Renderer 해제  
//            if (isRendererInitialized) {  
//                renderer.release();  
//                isRendererInitialized = false;  
//            }  
//  
//            VideoCallActivity.renderers.remove(renderer);  
//            isBound = false;  
//  
//            Log.i(TAG, "unbind: END");  
//        }  
    }  
}  
  
</document_content>  
</document>  
<document index="160">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\AllPostFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.fragment.app.Fragment;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.retrofit.clients.PostApiClient;  
import com.teamnova.assa.databinding.FragmentAllPostBinding;  
import com.teamnova.assa.ui.adapter.PostAdapter;  
import com.teamnova.assa.util.Utils;  
  
import java.util.ArrayList;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 모든 게시글 목록 프래그먼트  
 */  
public class AllPostFragment extends Fragment {  
  
    private static final String TAG = Utils.generateTAG(AllPostFragment.class);  
  
    FragmentAllPostBinding binding;  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentAllPostBinding.inflate(inflater, container, false);  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
        setRecyclerView();  
    }  
  
    @Override  
    public void onResume() {  
        super.onResume();  
        Log.d(TAG, "onResume: 포스트 목록");  
        getPosts();  
    }  
  
    /**  
     * 서버에서 모든 게시글을 가져온다.  
     */  
    private void getPosts() {  
        PostApiClient.getInstance().getPosts().enqueue(new Callback<PaginatedResponse<Post>>() {  
            @Override  
            public void onResponse(Call<PaginatedResponse<Post>> call, Response<PaginatedResponse<Post>> response) {  
                Log.d(TAG, "게시물 목록 요청 성공 : " + response.body());  
                if(response.isSuccessful()){  
                    PaginatedResponse<Post> postsResponse = response.body();  
                    setRecyclerViewData(postsResponse.data);  
                }  
            }  
  
            @Override  
            public void onFailure(Call<PaginatedResponse<Post>> call, Throwable throwable) {  
                Log.e(TAG, "게시물 목록 요청 실패", throwable);  
                Toast.makeText(getContext(), "게시물 목록 요청 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    private void setRecyclerView(){  
        // 리사이클러 뷰 세팅  
        binding.recyclerViewHomeAllPosts.setLayoutManager(new LinearLayoutManager(getContext()));  
        PostAdapter adapter = new PostAdapter(this.getContext());  
        binding.recyclerViewHomeAllPosts.setAdapter(adapter);  
    }  
  
    /**  
     * 리사이클러 뷰 데이터 세팅  
     * @param items  
     */  
    private void setRecyclerViewData(ArrayList<Post> items){  
        ((PostAdapter) binding.recyclerViewHomeAllPosts.getAdapter()).setItems(items);  
    }  
}  
</document_content>  
</document>  
<document index="161">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\ChatFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.content.BroadcastReceiver;  
import android.content.Context;  
import android.content.Intent;  
import android.content.IntentFilter;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.fragment.app.Fragment;  
import androidx.localbroadcastmanager.content.LocalBroadcastManager;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.command.CreateRoomCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.databinding.FragmentChatBinding;  
import com.teamnova.assa.ui.activity.SelectFriendsActivity;  
import com.teamnova.assa.ui.adapter.ChatRoomAdapter;  
import com.teamnova.assa.util.DBHelper;  
  
import java.util.ArrayList;  
import java.util.List;  
  
public class ChatFragment extends Fragment {  
    static final String TAG = ChatFragment.class.getSimpleName();  
    private FragmentChatBinding binding;  
    public ChatRoomAdapter adapter;  
    public static List<Long> roomItemList = new ArrayList<>();  
    DBHelper dbHelper = GlobalApplication.dbHelper;  
  
    public static boolean isChatListVisible = false;  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        Log.d(TAG, "onCreateView: ");  
        binding = FragmentChatBinding.inflate(inflater, container, false);  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
        Log.d(TAG, "onViewCreated: ");  
  
        initToolbar();  
        initRecyclerView();  
    }  
  
    // 상단 툴바 세팅  
    private void initToolbar() {  
        Log.i(TAG, "initToolbar: START");  
        binding.toolbarChat.setTitle("채팅");  
        binding.toolbarChat.inflateMenu(R.menu.menu_chat_toolbar);  
        binding.toolbarChat.setOnMenuItemClickListener(item -> {  
            int itemId = item.getItemId();  
  
            // 새 채팅 버튼 클릭 처리  
            if (itemId == R.id.item_chat_newchat) {  
                Intent intent = new Intent(getActivity(), SelectFriendsActivity.class);  
                intent.putExtra("isNewRoom", true);  
                startActivity(intent);  
                return true;  
            }  
            return false;  
        });  
        Log.i(TAG, "initToolbar: END");  
    }  
  
    // 리사이클러 뷰 세팅  
    private void initRecyclerView() {  
        Log.i(TAG, "initRecyclerView: START");  
  
        // 리사이클러 뷰 세팅  
        binding.rvChatList.setLayoutManager(new LinearLayoutManager(getContext()));  
        loadRoomList();  
        adapter = new ChatRoomAdapter(roomItemList, this.getActivity());  
        binding.rvChatList.setAdapter(adapter);  
        binding.rvChatList.setHasFixedSize(true);  
        binding.rvChatList.addItemDecoration(new DividerItemDecoration(getContext(), DividerItemDecoration.VERTICAL));  
  
        adapter.notifyDataSetChanged();  
        Log.i(TAG, "initRecyclerView: END");  
    }  
  
    // 방 목록 불러오기  
    public void loadRoomList() {  
        Log.i(TAG, "loadRoomList: START");  
        roomItemList.clear();  
  
        List<ChatRoom> roomList = dbHelper.getAllChatroomItem(CreateRoomCommand.RoomType.NORMAL);  
        Log.d(TAG, "loadRoomList: roomList=" + roomList);  
  
        for (ChatRoom room : roomList) {  
  
            String updated = room.updatedAt;  
  
            // 아무 메시지 없는 것은 패스  
            if ("0".equals(updated)) continue;  
  
            // 목록에 추가  
            roomItemList.add(room.id);  
            if(adapter != null) adapter.notifyDataSetChanged();  
            Log.d(TAG, "loadRoomList: roomItemList=" + roomItemList);  
        }  
        Log.i(TAG, "loadRoomList: END");  
    }  
  
    public void loadRoomListWithUiSync() {  
        Log.i(TAG, "loadRoomListWithUiSync: START");  
        loadRoomList();  
        adapter.notifyDataSetChanged();  
        Log.i(TAG, "loadRoomListWithUiSync: END");  
    }  
  
    private BroadcastReceiver messageReceiver = new BroadcastReceiver() {  
        @Override  
        public void onReceive(Context context, Intent intent) {  
            String message = intent.getStringExtra("message");  
            Log.i(TAG, "onReceive: 방 리스트 변경 수신");  
  
            // 현재는 알림 올만한 일이 "list_update"만 있음  
            getActivity().runOnUiThread(() -> {  
                // 방 목록 리사이클러 뷰 ui 업데이트  
                adapter.notifyDataSetChanged();  
            });  
        }  
    };  
  
    @Override  
    public void onStart() {  
        Log.i(TAG, "onStart: START");  
        super.onStart();  
        isChatListVisible = true;  
  
        Log.i(TAG, "onStart: END");  
    }  
  
    @Override  
    public void onStop() {  
        Log.i(TAG, "onStop: START");  
        super.onStop();  
        isChatListVisible = false;  
        Log.i(TAG, "onStop: END");  
    }  
  
    @Override  
    public void onResume() {  
        super.onResume();  
        Log.d(TAG, "onResume: ");  
        loadRoomListWithUiSync();  
        LocalBroadcastManager.getInstance(getContext()).registerReceiver(messageReceiver, new IntentFilter("roomList_event"));  
    }  
  
    @Override  
    public void onPause() {  
        super.onPause();  
        Log.d(TAG, "onPause: ");  
        LocalBroadcastManager.getInstance(getContext()).unregisterReceiver(messageReceiver);  
    }  
}  
</document_content>  
</document>  
<document index="162">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\FollowPostFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.fragment.app.Fragment;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.retrofit.clients.PostApiClient;  
import com.teamnova.assa.databinding.FragmentFollowPostBinding;  
import com.teamnova.assa.ui.adapter.PostAdapter;  
  
import java.util.ArrayList;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
/**  
 * 팔로우 하는 유저의 게시물을 보여주는 Fragment  
 */  
public class FollowPostFragment extends Fragment {  
  
    private final String TAG = FollowPostFragment.class.getSimpleName();  
    FragmentFollowPostBinding binding;  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentFollowPostBinding.inflate(inflater, container, false);  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
        setRecyclerView();  
    }  
  
    @Override  
    public void onResume() {  
        super.onResume();  
        Log.d(TAG, "onResume: 포스트 목록");  
        getPosts();  
    }  
  
  
    private void getPosts() {  
        PostApiClient.getInstance().getFollowingsPosts().enqueue(new Callback<PaginatedResponse<Post>>() {  
            @Override  
            public void onResponse(Call<PaginatedResponse<Post>> call, Response<PaginatedResponse<Post>> response) {  
                Log.d(TAG, "게시물 목록 요청 성공 : " + response.body());  
                if(response.isSuccessful()){  
                    PaginatedResponse<Post> postsResponse = response.body();  
                    setRecyclerViewData(postsResponse.data);  
                }  
            }  
  
            @Override  
            public void onFailure(Call<PaginatedResponse<Post>> call, Throwable throwable) {  
                Log.e(TAG, "게시물 목록 요청 실패", throwable);  
                Toast.makeText(getContext(), "게시물 목록 요청 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    private void setRecyclerView(){  
        // 리사이클러 뷰 세팅  
        binding.rvFollowPost.setLayoutManager(new LinearLayoutManager(getContext()));  
        PostAdapter adapter = new PostAdapter(this.getContext());  
        binding.rvFollowPost.setAdapter(adapter);  
    }  
  
    /**  
     * 리사이클러 뷰 데이터 세팅  
     * @param items  
     */  
    private void setRecyclerViewData(ArrayList<Post> items){  
        if (!items.isEmpty()) binding.tvEmpty.setVisibility(View.GONE);  
        else binding.tvEmpty.setVisibility(View.VISIBLE);  
        ((PostAdapter) binding.rvFollowPost.getAdapter()).setItems(items);  
    }  
}  
</document_content>  
</document>  
<document index="163">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\HomeFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.content.Intent;  
import android.graphics.Typeface;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.Menu;  
import android.view.MenuInflater;  
import android.view.MenuItem;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.TextView;  
  
import androidx.annotation.NonNull;  
import androidx.fragment.app.Fragment;  
import androidx.viewpager2.adapter.FragmentStateAdapter;  
  
import com.google.android.material.tabs.TabLayout;  
import com.google.android.material.tabs.TabLayoutMediator;  
import com.teamnova.assa.R;  
import com.teamnova.assa.databinding.FragmentHomeBinding;  
import com.teamnova.assa.ui.activity.PostCreateActivity;  
import com.teamnova.assa.ui.activity.PostNotificationActivity;  
  
import java.util.Arrays;  
import java.util.List;  
  
/**  
 * 홈 화면 프래그먼트  
 * 게시글 목록이 출력됨  
 */  
public class HomeFragment extends Fragment {  
    private static final String TAG = HomeFragment.class.getSimpleName();  
  
    private FragmentHomeBinding binding;  
  
    // 뷰 가 생성될 때 호출  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentHomeBinding.inflate(inflater, container, false);  
  
        setListeners(binding);  
        return binding.getRoot();  
    }  
  
    // 뷰가 완전히 생성된 후 호출  
    @Override  
    public void onViewCreated(@NonNull View view, Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
        setHasOptionsMenu(true);  
  
//        setToolbar();  
        setTabsWithViewPager();  
    }  
  
//    private void setToolbar() {  
//        // 툴바를 액티비티에 설정  
//        AppCompatActivity activity = (AppCompatActivity) getActivity();  
//        if (activity != null) {  
//            activity.setSupportActionBar(binding.toolbar);  
//            activity.getSupportActionBar().setDisplayShowTitleEnabled(false);  
//        }  
//    }  
  
    private void setTabBold(TabLayout.Tab tab){  
        // 탭 텍스트를 볼드 처리  
        View tabView = tab.view;  
        if (tabView instanceof ViewGroup) {  
            ViewGroup tabViewGroup = (ViewGroup) tabView;  
            for (int i = 0; i < tabViewGroup.getChildCount(); i++) {  
                View child = tabViewGroup.getChildAt(i);  
                if (child instanceof TextView) {  
                    TextView textView = (TextView) child;  
                    textView.setTypeface(textView.getTypeface(), Typeface.BOLD);  
                    break;  
                }  
            }  
        }  
    }  
  
    // 탭 + 뷰 페이저 세팅  
    private void setTabsWithViewPager() {  
        // 뷰 페이저 세팅  
        setViewPager();  
  
        // 탭 타이틀  
        List<String> tabTitles = Arrays.asList("전체", "팔로우 중");  
  
        // 탭 레이아웃, 뷰 페이저 연동  
        new TabLayoutMediator(binding.tabLayoutHome, binding.viewPagerHome, (tab, position) -> {  
            tab.setText(tabTitles.get(position));  
            setTabBold(tab);  
        }).attach();  
  
        binding.tabLayoutHome.addOnTabSelectedListener(new TabLayout.OnTabSelectedListener() {  
            @Override  
            public void onTabSelected(TabLayout.Tab tab) {  
                setTabBold(tab);  
            }  
  
            @Override  
            public void onTabUnselected(TabLayout.Tab tab) {  
                setTabBold(tab);  
            }  
  
            @Override  
            public void onTabReselected(TabLayout.Tab tab) {  
                setTabBold(tab);  
            }  
        });  
    }  
  
    private void setViewPager() {  
        binding.viewPagerHome.setAdapter(new FragmentStateAdapter(this) {  
            @NonNull  
            @Override  
            public Fragment createFragment(int position) {  
                switch (position) {  
                    case 0:  
                        return new AllPostFragment();  
                    case 1:  
                        return new FollowPostFragment();  
                    default:  
                        return new AllPostFragment();  
                }  
            }  
  
            @Override  
            public int getItemCount() {  
                return 2;  
            }  
        });  
    }  
  
    // 메뉴를 생성  
    @Override  
    public void onCreateOptionsMenu(@NonNull Menu menu, @NonNull MenuInflater inflater) {  
        inflater.inflate(R.menu.menu_main_toolbar, menu);  
        super.onCreateOptionsMenu(menu, inflater);  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
  
        if (id == R.id.item_home_notification) {  
            // 알림 화면으로 이동  
            Intent intent = new Intent(getActivity(), PostNotificationActivity.class);  
            startActivity(intent);  
            return true;  
        }  
  
        return super.onOptionsItemSelected(item);  
    }  
  
    private void setListeners(FragmentHomeBinding binding) {  
        // 플로팅 버튼 클릭  
        // 클릭 시  게시물 작성 화면으로 이동  
        binding.fabHomeAdd.setOnClickListener(v -> {  
            Log.d(TAG, "FAB clicked ");  
            Intent intent = new Intent(getActivity(), PostCreateActivity.class);  
            startActivity(intent);  
        });  
    }  
  
  
}  
</document_content>  
</document>  
<document index="164">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\OpenChatFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.content.BroadcastReceiver;  
import android.content.Context;  
import android.content.Intent;  
import android.content.IntentFilter;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.MenuItem;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.appcompat.widget.Toolbar;  
import androidx.fragment.app.Fragment;  
import androidx.localbroadcastmanager.content.LocalBroadcastManager;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.application.GlobalApplication;  
import com.teamnova.assa.command.CreateRoomCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.databinding.FragmentOpenChatBinding;  
import com.teamnova.assa.ui.activity.NewOpenChatActivity;  
import com.teamnova.assa.ui.adapter.ChatRoomAdapter;  
import com.teamnova.assa.util.DBHelper;  
  
import java.util.ArrayList;  
import java.util.List;  
  
public class OpenChatFragment extends Fragment {  
  
    private static final String TAG = OpenChatFragment.class.getSimpleName();  
    private FragmentOpenChatBinding binding;  
    private ChatRoomAdapter adapter;  
    public static List<Long> roomItemList = new ArrayList<>();  
    DBHelper dbHelper = GlobalApplication.dbHelper;  
  
    public static boolean isOpenChatVisible = false;  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        Log.i(TAG, "onCreateView: START");  
        binding = FragmentOpenChatBinding.inflate(inflater, container, false);  
        Log.i(TAG, "onCreateView: END");  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(View view, Bundle savedInstanceState) {  
        Log.i(TAG, "onViewCreated: START");  
  
        super.onViewCreated(view, savedInstanceState);  
        initToolbar();  
        setUpRecyclerView();  
  
        Log.i(TAG, "onViewCreated: END");  
    }  
  
    // 툴바 세팅  
    private void initToolbar() {  
        Log.i(TAG, "initToolbar: START");  
        binding.toolbarOpenchat.inflateMenu(R.menu.menu_openchat_toolbar);  
        binding.toolbarOpenchat.setOnMenuItemClickListener(new Toolbar.OnMenuItemClickListener() {  
            @Override  
            public boolean onMenuItemClick(MenuItem item) {  
                int itemId = item.getItemId();  
  
//                if (itemId == R.id.item_openchat_search) {  
//                    // TODO 클릭시 검색창 펼쳐짐  
//                    Toast.makeText(getContext(), "검색창 클릭", Toast.LENGTH_SHORT).show();  
//                    return true;  
//                }  
  
                // 새 채팅방 생성  
                if (itemId == R.id.item_openchat_newchat) {  
                    Intent intent = new Intent(OpenChatFragment.this.getActivity(), NewOpenChatActivity.class);  
                    startActivity(intent);  
                    return true;  
                }  
  
                return false;  
            }  
        });  
        Log.i(TAG, "initToolbar: END");  
    }  
  
    // 리사이클러 뷰 세팅  
    private void setUpRecyclerView() {  
        Log.i(TAG, "setUpRecyclerView: START");  
        // 리사이클러 뷰 세팅  
        binding.rvOpenChatChatRoomList.setLayoutManager(new LinearLayoutManager(getContext()));  
        loadRoomList();  
        adapter = new ChatRoomAdapter(roomItemList, this.getActivity());  
        binding.rvOpenChatChatRoomList.setAdapter(adapter);  
        binding.rvOpenChatChatRoomList.setHasFixedSize(true);  
        binding.rvOpenChatChatRoomList.addItemDecoration(new DividerItemDecoration(getContext(), DividerItemDecoration.VERTICAL));  
  
        adapter.notifyDataSetChanged();  
        Log.i(TAG, "setUpRecyclerView: END");  
    }  
  
    // 방 목록 불러오기  
    public void loadRoomList() {  
        Log.i(TAG, "loadRoomList: START");  
        roomItemList.clear();  
  
        List<ChatRoom> roomList = dbHelper.getAllChatroomItem(CreateRoomCommand.RoomType.OPEN);  
  
        for (ChatRoom room : roomList) {  
            Log.i(TAG, "loadRoomList: roomId = " + room.id + ", roomName = " + room.roomName  
                    + ", updatedAt = " + room.updatedAt);  
            String updated = room.updatedAt;  
  
            // 아무 메시지 없는 것은 패스 (일반채팅에서는 아래 코드가 실행 됨, 오픈채팅에서만 실행하지 않는다.)  
//            if ("0".equals(updated)) {  
//                Log.i(TAG, "loadRoomList: updated 가 0 임, 출력하지 않음");  
//                continue;  
//            }  
  
            // 목록에 추가  
            roomItemList.add(room.id);  
            if (adapter != null) adapter.notifyDataSetChanged();  
            Log.d(TAG, "loadRoomList: roomItemList=" + roomItemList);  
        }  
  
        Log.d(TAG, "loadRoomList: 추가된 오픈챗 id 목록 : " + roomItemList);  
        Log.i(TAG, "loadRoomList: END");  
    }  
  
    public void loadRoomListWithUiSync() {  
        Log.i(TAG, "loadRoomListWithUiSync: START");  
        loadRoomList();  
        adapter.notifyDataSetChanged();  
        Log.i(TAG, "loadRoomListWithUiSync: END");  
    }  
  
    private BroadcastReceiver messageReceiver = new BroadcastReceiver() {  
        @Override  
        public void onReceive(Context context, Intent intent) {  
            String message = intent.getStringExtra("message");  
            Log.i(TAG, "onReceive: 방 리스트 변경 수신 intent action = " + intent.getAction());  
  
            // 현재는 알림 올만한 일이 "list_update"만 있음  
            getActivity().runOnUiThread(() -> {  
                // 방 목록 리사이클러 뷰 ui 업데이트  
                adapter.notifyDataSetChanged();  
            });  
        }  
    };  
  
    @Override  
    public void onStart() {  
        Log.i(TAG, "onStart: START");  
        super.onStart();  
        isOpenChatVisible = true;  
  
        Log.i(TAG, "onStart: END");  
    }  
  
    @Override  
    public void onStop() {  
        Log.i(TAG, "onStop: START");  
        super.onStop();  
        isOpenChatVisible = false;  
        Log.i(TAG, "onStop: END");  
    }  
  
    @Override  
    public void onResume() {  
        super.onResume();  
        Log.d(TAG, "onResume: ");  
        loadRoomListWithUiSync();  
        LocalBroadcastManager.getInstance(getContext()).registerReceiver(messageReceiver, new IntentFilter("openChatList_event"));  
    }  
  
    @Override  
    public void onPause() {  
        super.onPause();  
        Log.d(TAG, "onPause: ");  
        LocalBroadcastManager.getInstance(getContext()).unregisterReceiver(messageReceiver);  
    }  
}  
</document_content>  
</document>  
<document index="165">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\OpenChatSearchResultFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.fragment.app.Fragment;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.data.retrofit.clients.SearchApiClient;  
import com.teamnova.assa.databinding.FragmentOpenChatSearchResultBinding;  
import com.teamnova.assa.ui.adapter.OpenChatSearchResultAdapter;  
import com.teamnova.assa.util.RetrofitUtils;  
  
import java.util.ArrayList;  
import java.util.Comparator;  
import java.util.List;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class OpenChatSearchResultFragment extends Fragment {  
    private static String TAG = OpenChatSearchResultFragment.class.getSimpleName();  
    FragmentOpenChatSearchResultBinding binding;  
    OpenChatSearchResultAdapter adapter;  
    String query;  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentOpenChatSearchResultBinding.inflate(inflater, container, false);  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        Log.i(TAG, "onViewCreated: START");  
        super.onViewCreated(view, savedInstanceState);  
        // 리사이클러 뷰 초기화  
        initRecyclerView();  
  
        Log.i(TAG, "onViewCreated: END");  
    }  
  
    private void initRecyclerView() {  
        Log.i(TAG, "initRecyclerView: START");  
        binding.rvOpenChatSearchResult.setLayoutManager(new LinearLayoutManager(getContext()));  
        adapter = new OpenChatSearchResultAdapter(new ArrayList<>(), this.getActivity());  
        binding.rvOpenChatSearchResult.setAdapter(adapter);  
  
        // 아이템 구분선 추가  
        RecyclerView.ItemDecoration decoration = new DividerItemDecoration(getContext(), DividerItemDecoration.VERTICAL);  
        binding.rvOpenChatSearchResult.addItemDecoration(decoration);  
        Log.i(TAG, "initRecyclerView: END");  
    }  
  
  
  
    /**  
     * 데이터 업데이트  
     *  
     * @param query  
     */  
    public void updateData(String query) {  
        Log.i(TAG, "updateData: " + query);  
        this.query = query;  
        // 데이터 업데이트  
        // 네트워크 요청을 통해 새로운 데이터를 가져오고 UI 업데이트  
        SearchApiClient.getInstance().searchOpenChatByRoomName(query).enqueue(new Callback<List<ChatRoom>>() {  
            @Override  
            public void onResponse(Call<List<ChatRoom>> call, Response<List<ChatRoom>> response) {  
                if (response.isSuccessful()) {  
                    updateUi(response.body());  
                } else {  
                    RetrofitUtils.onError(getContext(), TAG, "오픈채팅 검색");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<List<ChatRoom>> call, Throwable throwable) {  
                Log.e(TAG, "onFailure: 오픈채팅 검색 실패", throwable);  
                Toast.makeText(getContext(), "오픈채팅 검색 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    /**  
     * UI 업데이트  
     *  
     * @param chatRooms  
     */  
    private void updateUi(List<ChatRoom> chatRooms) {  
        Log.i(TAG, "updateUi: START - params : chatRooms = " + chatRooms);  
  
        // 최근 생성된 id 순으로 정렬한다.  
        chatRooms.sort(Comparator.comparing(ChatRoom::getRoomName));  
  
        adapter.setItems(chatRooms);  
    }  
  
}  
</document_content>  
</document>  
<document index="166">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\PostSearchResultFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.fragment.app.Fragment;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.retrofit.clients.SearchApiClient;  
import com.teamnova.assa.databinding.FragmentPostSearchResultBinding;  
import com.teamnova.assa.ui.adapter.PostAdapter;  
import com.teamnova.assa.util.RetrofitUtils;  
  
import java.util.ArrayList;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class PostSearchResultFragment extends Fragment {  
    private static final String TAG = "PostSearchResultFragment";  
    FragmentPostSearchResultBinding binding;  
    String query;  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentPostSearchResultBinding.inflate(inflater, container, false);  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
        // 뷰 초기화  
        setRecyclerView();  
    }  
  
    private void setRecyclerView() {  
        // 리사이클러 뷰 세팅  
        binding.rvPostSearchResult.setLayoutManager(new LinearLayoutManager(getContext()));  
        PostAdapter adapter = new PostAdapter(this.getContext());  
        binding.rvPostSearchResult.setAdapter(adapter);  
    }  
  
    @Override  
    public void onStart() {  
        super.onStart();  
        Log.d(TAG, "onStart: " + query);  
        // 데이터 받아오기  
        if(query != null) updateData(query);  
    }  
  
    /**  
     * 데이터 업데이트  
     *  
     * @param query  
     */  
    public void updateData(String query) {  
        Log.d(TAG, "updateData: " + query);  
        this.query = query;  
        // 데이터 업데이트  
        // 네트워크 요청을 통해 새로운 데이터를 가져오고 UI 업데이트  
        SearchApiClient.getInstance().searchPostsByContent(query).enqueue(new Callback<PaginatedResponse<Post>>() {  
            @Override  
            public void onResponse(Call<PaginatedResponse<Post>> call, Response<PaginatedResponse<Post>> response) {  
                if (response.isSuccessful()) {  
                    updateUi(response.body().data);  
                } else {  
                    RetrofitUtils.onError(getContext(), TAG, "게시물 검색");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<PaginatedResponse<Post>> call, Throwable throwable) {  
                RetrofitUtils.onFailure(getContext(), TAG, "게시물 검색", throwable);  
            }  
        });  
    }  
  
    /**  
     * UI 업데이트  
     *  
     * @param posts  
     */  
    private void updateUi(ArrayList<Post> posts) {  
        ((PostAdapter) binding.rvPostSearchResult.getAdapter()).setItems(posts);  
    }  
  
}  
</document_content>  
</document>  
<document index="167">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\ProfileFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.Menu;  
import android.view.MenuInflater;  
import android.view.MenuItem;  
import android.view.View;  
import android.view.ViewGroup;  
import android.widget.Toast;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.fragment.app.Fragment;  
import androidx.recyclerview.widget.ConcatAdapter;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.teamnova.assa.R;  
import com.teamnova.assa.data.dto.data.Post;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.helper.SPHelper;  
import com.teamnova.assa.data.retrofit.clients.AuthApiClient;  
import com.teamnova.assa.data.retrofit.clients.SearchApiClient;  
import com.teamnova.assa.databinding.FragmentProfileBinding;  
import com.teamnova.assa.ui.activity.ProfileNotificationActivity;  
import com.teamnova.assa.ui.activity.SettingActivity;  
import com.teamnova.assa.ui.adapter.PostAdapter;  
import com.teamnova.assa.ui.adapter.UserProfileInfoAdapter;  
  
import java.util.ArrayList;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class ProfileFragment extends Fragment {  
  
    private final String TAG = ProfileFragment.class.getSimpleName();  
    private FragmentProfileBinding binding;  
    private UserProfileInfoAdapter userProfileInfoAdapter;  
    private PostAdapter postAdapter;  
    private ConcatAdapter concatAdapter;  
    private Boolean friendRequestExist = false;  
    private MenuItem menuItem;  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentProfileBinding.inflate(inflater, container, false);  
        Log.d(TAG, "onCreateView: 실행 됨");  
        return binding.getRoot();  
    }  
  
    /**  
     * 뷰의 초기화 담당  
     */  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
        setHasOptionsMenu(true);  
        setToolbar();  
        userProfileInfoAdapter = new UserProfileInfoAdapter(getActivity());  
        postAdapter = new PostAdapter(getContext());  
  
        concatAdapter = new ConcatAdapter(userProfileInfoAdapter, postAdapter);  
  
        binding.rvProfileContainer.setAdapter(concatAdapter);  
        binding.rvProfileContainer.setLayoutManager(new LinearLayoutManager(getContext()));  
    }  
  
    private void setToolbar(){  
        AppCompatActivity activity = (AppCompatActivity) getActivity();  
        if (activity != null) {  
            activity.setSupportActionBar(binding.toolbarMyProfile);  
            activity.getSupportActionBar().setDisplayShowTitleEnabled(false);  
        }  
    }  
  
    // 이 시점에 사용자에게 화면이 보여지기 때문에 이 시점에 사용자에게 보여줄  
    // 사용자 데이터를 준비한다.  
    @Override  
    public void onStart() {  
        super.onStart();  
        Log.d(TAG, "onStart getUserInfo 실행");  
        // 서버에서 사용자 데이터 받아오기  
        getUserInfo();  
    }  
  
    @Override  
    public void onCreateOptionsMenu(@NonNull Menu menu, @NonNull MenuInflater inflater) {  
        inflater.inflate(R.menu.menu_my_profile_toolbar, menu);  
        menuItem = menu.findItem(R.id.menu_item_my_profile_notificatinon);  
    }  
  
    private void updateNotificationIcon(boolean notificationExist){  
        if(menuItem != null){  
            if(notificationExist){  
                menuItem.setIcon(R.drawable.ic_bell_on);  
                menuItem.setTitle("친구신청 알림");  
            }else{  
                menuItem.setIcon(R.drawable.ic_notification);  
            }  
        }  
    }  
  
    @Override  
    public boolean onOptionsItemSelected(@NonNull MenuItem item) {  
        int id = item.getItemId();  
  
        if (id == R.id.menu_item_my_profile_notificatinon) {  
            // 알림 화면으로 이동  
            Intent intent = new Intent(getActivity(), ProfileNotificationActivity.class);  
            intent.putExtra("userId", SPHelper.getUserId());  
            startActivity(intent);  
            return true;  
        } else if (id == R.id.menu_item_my_profile_settings) {  
            Intent intent = new Intent(getActivity(), SettingActivity.class);  
            startActivity(intent);  
        }  
  
        return super.onOptionsItemSelected(item);  
    }  
  
    // 서버에서 사용자 데이터 받아오기  
    // 받아온 데이터를 사용자 정보 아답터에 넘겨줘야함  
    private void getUserInfo() {  
        AuthApiClient.getInstance().me().enqueue(new Callback<UserData>() {  
            @Override  
            public void onResponse(Call<UserData> call, Response<UserData> response) {  
                Log.d(TAG, "사용자 정보 얻어오기 응답 성공 : " + response);  
                if (response.isSuccessful()) {  
                    UserData userData = response.body();  
                    Log.d(TAG, "받아온 사용자 정보 : " + userData);  
                    updateNotificationIcon(userData.friendRequestExist);  
                    // 어댑터에 값 추가  
                    userProfileInfoAdapter.setUserData(userData);  
                    getUserPosts(userData.id);  
                } else {  
                    Log.d(TAG, "사용자 정보 얻어오기 에러 응답");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<UserData> call, Throwable throwable) {  
                Log.e(TAG, "사용자 정보 얻어오기 통신 실패", throwable);  
            }  
        });  
    }  
  
    // 서버에서 사용자의 게시글 받아오기  
    private void getUserPosts(Long userId) {  
        SearchApiClient.getInstance().searchPostsByUserId(userId.toString()).enqueue(new Callback<PaginatedResponse<Post>>() {  
            @Override  
            public void onResponse(Call<PaginatedResponse<Post>> call, Response<PaginatedResponse<Post>> response) {  
                if (response.isSuccessful()) {  
                    Log.d(TAG, "게시글 받아오기 응답 성공 : " + response);  
                    PaginatedResponse<Post> searchResponse = response.body();  
                    Log.d(TAG, "받아온 게시글 : " + searchResponse);  
                    setPostsData(searchResponse.data);  
                } else {  
                    Log.d(TAG, "게시글 받아오기 에러 응답");  
                    Toast.makeText(getContext(), "게시글 받아오기 에러 응답", Toast.LENGTH_SHORT).show();  
                }  
            }  
  
            @Override  
            public void onFailure(Call<PaginatedResponse<Post>> call, Throwable throwable) {  
                Log.d(TAG, "게시글 받아오기 통신 실패");  
                Toast.makeText(getContext(), "게시글 받아오기 통신 실패", Toast.LENGTH_SHORT).show();  
            }  
        });  
    }  
  
    private void setPostsData(ArrayList<Post> posts) {  
        Log.d(TAG, "setPostsData: 게시글 데이터 설정 posts = " + posts);  
        postAdapter.setItems(posts);  
    }  
}  
</document_content>  
</document>  
<document index="168">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\SearchFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.content.Intent;  
import android.os.Bundle;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.appcompat.app.AppCompatActivity;  
import androidx.appcompat.widget.SearchView;  
import androidx.fragment.app.Fragment;  
  
import com.teamnova.assa.databinding.FragmentSearchBinding;  
import com.teamnova.assa.ui.activity.SearchResultActivity;  
  
public class SearchFragment extends Fragment {  
    private FragmentSearchBinding binding;  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentSearchBinding.inflate(inflater, container, false);  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
  
        setToolbar();  
    }  
  
    private void setToolbar() {  
        // 툴바를 액티비티에 설정  
        setHasOptionsMenu(true);  
  
        AppCompatActivity activity = (AppCompatActivity) getActivity();  
        if (activity != null) {  
            activity.setSupportActionBar(binding.tbSearch);  
            activity.getSupportActionBar().setDisplayShowTitleEnabled(false);  
        }  
  
        initSearchView();  
    }  
  
    private void initSearchView() {  
        binding.svSearch.setOnQueryTextListener(new SearchView.OnQueryTextListener() {  
            @Override  
            public boolean onQueryTextSubmit(String query) {  
                Intent intent = new Intent(getActivity(), SearchResultActivity.class);  
                intent.putExtra("query", query);  
                startActivity(intent);  
                return true;  
            }  
  
            @Override  
            public boolean onQueryTextChange(String newText) {  
                return false;  
            }  
        });  
    }  
  
}  
</document_content>  
</document>  
<document index="169">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\UserSearchResultFragment.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.fragment.app.Fragment;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
import androidx.recyclerview.widget.RecyclerView;  
  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.dto.response.PaginatedResponse;  
import com.teamnova.assa.data.retrofit.clients.SearchApiClient;  
import com.teamnova.assa.databinding.FragmentUserSearchResultBinding;  
import com.teamnova.assa.ui.adapter.UserPreviewAdapter;  
import com.teamnova.assa.util.RetrofitUtils;  
  
import java.util.ArrayList;  
  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
  
public class UserSearchResultFragment extends Fragment {  
  
    private static String TAG = UserSearchResultFragment.class.getSimpleName();  
    FragmentUserSearchResultBinding binding;  
    String query;  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentUserSearchResultBinding.inflate(inflater, container, false);  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
        setRecyclerView();  
    }  
  
    private void setRecyclerView() {  
        // 리사이클러 뷰 세팅  
        binding.rvUserSearchResult.setLayoutManager(new LinearLayoutManager(getContext()));  
        UserPreviewAdapter adapter = new UserPreviewAdapter(this.getActivity());  
        binding.rvUserSearchResult.setAdapter(adapter);  
  
        // 구분선  
        RecyclerView.ItemDecoration decoration = new DividerItemDecoration(getContext(), DividerItemDecoration.VERTICAL);  
        binding.rvUserSearchResult.addItemDecoration(decoration);  
    }  
  
    @Override  
    public void onStart() {  
        super.onStart();  
        Log.d(TAG, "onStart: ");  
        if (query != null) updateData(query);  
    }  
  
    public void updateData(String query) {  
        Log.d(TAG, "updateData: " + query);  
        this.query = query;  
        SearchApiClient.getInstance().searchUserByNickname(query).enqueue(new Callback<PaginatedResponse<UserData>>() {  
            @Override  
            public void onResponse(Call<PaginatedResponse<UserData>> call, Response<PaginatedResponse<UserData>> response) {  
                if (response.isSuccessful()) {  
                    updateUi(response.body().data);  
                } else {  
                    RetrofitUtils.onError(getContext(), TAG, "유저 검색");  
                }  
            }  
  
            @Override  
            public void onFailure(Call<PaginatedResponse<UserData>> call, Throwable throwable) {  
                RetrofitUtils.onFailure(getContext(), TAG, "유저 검색", throwable);  
            }  
        });  
    }  
  
    private void updateUi(ArrayList<UserData> users) {  
        ((UserPreviewAdapter) binding.rvUserSearchResult.getAdapter()).setItems(users);  
    }  
}  
</document_content>  
</document>  
<document index="170">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\VideoChatBottomSheet.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.content.Context;  
import android.os.Bundle;  
import android.text.Editable;  
import android.text.TextWatcher;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.google.android.material.bottomsheet.BottomSheetBehavior;  
import com.google.android.material.bottomsheet.BottomSheetDialogFragment;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.databinding.FragmentVideoChatBottomSheetBinding;  
import com.teamnova.assa.ui.activity.VideoCallActivity;  
import com.teamnova.assa.ui.adapter.SimpleChatAdapter;  
import com.teamnova.assa.util.TempStorage;  
import com.teamnova.assa.util.TimeUtils;  
  
import java.util.ArrayList;  
import java.util.List;  
  
  
public class VideoChatBottomSheet extends BottomSheetDialogFragment {  
  
    public static final String TAG = VideoChatBottomSheet.class.getSimpleName();  
    Context context;  
    FragmentVideoChatBottomSheetBinding binding;  
  
    String videoRoomId;  
    Long roomId;  
    boolean isHost;  
  
    BottomSheetBehavior bottomSheetBehavior;  
  
    SimpleChatAdapter adapter;  
  
    private List<SimpleChatAdapter.Message> messages = new ArrayList<>();  
  
    public VideoChatBottomSheet(Context context, List<SimpleChatAdapter.Message> previousMessages) {  
        this.context = context;  
        this.messages = previousMessages;  
    }  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentVideoChatBottomSheetBinding.inflate(inflater, container, false);  
  
//        Bundle args = getArguments(); // 인텐트로 받아온 데이터  
//        videoRoomId = args.getString("videoRoomId");  
//        roomId = args.getLong("roomId");  
//        isHost = args.getBoolean("isHost");  
  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
  
        // 다이얼로그 높이 조절  
        View bottomSheetView = (View) view.getParent();  
        bottomSheetBehavior = BottomSheetBehavior.from(bottomSheetView);  
        bottomSheetView.getLayoutParams().height = (int) (getResources().getDisplayMetrics().heightPixels * 0.5); // 메인 액티비티의 반을 채우도록 함  
        bottomSheetView.setLayoutParams(bottomSheetView.getLayoutParams());  
        bottomSheetBehavior.setState(BottomSheetBehavior.STATE_EXPANDED);  
  
        // 이전 채팅 기록 복구 및 리사이클러 뷰 세팅  
        adapter = new SimpleChatAdapter(context);  
        LinearLayoutManager layoutManager = new LinearLayoutManager(getContext());  
        layoutManager.setStackFromEnd(true);  
        binding.rvChatLog.setLayoutManager(layoutManager);  
        binding.rvChatLog.setAdapter(adapter);  
        binding.rvChatLog.setHasFixedSize(true);  
  
        if(adapter.getItemCount() == 0) {  
            // 맨 처음에는 오늘의 날짜 출력  
            SimpleUser serverUser = new SimpleUser(0L, null, null);  
            SimpleChatAdapter.Message messageObj =  
                    new SimpleChatAdapter.Message(serverUser, TimeUtils.getCurrentTimeInUTC(), TimeUtils.getCurrentTimeInUTC(), "SERVER");  
            adapter.addMessage(messageObj);  
        }  
  
        // 전송버튼 리스너  
        binding.btnSend.setOnClickListener(v -> {  
            String message = binding.etMessage.getText().toString();  
            if (!message.isEmpty()) {  
                Long senderId = TempStorage.getSimpleMe().id;  
                String currentTime = TimeUtils.getCurrentTimeInUTC();  
  
                // 메시지 형식 맞춰서 WebRTC 데이터 채널로 전송  
                StringBuilder sb = new StringBuilder();  
                sb.append("TEXT").append("|")  
                        .append(senderId).append("|")  
                        .append(currentTime).append("|")  
                        .append(message);  
  
                sendChat(sb.toString());  // WebRTC 데이터 채널로 전송  
                binding.etMessage.setText("");  // 입력창 초기화  
            }  
        });  
  
        // 텍스트 와쳐 부착  
        binding.etMessage.addTextChangedListener(new TextWatcher() {  
            @Override  
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {  
  
            }  
  
            @Override  
            public void onTextChanged(CharSequence s, int start, int before, int count) {  
  
            }  
  
            @Override  
            public void afterTextChanged(Editable s) {  
                binding.btnSend.setEnabled(s.length() > 0);  
            }  
        });  
  
    }  
  
    // WebRTC로 메시지 전송  
    private void sendChat(String message) {  
        ((VideoCallActivity) getActivity()).sendChat(message);  // VideoCallActivity의 WebRTC 메시지 전송 함수 호출  
  
        // 자기 자신에게도 메시지 추가  
        String[] result = message.split("\\|", 5);  
        String type = result[0];  
        String senderId = result[1];  
        String datetime = result[2];  
        String msg = result[3];  
  
        adapter.addMessage(new SimpleChatAdapter.Message(TempStorage.getSimpleMe(), msg, datetime, type));  
        binding.rvChatLog.scrollToPosition(messages.size() - 1);  
    }  
  
    // 채팅 기록 반환  
    public List<SimpleChatAdapter.Message> getMessages() {  
        return messages;  
    }  
  
  
  
}  
</document_content>  
</document>  
<document index="171">  
<source>app/src/main/java\com\teamnova\assa\ui\fragment\VideoRoomParticipantBottomSheet.java</source>  
<document_content>  
package com.teamnova.assa.ui.fragment;  
  
import android.content.BroadcastReceiver;  
import android.content.Context;  
import android.content.Intent;  
import android.content.IntentFilter;  
import android.os.Bundle;  
import android.util.Log;  
import android.view.LayoutInflater;  
import android.view.View;  
import android.view.ViewGroup;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.localbroadcastmanager.content.LocalBroadcastManager;  
import androidx.recyclerview.widget.DividerItemDecoration;  
import androidx.recyclerview.widget.LinearLayoutManager;  
  
import com.google.android.material.bottomsheet.BottomSheetBehavior;  
import com.google.android.material.bottomsheet.BottomSheetDialogFragment;  
import com.teamnova.assa.command.GetVideoRoomParticipantCommand;  
import com.teamnova.assa.databinding.FragmentVideoRoomParticipantBottomSheetBinding;  
import com.teamnova.assa.service.ChattingSocketService;  
import com.teamnova.assa.ui.activity.VideoCallActivity;  
import com.teamnova.assa.ui.adapter.ParticipantAdapter;  
  
  
public class VideoRoomParticipantBottomSheet extends BottomSheetDialogFragment {  
  
    public static final String TAG = VideoRoomParticipantBottomSheet.class.getSimpleName();  
    Context context;  
    FragmentVideoRoomParticipantBottomSheetBinding binding;  
  
    String videoRoomId;  
    Long roomId;  
    boolean isHost;  
  
    BottomSheetBehavior bottomSheetBehavior;  
  
    ParticipantAdapter adapter;  
  
    public VideoRoomParticipantBottomSheet(Context context) {  
        this.context = context;  
    }  
  
    @Override  
    public View onCreateView(LayoutInflater inflater, ViewGroup container,  
                             Bundle savedInstanceState) {  
        binding = FragmentVideoRoomParticipantBottomSheetBinding.inflate(inflater, container, false);  
  
        Bundle args = getArguments(); // 인텐트로 받아온 데이터  
        videoRoomId = args.getString("videoRoomId");  
        roomId = args.getLong("roomId");  
        isHost = args.getBoolean("isHost");  
  
        return binding.getRoot();  
    }  
  
    @Override  
    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {  
        super.onViewCreated(view, savedInstanceState);  
  
        View bottomSheetView = (View) view.getParent();  
        bottomSheetBehavior = BottomSheetBehavior.from(bottomSheetView);  
        bottomSheetView.getLayoutParams().height = (int) (getResources().getDisplayMetrics().heightPixels * 0.5); // 메인 액티비티의 반을 채우도록 함  
        bottomSheetView.setLayoutParams(bottomSheetView.getLayoutParams());  
        bottomSheetBehavior.setState(BottomSheetBehavior.STATE_EXPANDED);  
  
        // 리사이클러 뷰 준비  
        adapter = new ParticipantAdapter(getActivity());  
        binding.rvParticipant.setLayoutManager(new LinearLayoutManager(getContext()));  
        binding.rvParticipant.setAdapter(adapter);  
        binding.rvParticipant.setHasFixedSize(true);  
        binding.rvParticipant.addItemDecoration(new DividerItemDecoration(getContext(), DividerItemDecoration.VERTICAL));  
  
        // 버튼 리스너  
        binding.btnVideoRoomEnter.setOnClickListener(v -> {  
            // 영상회의 화면으로 이동  
            Intent videoRoomIntent = new Intent(context, VideoCallActivity.class);  
            videoRoomIntent.putExtra("roomId", this.roomId);  
            videoRoomIntent.putExtra("isHost", false);  
            videoRoomIntent.putExtra("videoRoomId", this.videoRoomId);  
            context.startActivity(videoRoomIntent);  
            dismiss();  
        });  
  
        // 소켓 서버에 참가자 목록 요청  
        GetVideoRoomParticipantCommand command = new GetVideoRoomParticipantCommand(this.videoRoomId);  
        sendRequest(command.toJson());  
    }  
  
    void sendRequest(String message) {  
        Log.i(TAG, "sendMessage: START - params: message=" + message);  
        Intent intent = new Intent(getContext(), ChattingSocketService.class);  
        intent.putExtra("message", message);  
        Log.d(TAG, "sendMessage: intent=" + intent);  
        getActivity().startService(intent);  
        Log.i(TAG, "sendMessage: END");  
    }  
  
    @Override  
    public void onResume() {  
        super.onResume();  
  
        IntentFilter filter = new IntentFilter("videoRoom_participant");  
        LocalBroadcastManager.getInstance(getContext()).registerReceiver(receiver, filter);  
    }  
  
    @Override  
    public void onPause() {  
        super.onPause();  
        LocalBroadcastManager.getInstance(getContext()).unregisterReceiver(receiver);  
    }  
  
    private BroadcastReceiver receiver = new BroadcastReceiver() {  
        @Override  
        public void onReceive(Context context, Intent intent) {  
            // 데이터를 받는 부분  
            if (intent != null) {  
                String data = intent.getStringExtra("message");  
                Log.d("Fragment", "수신한 데이터: " + data);  
  
                GetVideoRoomParticipantCommand command = null;  
                try {  
                    command = GetVideoRoomParticipantCommand.fromJson(data);  
                } catch (Exception e) {  
                    throw new RuntimeException(e);  
                }  
  
                // 받은 참가자 목록을 리사이클러 뷰로 출력한다.  
                adapter.setItems(command.userList);  
            }  
        }  
    };  
  
  
}  
</document_content>  
</document>  
<document index="172">  
<source>app/src/main/java\com\teamnova\assa\util\DBHelper.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.ContentValues;  
import android.content.Context;  
import android.database.Cursor;  
import android.database.sqlite.SQLiteDatabase;  
import android.database.sqlite.SQLiteOpenHelper;  
import android.util.Log;  
  
import androidx.annotation.Nullable;  
  
import com.google.gson.Gson;  
import com.google.gson.JsonArray;  
import com.google.gson.JsonObject;  
import com.google.gson.JsonParser;  
import com.teamnova.assa.command.CreateRoomCommand;  
import com.teamnova.assa.command.RoomInfoCommand;  
import com.teamnova.assa.command.SendMessageCommand;  
import com.teamnova.assa.data.dto.data.ChatRoom;  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.helper.SPHelper;  
  
import java.util.ArrayList;  
import java.util.List;  
  
/**  
 * 로컬 DB (SQLite) 다루는 클래스  
 */  
public class DBHelper extends SQLiteOpenHelper {  
  
    public static final String TAG = DBHelper.class.getSimpleName();  
    public static final int DB_VERSION = 1;  
    public static final String DB_NAME = "assa.db";  
  
    public DBHelper(@Nullable Context context) {  
        super(context, DB_NAME, null, DB_VERSION);  
    }  
  
    // 앱이 최초로 설치시 실행됨  
    @Override  
    public void onCreate(SQLiteDatabase db) {  
        // 새로운 테이블 생성  
        // 방 정보 테이블: id, 방이름, 사용자 지정 방이름 여부, 업데이트 시각, 알림 on/off 여부, 방장 id  
        db.execSQL("CREATE TABLE IF NOT EXISTS chat_rooms (id INTEGER PRIMARY KEY, room_name TEXT, updated_at TEXT, noti_on INTEGER, master_user_id INTEGER, data_owner_id INTEGER, room_type TEXT, local_name TEXT, description TEXT);");  
  
        // 채팅방 멤버 정보 id, 유저id, 방 id, 닉네임, 프로필이미지, 나갔는지 여부  
        db.execSQL("CREATE TABLE IF NOT EXISTS chat_members (id INTEGER PRIMARY KEY AUTOINCREMENT, room_id INTEGER, user_id INTEGER, nickname TEXT, profile_image TEXT, is_exit INTEGER);");  
  
        //채팅내용 테이블: id, 방id, 보낸사람 id, 메시지내용, 보낸시각, 읽음여부  
        db.execSQL("CREATE TABLE IF NOT EXISTS chat_logs (id INTEGER PRIMARY KEY, room_id INTEGER, sender_id INTEGER, message TEXT, date_time TEXT, is_Read TEXT, type TEXT, image_name TEXT, video_path TEXT, video_path_server TEXT);");  
    }  
  
    // 버전이 변경될 때 호출되는 메소드  
    @Override  
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {  
    }  
  
    // 방 정보 insert - id(서버에서 부여함), 방이름  
    public void insertChatRoom(RoomInfoCommand command) {  
        Log.d(TAG, "insertChatRoom: START - params: id=" + command.roomId +  
                ", roomName=" + command.roomName + ", masterId=" + command.masterId + ", roomType =" + command.roomType);  
  
        long lastInsertedId;  
        SQLiteDatabase db = getWritableDatabase();  
  
        long userId = SPHelper.getUserId();  
  
        // 채팅방 정보 insert  
        ContentValues values = new ContentValues();  
        values.put("id", command.roomId);  
        values.put("room_name", command.roomName);  
        values.put("updated_at", "0");  
        values.put("noti_on", 1);  
        values.put("master_user_id", command.masterId);  
        values.put("data_owner_id", userId);  
        values.put("room_type", command.roomType.toString());  
        values.put("description", command.description);  
  
        lastInsertedId = db.insert("chat_rooms", null, values);  
        Log.d(TAG, "insertChatRoom: 추가된 채팅방의 id = " + lastInsertedId);  
        Log.d(TAG, "insertChatRoom: END");  
    }  
  
    public void updateChatRoomInfo(RoomInfoCommand command) {  
        Log.d(TAG, "updateChatRoomInfo: START - params: command=" + command.toJson());  
  
        SQLiteDatabase db = getWritableDatabase();  
  
        // 방 정보 업데이트  
        ContentValues values = new ContentValues();  
        values.put("master_user_id", command.masterId);  
        values.put("room_name", command.roomName);  
        values.put("description", command.description);  
  
        String roomIdStr = String.valueOf(command.roomId);  
        String where = "id = ?";  
        db.update("chat_rooms", values, where, new String[]{roomIdStr});  
  
        // 멤버목록 업데이트  
        // 1. 주어진 roomId의 멤버 목록을 불러온다.  
        List<SimpleUser> originMemberList = getChatRoomMembers(command.roomId, false);  
  
        // 2. 서버로 부터 제공받은 멤버명단을 순회한다.  
        // 로컬에 유저정보가 이미 존재하면 해당 유저정보를 업데이트한다.  
        // 존재하지 않으면 로컬에 추가한다.  
        for (SimpleUser user : command.memberList) {  
            boolean isExist = false;  
            for (SimpleUser originUser : originMemberList) {  
                if (user.id == originUser.id) {  
                    updateChatRoomMember(command.roomId, user);  
                    isExist = true;  
                    break;  
                }  
            }  
            // 완전 새로운 멤버면 추가  
            if (!isExist) {  
                insertChatRoomMember(command.roomId, user);  
            }  
        }  
        Log.d(TAG, "updateChatRoomInfo: END");  
    }  
  
    // 채팅방 멤버 정보 추가  
    public void insertChatRoomMember(long roomId, SimpleUser user) {  
        Log.d(TAG, "insertChatRoomMember: START - params: roomId=" + roomId +  
                ", userId=" + user.id + ", nickname=" + user.nickname + ", profileImage=" + user.profileImage);  
        SQLiteDatabase db = getWritableDatabase();  
  
        // 입력 값 세팅  
        //  유저id, 방 id, 닉네임, 프로필이미지, 나갔는지 여부  
        ContentValues values = new ContentValues();  
        values.put("room_id", roomId);  
        values.put("user_id", user.id);  
        values.put("nickname", user.nickname);  
        values.put("profile_image", user.profileImage);  
        values.put("is_exit", 0);  
  
        db.insert("chat_members", null, values);  
        Log.d(TAG, "insertChatMember: 채팅방 멤버 추가됨");  
  
        Log.d(TAG, "insertChatMember: END");  
    }  
  
    public void updateChatRoomMember(long roomId, SimpleUser user) {  
        Log.d(TAG, "updateChatMember: START - params: roomId=" + roomId +  
                ", userId=" + user.id + ", nickname=" + user.nickname + ", profileImage=" + user.profileImage +  
                ", isExit=" + user.isExit);  
  
        SQLiteDatabase db = getWritableDatabase();  
  
        ContentValues values = new ContentValues();  
        values.put("room_id", roomId);  
        values.put("user_id", user.id);  
        values.put("nickname", user.nickname);  
        values.put("profile_image", user.profileImage);  
        values.put("is_exit", user.isExit);  
  
        String roomIdStr = String.valueOf(roomId);  
        String userIdStr = String.valueOf(user.id);  
        String where = "room_id = ? AND user_id = ?";  
  
        db.update("chat_members", values, where, new String[]{roomIdStr, userIdStr});  
  
        Log.d(TAG, "updateChatMember: 멤버변경 업데이트 완료");  
        Log.d(TAG, "updateChatMember: END");  
    }  
  
    // 채팅방 멤버객체 리스트 반환  
    public List<SimpleUser> getChatRoomMembers(long roomId, boolean onlyEntered) {  
        Log.d(TAG, "getChatRoomMembers: START - params: roomId=" + roomId);  
        SQLiteDatabase db = getWritableDatabase();  
        List<SimpleUser> memberList = new ArrayList<>();  
        String roomIdStr = String.valueOf(roomId);  
  
        // onlyEntered가 true면 나간 사람은 제외하고 가져온다.  
        String query = "SELECT * FROM chat_members WHERE room_id = ? " + (onlyEntered ? " AND is_exit = 0" : "");  
        Cursor cursor = db.rawQuery(query, new String[]{roomIdStr});  
        while (cursor.moveToNext()) {  
            long userId = cursor.getLong(2);  
            String nickname = cursor.getString(3);  
            String profileImage = cursor.getString(4);  
            Boolean isExit = cursor.getLong(5) == 1;  
  
            SimpleUser user = new SimpleUser(userId, nickname, profileImage);  
            user.isExit = isExit;  
            memberList.add(user);  
        }  
  
        Log.d(TAG, "getChatRoomMembers: END - return: memberList=" + new Gson().toJson(memberList));  
        return memberList;  
    }  
  
    public SimpleUser getUserById(long userId) {  
        Log.d(TAG, "getChatRoomMemberById: START - params: userId=" + userId);  
        SQLiteDatabase db = getWritableDatabase();  
  
        String userIdStr = String.valueOf(userId);  
        Cursor cursor = db.rawQuery("SELECT * FROM chat_members WHERE user_id = ?", new String[]{userIdStr});  
  
        if (cursor.moveToFirst()) {  
            String nickname = cursor.getString(3);  
            String profileImage = cursor.getString(4);  
            Log.d(TAG, "getChatRoomMemberById: END - return: userId = " + userId + ", nickname = " + nickname + ", profileImage = " + profileImage);  
            return new SimpleUser(userId, nickname, profileImage);  
        }  
  
        Log.d(TAG, "getChatRoomMemberById: END - return: null");  
        return null;  
    }  
  
  
    // 방 정보 반환, 멤버목록은 gson JsonArray 포맷 문자열로 반환  
    // 만약 id값에 해당하는 방 정보가 없으면 null 반환  
    public ChatRoom getChatRoomInfo(long roomId) {  
        Log.i(TAG, "getChatRoomInfo: START - pramas: roomId=" + roomId);  
        SQLiteDatabase db = getReadableDatabase();  
        ChatRoom ret = null;  
  
        Log.d(TAG, "getChatRoomInfo: 조회할 roomId = " + roomId);  
  
        String roomIdStr = String.valueOf(roomId);  
        Cursor cursor = db.rawQuery("SELECT * FROM chat_rooms WHERE id = ?", new String[]{roomIdStr});  
        while (cursor.moveToNext()) {  
            ret = new ChatRoom();  
            ret.id = cursor.getLong(0);  
            ret.roomName = cursor.getString(1);  
            ret.updatedAt = cursor.getString(2);  
            ret.notiOn = cursor.getInt(3);  
            ret.masterId = cursor.getLong(4);  
            ret.roomType = CreateRoomCommand.RoomType.valueOf(cursor.getString(6));  
            ret.localName = cursor.getString(7);  
            ret.description = cursor.getString(8);  
            if(ret.description == null) ret.description = "";  
        }  
        Log.i(TAG, "getChatRoomInfo: END - return=" + ret);  
        return ret;  
    }  
  
    // 내가 들어간 모든 방 목록 받아오기  
    public List<ChatRoom> getAllChatroomItem(CreateRoomCommand.RoomType roomType) {  
        Log.i(TAG, "getAllChatroom: START - params: roomType=" + roomType);  
        SQLiteDatabase db = getWritableDatabase();  
  
        List<ChatRoom> ret = new ArrayList<>();  
        List<Long> retIds = new ArrayList<>();  
  
        long userId = SPHelper.getUserId();  
        String userIdStr = String.valueOf(userId);  
  
        Cursor cursor = db.rawQuery("SELECT * FROM chat_rooms WHERE data_owner_id = ? AND room_type = ? ORDER BY datetime(updated_at) DESC", new String[]{userIdStr, roomType.toString()});  
  
        while (cursor.moveToNext()) {  
            ChatRoom chatRoom = new ChatRoom();  
            chatRoom.id = cursor.getLong(0);  
            chatRoom.roomName = cursor.getString(1);  
            chatRoom.updatedAt = cursor.getString(2);  
            chatRoom.notiOn = cursor.getInt(3);  
            chatRoom.masterId = cursor.getLong(4);  
            chatRoom.roomType = CreateRoomCommand.RoomType.valueOf(cursor.getString(6));  
            ret.add(chatRoom);  
            retIds.add(chatRoom.id);  
        }  
  
        Log.i(TAG, "getAllChatroom: END - return: 반환된 방 id 목록" + retIds);  
        return ret;  
    }  
  
    // 채팅방 푸시알림 on / off  
    // 0 - off, 1 - on  
    public void updateNotiOn(long roomId, int notiOn) {  
        Log.d(TAG, "updateNotiOn: START - params: roomId=" + roomId + ", notiOn=" + notiOn);  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
        String notiOnStr = String.valueOf(notiOn);  
        db.execSQL("UPDATE chat_rooms SET noti_on = ? WHERE id = ?", new String[]{notiOnStr, roomIdStr});  
        Log.d(TAG, "updateNotiOn: END");  
    }  
  
    // 채팅방 푸시알림 on / off 여부 반환  
    // 0 - off, 1 - on  
    public Integer getNotiOn(long roomId) {  
        Log.d(TAG, "getNotiOn: START - params: roomId=" + roomId);  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
        Cursor cursor = null;  
        Integer notiOn = 0;  // 기본값을 0(off)으로 설정  
        try {  
            cursor = db.rawQuery("SELECT noti_on FROM chat_rooms WHERE id = ?", new String[]{roomIdStr});  
            if (cursor != null && cursor.moveToFirst()) {  
                notiOn = cursor.getInt(0);  // 데이터가 있으면 값을 가져옴  
            }  
        } catch (Exception e) {  
            Log.e(TAG, "로컬에 정보가 없으므로 null 반환", e);  
            notiOn = null;  
        } finally {  
            if (cursor != null) {  
                cursor.close();  // Cursor를 반드시 닫아줘야 함  
            }  
        }  
  
        Log.d(TAG, "getNotiOn: END - return: notiOn=" + notiOn);  
        return notiOn;  
    }  
  
  
    // 특정 방의 아직 안 읽은 메시지 개수를 구한다.  
    public int getUnreadCount(long roomId) {  
        Log.i(TAG, "getUnreadCount: roomId = " + roomId);  
        SQLiteDatabase db = getReadableDatabase();  
        int count = 0;  
        String roomIdStr = String.valueOf(roomId);  
    // 275, UNREAD  
        Cursor cursor = db.rawQuery("SELECT count(*) FROM chat_logs " +  
                        "WHERE room_id = ? AND is_Read = ? AND sender_id != 0",  
                new String[]{roomIdStr, SendMessageCommand.ReadStatus.UNREAD.toString()});  
  
        cursor.moveToFirst();  
        count = cursor.getInt(0);  
  
        Log.d(TAG, "getUnreadCount: roomId = " + roomIdStr + "의 안 읽은 매시지 개수 = " + count);  
        Log.i(TAG, "getUnreadCount: END - return: " + count);  
        return count;  
    }  
  
    // 특정 방의 아직 안 읽은 메시지 개수를 구한다.  
    public int setUnreadCount(long roomId, int count) {  
        Log.d(TAG, "getUnreadCount: roomId = " + roomId);  
        SQLiteDatabase db = getReadableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
  
        ContentValues cv = new ContentValues();  
        cv.put("unreadCount", count);  
  
        db.update("chat_rooms", cv, "id = ?", new String[]{roomIdStr});  
  
        int updatedCount = getUnreadCount(roomId);  
        Log.d(TAG, "getUnreadCount: roomId = " + roomIdStr + "의 안 읽은 매시지 개수 = " + updatedCount);  
        return updatedCount;  
    }  
  
    // 특정 방의 아직 안 읽은 메시지들의 리스트를 구한다.  
    public List<SendMessageCommand> getUnReadMessages(long roomId) {  
        Log.d(TAG, "getUnreadCount: START - params: roomId = " + roomId);  
        SQLiteDatabase db = getReadableDatabase();  
        List<SendMessageCommand> messageList = new ArrayList<>();  
        String roomIdStr = String.valueOf(roomId);  
  
        Cursor cursor = db.rawQuery("SELECT * FROM chat_logs WHERE room_id = ? AND is_read = ? ORDER BY datetime(date_time)",  
                new String[]{roomIdStr, SendMessageCommand.ReadStatus.UNREAD.toString()});  
        while (cursor.moveToNext()) {  
            Long chatId = cursor.getLong(0);  
            Long senderId = cursor.getLong(2);  
            String message = cursor.getString(3);  
            String dateTime = cursor.getString(4);  
            String readStatusStr = cursor.getString(5);  
            SendMessageCommand.ReadStatus readStatus = SendMessageCommand.ReadStatus.valueOf(readStatusStr);  
            String type = cursor.getString(6);  
  
            SendMessageCommand item = new SendMessageCommand(roomId, message, SendMessageCommand.Type.valueOf(type));  
  
            item.id = chatId;  
            item.requesterId = senderId;  
            item.createdAT = dateTime;  
            item.readStatus = readStatus;  
  
            if (senderId == 0) continue; // 서버메시지는 제외  
  
            messageList.add(item);  
        }  
        Log.d(TAG, "getUnReadMessages: END - return=" + messageList.size() + "개 반환");  
        return messageList;  
    }  
  
    // 특정 방의 마지막 메시지를 구한다.  
    // 반환형식 -> 메시지,송신시간 (, 로 구분)  
    public List<String> getRecentMessage(long roomId) {  
        Log.d(TAG, "getRecentMessage: roomId=" + roomId);  
  
        List<String> ret = new ArrayList<>();  
        SQLiteDatabase db = getReadableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
        String recentMsg = "";  
        String sendTime = "";  
        String type = "";  
        Cursor cursor = db.rawQuery("SELECT message, date_time, type FROM chat_logs WHERE room_id = ? AND sender_id != 0 ORDER BY datetime(date_time) DESC LIMIT 1", new String[]{roomIdStr});  
        if (cursor.getCount() == 0) {  
            ret.add("");  
            ret.add("");  
            return ret;  
        }  
        cursor.moveToFirst();  
        recentMsg = cursor.getString(0);  
        sendTime = cursor.getString(1);  
        type = cursor.getString(2);  
        Log.d(TAG, "getRecentMessage: roomId=" + roomIdStr + "의 최근 메시지 = " + recentMsg + ", 송신시간 = " + sendTime + ", type = " + type);  
  
        if (type.equals(SendMessageCommand.Type.IMAGE.toString())) recentMsg = "이미지를 보냈습니다.";  
        if (type.equals(SendMessageCommand.Type.VIDEO_ROOM_OPEN.toString())) recentMsg = "영상회의";  
        if (type.equals(SendMessageCommand.Type.VIDEO_ROOM_CLOSE.toString())) recentMsg = "영상회의 종료";  
  
        ret.add(recentMsg);  
        ret.add(sendTime);  
        return ret;  
    }  
  
  
    /**  
     * 채팅 기록 저장  
     *  
     * @return 저장된 채팅 id  
     */  
    public void insertChatLog(SendMessageCommand command) {  
        SQLiteDatabase db = getWritableDatabase();  
  
        // 채팅 기록 insert  
        ContentValues values = new ContentValues();  
        values.put("id", command.id);  
        values.put("room_id", command.roomId);  
        values.put("sender_id", command.requesterId);  
        values.put("message", command.content);  
        values.put("is_Read", command.readStatus.toString());  
        values.put("date_time", command.createdAT);  
        values.put("type", command.type.toString());  
  
        db.insert("chat_logs", null, values);  
        Log.d(TAG, "insertChatLog: 채팅기록 추가됨 : id=" + command.id + ", room_id=" + command.roomId +  
                ", sender_id=" + command.requesterId + ", message=" + command.content +  
                ", date_time=" + command.createdAT);  
    }  
  
    // 마지막으로 도착한 메시지 시간 갱신  
    public void updateRoomTime(long roomId, String updateTime) {  
        SQLiteDatabase db = getWritableDatabase();  
  
        ContentValues values = new ContentValues();  
        values.put("updated_at", updateTime);  
  
        String roomIdStr = String.valueOf(roomId);  
        String where = "id = ?";  
        db.update("chat_rooms", values, where, new String[]{roomIdStr});  
        Log.d(TAG, "updateRoomTime: roomId = " + roomId + ", 업데이트 시간 = " + updateTime);  
    }  
  
    // 채팅 기록 불러오기  
    public List<SendMessageCommand> getChatLog(long roomId, int offset) {  
        Log.d(TAG, "getChatLog: START - args: roomId=" + roomId);  
        SQLiteDatabase db = getWritableDatabase();  
  
        int limit = Integer.MAX_VALUE; // 한 번에 불러올 채팅개수  
        List<SendMessageCommand> messageList = new ArrayList<>();  
        String roomIdStr = String.valueOf(roomId);  
        Log.d(TAG, "getChatLog: db=" + db + ", messageItemList=" + messageList + ", roomIdStr=" + roomIdStr);  
  
        // (id INTEGER PRIMARY KEY AUTOINCREMENT, room_id INTEGER, sender_id INTEGER, message TEXT, image_name TEXT, send_time TEXT, isRead INTEGER, video_path TEXT, video_path_server TEXT);");  
        // 최신순으로 정렬하여 limit 개수만큼 가져온다.  
        // 가장 최근 것이 먼저 나온다.  
        Cursor cursor = db.rawQuery("SELECT * FROM chat_logs WHERE room_id = ? ORDER BY datetime(date_time) DESC LIMIT ? OFFSET ?",  
                new String[]{roomIdStr, String.valueOf(limit), String.valueOf(offset)});  
  
        while (cursor.moveToNext()) {  
            Long chatId = cursor.getLong(0);  
//            Long roomId = cursor.getLong(1);  
            Long senderId = cursor.getLong(2);  
            String message = cursor.getString(3);  
            String dateTime = cursor.getString(4);  
            String readStatusStr = cursor.getString(5);  
            SendMessageCommand.ReadStatus readStatus = SendMessageCommand.ReadStatus.valueOf(readStatusStr);  
            String type = cursor.getString(6);  
  
            SendMessageCommand command = new SendMessageCommand(roomId, message, SendMessageCommand.Type.valueOf(type));  
  
            // 생성자의 인자를 제외한 추가 정보 입력  
            command.id = chatId;  
            command.requesterId = senderId;  
            command.createdAT = dateTime;  
            command.readStatus = readStatus;  
  
            messageList.add(command);  
        }  
        Log.d(TAG, "getChatLog: END - return=" + messageList.size() + "개 반환");  
        return messageList;  
    }  
  
  
    // 안 읽은 메시지 전체 읽음 처리  
    public void setUnReadMessageToRead(long roomId) {  
        Log.i(TAG, "setUnReadMessageToRead: START - params: roomId=" + roomId);  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
  
        db.execSQL("UPDATE chat_logs SET is_read = ? WHERE room_id = ? AND is_read = ?",  
                new String[]{  
                        SendMessageCommand.ReadStatus.READ.toString(),  
                        roomIdStr,  
                        SendMessageCommand.ReadStatus.UNREAD.toString()  
                });  
  
        Log.i(TAG, "setUnReadMessageToRead: END");  
    }  
  
    // 채팅방 나가기  
    public void exitRoom(long roomId) {  
        Log.i(TAG, "exitRoom: START - params: roomId=" + roomId);  
        deleteChatRoom(roomId);  
        deleteChatMember(roomId);  
        deleteChatLogs(roomId);  
        Log.i(TAG, "exitRoom: END");  
    }  
  
    // 채팅방 삭제  
    public void deleteChatRoom(long roomId) {  
        Log.i(TAG, "deleteChatRoom: START - params: roomId=" + roomId);  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
        db.delete("chat_rooms", "id = ?", new String[]{roomIdStr});  
        Log.i(TAG, "putChatRoomInfo: END");  
    }  
  
    // 채팅방 멤버 관계 테이블 제거  
    public void deleteChatMember(long roomId) {  
        Log.i(TAG, "deleteChatMember: START - params: roomId=" + roomId);  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
        db.delete("chat_members", "room_id = ?", new String[]{roomIdStr});  
        Log.i(TAG, "putChatRoomInfo: END");  
    }  
  
    // 채팅기록 제거  
    public void deleteChatLogs(long roomId) {  
        Log.i(TAG, "deleteChatRoom: START - params: roomId=" + roomId);  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
        db.delete("chat_logs", "room_id = ?", new String[]{roomIdStr});  
        Log.i(TAG, "deleteChatRoom: END");  
    }  
  
  
    // 특정 방의 특정멤버 제거  
    public void deleteMember(long roomId, long userId) {  
        Log.i(TAG, "deleteMember: START - params: roomId=" + roomId + ", userId=" + userId);  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
        String userIdStr = String.valueOf(userId);  
  
        // 멤버 목록 jsonArray  
        JsonArray jsonArray = getMembers(roomId);  
        // member json 수정  
        for (int i = 0; i < jsonArray.size(); i++) {  
            JsonObject member = jsonArray.get(i).getAsJsonObject();  
            if (member.get("userId").getAsLong() == userId) {  
                jsonArray.remove(i);  
                Log.d(TAG, "deleteMember: i 번째에서 유저를 찾아서 제거함");  
                break;  
            }  
        }  
  
        // 수정된 member json db에 저장  
        String updatedMembers = jsonArray.toString();  
        db.execSQL("UPDATE chat_rooms SET members = ? WHERE id = ?", new String[]{updatedMembers, roomIdStr});  
  
        Log.d(TAG, "deleteMember: 멤버변경 업데이트 완료 : " + this.getChatRoomInfo(roomId));  
        Log.i(TAG, "deleteMember: END");  
    }  
  
    // 특정방의 멤버목록 제공  
    public JsonArray getMembers(long roomId) {  
        Log.d(TAG, "getMembers: START - params: roomId=" + roomId);  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
        JsonArray jsonArray = null;  
  
        Cursor cursor = db.rawQuery("SELECT members FROM chat_rooms WHERE id = ?", new String[]{roomIdStr});  
  
        if (cursor.moveToFirst()) {  
            jsonArray = (JsonArray) JsonParser.parseString(cursor.getString(0));  
        }  
  
  
        Log.d(TAG, "getMembers: END - return: jsonArray=" + jsonArray);  
        return jsonArray;  
    }  
  
    public SendMessageCommand getChatLogById(long chatId) {  
        Log.d(TAG, "getChatLogById: START - params: chatId=" + chatId);  
        SQLiteDatabase db = getWritableDatabase();  
        String chatIdStr = String.valueOf(chatId);  
  
        Cursor cursor = db.rawQuery("SELECT * FROM chat_logs WHERE id = ?", new String[]{chatIdStr});  
        if (cursor.moveToFirst()) {  
            Long roomId = cursor.getLong(1);  
            Long senderId = cursor.getLong(2);  
            String message = cursor.getString(3);  
            String dateTime = cursor.getString(4);  
            String readStatusStr = cursor.getString(5);  
            SendMessageCommand.ReadStatus readStatus = SendMessageCommand.ReadStatus.valueOf(readStatusStr);  
            String type = cursor.getString(6);  
  
            SendMessageCommand command = new SendMessageCommand(roomId, message, SendMessageCommand.Type.valueOf(type));  
  
            command.id = chatId;  
            command.requesterId = senderId;  
            command.createdAT = dateTime;  
            command.readStatus = readStatus;  
  
            Log.d(TAG, "getChatLogById: END - 메시지 기록 찾음");  
            return command;  
        }  
        Log.d(TAG, "getChatLogById: END - 메시지 기록 못찾음");  
        return null;  
    }  
  
    // 채팅방 이름 변경  
    public void updateRoomName(long roomId, String roomName) {  
        Log.i(TAG, "updateRoomName: START - params: roomId=" + roomId + ", roomName=" + roomName);  
  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
  
        db.execSQL("UPDATE chat_rooms SET room_name = ? WHERE id = ?", new String[]{roomName, roomIdStr});  
  
        Log.i(TAG, "updateRoomName: END");  
    }  
  
    // 채팅방 로컬 이름 변경  
    public void updateLocalRoomName(long roomId, String roomName) {  
        Log.i(TAG, "updateLocalRoomName: START - params: roomId=" + roomId + ", roomName=" + roomName);  
  
        SQLiteDatabase db = getWritableDatabase();  
        String roomIdStr = String.valueOf(roomId);  
  
        db.execSQL("UPDATE chat_rooms SET local_name = ? WHERE id = ?", new String[]{roomName, roomIdStr});  
  
        Log.i(TAG, "updateLocalRoomName: END");  
    }  
  
}  
  
</document_content>  
</document>  
<document index="173">  
<source>app/src/main/java\com\teamnova\assa\util\DialogFactory.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.Context;  
import android.content.DialogInterface;  
import android.util.Log;  
  
import androidx.appcompat.app.AlertDialog;  
  
/**  
 * 다이얼로그 생성 클래스  
 */  
public class DialogFactory {  
  
    private static DialogFactory instance = null;  
  
    public static DialogFactory getInstance(){  
        if(instance == null){  
            instance = new DialogFactory();  
        }  
        return instance;  
    }  
  
    private DialogFactory(){}  
  
  
    /**  
     * 확인 취소 선택을 제공하는 다이얼로그 생성  
     *  
     * @return  
     */  
    public AlertDialog generateConfirmationDialog(Context context,  
                                       String title,  
                                       String message,  
                                       String positiveButtonText,  
                                       DialogInterface.OnClickListener positiveButtonListener,  
                                       String negativeButtonText,  
                                       DialogInterface.OnClickListener negativeButtonListener) {  
  
        String TAG = context.getClass().getSimpleName();  
        AlertDialog.Builder builder = new AlertDialog.Builder(context);  
  
        builder.setTitle(title)  
                .setMessage(message)  
                .setPositiveButton(positiveButtonText, (dialog, which) -> {  
                    Log.d(TAG, "generateDialog: 확인버튼 선택");  
                    positiveButtonListener.onClick(dialog, which);  
                })  
                .setNegativeButton(negativeButtonText, (dialog, which) -> {  
                    Log.d(TAG, "generateDialog: 취소버튼 선택");  
                    negativeButtonListener.onClick(dialog, which);  
                });  
  
        return builder.create();  
    }  
  
}  
  
</document_content>  
</document>  
<document index="174">  
<source>app/src/main/java\com\teamnova\assa\util\FileUploader.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.Context;  
import android.util.Log;  
import android.widget.Toast;  
  
import com.teamnova.assa.data.retrofit.RetrofitInstance;  
import com.teamnova.assa.data.retrofit.interfaces.FileService;  
  
import java.io.File;  
import java.io.IOException;  
import java.util.ArrayList;  
import java.util.List;  
  
import okhttp3.MultipartBody;  
import okhttp3.RequestBody;  
import okhttp3.ResponseBody;  
import okio.Buffer;  
import okio.BufferedSink;  
import retrofit2.Call;  
import retrofit2.Callback;  
import retrofit2.Response;  
import retrofit2.Retrofit;  
  
public class FileUploader {  
    private static final String TAG = FileUploader.class.getSimpleName();  
  
    public interface onFileUploadedListener {  
        void onFileUploaded(List<String> imageUrls);  
    }  
  
    public static void uploadFiles(Context context, List<File> fileList, onFileUploadedListener listener) {  
        Log.d(TAG, "uploadFiles: 실행 " + fileList);  
        List<MultipartBody.Part> parts = new ArrayList<>();  
  
        if (fileList == null || fileList.isEmpty()) {  
            // 보낼 파일이 없으면 게시물 객체정보만 전송함  
            Log.d(TAG, "uploadFiles: 파일 리스트가 비어있습니다.");  
            listener.onFileUploaded(null);  
        } else {  
            // 보낼 파일이 있으면 파일을 MultipartBody.Part로 변환하여 전송 후 게시물 객체정보 전송  
            Log.d(TAG, "uploadFiles: 파일 리스트가 비어있지 않습니다.");  
            for (File file : fileList) {  
                if (file != null) {  
                    Log.d(TAG, "파일 용량 " + file.length() / 1024 + " KB");  
                    MultipartBody.Part body = RetrofitUtils.convertFileToPart("files[]", file);  
                    parts.add(body);  
  
                    // 디버깅용 코드  
                    RequestBody requestBody = body.body();  
                    BufferedSink bufferedSink = new Buffer();  
                    try {  
                        requestBody.writeTo(bufferedSink);  
                        bufferedSink.close();  
                        long fileSizeInBytes = bufferedSink.buffer().size(); // 파일의 크기를 바이트 단위로 측정  
                        // 파일의 크기를 바이트 단위로 출력하거나 다른 작업 수행  
                        Log.d(TAG, "part에 담긴 파일 크기: " + fileSizeInBytes + " bytes");  
                    } catch (IOException e) {  
                        e.printStackTrace();  
                    }  
                }  
            }  
            Log.d(TAG, "전송될 part 객체들 목록 : " + parts);  
            Retrofit retrofit = RetrofitInstance.getInstance();  
            FileService fileService = retrofit.create(FileService.class);  
  
            Call<ResponseBody> call = fileService.uploadFiles(parts);  
  
            call.enqueue(new Callback<ResponseBody>() {  
                @Override  
                public void onResponse(Call<ResponseBody> call, Response<ResponseBody> response) {  
                    if (response.isSuccessful()) {  
                        Log.d(TAG, "onResponse: 파일 업로드 성공");  
  
                        String json = null;  
                        try {  
                            assert response.body() != null;  
                            json = response.body().string();  
                        } catch (IOException e) {  
                            throw new RuntimeException(e);  
                        }  
  
                        // Gson으로 응답 파싱  
                        FileResponse fileResponse = GsonUtils.getGson().fromJson(json, FileResponse.class);  
                        Log.d(TAG, "onResponse: 파싱된 이미지 업로드 응답 : " + fileResponse);  
  
                        listener.onFileUploaded(fileResponse.paths);  
                    } else {  
                        Log.e(TAG, "onResponse: 파일 업로드 에러");  
                        Toast.makeText(context, "파일 업로드 에러", Toast.LENGTH_SHORT).show();  
                    }  
                }  
  
                @Override  
                public void onFailure(Call<ResponseBody> call, Throwable throwable) {  
                    Log.e(TAG, "onFailure: 파일 업로드 통신 실패", throwable);  
                    Toast.makeText(context, "파일 업로드 통신 실패", Toast.LENGTH_SHORT).show();  
                }  
            });  
        }  
    }  
  
    public static class FileResponse {  
        List<String> paths;  
    }  
}  
  
</document_content>  
</document>  
<document index="175">  
<source>app/src/main/java\com\teamnova\assa\util\FileUtils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.ContentResolver;  
import android.content.Context;  
import android.database.Cursor;  
import android.graphics.Bitmap;  
import android.graphics.BitmapFactory;  
import android.net.Uri;  
import android.provider.MediaStore;  
import android.util.Log;  
  
import java.io.File;  
import java.io.FileOutputStream;  
import java.io.IOException;  
import java.io.InputStream;  
import java.util.ArrayList;  
import java.util.List;  
  
/**  
 * 파일 처리 유틸 클래스  
 */  
public class FileUtils {  
    private static final String TAG = "FileUtils";  
  
    /**  
     * 비트맵을 파일로 변환  
     *  
     * @param bitmap  
     * @param filename  
     * @return  
     */  
    public static File bitmapToFile(Context context, Bitmap bitmap, String filename) {  
        // 앱의 캐시 폴더에 파일 생성  
        File file = new File(context.getCacheDir(), filename);  
        try (FileOutputStream out = new FileOutputStream(file)) {  
            bitmap.compress(Bitmap.CompressFormat.JPEG, 100, out);  
            out.flush();  
        } catch (IOException e) {  
            e.printStackTrace();  
        }  
  
        return file;  
    }  
  
    /**  
     * Uri 리스트 를 path 리스트 로 변환  
     *  
     * @param context  
     * @param uris  
     * @return  
     */  
    public static List<String> getFilePathsFromUris(Context context, List<Uri> uris) {  
        List<String> filePaths = new ArrayList<>();  
        for (Uri uri : uris) {  
            String filePath = getFilePathFromUri(context, uri);  
            if (filePath != null) {  
                filePaths.add(filePath);  
            }  
        }  
        return filePaths;  
    }  
  
    /**  
     * Uri를 File로 변환  
     *  
     * @param context  
     * @param uri  
     */  
//    public static File getFileFromUri(Context context, Uri uri) {  
//        String filePath = getFilePathFromUri(context, uri);  
//  
//        if (filePath != null) {  
//            File compressed = null;  
//            try {  
//                compressed = ImageCompressor.compressImage(context, filePath, 85);  
//            } catch (IOException e) {  
//                e.printStackTrace();  
//                Log.d(TAG, "getFileFromUri: " + e.getMessage());  
//            }  
//            return compressed;  
//        } else {  
//            return null;  
//        }  
//    }  
  
    /**  
     * Uri 를 path 로 변환  
     *  
     * @param context  
     * @param uri  
     * @return  
     */  
    public static String getFilePathFromUri(Context context, Uri uri) {  
  
        String filePath = null;  
  
        if (context == null || uri == null) {  
            return null;  
        }  
  
        String scheme = uri.getScheme();  
  
        if ("content".equalsIgnoreCase(scheme)) {  
            filePath = getRealPathFromContentUri(context, uri);  
        } else if ("file".equalsIgnoreCase(scheme)) {  
            filePath = uri.getPath();  
        }  
  
        // filePath가 여전히 null이면, Uri를 통해 InputStream을 얻어 파일로 복사  
        if (filePath == null) {  
            filePath = copyUriContentToFile(context, uri);  
        }  
  
        return filePath;  
    }  
  
    // ContentResolver를 통해 Uri를 FilePath로 변환  
    private static String getRealPathFromContentUri(Context context, Uri uri) {  
        String[] projection = {MediaStore.Images.Media.DATA};  
        String filePath = null;  
  
        // ContentResolve로 쿼리 실행  
        ContentResolver contentResolver = context.getContentResolver();  
        Cursor cursor = contentResolver.query(uri, projection, null, null, null);  
        if (cursor != null) {  
            try {  
                if (cursor.moveToFirst()) {  
                    int index = cursor.getColumnIndexOrThrow(MediaStore.Images.Media.DATA);  
                    filePath = cursor.getString(index);  
                }  
            } catch (IllegalArgumentException e) {  
                e.printStackTrace();  
                Log.d(TAG, "getRealPathFromContentUri: 찾는 컬럼이 없음 " + e.getMessage());  
            } finally {  
                cursor.close();  
            }  
        }  
        return filePath;  
    }  
  
    // Uri로 부터 임시파일 생성 후 해당 임시파일의 경로를 반환  
    private static String copyUriContentToFile(Context context, Uri uri) {  
        InputStream inputStream = null;  
        FileOutputStream outputStream = null;  
        File tempFile = null;  
  
        try {  
            // 임시 파일 생성  
            tempFile = File.createTempFile("temp_", ".jpg", context.getCacheDir());  
            inputStream = context.getContentResolver().openInputStream(uri);  
            outputStream = new FileOutputStream(tempFile);  
  
            byte[] buffer = new byte[1024];  
            int length;  
            while ((length = inputStream.read(buffer)) > 0) {  
                outputStream.write(buffer, 0, length);  
            }  
        } catch (IOException e) {  
            e.printStackTrace();  
        } finally {  
            try {  
                if (inputStream != null) {  
                    inputStream.close();  
                }  
                if (outputStream != null) {  
                    outputStream.close();  
                }  
            } catch (IOException e) {  
                e.printStackTrace();  
            }  
  
        }  
        return (tempFile != null) ? tempFile.getAbsolutePath() : null;  
    }  
  
    public Bitmap getBitmapFromUri(Context context, Uri uri) throws IOException {  
        InputStream inputStream = context.getContentResolver().openInputStream(uri);  
        Bitmap bitmap = BitmapFactory.decodeStream(inputStream);  
        inputStream.close();  
        return bitmap;  
    }  
}  
  
</document_content>  
</document>  
<document index="176">  
<source>app/src/main/java\com\teamnova\assa\util\GsonUtils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.util.Log;  
  
import com.google.gson.Gson;  
import com.google.gson.GsonBuilder;  
import com.google.gson.JsonArray;  
import com.google.gson.JsonParser;  
import com.teamnova.assa.data.dto.data.UserData;  
import com.teamnova.assa.data.retrofit.LocalDateTimeDeserializer;  
  
import java.time.LocalDateTime;  
import java.util.ArrayList;  
import java.util.List;  
  
public class GsonUtils {  
    private static final String TAG = "GsonUtils";  
    private static Gson gson;  
  
    public static Gson getGson() {  
        Log.d(TAG, "getGson: gson 객체 반환");  
        if (gson == null) {  
            gson = new GsonBuilder()  
                    .registerTypeAdapter(LocalDateTime.class, new LocalDateTimeDeserializer())  
                    .setPrettyPrinting()  
                    .serializeNulls()  
                    .create();  
        }  
        return gson;  
    }  
  
    public static List<UserData> convertJsonToUserList(String json) {  
        Log.d(TAG, "convertJsonToUserList: start - params: json = " + json);  
        List<UserData> ret = new ArrayList<>();  
        JsonArray jsonArray = JsonParser.parseString(json).getAsJsonArray();  
  
        for(int i = 0 ; i < jsonArray.size() ; i++) {  
            UserData userData = new UserData();  
            userData.id = jsonArray.get(i).getAsJsonObject().get("id").getAsLong();  
            userData.nickname = jsonArray.get(i).getAsJsonObject().get("nickname").getAsString();  
            userData.profileImage = jsonArray.get(i).getAsJsonObject().get("profileImage").getAsString();  
            ret.add(userData);  
        };  
  
        Log.d(TAG, "convertJsonToUserList: end - return: ret="+ret);  
        return ret;  
    }  
  
}  
  
</document_content>  
</document>  
<document index="177">  
<source>app/src/main/java\com\teamnova\assa\util\HandlerManager.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.os.Handler;  
import android.util.Log;  
  
import java.util.HashMap;  
  
/**  
 * 핸들러들을 관리하는 클래스  
 */  
public class HandlerManager {  
    private static final String TAG = HandlerManager.class.getSimpleName();  
    private static HashMap<String, Handler> handlerMap = new HashMap<>();  
  
    public static void putHandler(String key, Handler handler){  
        Log.d(TAG, "putHandler: k = " + key + " v = " + handler);  
        handlerMap.put(key, handler);  
    }  
  
    public static Handler getHandler(String key){  
        Log.d(TAG, "getHandler: k = " + key + " v = " + handlerMap.get(key));  
        return handlerMap.get(key);  
    }  
}  
  
</document_content>  
</document>  
<document index="178">  
<source>app/src/main/java\com\teamnova\assa\util\ImageCompressor.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.Context;  
import android.graphics.Bitmap;  
import android.graphics.BitmapFactory;  
import android.graphics.Matrix;  
import android.media.ExifInterface;  
import android.net.Uri;  
import android.util.Log;  
  
import java.io.ByteArrayOutputStream;  
import java.io.File;  
import java.io.FileOutputStream;  
import java.io.IOException;  
import java.io.InputStream;  
  
/**  
 * 이미지 파일 압축  
 */  
public class ImageCompressor {  
  
    private static final String TAG = "ImageCompressor";  
  
    /**  
     * 주어진 uri의 이미지를 압축한 이미지 임시파일을 반환  
     *  
     * @param context  
     * @param uri  
     * @param quality  
     * @return  
     * @throws IOException  
     */  
    public static File compressImage(Context context, Uri uri, int quality) throws IOException {  
        // 이미지 파일을 BitMap으로 변환  
        Bitmap bitmap = BitmapFactory.decodeStream(context.getContentResolver().openInputStream(uri));  
        Log.d(TAG, "원본 비트맵 사이즈 " + bitmap.getAllocationByteCount() / 1024 + "KB");  
  
        // 원본 이미지가 회전된 각도 구하기  
        int rotationDegrees = getRotationFromExif(context, uri);  
  
        // 구한 각도 만큼 Bitmap도 회전  
        Bitmap rotatedBitmap = rotateBitmap(bitmap, rotationDegrees);  
  
        // Bitmap 압축  
        ByteArrayOutputStream out = new ByteArrayOutputStream();  
        rotatedBitmap.compress(Bitmap.CompressFormat.JPEG, quality, out);  
  
        // 임시 파일 생성  
        File tempFile = File.createTempFile("comp_", ".jpg", context.getCacheDir());  
  
        // 압축된 이미지를 임시 파일로 저장  
        try (FileOutputStream fos = new FileOutputStream(tempFile)) {  
            fos.write(out.toByteArray());  
        }  
        Log.d(TAG, "압축된 파일 사이즈 " + tempFile.length() / 1024 + "KB");  
  
        return tempFile;  
    }  
  
    public static int getRotationFromExif(Context context, Uri uri) throws IOException {  
        // 파일에서 exif 정보 가져오기  
        InputStream inputStream = context.getContentResolver().openInputStream(uri);  
        ExifInterface exifInterface = new ExifInterface(inputStream);  
  
        // exif 에서 이미지 회전 정보 가져오기  
        int orientation = exifInterface.getAttributeInt(ExifInterface.TAG_ORIENTATION, ExifInterface.ORIENTATION_NORMAL);  
        int rotatinoDegree = 0;  
  
        // 회전 정보에 따라 이미지 회전된 각도 구하기  
        switch (orientation){  
            case ExifInterface.ORIENTATION_ROTATE_90:  
                rotatinoDegree = 90;  
                break;  
            case ExifInterface.ORIENTATION_ROTATE_180:  
                rotatinoDegree = 180;  
                break;  
            case ExifInterface.ORIENTATION_ROTATE_270:  
                rotatinoDegree = 270;  
                break;  
        }  
  
        inputStream.close();  
        return rotatinoDegree;  
    }  
  
    /**  
     * 비트맵을 회전시키는 메서드  
     * @param bitmap  
     * @param rotationDegrees  
     * @return  
     */  
    public static Bitmap rotateBitmap(Bitmap bitmap, int rotationDegrees) {  
        if(rotationDegrees != 0){  
            Matrix matrix = new Matrix();  
            matrix.postRotate(rotationDegrees);  
            return Bitmap.createBitmap(bitmap, 0, 0, bitmap.getWidth(), bitmap.getHeight(), matrix, true);  
        }  
        return bitmap;  
    }  
}  
  
</document_content>  
</document>  
<document index="179">  
<source>app/src/main/java\com\teamnova\assa\util\ImageUtils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.Context;  
import android.graphics.Bitmap;  
import android.graphics.BitmapShader;  
import android.graphics.Canvas;  
import android.graphics.Matrix;  
import android.graphics.Paint;  
import android.graphics.Rect;  
import android.graphics.Shader;  
import android.graphics.drawable.Drawable;  
import android.util.Log;  
  
import androidx.annotation.NonNull;  
import androidx.annotation.Nullable;  
import androidx.core.content.ContextCompat;  
  
import com.bumptech.glide.Glide;  
import com.bumptech.glide.request.target.CustomTarget;  
import com.bumptech.glide.request.transition.Transition;  
import com.teamnova.assa.R;  
  
import java.util.ArrayList;  
import java.util.List;  
  
public class ImageUtils {  
  
    static final String TAG = ImageUtils.class.getSimpleName();  
  
    // URL 리스트에서 Bitmap 리스트를 생성하는 함수  
    public static void loadBitmapsFromUrls(Context context, List<String> urls, OnBitmapsLoadedListener listener) {  
        Log.d(TAG, "loadBitmapsFromUrls: START - params: context=" + context + ", urls=" + urls);  
        List<Bitmap> bitmaps = new ArrayList<>();  
  
        // 최대 4개까지만 변환  
        int maxCount = Math.min(urls.size(), 4);  
  
        // 전달받은 비트맵이 없다면 앱 로고를 출력한다.  
        if (maxCount == 0) {  
            Log.d(TAG, "bind: 전달받은 비트맵이 없음, 로고 출력");  
            Bitmap bitmap = getBitmapFromDrawable(context.getApplicationContext(), R.drawable.all_logo_assa);  
            Log.d(TAG, "loadBitmapsFromUrls: bitmap = " + bitmap);  
            bitmaps.add(bitmap);  
            listener.onBitmapsLoaded(bitmaps);  
            Log.d(TAG, "loadBitmapsFromUrls: END - 전달받은 경로가 없음 앱 로고 사용");  
            return;  
        }  
  
        for (int i = 0; i < maxCount; i++) {  
            String url = urls.get(i);  
            Log.d(TAG, "loadBitmapsFromUrls: 사용된 url=" + url);  
            Glide.with(context)  
                    .asBitmap()  
                    .load(url)  
                    .into(new CustomTarget<Bitmap>() {  
                        @Override  
                        public void onResourceReady(@NonNull Bitmap resource, @Nullable Transition<? super Bitmap> transition) {  
                            bitmaps.add(resource);  
  
                            // 전부 변환을 마치면 리스너 실행  
                            if (bitmaps.size() == maxCount) {  
                                listener.onBitmapsLoaded(bitmaps);  
                            }  
                        }  
  
                        @Override  
                        public void onLoadCleared(@Nullable Drawable placeholder) {  
  
                        }  
                    });  
        }  
        Log.d(TAG, "loadBitmapsFromUrls: END");  
    }  
  
    public interface OnBitmapsLoadedListener {  
        void onBitmapsLoaded(List<Bitmap> bitmaps);  
    }  
  
    // 인원수에 따라 적절한 채팅방 이미지 생성  
    // 상대가 1명 - 상대 이미지 사용  
    // 2명 이상부터 채팅방 이미지를 4등분 하여 왼쪽 위부터 오른쪽 아래 순으로 4명까지 채움  
    // 멤버이미지는 사용자 자기자신을 제외했다고 가정  
    public static Bitmap createChatRoomImage(List<Bitmap> memberImages, int imageSize) {  
        Log.d(TAG, "createChatRoomImage: START - params: memberImages=" + memberImages + ", imageSize=" + imageSize);  
        Bitmap combinedImage = Bitmap.createBitmap(imageSize, imageSize, Bitmap.Config.ARGB_8888);  
        Canvas canvas = new Canvas(combinedImage);  
        Paint paint = new Paint(Paint.ANTI_ALIAS_FLAG);  
  
        int halfSize = imageSize / 2;  
        int memberCount = Math.min(memberImages.size(), 4);  
  
        // 상대가 1명이면 해당 이미지를 원형으로 사용  
        if (memberCount == 1) {  
            Bitmap circularBitmap = createCircularBitmap(memberImages.get(0), imageSize);  
            canvas.drawBitmap(circularBitmap, null, new Rect(0, 0, imageSize, imageSize), paint);  
        } else {  
            // 만약 멤버가 4명 초과라면 첫 4명만 표시  
            for (int i = 0; i < memberCount; i++) {  
                int row = i / 2;  
                int col = i % 2;  
                Bitmap circularBitmap = createCircularBitmap(memberImages.get(i), halfSize);  
                canvas.drawBitmap(circularBitmap, null, new Rect(col * halfSize, row * halfSize, (col + 1) * halfSize, (row + 1) * halfSize), paint);  
            }  
        }  
  
        Log.d(TAG, "createChatRoomImage: END - return=" + combinedImage);  
        return combinedImage;  
    }  
  
    public static Bitmap createCircularBitmap(Bitmap bitmap, int size) {  
        // 1. 새로운 비트맵을 생성합니다. 이 비트맵의 크기는 size x size이며, 투명한 배경(ARGB_8888)을 갖습니다.  
        Bitmap output = Bitmap.createBitmap(size, size, Bitmap.Config.ARGB_8888);  
        Log.d(TAG, "createCircularBitmap: output=" + output);  
  
        // 2. 생성된 비트맵에 그림을 그리기 위한 Canvas 객체를 만듭니다.  
        Canvas canvas = new Canvas(output);  
        Log.d(TAG, "createCircularBitmap: canvas = " + canvas);  
  
        // 3. 그림을 부드럽게 그리기 위한 Paint 객체를 만듭니다. 이 객체는 안티앨리어싱, 필터 비트맵, 디더링(색의 경계선을 부드럽게 하는 것)을 활성화합니다.  
        Paint paint = new Paint(Paint.ANTI_ALIAS_FLAG);  
        paint.setAntiAlias(true);  
        paint.setFilterBitmap(true);  
        paint.setDither(true);  
  
        // 4. 비트맵의 원본 너비와 높이를 가져옵니다.  
        float bitmapWidth = bitmap.getWidth();  
        float bitmapHeight = bitmap.getHeight();  
  
        // 5. 비트맵을 원하는 크기로 자르기 위해 스케일을 계산합니다.  
        //    비트맵을 원형으로 자르기 위해, 주어진 크기(size)와 원본 비트맵의 크기를 비교하여 더 작은 쪽으로 스케일을 맞춥니다.  
        //    비트맵을 원안에 꽉채우기 위해 작은 쪽을 기준으로 이미지를 조정함  
        float scale = Math.max(size / bitmapWidth, size / bitmapHeight);  
  
        // 6. 스케일을 적용한 후 비트맵의 너비와 높이를 계산합니다.  
        float scaledWidth = scale * bitmapWidth;  
        float scaledHeight = scale * bitmapHeight;  
  
        // 7. 스케일이 적용된 비트맵을 캔버스의 중앙에 배치하기 위해 왼쪽과 위쪽의 위치를 계산합니다.  
        float left = (size - scaledWidth) / 2;  
        float top = (size - scaledHeight) / 2;  
//  
//        // 8. 스케일된 비트맵이 그려질 위치를 나타내는 사각형(RectF)을 정의합니다.  
//        RectF targetRect = new RectF(left, top, left + scaledWidth, top + scaledHeight);  
  
        // 9. BitmapShader는 비트맵을 타일 패턴으로 사용할 수 있도록 해줍니다. 여기서는 비트맵을 원형으로 자르기 위해 사용됩니다.  
        BitmapShader shader = new BitmapShader(bitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);  
  
        // 10. Matrix 객체를 사용해 비트맵의 위치를 설정하고, 스케일을 적용합니다.  
        //     비트맵의 크기와 위치를 조정한 후 BitmapShader에 적용합니다.  
        Matrix matrix = new Matrix();  
//        matrix.setTranslate(targetRect.left, targetRect.top); // 캔버스의 중앙으로 비트맵 위치를 이동시킵니다.  
        matrix.setTranslate(left, top); // 캔버스의 중앙으로 비트맵 위치를 이동시킵니다.  
        matrix.preScale(scale, scale); // 비트맵을 스케일합니다.  
        shader.setLocalMatrix(matrix);  
  
        // 11. BitmapShader를 Paint 객체에 적용하여 원형으로 자를 준비를 합니다.  
        paint.setShader(shader);  
  
        // 12. 비트맵의 반지름을 계산합니다. 주어진 크기(size)를 반으로 나눈 값입니다.  
        float radius = size / 2f;  
  
        // 13. 캔버스에 원을 그립니다. 이때 Paint에 설정된 BitmapShader로 인해 비트맵이 원형으로 그려집니다.  
        canvas.drawCircle(radius, radius, radius, paint);  
  
        // 14. 원형으로 자른 비트맵을 반환합니다.  
        return output;  
    }  
  
    // drawable 리소스를 Bitmap으로 변환하는 함수  
    public static Bitmap getBitmapFromDrawable(Context context, int drawableId) {  
        Drawable drawable = ContextCompat.getDrawable(context, drawableId);  
        if (drawable == null) {  
            return null;  
        }  
  
        Bitmap bitmap = Bitmap.createBitmap(drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight(), Bitmap.Config.ARGB_8888);  
  
        Canvas canvas = new Canvas(bitmap);  
        drawable.setBounds(0, 0, canvas.getWidth(), canvas.getHeight());  
        drawable.draw(canvas);  
  
        return bitmap;  
    }  
}  
  
</document_content>  
</document>  
<document index="180">  
<source>app/src/main/java\com\teamnova\assa\util\JsonUtils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import com.google.gson.JsonObject;  
  
/**  
 * json을 다루는 유틸 메소드들  
 */  
public class JsonUtils {  
  
    public static JsonObject makeJsonMsg(String action) {  
        JsonObject obj = new JsonObject();  
        obj.addProperty("action", action);  
        return obj;  
    }  
}  
  
</document_content>  
</document>  
<document index="181">  
<source>app/src/main/java\com\teamnova\assa\util\RetrofitUtils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.Context;  
import android.util.Log;  
import android.widget.Toast;  
  
import java.io.File;  
import java.io.IOException;  
  
import okhttp3.MediaType;  
import okhttp3.MultipartBody;  
import okhttp3.RequestBody;  
import okio.Buffer;  
import okio.BufferedSink;  
  
/**  
 * 레트로핏 사용사 재사용되는 유틸리티 클래스  
 */  
public class RetrofitUtils {  
    static final String TAG = "RetrofitUtils";  
  
    public static MultipartBody.Part convertFileToPart(String partName, File file) {  
        // 파일에서 요청 바디 생성  
        RequestBody requestBody = RequestBody.create(MediaType.parse("image/*"), file);  
  
        BufferedSink bufferedSink = new Buffer();  
        try {  
            requestBody.writeTo(bufferedSink);  
            bufferedSink.close();  
            long fileSizeInBytes = bufferedSink.buffer().size(); // 파일의 크기를 바이트 단위로 측정  
            // 파일의 크기를 바이트 단위로 출력하거나 다른 작업 수행  
            Log.d(TAG, "요청 바디에 담긴 파일 크기 " + fileSizeInBytes + " bytes");  
        } catch (IOException e) {  
            e.printStackTrace();  
        }  
  
        // MultipartBody.Part 생성  
        return MultipartBody.Part.createFormData(partName, file.getName(), requestBody);  
    }  
  
    public static void onFailure(Context context, String TAG, String message, Throwable t) {  
        Log.e(TAG, "onFailure: " + message + " 요청 실패 " + t.getMessage());  
        Toast.makeText(context, message + " 요청 실패", Toast.LENGTH_SHORT).show();  
    }  
  
    public static void onError(Context context, String TAG, String message) {  
        Log.d(TAG, "onFailure: " + message + "에러 응답");  
        Toast.makeText(context, message + " 에러 응답", Toast.LENGTH_SHORT).show();  
    }  
}  
  
</document_content>  
</document>  
<document index="182">  
<source>app/src/main/java\com\teamnova\assa\util\StartActivityUtils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.Context;  
import android.content.Intent;  
import android.os.Bundle;  
import android.os.Parcelable;  
import android.util.Log;  
  
import com.teamnova.assa.ui.activity.UserProfileActivity;  
  
import java.io.Serializable;  
import java.util.HashMap;  
  
/**  
 * 반복되어 나타나는 startActivity 재활용이 목적인 클래스  
 */  
public class StartActivityUtils {  
    private static final String TAG = StartActivityUtils.class.getSimpleName();  
  
    public static void moveToProfile(Context context, Long userId) {  
        HashMap<String, Object> params = new HashMap<>();  
        params.put("userId", userId);  
        move(context, UserProfileActivity.class, params);  
    }  
  
    public static void move(Context context, Class<?> clazz, HashMap<String, Object> params) {  
        Intent intent = new Intent(context, clazz);  
        putExtra(intent, params);  
  
        Log.d(TAG, clazz.getSimpleName() + " 으로 이동");  
        context.startActivity(intent);  
    }  
  
    private static void putExtra(Intent intent, HashMap<String, Object> params) {  
        if (params == null) return;  
  
        for (String key : params.keySet()) {  
            Object value = params.get(key);  
            if (value instanceof String) {  
                intent.putExtra(key, (String) value);  
            } else if (value instanceof Integer) {  
                intent.putExtra(key, (Integer) value);  
            } else if (value instanceof Boolean) {  
                intent.putExtra(key, (Boolean) value);  
            } else if (value instanceof Float) {  
                intent.putExtra(key, (Float) value);  
            } else if (value instanceof Long) {  
                intent.putExtra(key, (Long) value);  
            } else if (value instanceof Double) {  
                intent.putExtra(key, (Double) value);  
            } else if (value instanceof Byte) {  
                intent.putExtra(key, (Byte) value);  
            } else if (value instanceof Character) {  
                intent.putExtra(key, (Character) value);  
            } else if (value instanceof Short) {  
                intent.putExtra(key, (Short) value);  
            } else if (value instanceof CharSequence) {  
                intent.putExtra(key, (CharSequence) value);  
            } else if (value instanceof Bundle) {  
                intent.putExtra(key, (Bundle) value);  
            } else if (value instanceof Parcelable) {  
                intent.putExtra(key, (Parcelable) value);  
            } else if (value instanceof Serializable) {  
                intent.putExtra(key, (Serializable) value);  
            } else if (value instanceof boolean[]) {  
                intent.putExtra(key, (boolean[]) value);  
            } else if (value instanceof byte[]) {  
                intent.putExtra(key, (byte[]) value);  
            } else if (value instanceof short[]) {  
                intent.putExtra(key, (short[]) value);  
            } else if (value instanceof char[]) {  
                intent.putExtra(key, (char[]) value);  
            } else if (value instanceof int[]) {  
                intent.putExtra(key, (int[]) value);  
            } else if (value instanceof long[]) {  
                intent.putExtra(key, (long[]) value);  
            } else if (value instanceof float[]) {  
                intent.putExtra(key, (float[]) value);  
            } else if (value instanceof double[]) {  
                intent.putExtra(key, (double[]) value);  
            } else if (value instanceof String[]) {  
                intent.putExtra(key, (String[]) value);  
            } else if (value instanceof CharSequence[]) {  
                intent.putExtra(key, (CharSequence[]) value);  
            } else if (value instanceof Parcelable[]) {  
                intent.putExtra(key, (Parcelable[]) value);  
            } else {  
                throw new IllegalArgumentException("Unsupported data type: " + value.getClass().getName());  
            }  
        }  
    }  
}  
  
</document_content>  
</document>  
<document index="183">  
<source>app/src/main/java\com\teamnova\assa\util\StringUtils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import java.util.List;  
  
public class StringUtils {  
  
    /**  
     * 이미지 urlList를 이미지 경로 문자열로 변환  
     * @param urlList  
     * @return  
     */  
    public static String extractIamgeNames(List<String> urlList){  
        StringBuilder sb = new StringBuilder();  
        for (String urlString : urlList) {  
            sb.append(urlString).append(",");  
        }  
        // 마지막에 추가된 ',' 제거  
        if (sb.length() > 0) {  
            sb.deleteCharAt(sb.length() - 1);  
        }  
        return sb.toString();  
    }  
}  
  
</document_content>  
</document>  
<document index="184">  
<source>app/src/main/java\com\teamnova\assa\util\TempStorage.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.util.Log;  
  
import com.teamnova.assa.data.dto.data.SimpleUser;  
import com.teamnova.assa.data.dto.data.UserData;  
  
import java.util.HashMap;  
import java.util.Map;  
import java.util.Stack;  
  
public class TempStorage {  
    private static final String TAG = "TempStorage";  
    private static Map<String, Object> map = new HashMap<>();  
    public static Stack<Long> roomStack = new Stack<>();    // roomId stack  
  
    public static Object getItem(String key) {  
        Log.d(TAG, "getItem: 객체 꺼내옴 key :" + key + " - value : " + map.get(key));  
        return map.get(key);  
    }  
  
    public static void setItem(String key, Object value) {  
        Log.d(TAG, "setItem: 객체 저장 key :" + key + " - value : " + value);  
        map.put(key, value);  
    }  
  
    /**  
     * key와 매칭되는 객체를 map에서 빼냄  
     *  
     * @param key  
     * @return  
     */  
    public static Object removeItem(String key) {  
        Log.d(TAG, "removeItem: 객체 삭제 key :" + key);  
        return map.remove(key);  
    }  
  
    public static void clear() {  
        Log.d(TAG, "clear: 전체 객체 삭제");  
        map.clear();  
    }  
  
    public static void setMe(UserData userData) {  
        Log.d(TAG, "setMe: 내 정보 저장");  
        map.put("me", userData);  
        map.put("simpleMe", new SimpleUser(userData.id, userData.nickname, userData.profileImage));  
    }  
  
    public static UserData getMe() {  
        Log.d(TAG, "getMe: 내 정보 가져옴");  
        return (UserData) map.get("me");  
    }  
  
    public static SimpleUser getSimpleMe() {  
        Log.d(TAG, "getSimpleMe: 내 정보 가져옴");  
        return (SimpleUser) map.get("simpleMe");  
    }  
}  
  
</document_content>  
</document>  
<document index="185">  
<source>app/src/main/java\com\teamnova\assa\util\TimeUtils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.util.Log;  
  
import java.text.ParseException;  
import java.text.SimpleDateFormat;  
import java.time.LocalDateTime;  
import java.time.ZoneId;  
import java.time.ZoneOffset;  
import java.time.ZonedDateTime;  
import java.time.format.DateTimeFormatter;  
import java.util.Date;  
import java.util.Locale;  
import java.util.TimeZone;  
  
/**  
 * 시간 관련 유틸 메소드 모음  
 */  
public class TimeUtils {  
  
    static String TAG = TimeUtils.class.getSimpleName();  
  
    public static final String TIME_FORMAT_LOCAL = "yyyy-MM-dd HH:mm:ss";     // 시간대 맞춰진 시간 포맷  
    public static final String TIME_FORMAT_LOCAL_MIN = "yyyy-MM-dd HH:mm";     // 시간대 맞춰진 시간 포맷 분까지  
    public static final String TIME_FORMAT_UTC = "yyyy-MM-dd'T'HH:mm:ss.SSSX"; // UTC 시간 포맷  
  
    // 현재시간을 UTC 시간으로 변환  
    public static String getCurrentTimeInUTC() {  
        ZonedDateTime utcTime = ZonedDateTime.now(ZoneOffset.UTC);  
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(TIME_FORMAT_LOCAL);  
  
        String formatted = utcTime.format(formatter);  
//        Log.d(TAG, "getCurrentTimeInUTC: 현재 시간 = " + formatted);  
        return formatted;  
    }  
  
    // UTC -> 현재 시간대로 변환  
    public static String convertUTCToLocal(String utcTime) {  
        Log.d(TAG, "convertUTCToLocal: 주어진 UTC 시간 = " + utcTime);  
        ZonedDateTime utcDateTime = ZonedDateTime.parse(utcTime, DateTimeFormatter.ISO_OFFSET_DATE_TIME);  
        ZonedDateTime localDateTime = utcDateTime.withZoneSameInstant(ZoneId.systemDefault());  
  
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(TIME_FORMAT_LOCAL);  
        String formatted = localDateTime.format(formatter);  
        Log.d(TAG, "convertUTCToLocal: 변환된 시간 = " + formatted + "시간대 : " + ZoneId.systemDefault());  
        return formatted;  
    }  
  
    // UTC시간을 분까지 표시 "yyyy-MM-dd HH:mm"  
    public static String convertUTCToLocalMin(String utcTime) {  
        Log.d(TAG, "convertUTCToChat: 주어진 UTC 시간 = " + utcTime);  
  
        // 오픈채팅 진입시 아무 메시지 작성 안해도 채팅방 목록에 띄우기 위해 아래 코드 필요  
        if(utcTime == null || utcTime.isEmpty()) return "";  
  
        // 타임존 정보가 없기 때문에 ldt로 파싱한 다음 그 시간을 UTC로 해석해야 함  
  
        // 입력 문자열의 포맷터 정의 (타임존 정보 없이 LocalDateTime으로 파싱)  
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(TIME_FORMAT_LOCAL);  
        // LocalDateTime으로 파싱 (타임존 없이)  
        LocalDateTime localDateTime = LocalDateTime.parse(utcTime, formatter);  
        // UTC 타임존으로 해석  
        ZonedDateTime utcDateTime = localDateTime.atZone(ZoneOffset.UTC);  
        // 시스템 타임존으로 변환  
        ZonedDateTime localDateTimeWithZone = utcDateTime.withZoneSameInstant(ZoneId.systemDefault());  
  
        // 출력 포맷 정의  
        DateTimeFormatter outputFormatter = DateTimeFormatter.ofPattern(TIME_FORMAT_LOCAL_MIN);  
        String formatted = localDateTimeWithZone.format(outputFormatter);  
        Log.d(TAG, "convertUTCToLocal: 변환된 시간 = " + formatted + "시간대 : " + ZoneId.systemDefault());  
        return formatted;  
    }  
  
    // UTC 형식의 문자열을 Date 객체로 변환  
    public static SimpleDateFormat utcFormat = new SimpleDateFormat(TIME_FORMAT_LOCAL, Locale.getDefault());  
  
    // 오전/오후 형식으로 포맷하기 위한 SimpleDateFormat  
    public static SimpleDateFormat amPmFormat = new SimpleDateFormat("a hh:mm", Locale.KOREA); // a는 AM/PM 표시  
  
    public static String convertUTCToLocalTimeMin(String utcTime) {  
        utcFormat.setTimeZone(TimeZone.getTimeZone("UTC"));  
        amPmFormat.setTimeZone(TimeZone.getDefault()); // 로컬 타임존으로 설정  
        String formattedTime = "";  
        try {  
            // UTC 문자열을 Date 객체로 변환  
            Date date = utcFormat.parse(utcTime);  
            // 오전/오후 형식으로 변환  
            formattedTime = amPmFormat.format(date);  
        } catch (ParseException e) {  
            e.printStackTrace();  
        }  
  
        return formattedTime;  
    }  
  
}  
  
</document_content>  
</document>  
<document index="186">  
<source>app/src/main/java\com\teamnova\assa\util\UiFactories.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.content.Context;  
  
/**  
 * 각종 Ui 생성 클래스  
 */  
public class UiFactories {  
    private static String TAG = "UiFactories";  
    private Context mContext;  
  
    public UiFactories(Context context) {  
        mContext = context;  
    }  
  
  
  
}  
  
</document_content>  
</document>  
<document index="187">  
<source>app/src/main/java\com\teamnova\assa\util\Utils.java</source>  
<document_content>  
package com.teamnova.assa.util;  
  
import android.app.ActivityManager;  
import android.content.ComponentName;  
import android.content.Context;  
import android.graphics.Color;  
import android.text.SpannableString;  
import android.text.Spanned;  
import android.text.method.LinkMovementMethod;  
import android.text.style.ClickableSpan;  
import android.util.DisplayMetrics;  
import android.util.Log;  
import android.view.View;  
import android.view.inputmethod.InputMethodManager;  
import android.widget.TextView;  
  
import androidx.annotation.NonNull;  
  
import com.google.gson.Gson;  
import com.google.gson.GsonBuilder;  
import com.google.gson.JsonDeserializationContext;  
import com.google.gson.JsonDeserializer;  
import com.google.gson.JsonElement;  
import com.google.gson.JsonObject;  
import com.google.gson.JsonParseException;  
import com.google.gson.JsonParser;  
import com.google.gson.JsonPrimitive;  
import com.google.gson.JsonSerializationContext;  
import com.google.gson.JsonSerializer;  
import com.teamnova.assa.data.repository.TokenRepository;  
  
import java.lang.reflect.Type;  
import java.nio.charset.StandardCharsets;  
import java.security.MessageDigest;  
import java.security.NoSuchAlgorithmException;  
import java.security.SecureRandom;  
import java.time.LocalDateTime;  
import java.time.format.DateTimeFormatter;  
import java.util.ArrayList;  
import java.util.Base64;  
import java.util.HashMap;  
import java.util.List;  
import java.util.Map;  
import java.util.Random;  
  
/**  
 * 기타 편의 메소드 모음  
 */  
public class Utils {  
  
    private static final String TAG = Utils.class.getName();  
    private static Gson gson = null;  
  
    /**  
     * 랜덤한 숫자 반환한다  
     *  
     * @param digits 반환할 숫자의 자릿수  
     * @return  
     */  
    public static int generateRandomNumber(int digits) {  
        if (digits <= 0) throw new IllegalArgumentException("자릿수는 1 이상이어야 합니다.");  
  
  
        Random random = new Random();               // digits 가 6일 때  
        int min = (int) Math.pow(10, digits - 1);   // 100000  
        int max = (int) Math.pow(10, digits) - 1;   // 999999  
  
        return random.nextInt(max - min + 1) + min; // max, min 사이 개수 + 최소값  
    }  
  
    /**  
     * 랜덤한 숫자, 영문조합의 문자열을 생성합니다.  
     *  
     * @param length 생성할 문자열의 길이  
     * @return length 만큼의 길이를 가진 영문, 숫자 조합의 랜덤 문자열  
     */  
    public static String generateRandomString(int length) {  
        String allowedCharacters = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";  
  
        StringBuilder sb = new StringBuilder(length);  
        SecureRandom random = new SecureRandom();  
        for (int i = 0; i < length; i++) {  
            int randomIndex = random.nextInt(allowedCharacters.length());  
            char randomChar = allowedCharacters.charAt(randomIndex);  
            sb.append(randomChar);  
        }  
        return sb.toString();  
    }  
  
    // LocalDateTime 대응 직렬화 클래스 생성  
    public static Gson getGsonInstance() {  
        if (gson == null) {  
            GsonBuilder gsonBuilder = new GsonBuilder();  
  
            gsonBuilder.registerTypeAdapter(LocalDateTime.class, new LocalDateTimeSerializer());  
            gsonBuilder.registerTypeAdapter(LocalDateTime.class, new LocalDateTimeDeserializer());  
            gsonBuilder.serializeNulls();  
  
            gson = gsonBuilder.setPrettyPrinting().create();  
        }  
        return gson;  
    }  
  
  
    /**  
     * 약관 동의 텍스트 중 일부를 클릭하면 약관조회 버튼으로 작동하게 만듬  
     *  
     * @param v        textview  
     * @param text     텍스트 원문  
     * @param target   클릭이벤트 부여할 부분  
     * @param listener span 클릭이벤트 처리하는 리스터  
     */  
    public static void makeTextSpannable(View v, String text, String target, View.OnClickListener listener) {  
        SpannableString spannable = new SpannableString(text);  
  
        // span 텍스트에 리스너 부착  
        ClickableSpan clickableSpan = new ClickableSpan() {  
            @Override  
            public void onClick(@NonNull View widget) {  
                if (listener == null) return;  
                // 인자로 받은 클릭리스너 실행  
                listener.onClick(widget);  
                Log.d(TAG, "onClick: " + target);  
            }  
        };  
  
        // span 범위 지정  
        int startIndex = text.indexOf(target);  
        int endIndex = startIndex + target.length();  
  
        // span을 target 텍스트에 부착  
        spannable.setSpan(clickableSpan, startIndex, endIndex, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  
  
        ((TextView) v).setText(spannable); // textview에 텍스트 할당  
        ((TextView) v).setMovementMethod(LinkMovementMethod.getInstance()); // Spannable 클릭 이벤트 활성화  
        ((TextView) v).setHighlightColor(Color.TRANSPARENT); // span 클릭 여부 표시 제거  
    }  
  
    public static String getSHA256(String source) {  
        try {  
            MessageDigest md = MessageDigest.getInstance("SHA-256");  
            byte[] hashBytes = md.digest(source.getBytes(StandardCharsets.UTF_8)); // 해싱  
  
            // 바이트 배열을 16진수 문자열로 변환  
            StringBuilder result = new StringBuilder();  
            for (byte b : hashBytes) {  
                result.append(String.format("%02x", b));  
            }  
  
            return result.toString();  
        } catch (NoSuchAlgorithmException e) {  
            throw new RuntimeException(e);  
        }  
    }  
  
    public static String generateTAG(Class<?> object) {  
        return object.getSimpleName();  
    }  
  
  
    /**  
     * JSON 문자열을 Map 객체로 변환하는 메서드  
     *  
     * @param jsonString JSON 문자열  
     * @return 변환된 Map 객체  
     */  
    public static Map<String, Object> jsonToMap(String jsonString) {  
        return convertToMap(getGsonInstance().fromJson(jsonString, Map.class));  
    }  
  
  
    /**  
     * Map의 value를 map이나 list로 변환  
     *  
     * @param jsonMap  
     * @return  
     */  
    private static Map<String, Object> convertToMap(Map<?, ?> jsonMap) {  
        Map<String, Object> result = new HashMap<>();  
  
        // Map의 value를 map이나 list로 변환  
        for (Map.Entry<?, ?> entry : jsonMap.entrySet()) {  
            Object value = entry.getValue();  
            if (value instanceof Map) {  
                value = convertToMap((Map<?, ?>) value);  
            } else if (value instanceof List) {  
                value = convertToList((List<?>) value);  
            }  
            result.put(String.valueOf(entry.getKey()), value);  
        }  
        return result;  
    }  
  
    /**  
     * List의 각 요소를 map이나 list로 변환  
     *  
     * @param jsonList  
     * @return  
     */  
    private static List<Object> convertToList(List<?> jsonList) {  
        List<Object> resultList = new ArrayList<>();  
  
        // list의 각 요소를 map이나 list 또는 원래 타입으로 변환  
        for (Object item : jsonList) {  
            if (item instanceof Map) {  
                resultList.add(convertToMap((Map<?, ?>) item));  
            } else if (item instanceof List) {  
                resultList.add(convertToList((List<?>) item));  
            } else {  
                resultList.add(item);  
            }  
        }  
        return resultList;  
    }  
  
  
  
    public static Long getUserIdFromJwt() {  
        String jwt = TokenRepository.getToken();  
  
        // JWT 토큰에서 페이로드 추출  
        String[] parts = jwt.split("\\.");  
        if (parts.length != 3) {  
            return -1L;  
        }  
        String payload = parts[1];  
  
        // Base64 URL 디코딩  
        byte[] decodedBytes = Base64.getUrlDecoder().decode(payload);  
        String decodedPayload = new String(decodedBytes);  
  
        // JSON 파싱  
        JsonObject jsonPayload = JsonParser.parseString(decodedPayload).getAsJsonObject();  
  
        // "sub" 클레임 추출  
        String sub = jsonPayload.has("sub") ? jsonPayload.get("sub").getAsString() : "-1";  
  
        // Long 타입으로 변환  
        Long UserId = Long.parseLong(sub);  
        Log.d(TAG, "getUserIdFromJwt: UserId = " + UserId);  
        return UserId;  
    }  
  
    /**  
     * 키보드 숨기기  
     * @param context  
     * @param view - 현재 포커스된 뷰  
     */  
    public static void hideKeyboard(Context context, View view){  
        InputMethodManager imm = (InputMethodManager) context.getSystemService(Context.INPUT_METHOD_SERVICE);  
        imm.hideSoftInputFromWindow(view.getWindowToken(), 0);  
    }  
  
    /**  
     * 포그라운드 액티비티인지 확인  
     * @param context - 앱 컨텍스트  
     * @param cls   - 액티비티 클래스  
     * @return  
     */  
    public static boolean isForegroundActivity(Context context, Class<?> cls){  
        if(cls == null) return false;  
  
        ActivityManager activityManager = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);  
        // 실행 중인 액티비티 목록을 가져옴 (최대 1개),  
        List<ActivityManager.RunningTaskInfo> runningTasks = activityManager.getRunningTasks(1);  
        // 가장상위 (포어그라운드에서 실행 중인)작업 정보 획득  
        ActivityManager.RunningTaskInfo runningTask = runningTasks.get(0);  
        ComponentName componentName = runningTask.topActivity;  
  
        return cls.getName().equals(componentName.getClassName());  
    }  
  
    public static int dpToPx(Context context, int dp) {  
        DisplayMetrics metrics = context.getResources().getDisplayMetrics();  
        return Math.round(dp * metrics.density);  
    }  
}  
  
  
class LocalDateTimeSerializer implements JsonSerializer<LocalDateTime> {  
    private static final DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");  
  
    @Override  
    public JsonElement serialize(LocalDateTime localDateTime, Type srcType, JsonSerializationContext context) {  
        return new JsonPrimitive(formatter.format(localDateTime));  
    }  
}  
  
class LocalDateTimeDeserializer implements JsonDeserializer<LocalDateTime> {  
    @Override  
    public LocalDateTime deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context)  
            throws JsonParseException {  
        return LocalDateTime.parse(json.getAsString(),  
                DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"));  
    }  
}  
</document_content>  
</document>  
<document index="188">  
<source>app/src/main/res/layout\activity_account_linking.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.EmailActivity"  
    android:orientation="vertical"  
    >  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="16dp"  
        android:orientation="vertical"  
        android:padding="16dp"  
        >  
  
        <ImageButton  
            android:id="@+id/btn_back"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:backgroundTint="#00000000"  
            android:paddingLeft="0dp"  
            android:src="@drawable/all_arrow_back" />  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            >  
            <TextView  
                android:id="@+id/title"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="기존 계정에 연결"  
                android:textColor="@color/black"  
                android:textSize="24dp"  
                android:layout_marginBottom="8dp"  
                android:textStyle="bold" />  
  
            <TextView                android:id="@+id/description"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="24dp"  
                android:text=""  
                android:textColor="@color/black" />  
  
            <TextView                android:id="@+id/user_info"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="24dp"  
                android:textColor="@color/black"/>  
        </LinearLayout>  
  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:orientation="vertical">  
  
  
            <com.google.android.material.textfield.TextInputLayout  
                android:id="@+id/password_til"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
                android:hint="비밀번호"  
                android:textColorHint="#999DA3"  
                app:passwordToggleEnabled="true"  
                app:errorEnabled="true">  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/password_tiet"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:inputType="textPassword"  
                    android:maxLength="255" />  
            </com.google.android.material.textfield.TextInputLayout>  
  
        </LinearLayout>  
  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_next"  
            style="@style/Widget.AppCompat.Button.Borderless"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:background="@drawable/button_state_color"  
            android:enabled="true"  
            android:textColor="@drawable/button_text_state_color"  
            android:textStyle="bold"  
            android:layout_marginBottom="16dp"  
            android:text="연결하기" />  
  
        <TextView            android:id="@+id/tv_signUp"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="신규회원으로 시작하기"  
            android:textAlignment="center"  
            android:textColor="#8A8A8A"  
            android:clickable="true"  
            android:focusable="true"  
            />  
  
    </LinearLayout>  
  
</LinearLayout>  
  
  
</document_content>  
</document>  
<document index="189">  
<source>app/src/main/res/layout\activity_agree_to_terms.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    android:padding="16dp">  
  
    <ImageButton  
        android:id="@+id/btn_back"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:backgroundTint="#00000000"  
        android:paddingLeft="0dp"  
        android:src="@drawable/all_arrow_back" />  
  
  
    <TextView        android:id="@+id/title"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="24dp"  
        android:text="약관 동의"  
        android:textColor="@color/black"  
        android:textSize="24dp"  
        android:textStyle="bold" />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical">  
  
        <Space  
            android:layout_width="wrap_content"  
            android:layout_height="0dp"  
            android:layout_weight="1" />  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical">  
  
            <TextView  
                android:id="@+id/textView2"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="서비스약관에 동의해주세요."  
                android:textStyle="bold" />  
  
            <LinearLayout                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:orientation="horizontal">  
  
                <android.widget.CheckBox  
                    android:id="@+id/check_all_terms"  
                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:background="@android:color/transparent"  
                    android:buttonTint="@color/primary" />  
  
                <TextView                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:text="모두 동의합니다."  
                    android:textSize="16dp"  
                    android:textStyle="bold" />  
            </LinearLayout>  
  
            <LinearLayout                android:id="@+id/requiredTermsContainer"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="24dp"  
                android:orientation="vertical"  
                android:paddingLeft="24dp">  
  
                <LinearLayout  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:orientation="horizontal">  
  
                    <android.widget.CheckBox  
                        android:id="@+id/check_service_term"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:background="@android:color/transparent"  
                        android:buttonTint="@color/primary" />  
  
                    <TextView                        android:id="@+id/tv_service_term"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:text="[필수] 서비스 이용약관 동의"  
  
                        />  
                </LinearLayout>  
  
                <LinearLayout                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:orientation="horizontal">  
  
                    <android.widget.CheckBox  
                        android:id="@+id/check_privacy_term"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:background="@android:color/transparent"  
                        android:buttonTint="@color/primary" />  
  
                    <TextView                        android:id="@+id/tv_privacy_term"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:text="[필수] 개인정보 처리방침 동의"  
  
                        />  
                </LinearLayout>  
  
            </LinearLayout>  
  
  
        </LinearLayout>  
  
    </LinearLayout>  
  
    <android.widget.Button        android:id="@+id/btn_next"  
        style="@style/Widget.AppCompat.Button.Borderless"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:background="@drawable/button_state_color"  
        android:enabled="false"  
        android:text="동의하고 가입하기"  
        android:textColor="@drawable/button_text_state_color"  
        android:textStyle="bold"  
        />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="190">  
<source>app/src/main/res/layout\activity_banned_user_list.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.EditAccountActivity">  
  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        >  
  
        <ImageButton  
            android:id="@+id/back_button"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="left"  
            android:contentDescription="뒤로가기"  
            android:background="@android:color/transparent"  
            android:src="@drawable/all_arrow_back" />  
  
        <TextView            android:id="@+id/toolbar_title"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="center"  
            android:gravity="center"  
            android:text="차단유저 목록"  
            android:textStyle="bold"  
            android:textAppearance="@style/TextAppearance.AppCompat.Widget.ActionBar.Title" />  
    </androidx.appcompat.widget.Toolbar>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content"/>  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="191">  
<source>app/src/main/res/layout\activity_change_description.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.ChangeRoomNameActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_room_name_change"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"></androidx.appcompat.widget.Toolbar>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey" />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="horizontal">  
  
            <TextView  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_marginRight="8dp"  
                android:text="채팅방 소개글"  
                android:textSize="18sp"  
                android:textStyle="bold" />  
  
            <TextView                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="공백으로 저장하면 기본값으로 초기화 됩니다."  
                android:textColor="@color/grey"  
                android:visibility="gone"  
                android:textSize="12sp" />  
  
        </LinearLayout>  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical">  
  
            <com.google.android.material.textfield.TextInputLayout  
                android:id="@+id/til_new_room_name"  
                style="@style/Widget.MaterialComponents.TextInputLayout.FilledBox"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                app:boxBackgroundColor="@android:color/transparent"  
                app:counterEnabled="true"  
                app:counterMaxLength="50"  
                app:endIconMode="clear_text"  
                >  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/tiet_new_room_name"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:background="@android:color/transparent"  
                    android:inputType="text"  
                    android:maxLength="50" />  
            </com.google.android.material.textfield.TextInputLayout>  
        </LinearLayout>  
  
    </LinearLayout>  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="192">  
<source>app/src/main/res/layout\activity_change_open_chat_room_name.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.ChangeRoomNameActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_room_name_change"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"></androidx.appcompat.widget.Toolbar>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey" />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="horizontal">  
  
            <TextView  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_marginRight="8dp"  
                android:text="채팅방 이름"  
                android:textSize="18sp"  
                android:textStyle="bold" />  
  
            <TextView                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="공백으로 저장하면 기본값으로 초기화 됩니다."  
                android:textColor="@color/grey"  
                android:visibility="gone"  
                android:textSize="12sp" />  
  
        </LinearLayout>  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical">  
  
            <com.google.android.material.textfield.TextInputLayout  
                android:id="@+id/til_new_room_name"  
                style="@style/Widget.MaterialComponents.TextInputLayout.FilledBox"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                app:boxBackgroundColor="@android:color/transparent"  
                app:counterEnabled="true"  
                app:counterMaxLength="50"  
                app:endIconMode="clear_text"  
                >  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/tiet_new_room_name"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:background="@android:color/transparent"  
                    android:inputType="text"  
                    android:maxLength="50" />  
            </com.google.android.material.textfield.TextInputLayout>  
        </LinearLayout>  
  
    </LinearLayout>  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="193">  
<source>app/src/main/res/layout\activity_change_password.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.ChangePasswordActivity"  
    android:orientation="vertical"  
    >  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize">  
  
        <ImageButton  
            android:id="@+id/back_button"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="left"  
            android:contentDescription="뒤로가기"  
            android:background="@android:color/transparent"  
            android:src="@drawable/all_arrow_back" />  
  
        <TextView            android:id="@+id/toolbar_title"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="left"  
            android:paddingLeft="32dp"  
            android:gravity="center"  
            android:text="비밀번호 변경"  
            android:textAppearance="@style/TextAppearance.AppCompat.Widget.ActionBar.Title"  
            android:textStyle="bold" />  
  
        <TextView            android:id="@+id/tv_save_edit_profile"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="end"  
            android:gravity="center"  
            android:paddingHorizontal="16dp"  
            android:text="저장하기"  
            android:enabled="false"  
            android:textColor="@drawable/text_state_color"  
            android:textStyle="bold" />  
    </androidx.appcompat.widget.Toolbar>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content" />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:layout_marginBottom="16dp"  
            android:orientation="vertical">  
  
            <TextView  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="현재 비밀번호"  
                android:textColor="@color/black"  
                android:textStyle="bold" />  
  
            <com.google.android.material.textfield.TextInputLayout                android:id="@+id/til_current_password"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
                android:textColorHint="#999DA3"  
                app:counterEnabled="true"  
                app:counterMaxLength="32"  
                app:errorEnabled="true"  
                app:errorIconDrawable="@null"  
                app:endIconMode="password_toggle"  
                app:endIconDrawable="@drawable/custom_password_eye"  
                >  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/tiet_current_password"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:inputType="textPassword"  
                    android:maxLength="32" />  
            </com.google.android.material.textfield.TextInputLayout>  
  
  
        </LinearLayout>  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:layout_marginBottom="16dp"  
            android:orientation="vertical">  
  
            <TextView  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="새 비밀번호"  
                android:textColor="@color/black"  
                android:textStyle="bold" />  
  
            <com.google.android.material.textfield.TextInputLayout                android:id="@+id/til_new_password"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
                android:hint="8~32자리 영문, 숫자, 특수문자 조합"  
                android:textColorHint="#999DA3"  
                app:counterEnabled="true"  
                app:counterMaxLength="32"  
                app:errorEnabled="true"  
                app:errorIconDrawable="@null"  
                app:endIconMode="password_toggle"  
                app:endIconDrawable="@drawable/custom_password_eye">  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/tiet_new_password"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:inputType="textPassword"  
                    android:maxLength="32" />  
            </com.google.android.material.textfield.TextInputLayout>  
  
  
        </LinearLayout>  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:layout_marginBottom="16dp"  
            android:orientation="vertical">  
  
            <TextView  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="새 비밀번호 재입력"  
                android:textColor="@color/black"  
                android:textStyle="bold" />  
  
            <com.google.android.material.textfield.TextInputLayout                android:id="@+id/til_re_new_password"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
                android:hint="새 비밀번호 재입력"  
                android:textColorHint="#999DA3"  
                app:counterEnabled="true"  
                app:counterMaxLength="32"  
                app:endIconMode="password_toggle"  
                app:endIconDrawable="@drawable/custom_password_eye"  
                app:errorEnabled="true"  
                app:errorIconDrawable="@null"  
                >  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/tiet_re_new_password"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:inputType="textPassword"  
                    android:maxLength="32" />  
            </com.google.android.material.textfield.TextInputLayout>  
  
  
        </LinearLayout>  
  
    </LinearLayout>  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="194">  
<source>app/src/main/res/layout\activity_change_room_name.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.ChangeRoomNameActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_room_name_change"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"></androidx.appcompat.widget.Toolbar>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey" />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="horizontal">  
  
            <TextView  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_marginRight="8dp"  
                android:text="채팅방 이름"  
                android:textSize="18sp"  
                android:textStyle="bold" />  
  
            <TextView                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="공백으로 저장하면 기본값으로 초기화 됩니다."  
                android:textColor="@color/grey"  
                android:textSize="12sp" />  
  
        </LinearLayout>  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical">  
  
            <com.google.android.material.textfield.TextInputLayout  
                android:id="@+id/til_new_room_name"  
                style="@style/Widget.MaterialComponents.TextInputLayout.FilledBox"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                app:boxBackgroundColor="@android:color/transparent"  
                app:counterEnabled="true"  
                app:counterMaxLength="50"  
                app:endIconMode="clear_text"  
                >  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/tiet_new_room_name"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:background="@android:color/transparent"  
                    android:inputType="text"  
                    android:maxLength="50" />  
            </com.google.android.material.textfield.TextInputLayout>  
        </LinearLayout>  
  
    </LinearLayout>  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="195">  
<source>app/src/main/res/layout\activity_chat_room.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<androidx.drawerlayout.widget.DrawerLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/dl_chatroom"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.ChatRoomActivity">  
  
    <LinearLayout  
        android:id="@+id/ll_chatroom"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:orientation="vertical">  
  
        <androidx.appcompat.widget.Toolbar  
            android:id="@+id/toolbar_chatroom"  
            android:layout_width="match_parent"  
            android:layout_height="?attr/actionBarSize">  
  
<!--            <TextView-->  
<!--                android:layout_width="wrap_content"-->  
<!--                android:layout_height="wrap_content"-->  
<!--                android:text="000"-->  
<!--                android:textStyle="bold"-->  
<!--                android:textColor="@color/grey"-->  
<!--                />-->  
  
        </androidx.appcompat.widget.Toolbar>  
  
        <View            android:layout_width="match_parent"  
            android:layout_height="1dp"  
            android:background="@color/divider_grey" />  
  
        <!-- 메시지 목록 -->  
        <androidx.recyclerview.widget.RecyclerView  
            android:id="@+id/rv_chat"  
            android:layout_width="match_parent"  
            android:layout_height="0dp"  
            android:layout_weight="1"  
            />  
  
        <View            android:layout_width="match_parent"  
            android:layout_height="1dp"  
            android:background="@color/divider_grey" />  
  
        <TextView            android:id="@+id/tv_indicator"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:gravity="center"  
            android:text="전송 중..."  
            android:padding="4dp"  
            android:background="@color/divider_grey"  
            android:visibility="gone"  
            />  
  
  
        <!-- 텍스트 입력창을 포함한 하단 레이아웃 -->  
        <LinearLayout  
            android:id="@+id/ll_chatroom_bottom"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical">  
  
            <LinearLayout  
                android:id="@+id/ll_bottom_chatroom"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_gravity="bottom"  
                android:gravity="center_vertical"  
                android:background="@android:color/white"  
                android:orientation="horizontal"  
                android:padding="8dp"  
                >  
  
                <ImageButton  
                    android:id="@+id/ib_select_image"  
                    android:layout_width="40dp"  
                    android:layout_height="40dp"  
                    android:background="@color/white"  
                    android:src="@drawable/ic_image" />  
  
                <EditText                    android:id="@+id/et_message"  
                    android:layout_width="0dp"  
                    android:layout_height="wrap_content"  
                    android:layout_marginEnd="8dp"  
                    android:layout_weight="1"  
                    android:hint="Type a message"  
                    android:inputType="text"  
                    android:padding="8dp"  
                    android:background="@android:color/transparent"  
                    />  
  
                <androidx.appcompat.widget.AppCompatButton                    android:id="@+id/btn_send"  
                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:text="보내기"  
                    android:enabled="false"  
                    android:textStyle="bold"  
                    android:textColor="@drawable/text_state_color"  
                    android:textSize="20sp"  
                    android:background="@android:color/transparent"  
                    />  
  
            </LinearLayout>  
  
        </LinearLayout>  
  
  
    </LinearLayout>  
  
    <include        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:id="@+id/ll_chatroom_sidemenu"  
        layout="@layout/layout_chat_side_drawer"  
        android:layout_gravity="right"  
        />  
  
</androidx.drawerlayout.widget.DrawerLayout>  
</document_content>  
</document>  
<document index="196">  
<source>app/src/main/res/layout\activity_comment_update.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.PostCreateActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_comment_update"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toTopOf="parent" />  
  
  
    <EditText        android:id="@+id/et_content_comment"  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="1"  
        android:background="@android:color/transparent"  
        android:gravity="top"  
        android:hint="본문을 입력해주세요"  
        android:padding="16dp"  
        app:layout_constraintBottom_toTopOf="@+id/linearLayout"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toBottomOf="@+id/toolbar_post_create" />  
  
<!--    <LinearLayout-->  
<!--        android:id="@+id/linearLayout"-->  
<!--        android:layout_width="match_parent"-->  
<!--        android:layout_height="wrap_content"-->  
<!--        android:orientation="horizontal"-->  
<!--        android:padding="8dp"-->  
<!--        app:layout_constraintBottom_toBottomOf="parent"-->  
<!--        app:layout_constraintEnd_toEndOf="parent"-->  
<!--        app:layout_constraintStart_toStartOf="parent">-->  
  
  
<!--        <ImageButton-->  
<!--            android:id="@+id/ib_add_image"-->  
<!--            android:layout_width="wrap_content"-->  
<!--            android:layout_height="wrap_content"-->  
<!--            android:background="@color/white"-->  
<!--            android:src="@drawable/ic_image" />-->  
  
<!--    </LinearLayout>-->  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="197">  
<source>app/src/main/res/layout\activity_edit_account.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.EditAccountActivity">  
  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        >  
  
        <ImageButton  
            android:id="@+id/back_button"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="left"  
            android:contentDescription="뒤로가기"  
            android:background="@android:color/transparent"  
            android:src="@drawable/all_arrow_back" />  
  
        <TextView            android:id="@+id/toolbar_title"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="center"  
            android:gravity="center"  
            android:text="계정 설정"  
            android:textStyle="bold"  
            android:textAppearance="@style/TextAppearance.AppCompat.Widget.ActionBar.Title" />  
    </androidx.appcompat.widget.Toolbar>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content"/>  
  
    <!-- Content -->  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_below="@id/toolbar"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <TextView  
            android:id="@+id/change_password"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="비밀번호 변경"  
            android:textSize="18sp"  
            android:padding="8dp" />  
  
        <TextView            android:id="@+id/withdraw"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="회원탈퇴"  
            android:textSize="18sp"  
            android:padding="8dp" />  
  
    </LinearLayout>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="198">  
<source>app/src/main/res/layout\activity_edit_profile.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.EditProfileActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize">  
  
        <ImageButton  
            android:id="@+id/back_button"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="left"  
            android:contentDescription="뒤로가기"  
            android:background="@android:color/transparent"  
            android:src="@drawable/all_arrow_back" />  
  
        <TextView            android:id="@+id/toolbar_title"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="center"  
            android:gravity="center"  
            android:text="프로필 편집"  
            android:textAppearance="@style/TextAppearance.AppCompat.Widget.ActionBar.Title"  
            android:textStyle="bold" />  
  
        <TextView            android:id="@+id/tv_save_edit_profile"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="end"  
            android:gravity="center"  
            android:padding="16dp"  
            android:text="저장하기"  
            android:enabled="false"  
            android:textColor="@drawable/text_state_color"  
            android:textStyle="bold" />  
    </androidx.appcompat.widget.Toolbar>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content" />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <TextView  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="프로필 이미지"  
            android:textSize="18sp"  
            android:textStyle="bold" />  
  
        <FrameLayout            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:layout_gravity="center">  
  
            <ImageView  
                android:id="@+id/iv_profile_image"  
                android:layout_width="100dp"  
                android:layout_height="100dp"  
                android:layout_gravity="center"  
                android:background="@drawable/circle_shape"  
                android:scaleType="centerCrop"  
                tools:srcCompat="@tools:sample/avatars" />  
  
            <ImageView                android:id="@+id/iv_camera_icon"  
                android:layout_width="100dp"  
                android:layout_height="100dp"  
                android:layout_gravity="center"  
                android:background="@drawable/semi_transparent_circle"  
                android:scaleType="center"  
                android:src="@drawable/ic_camera" />  
  
        </FrameLayout>  
  
  
    </LinearLayout>  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <TextView  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="닉네임"  
            android:textSize="18sp"  
            android:textStyle="bold" />  
  
        <com.google.android.material.textfield.TextInputLayout            android:id="@+id/til_nickname_edit_profile"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            app:counterEnabled="true"  
            app:counterMaxLength="20"  
            >  
  
            <com.google.android.material.textfield.TextInputEditText  
                android:id="@+id/tiet_nickname_edit_profile"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:maxLength="20"  
                />  
        </com.google.android.material.textfield.TextInputLayout>  
  
    </LinearLayout>  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <TextView  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="소개글"  
            android:textSize="18sp"  
            android:textStyle="bold" />  
  
        <com.google.android.material.textfield.TextInputLayout            android:id="@+id/til_description_edit_profile"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            app:counterEnabled="true"  
            app:counterMaxLength="60"  
            >  
  
            <com.google.android.material.textfield.TextInputEditText  
                android:id="@+id/tiet_description_edit_profile"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:maxLength="60"  
                />  
        </com.google.android.material.textfield.TextInputLayout>  
  
    </LinearLayout>  
</LinearLayout>  
</document_content>  
</document>  
<document index="199">  
<source>app/src/main/res/layout\activity_email.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.EmailActivity"  
    android:orientation="vertical"  
    >  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="16dp"  
        android:orientation="vertical"  
        android:padding="16dp"  
        >  
  
        <ImageButton  
            android:id="@+id/btn_back"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:backgroundTint="#00000000"  
            android:paddingLeft="0dp"  
            android:src="@drawable/all_arrow_back" />  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            >  
            <TextView  
                android:id="@+id/title"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="이메일"  
                android:textColor="@color/black"  
                android:textSize="24dp"  
                android:layout_marginBottom="8dp"  
                android:textStyle="bold" />  
  
            <TextView                android:id="@+id/description"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="24dp"  
                android:text="사용하시는 이메일을 입력해주세요."  
                android:textColor="@color/black" />  
  
        </LinearLayout>  
  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:orientation="vertical">  
  
  
            <TextView  
                android:id="@+id/tv_email_title"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="이메일"  
                android:textStyle="bold"  
                android:visibility="gone"  
                android:textColor="@color/black" />  
  
            <com.google.android.material.textfield.TextInputLayout                android:id="@+id/email_layout"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
                android:textColorHint="#999DA3"  
                app:hintAnimationEnabled="false"  
                app:errorEnabled="true">  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/email"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:inputType="textEmailAddress"  
                    android:hint="예) example@gmail.com"  
                    android:maxLength="255" />  
            </com.google.android.material.textfield.TextInputLayout>  
  
        </LinearLayout>  
  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_next"  
            style="@style/Widget.AppCompat.Button.Borderless"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:background="@drawable/button_state_color"  
            android:enabled="false"  
            android:textColor="@drawable/button_text_state_color"  
            android:textStyle="bold"  
            android:text="다음" />  
  
    </LinearLayout>  
  
</LinearLayout>  
  
  
</document_content>  
</document>  
<document index="200">  
<source>app/src/main/res/layout\activity_email_confirmation.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.EmailActivity"  
    android:orientation="vertical"  
    >  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="16dp"  
        android:orientation="vertical"  
        android:padding="16dp"  
        >  
  
        <ImageButton  
            android:id="@+id/btn_back"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:backgroundTint="#00000000"  
            android:paddingLeft="0dp"  
            android:src="@drawable/all_arrow_back" />  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            >  
            <TextView  
                android:id="@+id/title"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="인증번호 확인"  
                android:textColor="@color/black"  
                android:textSize="24dp"  
                android:layout_marginBottom="8dp"  
                android:textStyle="bold" />  
  
            <TextView                android:id="@+id/description"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="24dp"  
                android:text="입력한 이메일 주소로 인증번호를 전송했습니다.\n전송받은 인증번호를 입력하세요"  
                android:textColor="@color/black" />  
        </LinearLayout>  
  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:orientation="vertical">  
  
            <TextView  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="인증번호"  
                android:textStyle="bold"  
                android:textSize="16sp"  
                />  
  
            <com.google.android.material.textfield.TextInputLayout                android:id="@+id/code_layout"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
                android:textColorHint="#999DA3"  
                app:errorEnabled="true">  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/code"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:inputType="textEmailAddress"  
                    android:maxLength="255" />  
            </com.google.android.material.textfield.TextInputLayout>  
  
        </LinearLayout>  
  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_next"  
            style="@style/Widget.AppCompat.Button.Borderless"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:background="@drawable/button_state_color"  
            android:enabled="false"  
            android:textColor="@drawable/button_text_state_color"  
            android:textStyle="bold"  
            android:text="다음"  
            android:layout_marginBottom="16dp"  
            />  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_resend"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:paddingHorizontal="16dp"  
            android:text="인증번호 재전송"  
            android:textColor="@color/primary"  
            android:background="#00ff0000"  
            />  
  
    </LinearLayout>  
  
</LinearLayout>  
  
  
</document_content>  
</document>  
<document index="201">  
<source>app/src/main/res/layout\activity_follower.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.FollowingActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/tb_follower"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"/>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content"/>  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_follower"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent" />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="202">  
<source>app/src/main/res/layout\activity_following.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.FollowingActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/tb_following"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"/>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content"/>  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_following"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent" />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="203">  
<source>app/src/main/res/layout\activity_friends.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:fitsSystemWindows="true"  
    android:orientation="vertical"  
    tools:context=".ui.activity.FriendsActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/tb_friends"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"/>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content"/>  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_friends"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent" />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="204">  
<source>app/src/main/res/layout\activity_full_terms.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.FullTermsActivity"  
    android:orientation="vertical"  
    android:padding="16dp"  
    >  
  
  
    <ImageButton  
        android:id="@+id/btn_back"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:backgroundTint="#00000000"  
        android:paddingLeft="0dp"  
        android:src="@drawable/all_arrow_back" />  
  
  
    <ScrollView        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:fillViewport="true"  
        >  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:orientation="vertical"  
            >  
  
            <TextView  
                android:id="@+id/tv_terms_title"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="약관 제목"  
                android:textStyle="bold"  
                android:textSize="24sp"  
                android:layout_marginBottom="8dp"  
                />  
  
  
            <TextView                android:id="@+id/terms"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="" />  
        </LinearLayout>  
  
    </ScrollView>  
  
  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="205">  
<source>app/src/main/res/layout\activity_http_practice.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    android:padding="16dp"  
    tools:context=".ui.activity.MainActivity2">  
  
    <TextView  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:text="HTTP 통신 테스트"  
        android:textSize="32dp"  
        android:layout_marginBottom="16dp"  
        />  
  
    <Button        android:id="@+id/btn_main_reset"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="reset"  
        android:textSize="16dp"/>  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:layout_marginBottom="16dp"  
        >  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content">  
            <TextView  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="HttpURLConnection"  
                android:textSize="24dp"  
                app:layout_constraintBottom_toBottomOf="parent"  
                app:layout_constraintEnd_toEndOf="parent"  
                app:layout_constraintStart_toStartOf="parent"  
                app:layout_constraintTop_toTopOf="parent" />  
            <Space                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_weight="1" />  
  
            <Button                android:id="@+id/btn_main_send_httpUrlConnection"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="request send"/>  
        </LinearLayout>  
  
        <TextView            android:id="@+id/tv_main_response_httpUrlConnection"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content" />  
  
    </LinearLayout>  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:layout_marginBottom="16dp"  
        >  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content">  
            <TextView  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="Volley"  
                android:textSize="24dp"  
                app:layout_constraintBottom_toBottomOf="parent"  
                app:layout_constraintEnd_toEndOf="parent"  
                app:layout_constraintStart_toStartOf="parent"  
                app:layout_constraintTop_toTopOf="parent" />  
            <Space                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_weight="1" />  
  
            <Button                android:id="@+id/btn_main_send_volley"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="request send"/>  
        </LinearLayout>  
  
        <TextView            android:id="@+id/tv_main_response_volley"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content" />  
  
    </LinearLayout> <LinearLayout  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:orientation="vertical"  
    android:layout_marginBottom="16dp"  
    >  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content">  
        <TextView  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="Retrofit"  
            android:textSize="24dp"  
            app:layout_constraintBottom_toBottomOf="parent"  
            app:layout_constraintEnd_toEndOf="parent"  
            app:layout_constraintStart_toStartOf="parent"  
            app:layout_constraintTop_toTopOf="parent" />  
        <Space            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:layout_weight="1" />  
  
        <Button            android:id="@+id/btn_main_send_retrofit"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="request send"/>  
    </LinearLayout>  
  
    <TextView        android:id="@+id/tv_main_response_retrofit"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content" />  
  
</LinearLayout>  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="206">  
<source>app/src/main/res/layout\activity_login.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    android:padding="16dp"  
    >  
    <Space  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_weight=".4"  
        />  
    <ImageView        android:id="@+id/imageView2"  
        android:layout_width="match_parent"  
        android:layout_height="128dp"  
        android:src="@drawable/all_logo_assa"  
        android:layout_marginBottom="32dp"  
        />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:layout_marginBottom="16dp"  
        >  
  
        <TextView  
            android:id="@+id/textView"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="이메일"  
            android:textColor="@color/black"  
            android:textStyle="bold"  
            />  
  
        <com.google.android.material.textfield.TextInputLayout            android:layout_width="match_parent"  
            android:layout_height="match_parent">  
  
            <com.google.android.material.textfield.TextInputEditText  
                android:id="@+id/tiet_login_eamil"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:inputType="textEmailAddress"  
                />  
        </com.google.android.material.textfield.TextInputLayout>  
    </LinearLayout>  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:layout_marginBottom="16dp"  
        >  
  
        <TextView  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="비밀번호"  
            android:textColor="@color/black"  
            android:textStyle="bold"  
            />  
  
        <com.google.android.material.textfield.TextInputLayout            android:id="@+id/til_login_pw"  
            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            app:endIconMode="password_toggle"  
            app:endIconDrawable="@drawable/custom_password_eye"  
            >  
  
            <com.google.android.material.textfield.TextInputEditText  
                android:id="@+id/tiet_login_pw"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:inputType="textPassword"  
                />  
        </com.google.android.material.textfield.TextInputLayout>  
    </LinearLayout>  
  
    <android.widget.Button        android:id="@+id/btn_login_login"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:background="@drawable/all_button"  
        android:textColor="@color/white"  
        android:text="로그인"  
        android:textStyle="bold"  
        android:layout_marginBottom="8dp"  
        />  
  
  
    <android.widget.Button        android:id="@+id/btn_login_kakao"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:drawableLeft="@drawable/kakao_logo"  
        android:paddingHorizontal="16dp"  
        android:text="카카오 로그인 / 회원가입"  
        style="@style/Widget.AppCompat.Button.Borderless"  
        android:textStyle="bold"  
        android:background="#fee500"  
        android:layout_marginBottom="16dp"  
        />  
  
  
    <TextView        android:id="@+id/tv_login_forgotpw"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="비밀번호를 잊었습니까?"  
        android:textAlignment="center"  
        android:textColor="@color/primary"  
        android:clickable="true"  
        android:focusable="true"  
        />  
  
    <Space        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_weight="1"  
        />  
  
    <androidx.appcompat.widget.AppCompatButton        android:id="@+id/btn_login_signup"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:paddingHorizontal="16dp"  
        android:text="회원가입"  
        android:textColor="@color/primary"  
        android:textStyle="bold"  
        android:background="@drawable/all_button_border"  
        />  
</LinearLayout>  
</document_content>  
</document>  
<document index="207">  
<source>app/src/main/res/layout\activity_main.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    >  
  
    <androidx.fragment.app.FragmentContainerView  
        android:id="@+id/fragment_container_main"  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="1"/>  
  
  
    <com.google.android.material.bottomnavigation.BottomNavigationView        android:id="@+id/bottom_navigation_main"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        app:labelVisibilityMode="labeled"  
        android:background="@color/white"  
        app:menu="@menu/menu_bottom_nav" />  
</LinearLayout>  
  
</document_content>  
</document>  
<document index="208">  
<source>app/src/main/res/layout\activity_main2.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.MainActivity2"  
    android:orientation="vertical">  
  
    <TextView  
        android:id="@+id/textView3"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="main_activity(홈 화면)"  
        android:textSize="32dp"  
        />  
  
    <TextView        android:id="@+id/tv_user"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text=""  
        android:textSize="32dp"  
        />  
    <Button        android:id="@+id/btn_logout"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="로그아웃" />  
  
    <Button        android:id="@+id/btn_delete_account"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="회원탈퇴" />  
  
    <Button        android:id="@+id/btn_refresh"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="새로고침" />  
</LinearLayout>  
</document_content>  
</document>  
<document index="209">  
<source>app/src/main/res/layout\activity_new_open_chat.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:orientation="vertical"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.NewOpenChatActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_newchat"  
        app:title="오픈채팅 만들기"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        >  
        <TextView  
            android:id="@+id/tv_newchat_complete"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="right"  
            android:text="완료"  
            android:padding="16dp"  
            android:textSize="16sp"  
            android:textStyle="bold"  
            android:enabled="false"  
            android:textColor="@color/color_selector"  
            android:gravity="center"/>  
    </androidx.appcompat.widget.Toolbar>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey"/>  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:padding="16dp"  
        android:orientation="vertical">  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            android:layout_marginBottom="16dp"  
            >  
            <TextView  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="오픈채팅 이름 (필수)"  
                android:textSize="16sp"  
                android:textStyle="bold"  
                />  
  
            <EditText                android:id="@+id/et_newchat_title"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:textSize="14sp"  
                android:hint="오픈채팅 이름을 입력해주세요"/>  
  
        </LinearLayout>  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            >  
            <TextView  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="오픈채팅 소개글 (선택)"  
                android:textSize="16sp"  
                android:textStyle="bold"  
                />  
  
            <EditText                android:id="@+id/et_newchat_description"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:textSize="14sp"  
                android:hint="오픈채팅 소개글을 입력해주세요"/>  
  
        </LinearLayout>  
    </LinearLayout>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="210">  
<source>app/src/main/res/layout\activity_open_chat_setting.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.OpenChatSettingActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_open_chat_setting"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"/>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey"/>  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        >  
  
        <TextView  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="오픈채팅 정보"  
            android:textStyle="bold"  
            android:textColor="@color/grey"  
            android:background="#ECECEC"  
            android:paddingVertical="4dp"  
            android:paddingLeft="16dp"  
            />  
  
        <LinearLayout            android:id="@+id/ll_set_open_chat_name_container"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            android:paddingBottom="16dp"  
            >  
  
            <TextView  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="오픈채팅 이름"  
                android:textSize="16sp"  
                android:textStyle="bold"  
                android:paddingVertical="4dp"  
                android:paddingLeft="16dp"  
                />  
  
            <TextView                android:id="@+id/tv_set_open_chat_name_value"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="오픈채팅 이름"  
                android:textSize="12sp"  
                android:textColor="@color/grey"  
                android:paddingVertical="4dp"  
                android:paddingLeft="16dp"  
                />  
        </LinearLayout>  
  
        <LinearLayout            android:id="@+id/ll_set_open_chat_description_container"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            android:paddingBottom="16dp"  
            >  
  
            <TextView  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="오픈채팅 소개글"  
                android:textSize="16sp"  
                android:textStyle="bold"  
                android:paddingVertical="4dp"  
                android:paddingLeft="16dp"  
                />  
  
            <TextView                android:id="@+id/tv_set_open_chat_description_value"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="소개글"  
                android:textSize="12sp"  
                android:textColor="@color/grey"  
                android:paddingVertical="4dp"  
                android:paddingLeft="16dp"  
                />  
        </LinearLayout>  
  
    </LinearLayout>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="211">  
<source>app/src/main/res/layout\activity_post_create.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.PostCreateActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_post_create"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toTopOf="parent" />  
  
    <ScrollView        android:id="@+id/sv_post_create"  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:fillViewport="true"  
        android:scrollbars="none"  
        app:layout_constraintBottom_toTopOf="@+id/linearLayout"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toBottomOf="@+id/toolbar_post_create">  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:orientation="vertical">  
  
            <EditText  
                android:id="@+id/et_content_post"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:background="@android:color/transparent"  
                android:hint="본문을 입력해주세요"  
                android:padding="16dp" />  
  
            <LinearLayout                android:id="@+id/ll_post_create_image_container"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:orientation="vertical">  
  
            </LinearLayout>  
        </LinearLayout>  
  
    </ScrollView>  
  
  
    <!--   업로드할 이미지들이 이 영역안에서 보임-->  
    <LinearLayout  
        android:id="@+id/linearLayout"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="horizontal"  
        android:padding="8dp"  
        app:layout_constraintBottom_toBottomOf="parent"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent">  
  
  
        <ImageButton  
            android:id="@+id/ib_add_image"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:background="@color/white"  
            android:src="@drawable/ic_image" />  
  
    </LinearLayout>  
  
</androidx.constraintlayout.widget.ConstraintLayout>  
</document_content>  
</document>  
<document index="212">  
<source>app/src/main/res/layout\activity_post_detail.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.PostDetailActivity">  
  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_post_detail"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toTopOf="parent" />  
  
    <com.google.android.material.divider.MaterialDivider        android:id="@+id/materialDivider2"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toBottomOf="@id/toolbar_post_detail" />  
  
    <!--    본문 -->  
  
    <androidx.core.widget.NestedScrollView  
        android:layout_width="0dp"  
        android:layout_height="0dp"  
        android:fillViewport="true"  
        app:layout_constraintBottom_toTopOf="@+id/ll_post_detail_add_comment"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toBottomOf="@+id/materialDivider2">  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            app:layout_constraintBottom_toTopOf="@+id/ll_post_detail_add_comment"  
            app:layout_constraintEnd_toEndOf="parent"  
            app:layout_constraintStart_toStartOf="parent">  
  
            <LinearLayout  
                android:id="@+id/ll_post_detail_content"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:orientation="vertical"  
                android:padding="16dp">  
  
                <!--        작성자 정보 & 작성일-->  
                <LinearLayout  
                    android:id="@+id/ll_post_detail_author"  
                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:layout_marginBottom="16dp"  
                    android:gravity="center_vertical"  
                    android:orientation="horizontal">  
  
                    <ImageView  
                        android:id="@+id/iv_post_detail_author_profile_image"  
                        android:layout_width="40dp"  
                        android:layout_height="40dp"  
                        android:layout_marginRight="8dp"  
                        android:background="@drawable/circle_shape"  
                        android:clipToOutline="true" />  
  
                    <LinearLayout                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:gravity="center_vertical"  
                        android:orientation="vertical">  
  
                        <TextView  
                            android:id="@+id/tv_post_detail_author_nickname"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:text="test"  
                            android:textSize="18sp" />  
  
                        <TextView                            android:id="@+id/tv_post_detail_date"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:text="2020.01.01"  
                            android:textColor="@color/grey"  
                            android:textSize="12sp" />  
                    </LinearLayout>  
  
                </LinearLayout>  
  
                <!--      본문-->  
                <TextView  
                    android:id="@+id/tv_post_detail_content"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:layout_marginBottom="16dp"  
                    android:text="test"  
                    android:textSize="16sp" />  
  
            </LinearLayout>  
  
            <LinearLayout                android:id="@+id/ll_post_detail_comment_container"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:orientation="vertical">  
  
                <com.google.android.material.divider.MaterialDivider  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content" />  
  
                <LinearLayout                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:gravity="center"  
                    android:orientation="horizontal">  
  
                    <androidx.appcompat.widget.AppCompatButton  
                        android:id="@+id/btn_post_detail_like"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:background="@android:color/transparent"  
                        android:drawableStart="@drawable/ic_like_false"  
                        android:drawablePadding="8dp"  
                        android:gravity="center"  
                        android:paddingHorizontal="32dp" />  
  
                    <androidx.appcompat.widget.AppCompatButton                        android:id="@+id/btn_post_detail_comment"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:background="@android:color/transparent"  
                        android:drawableStart="@drawable/ic_comment"  
                        android:drawablePadding="8dp"  
                        android:paddingHorizontal="32dp" />  
  
                    <androidx.appcompat.widget.AppCompatButton                        android:id="@+id/btn_post_detail_view"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:background="@android:color/transparent"  
                        android:drawableStart="@drawable/ic_eye"  
                        android:drawablePadding="8dp"  
                        android:paddingHorizontal="32dp" />  
                </LinearLayout>  
            </LinearLayout>  
  
  
            <com.google.android.material.divider.MaterialDivider                android:layout_width="match_parent"  
                android:layout_height="wrap_content" />  
  
            <TextView                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:paddingHorizontal="16dp"  
                android:paddingVertical="8dp"  
                android:text="댓글"  
                android:textColor="@color/grey"  
                android:textSize="16sp"  
                android:textStyle="bold" />  
  
            <com.google.android.material.divider.MaterialDivider                android:layout_width="match_parent"  
                android:layout_height="wrap_content" />  
  
            <androidx.recyclerview.widget.RecyclerView                android:id="@+id/rv_post_detail_comment"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
                android:nestedScrollingEnabled="false"  
                android:overScrollMode="never" />  
        </LinearLayout>  
  
    </androidx.core.widget.NestedScrollView>  
  
  
    <LinearLayout        android:id="@+id/ll_post_detail_add_comment"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        app:layout_constraintBottom_toBottomOf="parent"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent">  
  
        <com.google.android.material.divider.MaterialDivider  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content" />  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:gravity="center_vertical"  
            android:orientation="horizontal">  
  
            <EditText  
                android:id="@+id/et_post_detail_comment"  
                android:layout_width="0dp"  
                android:layout_height="wrap_content"  
                android:layout_weight="1"  
                android:background="@color/white"  
                android:hint="댓글을 남겨주세요."  
                android:padding="12dp" />  
  
            <androidx.appcompat.widget.AppCompatButton                android:id="@+id/btn_post_detail_add_comment"  
                android:layout_width="wrap_content"  
                android:layout_height="match_parent"  
                android:background="@drawable/button_state_color"  
                android:enabled="false"  
                android:text="등록"  
                android:textColor="@drawable/button_text_state_color"  
                android:visibility="gone" />  
        </LinearLayout>  
  
  
    </LinearLayout>  
  
  
</androidx.constraintlayout.widget.ConstraintLayout>  
</document_content>  
</document>  
<document index="213">  
<source>app/src/main/res/layout\activity_post_notification.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.PostNotificationActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        app:title="Post Notification"  
        />  
</LinearLayout>  
</document_content>  
</document>  
<document index="214">  
<source>app/src/main/res/layout\activity_profile_notification.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.ProfileNotificationActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_profile_notification"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"/>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@android:color/darker_gray"/>  
  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_profile_notification"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"/>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="215">  
<source>app/src/main/res/layout\activity_search_result.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:background="@android:color/transparent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.SearchResultActivity">  
  
    <View  
        android:id="@+id/v_focus_dummy"  
        android:layout_width="1dp"  
        android:layout_height="1dp"  
        android:focusable="true"  
        android:focusableInTouchMode="true"  
        android:visibility="visible"  
        />  
  
    <androidx.appcompat.widget.Toolbar        android:id="@+id/tb_search"  
        android:layout_width="match_parent"  
        android:layout_height="?android:attr/actionBarSize"  
        app:contentInsetEnd="16dp">  
  
        <androidx.appcompat.widget.SearchView  
            android:id="@+id/sv_search"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:background="@color/inactive"  
            app:defaultQueryHint="게시물, 오픈채팅, 사용자를 검색"  
            app:iconifiedByDefault="false"  
            app:queryBackground="@color/inactive"  
            app:queryHint="게시물, 오픈채팅, 사용자를 검색" />  
    </androidx.appcompat.widget.Toolbar>  
  
    <com.google.android.material.tabs.TabLayout        android:id="@+id/tl_search"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        app:tabIndicatorColor="@color/primary"  
        app:tabIndicatorFullWidth="true"  
        app:tabSelectedTextColor="@color/primary" />  
  
    <androidx.viewpager2.widget.ViewPager2        android:id="@+id/vp_search"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent" />  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="216">  
<source>app/src/main/res/layout\activity_select_account.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.SelectAccountActivity">  
  
</androidx.constraintlayout.widget.ConstraintLayout>  
</document_content>  
</document>  
<document index="217">  
<source>app/src/main/res/layout\activity_select_friends.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.SelectFriendsActivity"  
    android:orientation="vertical"  
    >  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_select_friends"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"/>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey"  
        />  
  
    <TextView        android:padding="8dp"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:text="친구목록"  
        android:textStyle="bold"  
        />  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey"  
        />  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_select_friends"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent" />  
  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="218">  
<source>app/src/main/res/layout\activity_setting.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.activity.SettingActivity">  
  
  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
       >  
  
        <ImageButton  
            android:id="@+id/back_button"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="left"  
            android:contentDescription="뒤로가기"  
            android:background="@android:color/transparent"  
            android:src="@drawable/all_arrow_back" />  
  
        <TextView            android:id="@+id/toolbar_title"  
            android:layout_width="wrap_content"  
            android:layout_height="match_parent"  
            android:layout_gravity="center"  
            android:gravity="center"  
            android:text="설정"  
            android:textStyle="bold"  
            android:textAppearance="@style/TextAppearance.AppCompat.Widget.ActionBar.Title" />  
    </androidx.appcompat.widget.Toolbar>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content"/>  
  
    <!-- Content -->  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_below="@id/toolbar"  
        android:orientation="vertical"  
        android:padding="16dp">  
  
        <TextView  
            android:id="@+id/edit_profile"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="프로필 편집"  
            android:textSize="18sp"  
            android:padding="8dp" />  
  
        <TextView            android:id="@+id/edit_account"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="계정 설정"  
            android:textSize="18sp"  
            android:padding="8dp" />  
  
        <TextView            android:id="@+id/logout"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="로그아웃"  
            android:textSize="18sp"  
            android:padding="8dp" />  
  
    </LinearLayout>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="219">  
<source>app/src/main/res/layout\activity_set_nickname.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.EmailActivity"  
    android:orientation="vertical"  
    >  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="16dp"  
        android:orientation="vertical"  
        android:padding="16dp"  
        >  
  
        <ImageButton  
            android:id="@+id/btn_back"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:backgroundTint="#00000000"  
            android:paddingLeft="0dp"  
            android:src="@drawable/all_arrow_back" />  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            >  
            <TextView  
                android:id="@+id/title"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="닉네임"  
                android:textColor="@color/black"  
                android:textSize="24dp"  
                android:layout_marginBottom="8dp"  
                android:textStyle="bold" />  
  
            <TextView                android:id="@+id/description"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="24dp"  
                android:text="닉네임을 설정해주세요"  
                android:textColor="@color/black" />  
        </LinearLayout>  
  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:orientation="vertical">  
  
            <com.google.android.material.textfield.TextInputLayout  
                android:id="@+id/nickname_layout"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
                android:hint="1~20자리 영문, 한글, 숫자, 밑줄(_) 조합"  
                android:textColorHint="#999DA3"  
                app:counterEnabled="true"  
                app:counterMaxLength="20"  
                app:errorEnabled="true">  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/nickname"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:inputType="textEmailAddress"  
                    android:maxLength="20" />  
            </com.google.android.material.textfield.TextInputLayout>  
  
        </LinearLayout>  
  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_next"  
            style="@style/Widget.AppCompat.Button.Borderless"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:background="@drawable/button_state_color"  
            android:enabled="false"  
            android:textColor="@drawable/button_text_state_color"  
            android:textStyle="bold"  
            android:text="다음"  
            android:layout_marginBottom="16dp"  
            />  
  
  
  
    </LinearLayout>  
  
</LinearLayout>  
  
  
</document_content>  
</document>  
<document index="220">  
<source>app/src/main/res/layout\activity_set_password.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.EmailActivity"  
    android:orientation="vertical"  
    >  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="16dp"  
        android:orientation="vertical"  
        android:padding="16dp"  
        >  
  
        <ImageButton  
            android:id="@+id/btn_back"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:backgroundTint="#00000000"  
            android:paddingLeft="0dp"  
            android:src="@drawable/all_arrow_back" />  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            >  
            <TextView  
                android:id="@+id/title"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:text="비밀번호"  
                android:textColor="@color/black"  
                android:textSize="24dp"  
                android:layout_marginBottom="8dp"  
                android:textStyle="bold" />  
  
            <TextView                android:id="@+id/description"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="24dp"  
                android:text="비밀번호를 설정해주세요"  
                android:textColor="@color/black" />  
        </LinearLayout>  
  
  
  
        <LinearLayout            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:orientation="vertical">  
  
            <TextView  
                android:id="@+id/tv_til_title"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="새 비밀번호"  
                android:textStyle="bold"  
                android:textSize="16sp"  
                />  
  
  
            <com.google.android.material.textfield.TextInputLayout                android:id="@+id/password_layout"  
                android:layout_width="match_parent"  
                android:layout_height="match_parent"  
  
                android:hint="8~32자리 영문, 숫자, 특수문자 조합"  
                android:textColorHint="#999DA3"  
                app:counterEnabled="true"  
                app:counterMaxLength="32"  
                app:errorEnabled="true"  
                app:errorIconDrawable="@null"  
                app:endIconMode="password_toggle"  
                app:endIconDrawable="@drawable/custom_password_eye"  
                >  
  
                <com.google.android.material.textfield.TextInputEditText  
                    android:id="@+id/password"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:inputType="textPassword"  
                    android:maxLength="32" />  
            </com.google.android.material.textfield.TextInputLayout>  
  
        </LinearLayout>  
  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_next"  
            style="@style/Widget.AppCompat.Button.Borderless"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:background="@drawable/button_state_color"  
            android:enabled="false"  
            android:textColor="@drawable/button_text_state_color"  
            android:textStyle="bold"  
            android:text="다음"  
            android:layout_marginBottom="16dp"  
            />  
  
  
  
    </LinearLayout>  
  
</LinearLayout>  
  
  
</document_content>  
</document>  
<document index="221">  
<source>app/src/main/res/layout\activity_signup.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    android:padding="16dp">  
  
    <ImageButton  
        android:id="@+id/btn_back"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:backgroundTint="#00000000"  
        android:paddingLeft="0dp"  
        android:src="@drawable/all_arrow_back" />  
  
  
    <TextView        android:id="@+id/title"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="24dp"  
        android:text="회원가입"  
        android:textColor="@color/black"  
        android:textSize="24dp"  
        android:textStyle="bold" />  
  
    <ScrollView        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="1"  
        android:scrollbars="none"  
        >  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            >  
  
            <LinearLayout  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="16dp"  
                android:orientation="vertical">  
  
                <TextView  
                    android:id="@+id/textView"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:text="닉네임"  
                    android:textColor="@color/black"  
                    android:textStyle="bold" />  
  
                <com.google.android.material.textfield.TextInputLayout                    android:id="@+id/nickname_layout"  
                    android:layout_width="match_parent"  
                    android:layout_height="match_parent"  
                    android:hint="1~20자리 영문, 한글, 숫자, 밑줄(_) 조합"  
                    android:textColorHint="#999DA3"  
                    app:counterEnabled="true"  
                    app:counterMaxLength="20"  
                    app:errorEnabled="true">  
  
                    <com.google.android.material.textfield.TextInputEditText  
                        android:id="@+id/nickname"  
                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:inputType="textEmailAddress"  
                        android:maxLength="20" />  
                </com.google.android.material.textfield.TextInputLayout>  
            </LinearLayout>  
  
            <LinearLayout                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="16dp"  
                android:orientation="vertical">  
  
                <TextView  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:text="이메일"  
                    android:textColor="@color/black"  
                    android:textStyle="bold" />  
  
                <com.google.android.material.textfield.TextInputLayout                    android:id="@+id/email_layout"  
                    android:layout_width="match_parent"  
                    android:layout_height="match_parent"  
                    android:hint="예) example@gmail.com"  
                    android:textColorHint="#999DA3"  
                    app:errorEnabled="true">  
  
                    <com.google.android.material.textfield.TextInputEditText  
                        android:id="@+id/email"  
                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:inputType="textEmailAddress"  
                        android:maxLength="255" />  
                </com.google.android.material.textfield.TextInputLayout>  
            </LinearLayout>  
  
            <LinearLayout                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="16dp"  
                android:orientation="vertical">  
  
                <TextView  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:text="비밀번호"  
                    android:textColor="@color/black"  
                    android:textStyle="bold" />  
  
                <com.google.android.material.textfield.TextInputLayout                    android:id="@+id/password_layout"  
                    android:layout_width="match_parent"  
                    android:layout_height="match_parent"  
                    android:hint="8~32자리 영문, 숫자, 특수문자 조합"  
                    android:textColorHint="#999DA3"  
                    app:counterEnabled="true"  
                    app:counterMaxLength="32"  
                    app:passwordToggleEnabled="true"  
                    app:errorEnabled="true"  
                    app:errorIconDrawable="@null"  
                    >  
  
                    <com.google.android.material.textfield.TextInputEditText  
                        android:id="@+id/password"  
                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:inputType="textPassword"  
                        android:maxLength="32" />  
                </com.google.android.material.textfield.TextInputLayout>  
            </LinearLayout>  
  
            <Space                android:layout_width="wrap_content"  
                android:layout_height="0dp"  
                android:layout_weight="1" />  
  
            <LinearLayout                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:orientation="vertical">  
  
                <View  
                    android:id="@+id/divider"  
                    android:layout_width="match_parent"  
                    android:layout_height="1dp"  
                    android:layout_marginBottom="16dp"  
                    android:background="?android:attr/listDivider" />  
  
                <TextView                    android:id="@+id/textView2"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:text="서비스약관에 동의해주세요."  
                    android:textStyle="bold" />  
  
                <LinearLayout                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:orientation="horizontal">  
  
                    <android.widget.CheckBox  
                        android:id="@+id/check_all_terms"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:background="@android:color/transparent"  
                        android:buttonTint="@color/primary" />  
  
                    <TextView                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:text="모두 동의합니다."  
                        android:textSize="16dp"  
                        android:textStyle="bold" />  
                </LinearLayout>  
  
                <LinearLayout                    android:id="@+id/requiredTermsContainer"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:layout_marginBottom="24dp"  
                    android:orientation="vertical"  
                    android:paddingLeft="24dp">  
  
                    <LinearLayout  
                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:orientation="horizontal">  
  
                        <android.widget.CheckBox  
                            android:id="@+id/check_service_term"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:background="@android:color/transparent"  
                            android:buttonTint="@color/primary" />  
  
                        <TextView                            android:id="@+id/tv_service_term"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:text="[필수] 서비스 이용약관 동의"  
  
                            />  
                    </LinearLayout>  
  
                    <LinearLayout                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:orientation="horizontal">  
  
                        <android.widget.CheckBox  
                            android:id="@+id/check_privacy_term"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:background="@android:color/transparent"  
                            android:buttonTint="@color/primary" />  
  
                        <TextView                            android:id="@+id/tv_privacy_term"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:text="[필수] 개인정보 처리방침 동의"  
  
                            />  
                    </LinearLayout>  
  
                </LinearLayout>  
  
  
            </LinearLayout>  
  
        </LinearLayout>  
  
  
    </ScrollView>  
  
    <android.widget.Button        android:id="@+id/btn_next"  
        style="@style/Widget.AppCompat.Button.Borderless"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:background="@drawable/button_state_color"  
        android:enabled="false"  
        android:text="동의하고 가입하기"  
        android:textColor="@drawable/button_text_state_color"  
        android:textStyle="bold"  
        />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="222">  
<source>app/src/main/res/layout\activity_signup_backup.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    android:padding="16dp">  
  
    <ImageButton  
        android:id="@+id/btn_back"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:backgroundTint="#00000000"  
        android:paddingLeft="0dp"  
        android:src="@drawable/all_arrow_back" />  
  
  
    <TextView        android:id="@+id/title"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="24dp"  
        android:text="회원가입"  
        android:textColor="@color/black"  
        android:textSize="24dp"  
        android:textStyle="bold" />  
  
    <ScrollView        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="1"  
        android:scrollbars="none"  
        >  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            >  
  
            <LinearLayout  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="16dp"  
                android:orientation="vertical">  
  
                <TextView  
                    android:id="@+id/textView"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:text="닉네임"  
                    android:textColor="@color/black"  
                    android:textStyle="bold" />  
  
                <com.google.android.material.textfield.TextInputLayout                    android:id="@+id/nickname_layout"  
                    android:layout_width="match_parent"  
                    android:layout_height="match_parent"  
                    android:hint="1~20자리 영문, 한글, 숫자, 밑줄(_) 조합"  
                    android:textColorHint="#999DA3"  
                    app:counterEnabled="true"  
                    app:counterMaxLength="20"  
                    app:errorEnabled="true">  
  
                    <com.google.android.material.textfield.TextInputEditText  
                        android:id="@+id/nickname"  
                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:inputType="textEmailAddress"  
                        android:maxLength="20" />  
                </com.google.android.material.textfield.TextInputLayout>  
            </LinearLayout>  
  
            <LinearLayout                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="16dp"  
                android:orientation="vertical">  
  
                <TextView  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:text="이메일"  
                    android:textColor="@color/black"  
                    android:textStyle="bold" />  
  
                <com.google.android.material.textfield.TextInputLayout                    android:id="@+id/email_layout"  
                    android:layout_width="match_parent"  
                    android:layout_height="match_parent"  
                    android:hint="예) example@gmail.com"  
                    android:textColorHint="#999DA3"  
                    app:errorEnabled="true">  
  
                    <com.google.android.material.textfield.TextInputEditText  
                        android:id="@+id/email"  
                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:inputType="textEmailAddress"  
                        android:maxLength="255" />  
                </com.google.android.material.textfield.TextInputLayout>  
            </LinearLayout>  
  
            <LinearLayout                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="16dp"  
                android:orientation="vertical">  
  
                <TextView  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:text="비밀번호"  
                    android:textColor="@color/black"  
                    android:textStyle="bold" />  
  
                <com.google.android.material.textfield.TextInputLayout                    android:id="@+id/password_layout"  
                    android:layout_width="match_parent"  
                    android:layout_height="match_parent"  
                    android:hint="8~32자리 영문, 숫자, 특수문자 조합"  
                    android:textColorHint="#999DA3"  
                    app:counterEnabled="true"  
                    app:counterMaxLength="32"  
                    app:passwordToggleEnabled="true"  
                    app:errorEnabled="true"  
                    app:errorIconDrawable="@null"  
                    >  
  
                    <com.google.android.material.textfield.TextInputEditText  
                        android:id="@+id/password"  
                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:inputType="textPassword"  
                        android:maxLength="32" />  
                </com.google.android.material.textfield.TextInputLayout>  
            </LinearLayout>  
  
            <Space                android:layout_width="wrap_content"  
                android:layout_height="0dp"  
                android:layout_weight="1" />  
  
            <LinearLayout                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:orientation="vertical">  
  
                <View  
                    android:id="@+id/divider"  
                    android:layout_width="match_parent"  
                    android:layout_height="1dp"  
                    android:layout_marginBottom="16dp"  
                    android:background="?android:attr/listDivider" />  
  
                <TextView                    android:id="@+id/textView2"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:text="서비스약관에 동의해주세요."  
                    android:textStyle="bold" />  
  
                <LinearLayout                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:orientation="horizontal">  
  
                    <android.widget.CheckBox  
                        android:id="@+id/check_all_terms"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:background="@android:color/transparent"  
                        android:buttonTint="@color/primary" />  
  
                    <TextView                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:text="모두 동의합니다."  
                        android:textSize="16dp"  
                        android:textStyle="bold" />  
                </LinearLayout>  
  
                <LinearLayout                    android:id="@+id/requiredTermsContainer"  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:layout_marginBottom="24dp"  
                    android:orientation="vertical"  
                    android:paddingLeft="24dp">  
  
                    <LinearLayout  
                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:orientation="horizontal">  
  
                        <android.widget.CheckBox  
                            android:id="@+id/check_service_term"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:background="@android:color/transparent"  
                            android:buttonTint="@color/primary" />  
  
                        <TextView                            android:id="@+id/tv_service_term"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:text="[필수] 서비스 이용약관 동의"  
  
                            />  
                    </LinearLayout>  
  
                    <LinearLayout                        android:layout_width="match_parent"  
                        android:layout_height="wrap_content"  
                        android:orientation="horizontal">  
  
                        <android.widget.CheckBox  
                            android:id="@+id/check_privacy_term"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:background="@android:color/transparent"  
                            android:buttonTint="@color/primary" />  
  
                        <TextView                            android:id="@+id/tv_privacy_term"  
                            android:layout_width="wrap_content"  
                            android:layout_height="wrap_content"  
                            android:text="[필수] 개인정보 처리방침 동의"  
  
                            />  
                    </LinearLayout>  
  
                </LinearLayout>  
  
  
            </LinearLayout>  
  
        </LinearLayout>  
  
  
    </ScrollView>  
  
    <android.widget.Button        android:id="@+id/btn_next"  
        style="@style/Widget.AppCompat.Button.Borderless"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:background="@drawable/button_state_color"  
        android:enabled="false"  
        android:text="동의하고 가입하기"  
        android:textColor="@drawable/button_text_state_color"  
        android:textStyle="bold"  
        />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="223">  
<source>app/src/main/res/layout\activity_splash_screen.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.activity.SplashScreenActivity">  
  
    <ImageView  
        android:id="@+id/imageView"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        app:layout_constraintBottom_toBottomOf="parent"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toTopOf="parent"  
        app:srcCompat="@drawable/all_logo_assa" />  
</androidx.constraintlayout.widget.ConstraintLayout>  
</document_content>  
</document>  
<document index="224">  
<source>app/src/main/res/layout\activity_user_profile.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.fragment.ProfileFragment">  
  
    <!--    <LinearLayout-->  
    <!--        android:layout_width="match_parent"-->    <!--        android:layout_height="wrap_content"-->    <!--        android:gravity="end"-->    <!--        android:padding="16dp">-->  
    <!--        <Button-->    <!--            android:id="@+id/image_button_notification"-->    <!--            android:layout_width="32dp"-->    <!--            android:layout_height="32dp"-->    <!--            android:layout_marginRight="16dp"-->    <!--            android:background="@drawable/ic_notification"-->    <!--            android:scaleType="fitCenter" />-->  
    <!--        <Button-->    <!--            android:id="@+id/image_button_setting"-->    <!--            android:layout_width="32dp"-->    <!--            android:layout_height="32dp"-->    <!--            android:background="@drawable/menu"-->    <!--            android:scaleType="fitCenter" />-->    <!--    </LinearLayout>-->  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_user_profile"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize" />  
  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content" />  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_profile_container"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:nestedScrollingEnabled="false" />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="225">  
<source>app/src/main/res/layout\activity_video_call.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:id="@+id/main"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:gravity="center"  
    android:orientation="vertical"  
    tools:context=".ui.activity.VideoCallActivity">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_video_call"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        />  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_participants"  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="0.00001"  
        android:background="@color/grey"  
        />  
  
    <LinearLayout        android:id="@+id/chat_layout"  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="1"  
        android:background="@color/white"  
        android:orientation="vertical"  
        android:visibility="gone">  
  
        <View  
            android:layout_width="match_parent"  
            android:layout_height="1dp"  
            android:background="@color/divider_grey"/>  
  
        <TextView            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="채팅"  
            android:textStyle="bold"  
            android:textSize="16sp"  
            android:textColor="@color/black"  
            android:layout_gravity="center"  
            android:padding="4dp" />  
  
        <View            android:layout_width="match_parent"  
            android:layout_height="1dp"  
            android:background="@color/divider_grey"/>  
  
        <androidx.recyclerview.widget.RecyclerView            android:id="@+id/rv_chat_log"  
            android:layout_width="match_parent"  
            android:layout_height="0dp"  
            android:layout_weight="1" />  
  
        <LinearLayout            android:id="@+id/ll_chatroom_bottom"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical">  
  
            <View  
                android:layout_width="match_parent"  
                android:layout_height="1dp"  
                android:background="@color/divider_grey" />  
  
            <LinearLayout                android:id="@+id/ll_bottom_chatroom"  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:layout_gravity="bottom"  
                android:gravity="center_vertical"  
                android:background="@android:color/white"  
                android:orientation="horizontal"  
                android:padding="8dp"  
                >  
  
<!--                <ImageButton-->  
<!--                    android:id="@+id/ib_select_image"-->  
<!--                    android:layout_width="40dp"-->  
<!--                    android:layout_height="40dp"-->  
<!--                    android:background="@color/white"-->  
<!--                    android:src="@drawable/ic_image" />-->  
  
                <EditText  
                    android:id="@+id/et_message"  
                    android:layout_width="0dp"  
                    android:layout_height="wrap_content"  
                    android:layout_marginEnd="8dp"  
                    android:layout_weight="1"  
                    android:hint="Type a message"  
                    android:inputType="text"  
                    android:padding="8dp"  
                    android:background="@android:color/transparent"  
                    />  
  
                <androidx.appcompat.widget.AppCompatButton                    android:id="@+id/btn_send"  
                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:text="보내기"  
                    android:enabled="false"  
                    android:textStyle="bold"  
                    android:textColor="@drawable/text_state_color"  
                    android:textSize="20sp"  
                    android:background="@android:color/transparent"  
                    />  
  
            </LinearLayout>  
  
        </LinearLayout>  
  
    </LinearLayout>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="226">  
<source>app/src/main/res/layout\bottomsheet_video_meeting_participant_list.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:orientation="vertical"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:gravity="center"  
    >  
  
    <TextView  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:textSize="24sp"  
        android:text="bottomsheet"/>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="227">  
<source>app/src/main/res/layout\comment_item.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:orientation="vertical"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:paddingVertical="8dp"  
    android:paddingHorizontal="16dp"  
    android:background="@drawable/item_border_grey"  
    >  
  
    <LinearLayout  
        android:id="@+id/ll_comment_item_author"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="8dp"  
        android:gravity="center_vertical"  
        android:orientation="horizontal">  
  
        <ImageView  
            android:id="@+id/iv_comment_item_author_profile_image"  
            android:layout_width="30dp"  
            android:layout_height="30dp"  
            android:layout_marginRight="8dp"  
            android:background="@drawable/circle_shape"  
            android:clipToOutline="true"  
            android:src="@mipmap/ic_launcher_round" />  
  
        <LinearLayout            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:gravity="center_vertical"  
            android:orientation="vertical">  
  
            <TextView  
                android:id="@+id/tv_comment_item_author_nickname"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="test"  
                android:textSize="14sp" />  
  
            <TextView                android:id="@+id/tv_comment_item_date"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="2020.01.01"  
                android:textColor="@color/grey"  
                android:textSize="10sp" />  
        </LinearLayout>  
  
    </LinearLayout>  
  
    <TextView        android:id="@+id/tv_comment_item_content"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="test"  
        android:layout_marginBottom="8dp"  
        />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:gravity="start"  
        android:orientation="horizontal">  
  
        <androidx.appcompat.widget.AppCompatButton  
            android:id="@+id/btn_comment_item_like"  
            android:layout_width="wrap_content"  
            android:layout_height="30dp"  
            android:background="@android:color/transparent"  
            android:drawableStart="@drawable/ic_like_false"  
            android:drawablePadding="-25dp"  
            android:gravity="center"  
            android:text="123" />  
<!--         대댓글-->  
        <TextView  
            android:id="@+id/tv_add_reply"  
            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:gravity="center_vertical"  
            android:text="덧글 입력하기"  
            android:textColor="@color/primary"  
            />  
  
    </LinearLayout>  
</LinearLayout>  
</document_content>  
</document>  
<document index="228">  
<source>app/src/main/res/layout\fragment_all_post.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.fragment.AllPostFragment"  
    android:orientation="vertical"  
    >  
  
    <androidx.recyclerview.widget.RecyclerView  
        android:id="@+id/recycler_view_home_all_posts"  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="1"  
        />  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="229">  
<source>app/src/main/res/layout\fragment_chat.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.fragment.ChatFragment">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_chat"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
    />  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@android:color/darker_gray" />  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_chatList"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent" />  
</LinearLayout>  
</document_content>  
</document>  
<document index="230">  
<source>app/src/main/res/layout\fragment_follow_post.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.fragment.FollowPostFragment"  
    android:orientation="vertical"  
    >  
  
    <androidx.recyclerview.widget.RecyclerView  
        android:id="@+id/rv_follow_post"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent" />  
  
    <TextView        android:id="@+id/tv_empty"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:gravity="center"  
        android:text="아직 팔로우한 사용자가 없습니다."  
        android:textColor="#7E7E7E"  
        />  
  
</FrameLayout>  
</document_content>  
</document>  
<document index="231">  
<source>app/src/main/res/layout\fragment_home.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.fragment.HomeFragment">  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:orientation="vertical">  
  
<!--        <androidx.appcompat.widget.Toolbar-->  
<!--            android:id="@+id/toolbar"-->  
<!--            android:layout_width="match_parent"-->  
<!--            android:layout_height="?attr/actionBarSize" />-->  
  
        <com.google.android.material.tabs.TabLayout  
            android:id="@+id/tab_layout_home"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            app:tabIndicatorColor="@color/primary"  
            app:tabSelectedTextColor="@color/primary"  
            app:tabIndicatorFullWidth="true" />  
  
        <androidx.viewpager2.widget.ViewPager2            android:id="@+id/view_pager_home"  
            android:layout_width="match_parent"  
            android:layout_height="match_parent" />  
  
    </LinearLayout>  
  
    <com.google.android.material.floatingactionbutton.FloatingActionButton        android:id="@+id/fab_home_add"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:layout_gravity="bottom|end"  
        android:layout_margin="16dp"  
        android:backgroundTint="@color/primary"  
        app:tint="@android:color/white"  
        app:srcCompat="@drawable/ic_add"  
        app:shapeAppearance="@style/fab_circle"  
        />  
  
</FrameLayout>  
</document_content>  
</document>  
<document index="232">  
<source>app/src/main/res/layout\fragment_open_chat.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.fragment.OpenChatFragment">  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_openchat"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"  
        app:title="오픈채팅">  
  
    </androidx.appcompat.widget.Toolbar>  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey" />  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_openChat_chatRoomList"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="233">  
<source>app/src/main/res/layout\fragment_open_chat_search_result.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.fragment.OpenChatSearchResultFragment">  
  
    <androidx.recyclerview.widget.RecyclerView  
        android:id="@+id/rv_open_chat_search_result"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"/>  
  
</FrameLayout>  
</document_content>  
</document>  
<document index="234">  
<source>app/src/main/res/layout\fragment_post_search_result.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.fragment.PostSearchResultFragment">  
  
    <androidx.recyclerview.widget.RecyclerView  
        android:id="@+id/rv_post_search_result"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"/>  
  
</FrameLayout>  
</document_content>  
</document>  
<document index="235">  
<source>app/src/main/res/layout\fragment_profile.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.fragment.ProfileFragment">  
  
<!--    <LinearLayout-->  
<!--        android:layout_width="match_parent"-->  
<!--        android:layout_height="wrap_content"-->  
<!--        android:gravity="end"-->  
<!--        android:padding="16dp">-->  
  
<!--        <Button-->  
<!--            android:id="@+id/image_button_notification"-->  
<!--            android:layout_width="32dp"-->  
<!--            android:layout_height="32dp"-->  
<!--            android:layout_marginRight="16dp"-->  
<!--            android:background="@drawable/ic_notification"-->  
<!--            android:scaleType="fitCenter" />-->  
  
<!--        <Button-->  
<!--            android:id="@+id/image_button_setting"-->  
<!--            android:layout_width="32dp"-->  
<!--            android:layout_height="32dp"-->  
<!--            android:background="@drawable/ic_menu"-->  
<!--            android:scaleType="fitCenter" />-->  
<!--    </LinearLayout>-->  
  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/toolbar_my_profile"  
        android:layout_width="match_parent"  
        android:layout_height="?attr/actionBarSize"/>  
  
    <com.google.android.material.divider.MaterialDivider        android:layout_width="match_parent"  
        android:layout_height="wrap_content"/>  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_profile_container"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:nestedScrollingEnabled="false" />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="236">  
<source>app/src/main/res/layout\fragment_search.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    android:orientation="vertical"  
    tools:context=".ui.fragment.SearchFragment">  
  
    <!-- TODO: Update blank fragment layout -->  
    <androidx.appcompat.widget.Toolbar  
        android:id="@+id/tb_search"  
        android:layout_width="match_parent"  
        android:layout_height="?android:attr/actionBarSize"  
        app:contentInsetEnd="16dp"  
        >  
  
        <androidx.appcompat.widget.SearchView  
            android:id="@+id/sv_search"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            app:queryHint="게시물, 오픈채팅, 사용자를 검색"  
            app:defaultQueryHint="게시물, 오픈채팅, 사용자를 검색"  
            app:queryBackground="@color/inactive"  
            android:background="@color/inactive"  
            app:iconifiedByDefault="false"  
            />  
    </androidx.appcompat.widget.Toolbar>  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="237">  
<source>app/src/main/res/layout\fragment_user_search_result.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    tools:context=".ui.fragment.UserSearchResultFragment">  
  
    <androidx.recyclerview.widget.RecyclerView  
        android:id="@+id/rv_user_search_result"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"/>  
  
</FrameLayout>  
</document_content>  
</document>  
<document index="238">  
<source>app/src/main/res/layout\fragment_video_chat_bottom_sheet.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.fragment.VideoRoomParticipantBottomSheet">  
  
    <View  
        android:layout_gravity="center_horizontal"  
        android:layout_width="150dp"  
        android:layout_height="2dp"  
        android:background="@color/grey"  
        android:layout_marginTop="8dp"  
        />  
  
  
    <TextView        android:layout_gravity="center_horizontal"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:gravity="center"  
        android:text="채팅"  
        android:textStyle="bold"  
        android:textSize="24sp"  
        android:padding="16dp"  
        />  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey"/>  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_chat_log"  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="1"  
        />  
  
    <LinearLayout        android:id="@+id/ll_chatroom_bottom"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="vertical">  
  
        <View  
            android:layout_width="match_parent"  
            android:layout_height="1dp"  
            android:background="@color/divider_grey" />  
  
        <LinearLayout            android:id="@+id/ll_bottom_chatroom"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:layout_gravity="bottom"  
            android:gravity="center_vertical"  
            android:background="@android:color/white"  
            android:orientation="horizontal"  
            android:padding="8dp"  
            >  
  
            <ImageButton  
                android:id="@+id/ib_select_image"  
                android:layout_width="40dp"  
                android:layout_height="40dp"  
                android:background="@color/white"  
                android:src="@drawable/ic_image" />  
  
            <EditText                android:id="@+id/et_message"  
                android:layout_width="0dp"  
                android:layout_height="wrap_content"  
                android:layout_marginEnd="8dp"  
                android:layout_weight="1"  
                android:hint="Type a message"  
                android:inputType="text"  
                android:padding="8dp"  
                android:background="@android:color/transparent"  
                />  
  
            <androidx.appcompat.widget.AppCompatButton                android:id="@+id/btn_send"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="보내기"  
                android:enabled="false"  
                android:textStyle="bold"  
                android:textColor="@drawable/text_state_color"  
                android:textSize="20sp"  
                android:background="@android:color/transparent"  
                />  
  
        </LinearLayout>  
  
    </LinearLayout>  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="239">  
<source>app/src/main/res/layout\fragment_video_room_participant_bottom_sheet.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:orientation="vertical"  
    tools:context=".ui.fragment.VideoRoomParticipantBottomSheet">  
  
    <View  
        android:layout_gravity="center_horizontal"  
        android:layout_width="150dp"  
        android:layout_height="2dp"  
        android:background="@color/grey"  
        android:layout_marginTop="8dp"  
        />  
  
  
    <TextView        android:layout_gravity="center_horizontal"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:gravity="center"  
        android:text="영상회의"  
        android:textStyle="bold"  
        android:textSize="24sp"  
        android:padding="16dp"  
        />  
  
    <TextView        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="참가자"  
        android:textSize="18sp"  
        android:textStyle="bold"  
        android:padding="16dp"/>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey"/>  
  
    <androidx.recyclerview.widget.RecyclerView        android:id="@+id/rv_participant"  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="1"  
        />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:padding="16dp">  
  
        <androidx.appcompat.widget.AppCompatButton  
            android:id="@+id/btn_video_room_enter"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="영상회의 참가"  
            android:textStyle="bold"  
            android:textSize="18sp"  
            android:background="@color/primary"  
            android:textColor="@color/white"  
            android:paddingVertical="16dp"/>  
    </LinearLayout>  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="240">  
<source>app/src/main/res/layout\header_chat_side.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="match_parent"  
    android:layout_height="48dp"  
    android:orientation="horizontal"  
    android:gravity="center_vertical"  
    android:padding="8dp"  
    >  
  
        <ImageView  
            android:id="@+id/iv_user_profile_image"  
            android:layout_width="16dp"  
            android:layout_height="16dp"  
            android:layout_marginRight="4dp"  
            android:clipToOutline="true"  
            android:backgroundTint="@color/divider_grey"  
            android:src="@drawable/ic_add" />  
  
        <TextView            android:id="@+id/tv_user_nickname"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="멤버초대"  
            android:textColor="@color/black"  
            android:textSize="16sp"  
            android:textStyle="bold"  
            />  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="241">  
<source>app/src/main/res/layout\item_chatroom.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:orientation="vertical"  
    android:padding="16dp">  
  
    <LinearLayout  
        android:id="@+id/ll_reply_item_author"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_gravity="center_vertical"  
        android:layout_marginBottom="8dp"  
        android:gravity="center"  
        android:orientation="horizontal">  
  
        <!--         가운데-->  
        <ImageView  
            android:id="@+id/iv_chatroom_image"  
            android:layout_width="40dp"  
            android:layout_height="40dp"  
            android:layout_marginRight="8dp"  
            android:clipToOutline="true" />  
  
        <LinearLayout            android:layout_width="0dp"  
            android:layout_height="wrap_content"  
            android:layout_weight="1"  
            android:orientation="vertical">  
  
            <!--  채팅방 제목, 인원 수         -->  
            <TableLayout  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:shrinkColumns="0">  
  
                <TableRow  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:gravity="center_vertical">  
  
                    <TextView  
                        android:id="@+id/tv_chatroomList_title"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:ellipsize="end"  
                        android:text="채팅방 이름"  
                        android:maxLines="1"  
                        android:textSize="18sp"  
                        android:textStyle="bold" />  
  
                    <TextView                        android:id="@+id/tv_chatroomList_memberCount"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:paddingHorizontal="8dp"  
                        android:text="인원수"  
                        android:textColor="@color/grey"  
                        android:textSize="12sp" />  
  
                </TableRow>  
            </TableLayout>  
  
            <TextView                android:id="@+id/tv_chatroomList_lastMessage"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:ellipsize="end"  
                android:maxLines="2"  
                android:text="마지막메시지 마지막 메시지마지막 메시지마지막 메시지마지막 메시지마지막 메시지마지막 메시지마지막 메시지"  
                android:textColor="@color/grey"  
                android:textSize="12sp" />  
  
        </LinearLayout>  
  
        <!--  오른쪽, 마지막 전송날짜, 안읽은 메시지 수 출력       -->  
        <LinearLayout  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:layout_gravity="top"  
            android:orientation="vertical">  
  
            <TextView  
                android:id="@+id/tv_chatroomList_lastSendDateTime"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="오전 00:00"                android:textSize="12sp" />  
  
  
            <TextView                android:id="@+id/tv_chatroomList_notReadCount"  
                android:layout_width="24dp"  
                android:layout_height="24dp"  
                android:layout_gravity="right"  
                android:layout_marginTop="4dp"  
                android:background="@drawable/badge"  
                android:gravity="center"  
                android:text="99+"  
                android:textStyle="bold"  
                android:textColor="@android:color/white"  
                android:textSize="10sp" />  
        </LinearLayout>  
  
    </LinearLayout>  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="242">  
<source>app/src/main/res/layout\item_chatroom_search.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:orientation="vertical"  
    android:padding="16dp">  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:layout_gravity="center_vertical"  
        android:layout_marginBottom="8dp"  
        android:gravity="center"  
        android:orientation="horizontal">  
  
        <!--         가운데-->  
        <ImageView  
            android:id="@+id/iv_chatroom_image"  
            android:layout_width="40dp"  
            android:layout_height="40dp"  
            android:layout_marginRight="8dp"  
            android:clipToOutline="true"  
            android:visibility="gone"  
            />  
  
        <LinearLayout            android:layout_width="0dp"  
            android:layout_height="wrap_content"  
            android:layout_weight="1"  
            android:orientation="vertical">  
  
            <!--  채팅방 제목, 인원 수         -->  
            <TableLayout  
                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:shrinkColumns="0">  
  
                <TableRow  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:gravity="center_vertical">  
  
                    <TextView  
                        android:id="@+id/tv_chatRoomSearch_roomName"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:ellipsize="end"  
                        android:text="채팅방 이름"  
                        android:maxLines="1"  
                        android:textSize="18sp"  
                        android:textStyle="bold" />  
  
                    <TextView                        android:id="@+id/tv_chatRoomSearch_memberCount"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:paddingHorizontal="8dp"  
                        android:text="인원수"  
                        android:textColor="@color/grey"  
                        android:textSize="12sp" />  
  
                </TableRow>  
            </TableLayout>  
  
            <TextView                android:id="@+id/tv_chatRoomSearch_discription"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:ellipsize="end"  
                android:maxLines="2"  
                android:text="마지막메시지 마지막 메시지마지막 메시지마지막 메시지마지막 메시지마지막 메시지마지막 메시지마지막 메시지"  
                android:textColor="@color/grey"  
                android:textSize="12sp" />  
  
        </LinearLayout>  
  
        <!--  오른쪽, 마지막 전송날짜, 안읽은 메시지 수 출력       -->  
        <LinearLayout  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:layout_gravity="top"  
            android:orientation="vertical">  
  
  
        </LinearLayout>  
    </LinearLayout>  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="243">  
<source>app/src/main/res/layout\item_chat_member.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:orientation="horizontal"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:gravity="left|center_vertical"  
    android:padding="8dp"  
    >  
  
        <ImageView  
            android:id="@+id/iv_user_profile_image"  
            android:layout_width="40dp"  
            android:layout_height="40dp"  
            android:layout_marginRight="8dp"  
            android:background="@drawable/circle_shape"  
            android:clipToOutline="true"  
            android:src="@mipmap/ic_launcher_round" />  
  
        <TextView            android:id="@+id/me_mark"  
            android:layout_width="20dp"  
            android:layout_height="20dp"  
            android:text="나"  
            android:textSize="12sp"  
            android:textStyle="bold"  
            android:background="@color/grey"  
            android:textColor="@color/white"  
            android:layout_marginRight="8dp"  
            android:gravity="center"  
            android:visibility="gone"  
            />  
  
        <TextView            android:id="@+id/room_master_mark"  
            android:layout_width="wrap_content"  
            android:layout_height="20dp"  
            android:text="방장"  
            android:textSize="12sp"  
            android:textStyle="bold"  
            android:background="@color/grey"  
            android:textColor="@color/white"  
            android:layout_marginRight="8dp"  
            android:paddingHorizontal="4dp"  
            android:gravity="center"  
            android:visibility="gone"  
            />  
  
        <TextView            android:id="@+id/tv_user_nickname"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="test"  
            android:textSize="16sp" />  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="244">  
<source>app/src/main/res/layout\item_chat_message_simple.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:orientation="vertical"  
    android:paddingHorizontal="8dp"  
    android:paddingVertical="4dp"  
    >  
  
    <TextView  
        android:id="@+id/tv_message"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:textSize="12sp" />  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="245">  
<source>app/src/main/res/layout\item_chat_received.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:padding="8dp">  
  
  
    <ImageView  
        android:id="@+id/iv_profile_received"  
        android:layout_width="40dp"  
        android:layout_height="40dp"  
        android:layout_marginStart="8dp"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toTopOf="parent"  
        tools:srcCompat="@tools:sample/avatars"  
        />  
  
    <LinearLayout        android:id="@+id/linearLayout2"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:layout_marginStart="8dp"  
        android:layout_marginTop="4dp"  
        android:orientation="vertical"  
        app:layout_constraintStart_toEndOf="@+id/iv_profile_received"  
        app:layout_constraintTop_toTopOf="@+id/iv_profile_received">  
  
        <TextView  
            android:id="@+id/tv_sender_nickname_received"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:layout_marginBottom="4dp"  
            android:text="보낸사람"  
  
         />  
  
        <LinearLayout            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:gravity="left"  
            android:orientation="horizontal">  
  
            <TextView  
                android:id="@+id/tv_message_received"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:background="#D3D1D1"  
                android:padding="8dp"  
                android:text="메시지"  
                android:textColor="@android:color/black"  
  
                app:layout_constraintStart_toEndOf="@+id/iv_profile_received" />  
  
            <LinearLayout                android:id="@+id/linearLayout"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_gravity="bottom"  
                android:layout_marginStart="4dp"  
                android:gravity="left"  
                android:orientation="vertical"  
                android:paddingRight="8dp"  
                app:layout_constraintBottom_toBottomOf="@+id/tv_message_received"  
                app:layout_constraintStart_toEndOf="@+id/tv_message_received">  
  
<!--                <TextView-->  
<!--                    android:id="@+id/tv_unRead_received"-->  
<!--                    android:layout_width="wrap_content"-->  
<!--                    android:layout_height="wrap_content"-->  
<!--                    android:text="안읽은 사람 수"-->  
<!--                 />-->  
  
                <TextView  
                    android:id="@+id/tv_datetime_received"  
                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:text="보낸 시간"  
                   />  
  
            </LinearLayout>  
  
  
        </LinearLayout>  
  
    </LinearLayout>  
  
  
    <!--    <LinearLayout-->  
    <!--        android:id="@+id/ll_message_container_received"-->    <!--        android:layout_width="wrap_content"-->    <!--        android:layout_height="wrap_content"-->    <!--        android:orientation="vertical">-->    <!--       -->    <!--    </LinearLayout>-->  
</androidx.constraintlayout.widget.ConstraintLayout>  
</document_content>  
</document>  
<document index="246">  
<source>app/src/main/res/layout\item_chat_sent.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:gravity="end"  
    android:padding="8dp"  
    >  
  
    <LinearLayout  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:gravity="end"  
        android:layout_gravity="bottom"  
        android:paddingRight="4dp"  
        >  
  
<!--        <TextView-->  
<!--            android:id="@+id/tv_unRead_sent"-->  
<!--            android:layout_width="wrap_content"-->  
<!--            android:layout_height="wrap_content"-->  
<!--            android:text="안읽은 사람 수"-->  
  
<!--            />-->  
  
        <TextView  
            android:id="@+id/tv_datetime_sent"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="보낸 시간"  
            />  
    </LinearLayout>  
  
    <TextView        android:id="@+id/tv_message_sent"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:background="@color/primary"  
        android:padding="8dp"  
        android:text="메시지"  
        android:textColor="@android:color/white"  
       />  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="247">  
<source>app/src/main/res/layout\item_chat_server.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:gravity="center"  
    android:padding="8dp">  
  
  
    <TextView  
        android:id="@+id/tv_message_server"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:textColor="#7C7C7C"  
        android:gravity="center"  
        android:text="서버 메시지" />  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="248">  
<source>app/src/main/res/layout\item_friend_request.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:orientation="horizontal"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:paddingVertical="8dp"  
    android:paddingHorizontal="16dp"  
    >  
  
    <LinearLayout  
        android:id="@+id/ll_reply_item_author"  
        android:layout_width="0dp"  
        android:layout_height="match_parent"  
        android:layout_weight="1"  
        android:gravity="center_vertical"  
        android:orientation="horizontal">  
  
        <ImageView  
            android:id="@+id/iv_user_profile_image"  
            android:layout_width="40dp"  
            android:layout_height="40dp"  
            android:layout_marginRight="8dp"  
            android:background="@drawable/circle_shape"  
            android:clipToOutline="true"  
            android:src="@mipmap/ic_launcher_round" />  
  
        <TextView            android:id="@+id/tv_user_nickname"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="test"  
            android:textSize="24sp" />  
  
    </LinearLayout>  
  
  
    <LinearLayout        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:orientation="vertical">  
  
        <TextView  
            android:id="@+id/tv_request_time"  
            android:layout_gravity="right"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:textColor="@color/grey"  
            />  
  
        <LinearLayout            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:orientation="horizontal"  
            >  
  
            <androidx.appcompat.widget.AppCompatButton  
                android:id="@+id/btn_accept"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:backgroundTint="@color/primary"  
                android:textColor="@color/white"  
                android:text="수락"  
                />  
  
            <androidx.appcompat.widget.AppCompatButton                android:id="@+id/btn_reject"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:backgroundTint="@color/grey"  
                android:textColor="@color/white"  
                android:text="삭제"  
                />  
  
        </LinearLayout>  
    </LinearLayout>  
  
  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="249">  
<source>app/src/main/res/layout\item_image_received.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:orientation="vertical"  
    android:padding="8dp">  
  
    <!-- 상단에 프로필 이미지 및 텍스트를 수평으로 배치 -->  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="horizontal"  
        android:gravity="start">  
  
        <ImageView  
            android:id="@+id/iv_profile_received"  
            android:layout_width="40dp"  
            android:layout_height="40dp"  
            android:layout_marginEnd="8dp"  
            android:layout_gravity="top"  
            tools:srcCompat="@tools:sample/avatars" />  
  
        <LinearLayout            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            android:gravity="start">  
  
            <TextView  
                android:id="@+id/tv_sender_nickname_received"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_marginBottom="4dp"  
                android:text="보낸사람"  
                android:gravity="start" />  
  
  
            <!--  채팅방 제목, 인원 수         -->  
            <TableLayout  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:shrinkColumns="0">  
  
                <TableRow  
                    android:layout_width="match_parent"  
                    android:layout_height="wrap_content"  
                    android:gravity="center_vertical">  
  
                    <ImageView  
                        android:id="@+id/iv_image_received"  
                        android:layout_width="200dp"  
                        android:layout_height="wrap_content"  
                        android:padding="8dp"  
                        android:layout_marginEnd="4dp" />  
  
                    <TextView                        android:id="@+id/tv_datetime_received"  
                        android:layout_width="wrap_content"  
                        android:layout_height="wrap_content"  
                        android:text="보낸 시간"  
                        android:gravity="start"  
                        android:layout_gravity="bottom"  
                        />  
  
                </TableRow>  
            </TableLayout>  
  
        </LinearLayout>  
    </LinearLayout>  
</LinearLayout>  
</document_content>  
</document>  
<document index="250">  
<source>app/src/main/res/layout\item_image_sent.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:gravity="end"  
    android:padding="8dp">  
  
    <TableLayout  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:shrinkColumns="1">  
  
        <TableRow  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:gravity="center_vertical">  
  
            <TextView  
                android:id="@+id/tv_datetime_sent"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_gravity="bottom"  
                android:gravity="start"  
                android:text="보낸 시간" />  
  
            <ImageView                android:id="@+id/iv_image_sent"  
                android:layout_width="200dp"  
                android:layout_height="wrap_content"  
                android:layout_marginEnd="4dp"  
                android:padding="8dp" />  
  
        </TableRow>  
    </TableLayout>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="251">  
<source>app/src/main/res/layout\item_user.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:orientation="vertical"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:padding="16dp"  
    >  
  
    <LinearLayout  
        android:id="@+id/ll_reply_item_author"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="8dp"  
        android:layout_gravity="center_vertical"  
        android:gravity="center"  
        android:orientation="horizontal">  
  
        <ImageView  
            android:id="@+id/iv_user_profile_image"  
            android:layout_width="40dp"  
            android:layout_height="40dp"  
            android:layout_marginRight="8dp"  
            android:background="@drawable/circle_shape"  
            android:clipToOutline="true"  
            android:src="@mipmap/ic_launcher_round" />  
  
        <TextView            android:id="@+id/tv_user_nickname"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="test"  
            android:textSize="24sp" />  
  
    </LinearLayout>  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="252">  
<source>app/src/main/res/layout\item_user_profile_info.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:orientation="vertical">  
  
  
    <LinearLayout  
        android:id="@+id/ll_sv_content_container"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:orientation="vertical">  
  
        <LinearLayout  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="vertical"  
            android:padding="16dp">  
  
            <ImageView  
                android:id="@+id/image_view_profile"  
                android:layout_width="100dp"  
                android:layout_height="100dp"  
                tools:src="@tools:sample/avatars" />  
  
            <TextView                android:id="@+id/text_view_nickname"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:textSize="32dp"  
                android:textStyle="bold" />  
  
            <TextView                android:id="@+id/text_view_description"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:textSize="16dp" />  
  
            <LinearLayout                android:layout_width="match_parent"  
                android:layout_height="wrap_content"  
                android:orientation="horizontal"  
                android:paddingTop="16dp">  
  
                <TextView  
                    android:id="@+id/text_view_follower"  
                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:layout_marginRight="16dp"  
                    android:text="0 팔로워" />  
  
                <TextView                    android:id="@+id/text_view_following"  
                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:text="0 팔로잉" />  
            </LinearLayout>  
        </LinearLayout>  
  
        <com.google.android.material.divider.MaterialDivider            android:layout_width="match_parent"  
            android:layout_height="wrap_content" />  
  
        <LinearLayout            android:id="@+id/ll_friends_container"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:orientation="horizontal"  
            android:visibility="gone"  
            android:paddingVertical="4dp"  
            >  
  
            <TextView  
                android:id="@+id/text_view_friends"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_marginStart="16dp"  
                android:text="친구 00 명"  
                android:textSize="16dp"  
                android:textStyle="bold" />  
  
            <Space                android:layout_width="0dp"  
                android:layout_height="wrap_content"  
                android:layout_weight="1" />  
  
            <androidx.appcompat.widget.AppCompatButton                android:id="@+id/btn_friends_list"  
                android:layout_width="150dp"  
                android:layout_height="wrap_content"  
                android:layout_marginEnd="16dp"  
                android:background="@color/primary"  
                android:textColor="@color/white"  
                android:text="친구 목록" />  
  
        </LinearLayout>  
  
        <LinearLayout            android:id="@+id/ll_buttons_container"  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:paddingHorizontal="16dp"  
            android:orientation="horizontal"  
            android:visibility="gone"  
            >  
  
            <androidx.appcompat.widget.AppCompatButton  
                android:id="@+id/btn_follow"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="팔로우"  
                android:backgroundTint="@color/primary"  
                android:textColor="@color/white"  
                />  
  
            <androidx.appcompat.widget.AppCompatButton                android:id="@+id/btn_friend"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="친구신청" />  
  
            <Space                android:layout_width="0dp"  
                android:layout_height="wrap_content"  
                android:layout_weight="1" />  
  
  
        </LinearLayout>  
  
        <com.google.android.material.divider.MaterialDivider            android:layout_width="match_parent"  
            android:layout_height="wrap_content" />  
  
        <TextView            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:padding="16dp"  
            android:text="게시물"  
            android:textSize="16dp"  
            android:textStyle="bold" />  
  
        <com.google.android.material.divider.MaterialDivider            android:layout_width="match_parent"  
            android:layout_height="wrap_content" />  
  
    </LinearLayout>  
</LinearLayout>  
</document_content>  
</document>  
<document index="253">  
<source>app/src/main/res/layout\item_user_select.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
  
<!-- 친구 선택 아이템 -->  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:orientation="horizontal"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:paddingHorizontal="16dp"  
    android:paddingVertical="8dp"  
    android:id="@+id/ll_friends_select"  
    >  
  
    <LinearLayout  
        android:id="@+id/ll_reply_item_author"  
        android:layout_width="0dp"  
        android:layout_height="50dp"  
        android:layout_weight="1"  
        android:gravity="center_vertical"  
        android:orientation="horizontal"  
        android:paddingVertical="4dp"  
        >  
  
        <ImageView  
            android:id="@+id/iv_user_profile_image"  
            android:layout_width="40dp"  
            android:layout_height="40dp"  
            android:layout_marginRight="8dp"  
            android:background="@drawable/circle_shape"  
            android:clipToOutline="true"  
            android:src="@mipmap/ic_launcher_round"  
            />  
  
        <TextView            android:id="@+id/tv_user_nickname"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="test"  
            android:textSize="24sp" />  
  
    </LinearLayout>  
  
  
  
    <RadioButton        android:id="@+id/rb_select"  
        android:layout_width="wrap_content"  
        android:layout_height="50dp"  
        android:layout_gravity="end"  
        android:layoutDirection="rtl"  
         />  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="254">  
<source>app/src/main/res/layout\item_video_room_participant.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="250dp">  
  
  
    <org.webrtc.SurfaceViewRenderer  
        android:id="@+id/surface_view"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        app:layout_constraintBottom_toBottomOf="parent"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toTopOf="parent" />  
  
    <LinearLayout        android:id="@+id/ll_iv_wrapper"  
        android:layout_width="match_parent"  
        android:layout_height="match_parent"  
        android:gravity="center"  
        android:orientation="horizontal"  
        android:background="@color/black"  
        app:layout_constraintBottom_toBottomOf="parent"  
        app:layout_constraintEnd_toEndOf="parent"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toTopOf="parent"  
        android:visibility="gone"  
        >  
  
        <ImageView  
            android:id="@+id/iv_profile"  
            android:layout_width="100dp"  
            android:layout_height="100dp"  
            app:layout_constraintBottom_toBottomOf="parent"  
            app:layout_constraintEnd_toEndOf="parent"  
            app:layout_constraintStart_toStartOf="parent"  
            app:layout_constraintTop_toTopOf="parent" />  
  
    </LinearLayout>  
  
  
  
  
    <LinearLayout        android:id="@+id/ll_user_info"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:background="@color/black"  
        android:orientation="horizontal"  
        android:gravity="center"  
        android:padding="4dp"  
        app:layout_constraintBottom_toBottomOf="parent"  
        app:layout_constraintStart_toStartOf="parent">  
  
        <ImageView  
            android:id="@+id/iv_mic_status"  
            android:layout_width="14dp"  
            android:layout_height="match_parent"  
            android:src="@drawable/ic_mic_off_red"  
            android:layout_marginEnd="4dp"  
            android:visibility="gone"  
            />  
  
        <TextView            android:id="@+id/tv_nickname"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="loading..."  
            android:textColor="@color/white" />  
  
    </LinearLayout>  
  
  
</androidx.constraintlayout.widget.ConstraintLayout>  
</document_content>  
</document>  
<document index="255">  
<source>app/src/main/res/layout\item_video_room_received.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:padding="8dp">  
  
  
    <ImageView  
        android:id="@+id/iv_profile_received"  
        android:layout_width="40dp"  
        android:layout_height="40dp"  
        android:layout_marginStart="8dp"  
        app:layout_constraintStart_toStartOf="parent"  
        app:layout_constraintTop_toTopOf="parent"  
        tools:srcCompat="@tools:sample/avatars" />  
  
    <LinearLayout        android:id="@+id/linearLayout2"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:layout_marginStart="8dp"  
        android:layout_marginTop="4dp"  
        android:orientation="vertical"  
        app:layout_constraintStart_toEndOf="@+id/iv_profile_received"  
        app:layout_constraintTop_toTopOf="@+id/iv_profile_received">  
  
        <TextView  
            android:id="@+id/tv_sender_nickname_received"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:layout_marginBottom="4dp"  
            android:text="보낸사람"  
         />  
  
        <LinearLayout            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:gravity="left"  
            android:orientation="horizontal">  
  
            <LinearLayout  
                android:id="@+id/ll_enter_video_room_received"  
                android:layout_width="150dp"  
                android:layout_height="wrap_content"  
                android:gravity="center_vertical"  
                android:orientation="horizontal"  
                android:background="#D3D1D1"  
                android:padding="4dp">  
  
                <ImageView  
                    android:layout_width="24dp"  
                    android:layout_height="24dp"  
                    android:src="@drawable/ic_video_on"  
                    />  
  
                <TextView                    android:id="@+id/tv_video_room_received"  
                    android:layout_width="0dp"  
                    android:layout_height="wrap_content"  
                    android:layout_weight="1"  
                    android:gravity="right"  
                    android:padding="8dp"  
                    android:text="영상통화"  
                    android:textColor="@android:color/black"  
                    />  
  
            </LinearLayout>  
  
  
  
            <LinearLayout                android:id="@+id/linearLayout"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:layout_gravity="bottom"  
                android:layout_marginStart="4dp"  
                android:gravity="left"  
                android:orientation="vertical"  
                android:paddingRight="8dp"  
                app:layout_constraintBottom_toBottomOf="@+id/tv_message_received"  
                app:layout_constraintStart_toEndOf="@+id/tv_message_received">  
  
<!--                <TextView-->  
<!--                    android:id="@+id/tv_unRead_received"-->  
<!--                    android:layout_width="wrap_content"-->  
<!--                    android:layout_height="wrap_content"-->  
<!--                    android:text="안읽은 사람 수"-->  
<!--                 />-->  
  
                <TextView  
                    android:id="@+id/tv_datetime_received"  
                    android:layout_width="wrap_content"  
                    android:layout_height="wrap_content"  
                    android:text="보낸 시간"  
                   />  
  
            </LinearLayout>  
  
  
        </LinearLayout>  
  
    </LinearLayout>  
  
</androidx.constraintlayout.widget.ConstraintLayout>  
</document_content>  
</document>  
<document index="256">  
<source>app/src/main/res/layout\item_video_room_sent.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:gravity="end"  
    android:padding="8dp"  
    >  
  
    <LinearLayout  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:orientation="vertical"  
        android:gravity="end"  
        android:layout_gravity="bottom"  
        android:paddingRight="4dp"  
        >  
  
<!--        <TextView-->  
<!--            android:id="@+id/tv_unRead_sent"-->  
<!--            android:layout_width="wrap_content"-->  
<!--            android:layout_height="wrap_content"-->  
<!--            android:text="안읽은 사람 수"-->  
  
<!--            />-->  
  
        <TextView  
            android:id="@+id/tv_datetime_sent"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="보낸 시간"  
            />  
    </LinearLayout>  
  
    <LinearLayout        android:id="@+id/ll_message_container_sent"  
        android:layout_width="150dp"  
        android:layout_height="wrap_content"  
        android:orientation="horizontal"  
        android:gravity="center_vertical"  
        android:background="@color/primary"  
        android:padding="4dp"  
        >  
  
        <ImageView  
            android:layout_width="24dp"  
            android:layout_height="24dp"  
            android:src="@drawable/ic_video_white"  
            />  
  
        <TextView            android:id="@+id/tv_video_room_sent"  
            android:layout_width="0dp"  
            android:layout_height="wrap_content"  
            android:layout_weight="1"  
            android:padding="8dp"  
            android:text="영상통화"  
            android:gravity="right"  
            android:textColor="@android:color/white"  
            />  
  
    </LinearLayout>  
  
  
  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="257">  
<source>app/src/main/res/layout\layout_chat_side_drawer.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:app="http://schemas.android.com/apk/res-auto"  
    android:layout_width="match_parent"  
    android:layout_height="match_parent"  
    android:background="@color/white"  
    android:orientation="vertical">  
    <!--    app:layout_constraintWidth_percent="0.8"-->  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="horizontal"  
        android:gravity="center_vertical"  
        android:padding="8dp"  
        >  
        <TextView  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="채팅방 설정"  
            android:textStyle="bold"  
            android:textSize="18sp"  
            android:paddingVertical="16dp"  
            android:paddingHorizontal="8dp"  
            />  
        <View            android:layout_width="0dp"  
            android:layout_height="0dp"  
            android:layout_weight="1"  
            />  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_change_room_name"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:text="채팅방 표시 이름 변경"  
            android:paddingHorizontal="8dp"  
            android:background="@color/primary"  
            android:textColor="@color/white"  
            />  
    </LinearLayout>  
  
    <View        android:layout_width="match_parent"  
        android:layout_height="1dp"  
        android:background="@color/divider_grey"  
        />  
  
<!--    <LinearLayout-->  
<!--        android:layout_width="match_parent"-->  
<!--        android:layout_height="0dp"-->  
<!--        android:layout_weight="3"-->  
<!--        android:orientation="vertical"/>-->  
  
    <LinearLayout  
        android:layout_width="match_parent"  
        android:layout_height="0dp"  
        android:layout_weight="7"  
        android:orientation="vertical">  
  
        <TextView  
            android:layout_width="match_parent"  
            android:layout_height="wrap_content"  
            android:text="대화상대"  
            android:textStyle="bold"  
            android:textSize="16sp"  
            android:paddingVertical="16dp"  
            android:paddingHorizontal="8dp"  
            />  
  
        <View            android:layout_width="match_parent"  
            android:layout_height="1dp"  
            android:background="@color/divider_grey"  
            />  
  
        <androidx.recyclerview.widget.RecyclerView            android:id="@+id/rv_member"  
            android:layout_width="match_parent"  
            android:layout_height="match_parent" />  
  
  
    </LinearLayout>  
  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:background="@color/divider_grey"  
        android:orientation="horizontal"  
        >  
  
        <ImageButton  
            android:id="@+id/ib_chatroom_exit"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:src="@drawable/ic_exit"  
            android:background="@android:color/transparent"  
            android:padding="8dp"  
            />  
  
        <View            android:layout_width="0dp"  
            android:layout_height="0dp"  
            android:layout_weight="1"  
            />  
  
        <ImageButton            android:id="@+id/ib_chatroom_toggle_notification"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:src="@drawable/ic_bell_on"  
            android:background="@android:color/transparent"  
            android:padding="8dp"  
            />  
    </LinearLayout>  
  
</LinearLayout>  
</document_content>  
</document>  
<document index="258">  
<source>app/src/main/res/layout\menu_icon_with_badge.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="wrap_content"  
    android:layout_height="wrap_content"  
    android:paddingRight="8dp"  
    >  
  
    <!-- 아이콘 -->  
    <ImageView  
        android:id="@+id/menu_icon"  
        android:layout_width="28dp"  
        android:layout_height="48dp"  
        android:src="@drawable/chat"  
        android:layout_gravity="center"  
        />  
  
    <!-- 빨간 점 (배지) -->  
    <View  
        android:id="@+id/chat_red_dot"  
        android:layout_width="14dp"  
        android:layout_height="14dp"  
        android:background="@drawable/badge"  
        android:layout_marginLeft="28dp"  
        android:layout_marginTop="8dp"  
        android:visibility="invisible" /> <!-- 기본적으로 숨김 처리 -->  
  
</FrameLayout>  
</document_content>  
</document>  
<document index="259">  
<source>app/src/main/res/layout\menu_text_item.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<TextView xmlns:android="http://schemas.android.com/apk/res/android"  
    android:layout_width="wrap_content"  
    android:layout_height="wrap_content"  
    android:paddingRight="16dp"  
    android:text="게시하기"  
    style="@style/ToolbarMenuTextStyle"  
/>  
  
  
</document_content>  
</document>  
<document index="260">  
<source>app/src/main/res/layout\post_item.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools"  
    android:orientation="vertical"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:padding="16dp"  
    android:background="@drawable/item_border_grey">  
  
    <LinearLayout  
        android:id="@+id/ll_post_item_author"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="16dp"  
        android:gravity="center_vertical"  
        android:orientation="horizontal">  
  
        <ImageView  
            android:id="@+id/iv_post_item_author_profile_image"  
            android:layout_width="40dp"  
            android:layout_height="40dp"  
            android:layout_marginRight="8dp"  
            android:background="@drawable/circle_shape"  
            android:clipToOutline="true"  
            android:src="@mipmap/ic_launcher_round" />  
  
        <LinearLayout            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:gravity="center_vertical"  
            android:orientation="vertical">  
  
            <TextView  
                android:id="@+id/tv_post_item_author_nickname"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="test"  
                android:textSize="18sp" />  
  
            <TextView                android:id="@+id/tv_post_item_date"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="2020.01.01"  
                android:textColor="@color/grey"  
                android:textSize="12sp" />  
        </LinearLayout>  
  
    </LinearLayout>  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:orientation="horizontal"  
        android:layout_marginBottom="16dp"  
  
        >  
  
        <TextView  
            android:id="@+id/tv_post_item_content"  
            android:layout_width="0dp"  
            android:layout_height="wrap_content"  
            android:layout_weight="1"  
            android:text="test"  
            android:maxLines="3"  
            android:ellipsize="end"  
            />  
  
        <ImageView            android:id="@+id/iv_post_item_image"  
            android:layout_width="100dp"  
            android:layout_height="100dp"  
            tools:srcCompat="@tools:sample/avatars"  
            android:layout_marginLeft="16dp"  
            android:visibility="gone"  
            android:background="@color/grey"  
            />  
  
    </LinearLayout>  
  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:gravity="center"  
        android:orientation="horizontal">  
  
        <androidx.appcompat.widget.AppCompatButton  
            android:id="@+id/btn_post_item_like"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:background="@android:color/transparent"  
            android:drawableStart="@drawable/ic_like_false"  
            android:drawablePadding="8dp"  
            android:gravity="center"  
            android:paddingEnd="32dp"  
            />  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_post_item_comment"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:background="@android:color/transparent"  
            android:drawableStart="@drawable/ic_comment"  
            android:drawablePadding="8dp"  
            android:paddingHorizontal="32dp"  
            />  
  
        <androidx.appcompat.widget.AppCompatButton            android:id="@+id/btn_post_item_view"  
            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:background="@android:color/transparent"  
            android:drawableStart="@drawable/ic_eye"  
            android:drawablePadding="8dp"  
            android:paddingStart="32dp"  
           />  
    </LinearLayout>  
</LinearLayout>  
</document_content>  
</document>  
<document index="261">  
<source>app/src/main/res/layout\reply_item.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"  
    android:orientation="vertical"  
    android:layout_width="match_parent"  
    android:layout_height="wrap_content"  
    android:paddingRight="8dp"  
    android:paddingLeft="48dp"  
    android:paddingVertical="8dp"  
    android:background="@drawable/bg_reply"  
    >  
  
    <LinearLayout  
        android:id="@+id/ll_reply_item_author"  
        android:layout_width="wrap_content"  
        android:layout_height="wrap_content"  
        android:layout_marginBottom="8dp"  
        android:gravity="center_vertical"  
        android:orientation="horizontal">  
  
        <ImageView  
            android:id="@+id/iv_reply_item_author_profile_image"  
            android:layout_width="30dp"  
            android:layout_height="30dp"  
            android:layout_marginRight="8dp"  
            android:background="@drawable/circle_shape"  
            android:clipToOutline="true"  
            android:src="@mipmap/ic_launcher_round" />  
  
        <LinearLayout            android:layout_width="wrap_content"  
            android:layout_height="wrap_content"  
            android:gravity="center_vertical"  
            android:orientation="vertical">  
  
            <TextView  
                android:id="@+id/tv_reply_item_author_nickname"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="test"  
                android:textSize="14sp" />  
  
            <TextView                android:id="@+id/tv_reply_item_date"  
                android:layout_width="wrap_content"  
                android:layout_height="wrap_content"  
                android:text="2020.01.01"  
                android:textColor="@color/grey"  
                android:textSize="10sp" />  
        </LinearLayout>  
  
    </LinearLayout>  
  
    <TextView        android:id="@+id/tv_reply_item_content"  
        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:text="test"  
        android:layout_marginBottom="8dp"  
        />  
  
    <LinearLayout        android:layout_width="match_parent"  
        android:layout_height="wrap_content"  
        android:gravity="start"  
        android:orientation="horizontal">  
  
        <androidx.appcompat.widget.AppCompatButton  
            android:id="@+id/btn_reply_item_like"  
            android:layout_width="wrap_content"  
            android:layout_height="30dp"  
            android:background="@android:color/transparent"  
            android:drawableStart="@drawable/ic_like_false"  
            android:drawablePadding="-25dp"  
            android:gravity="center"  
            android:text="123" />  
<!--         대댓글-->  
        <TextView  
            android:id="@+id/tv_add_reply"  
            android:layout_width="match_parent"  
            android:layout_height="match_parent"  
            android:gravity="center_vertical"  
            android:text="덧글 입력하기"  
            android:textColor="@color/primary"  
            />  
    </LinearLayout>  
</LinearLayout>  
</document_content>  
</document>  
<document index="262">  
<source>app/src/main/res/values\colors.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<resources>  
    <color name="black">#FF000000</color>  
    <color name="white">#FFFFFFFF</color>  
    <color name="kakao_yellow">#FEE500</color>  
    <color name="primary">#2450A6</color>  
    <color name="inactive">#DBDBDB</color>  
    <color name="grey">#808080</color>  
    <color name="divider_grey">#BABABA</color>  
</resources>  
</document_content>  
</document>  
<document index="263">  
<source>app/src/main/res/values\dimens.xml</source>  
<document_content>  
<resources>  
    <!-- Default screen margins, per the Android Design guidelines. -->  
    <dimen name="activity_horizontal_margin">16dp</dimen>  
    <dimen name="activity_vertical_margin">16dp</dimen>  
    <dimen name="text_margin">16dp</dimen>  
    <dimen name="fab_margin">16dp</dimen>  
    <dimen name="image_preview_margin">8dp</dimen>  
    <dimen name="delete_icon_padding">4dp</dimen>  
</resources>  
</document_content>  
</document>  
<document index="264">  
<source>app/src/main/res/values\ids.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<resources>  
    <item name="tag_file" type="id"/>  
    <item name="tag_uri" type="id"/>  
</resources>  
</document_content>  
</document>  
<document index="265">  
<source>app/src/main/res/values\strings.xml</source>  
<document_content>  
<resources>  
    <string name="app_name">ASSA</string>  
    <string name="title_activity_login">LoginActivity</string>  
    <string name="prompt_email">Email</string>  
    <string name="prompt_password">Password</string>  
    <string name="action_sign_in">Sign in or register</string>  
    <string name="action_sign_in_short">Sign in</string>  
    <string name="welcome">"Welcome !"</string>  
    <string name="invalid_username">Not a valid username</string>  
    <string name="invalid_password">Password must be >5 characters</string>  
    <string name="login_failed">"Login failed"</string>  
    <string name="title_activity_login2">LoginActivity2</string>  
    <!-- TODO: Remove or change this placeholder text -->  
    <string name="hello_blank_fragment">Hello blank fragment</string>  
    <!-- Strings used for fragments for navigation -->  
    <string name="first_fragment_label">First Fragment</string>  
    <string name="second_fragment_label">Second Fragment</string>  
    <string name="next">Next</string>  
    <string name="previous">Previous</string>  
  
    <string name="lorem_ipsum">  
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam in scelerisque sem. Mauris  
        volutpat, dolor id interdum ullamcorper, risus dolor egestas lectus, sit amet mattis purus  
        dui nec risus. Maecenas non sodales nisi, vel dictum dolor. Class aptent taciti sociosqu ad  
        litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse blandit eleifend  
        diam, vel rutrum tellus vulputate quis. Aliquam eget libero aliquet, imperdiet nisl a,  
        ornare ex. Sed rhoncus est ut libero porta lobortis. Fusce in dictum tellus.\n\n  
        Suspendisse interdum ornare ante. Aliquam nec cursus lorem. Morbi id magna felis. Vivamus  
        egestas, est a condimentum egestas, turpis nisl iaculis ipsum, in dictum tellus dolor sed  
        neque. Morbi tellus erat, dapibus ut sem a, iaculis tincidunt dui. Interdum et malesuada  
        fames ac ante ipsum primis in faucibus. Curabitur et eros porttitor, ultricies urna vitae,  
        molestie nibh. Phasellus at commodo eros, non aliquet metus. Sed maximus nisl nec dolor  
        bibendum, vel congue leo egestas.\n\n  
        Sed interdum tortor nibh, in sagittis risus mollis quis. Curabitur mi odio, condimentum sit  
        amet auctor at, mollis non turpis. Nullam pretium libero vestibulum, finibus orci vel,  
        molestie quam. Fusce blandit tincidunt nulla, quis sollicitudin libero facilisis et. Integer  
        interdum nunc ligula, et fermentum metus hendrerit id. Vestibulum lectus felis, dictum at  
        lacinia sit amet, tristique id quam. Cras eu consequat dui. Suspendisse sodales nunc ligula,  
        in lobortis sem porta sed. Integer id ultrices magna, in luctus elit. Sed a pellentesque  
        est.\n\n  
        Aenean nunc velit, lacinia sed dolor sed, ultrices viverra nulla. Etiam a venenatis nibh.  
        Morbi laoreet, tortor sed facilisis varius, nibh orci rhoncus nulla, id elementum leo dui  
        non lorem. Nam mollis ipsum quis auctor varius. Quisque elementum eu libero sed commodo. In  
        eros nisl, imperdiet vel imperdiet et, scelerisque a mauris. Pellentesque varius ex nunc,  
        quis imperdiet eros placerat ac. Duis finibus orci et est auctor tincidunt. Sed non viverra  
        ipsum. Nunc quis augue egestas, cursus lorem at, molestie sem. Morbi a consectetur ipsum, a  
        placerat diam. Etiam vulputate dignissim convallis. Integer faucibus mauris sit amet finibus  
        convallis.\n\n  
        Phasellus in aliquet mi. Pellentesque habitant morbi tristique senectus et netus et  
        malesuada fames ac turpis egestas. In volutpat arcu ut felis sagittis, in finibus massa  
        gravida. Pellentesque id tellus orci. Integer dictum, lorem sed efficitur ullamcorper,  
        libero justo consectetur ipsum, in mollis nisl ex sed nisl. Donec maximus ullamcorper  
        sodales. Praesent bibendum rhoncus tellus nec feugiat. In a ornare nulla. Donec rhoncus  
        libero vel nunc consequat, quis tincidunt nisl eleifend. Cras bibendum enim a justo luctus  
        vestibulum. Fusce dictum libero quis erat maximus, vitae volutpat diam dignissim.  
    </string>  
</resources>  
</document_content>  
</document>  
<document index="266">  
<source>app/src/main/res/values\styles.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<resources>  
  
    <style name="fab_circle">  
        <item name="cornerFamily">rounded</item>  
    </style>  
  
    <style name="ToolbarMenuTextStyle" parent="TextAppearance.AppCompat.Widget.ActionBar.Menu">  
        <item name="android:textColor">@color/color_selector</item>  
        <item name="android:textStyle">bold</item> <!-- 굵게 -->  
        <item name="android:textSize">18sp</item>  
    </style>  
  
</resources>  
</document_content>  
</document>  
<document index="267">  
<source>app/src/main/res/values\themes.xml</source>  
<document_content>  
<resources xmlns:tools="http://schemas.android.com/tools">  
    <!-- Base application theme. -->  
    <style name="Base.Theme.ASSA" parent="Theme.Material3.DayNight.NoActionBar">  
        <!-- Customize your light theme here. -->  
<!--         <item name="colorPrimary">@color/my_light_primary</item> -->  
        <item name="android:statusBarColor">#00000000</item>  
        <item name="android:windowLightStatusBar">true</item>  
    </style>  
  
    <style name="Theme.ASSA" parent="Base.Theme.ASSA" />  
  
    <style name="Theme.ASSA.Splash" parent="Theme.SplashScreen">  
        <item name="windowSplashScreenBackground">@color/white</item>  
        <item name="postSplashScreenTheme">@style/Theme.ASSA</item>  
        <item name="windowSplashScreenAnimatedIcon">@drawable/all_logo_assa</item>  
    </style>  
</resources>  
</document_content>  
</document>  
<document index="268">  
<source>app/src/main/AndroidManifest.xml</source>  
<document_content>  
<?xml version="1.0" encoding="utf-8"?>  
<manifest xmlns:android="http://schemas.android.com/apk/res/android"  
    xmlns:tools="http://schemas.android.com/tools">  
  
    <uses-permission  
        android:name="android.permission.CAPTURE_VIDEO_OUTPUT"  
        tools:ignore="ProtectedPermissions" />  
  
    <uses-feature        android:name="android.hardware.camera"  
        android:required="true" /> <!-- 카메라 사용 권한 -->  
    <uses-permission android:name="android.permission.CAMERA" /> <!-- 오디오 사용 권한 -->  
    <uses-permission android:name="android.permission.RECORD_AUDIO" />  
    <uses-permission android:name="android.permission.INTERNET" /> <!-- 안드 9 이하를 위한 권한 -->  
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />  
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />  
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />  
    <uses-permission android:name="android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS" /> <!-- 배터리 최적화 제외 -->  
  
    <!-- 부팅시 자동 실행 -->  
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />  
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />  
    <uses-permission android:name="android.permission.BOOT_COMPLETED" />  
    <uses-permission android:name="android.permission.ACCESS_BACKGROUND_SERVICE" />  
  
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" /> <!-- 예시 -->  
    <!-- remoteMessaging 타입에 필요한 권한 (API 34 이상) -->  
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_REMOTE_MESSAGING" />  
    <!-- 다른 타입도 사용했다면 해당 권한 추가 (예: dataSync) -->  
     <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" />  
    <!-- 알림 표시 권한 (API 33 이상 필요) -->  
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS"/>  
  
    <application        android:name=".application.GlobalApplication"  
        android:allowBackup="true"  
        android:dataExtractionRules="@xml/data_extraction_rules"  
        android:fullBackupContent="@xml/backup_rules"  
        android:hardwareAccelerated="true"  
        android:icon="@drawable/all_logo_assa"  
        android:label="@string/app_name"  
        android:roundIcon="@drawable/all_logo_assa"  
        android:supportsRtl="true"  
        android:theme="@style/Theme.ASSA"  
        android:usesCleartextTraffic="true"  
        tools:targetApi="31">  
        <activity  
            android:name=".ui.activity.ChangeOpenChatRoomNameActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.ChangeDescriptionActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.OpenChatSettingActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.VideoCallActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.ChangeRoomNameActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.SelectFriendsActivity"  
            android:exported="false" />  
  
        <service            android:name=".service.RestartService"  
            android:enabled="true"  
            android:exported="true" />  
  
        <receiver            android:name=".broadcastReceiver.BootReceiver"  
            android:enabled="true"  
            android:exported="true">  
            <intent-filter>  
                <action android:name="android.intent.action.BOOT_COMPLETED" />  
            </intent-filter>  
        </receiver>  
        <receiver            android:name=".broadcastReceiver.AlarmReceiver"  
            android:enabled="true"  
            android:exported="true" />  
  
        <service            android:name=".service.ChattingSocketService"  
            android:enabled="true"  
            android:exported="true"  
            android:foregroundServiceType="dataSync|remoteMessaging"  
            />  
  
        <activity            android:name=".ui.activity.ChatRoomActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.NewOpenChatActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.ProfileNotificationActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.FriendsActivity"  
            android:exported="false"  
            android:theme="@style/Theme.ASSA" />  
        <activity            android:name=".ui.activity.SearchResultActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.FollowingActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.FollowerActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.UserProfileActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.CommentUpdateActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.PostDetailActivity"  
            android:exported="false"  
            android:windowSoftInputMode="adjustResize" />  
        <activity            android:name=".ui.activity.PostCreateActivity"  
            android:exported="false"  
            android:windowSoftInputMode="adjustPan" />  
  
        <provider            android:name="androidx.core.content.FileProvider"  
            android:authorities="${applicationId}.provider"  
            android:exported="false"  
            android:grantUriPermissions="true">  
            <meta-data  
                android:name="android.support.FILE_PROVIDER_PATHS"  
                android:resource="@xml/file_paths"  
                tools:replace="android:resource" />  
        </provider>  
  
        <activity            android:name=".ui.activity.PostNotificationActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.ChangePasswordActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.BannedUserListActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.EditAccountActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.EditProfileActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.SplashScreenActivity"  
            android:exported="true">  
            <intent-filter>  
                <action android:name="android.intent.action.MAIN" />  
  
                <category android:name="android.intent.category.LAUNCHER" />  
            </intent-filter>  
        </activity>  
        <activity            android:name=".ui.activity.SettingActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.SelectAccountActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.MainActivity2"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.AccountLinkingActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.SetNicknameActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.SetPasswordActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.EmailConfirmationActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.EmailActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.AgreeToTermsActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.FullTermsActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.MainActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.SignupActivity"  
            android:exported="false" />  
        <activity            android:name=".ui.activity.LoginActivity"  
            android:exported="true">  
  
            <!-- <intent-filter> -->  
            <!-- <action android:name="android.intent.action.MAIN" /> -->  
  
            <!-- <category android:name="android.intent.category.LAUNCHER" /> -->            <!-- </intent-filter> -->        </activity>  
        <activity            android:name="com.kakao.sdk.auth.AuthCodeHandlerActivity"  
            android:exported="true">  
            <intent-filter>  
                <action android:name="android.intent.action.VIEW" />  
  
                <category android:name="android.intent.category.DEFAULT" />  
                <category android:name="android.intent.category.BROWSABLE" />  
  
                <!-- Redirect URI: "kakao${NATIVE_APP_KEY}://oauth" -->  
                <data  
                    android:host="oauth"  
                    android:scheme="kakao${KAKAO_NATIVE_APP_KEY}" />  
            </intent-filter>  
        </activity>  
    </application>  
  
</manifest>  
</document_content>  
</document>  
<document index="269">  
<source>app\build.gradle</source>  
<document_content>  
plugins {  
    alias(libs.plugins.androidApplication)  
}  
  
android {  
    namespace 'com.teamnova.assa'  
    compileSdk 34  
  
    defaultConfig {  
        applicationId "com.teamnova.assa"  
        minSdk 27  
        targetSdk 34  
        versionCode 1  
        versionName "1.0"  
  
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"  
  
        // 카카오 로그인 키 설정  
        Properties properties = new Properties()  
        properties.load(project.rootProject.file("local.properties").newDataInputStream())  
        // 카카오 앱 키(client_id)  
        buildConfigField "String", "KAKAO_NATIVE_APP_KEY", "\"${properties['KAKAO_NATIVE_APP_KEY']}\""  
        // 서버 IP  
        buildConfigField "String", "BASE_URL", "\"${properties['BASE_URL']}\""  
  
        // IP 번호  
        buildConfigField "String", "HOST", "\"${properties['HOST']}\""  
        // 채팅 소켓서버 포트 번호  
        buildConfigField "int", "CHATTING_SOCKET_PORT", "${properties['CHATTING_SOCKET_PORT']}"  
  
        // 매니페스트 변수  
        manifestPlaceholders = ["KAKAO_NATIVE_APP_KEY": "${properties.getProperty("KAKAO_NATIVE_APP_KEY")}"]  
    }  
  
    buildTypes {  
        release {  
            minifyEnabled false  
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'  
        }  
    }  
    compileOptions {  
        sourceCompatibility JavaVersion.VERSION_1_8  
        targetCompatibility JavaVersion.VERSION_1_8  
    }  
    buildFeatures {  
        viewBinding true  
        dataBinding true  
        android.buildFeatures.buildConfig true  
    }  
}  
  
dependencies {  
  
    implementation libs.appcompat  
    implementation libs.material  
    implementation libs.activity  
    implementation libs.constraintlayout  
    implementation libs.annotation  
    implementation libs.lifecycle.livedata.ktx  
    implementation libs.lifecycle.viewmodel.ktx  
    implementation libs.legacy.support.v4  
    implementation libs.recyclerview  
    implementation libs.navigation.fragment  
    implementation libs.navigation.ui  
    implementation files('C:/Users/kal02/AndroidStudioProjects/ASSA/lib/libwebrtc.aar')  
    testImplementation libs.junit  
    androidTestImplementation libs.ext.junit  
    androidTestImplementation libs.espresso.core  
  
    implementation "androidx.core:core-splashscreen:1.0.0" // 스플래시 스크린  
  
    // http 통신 라이브러리  
    implementation 'com.android.volley:volley:1.2.1'  
    implementation 'com.squareup.retrofit2:retrofit:2.11.0'  
  
    // retrofit에 사용되는 java 객체 - json 변환기  
    implementation 'com.squareup.retrofit2:converter-gson:2.11.0'  
    implementation("com.squareup.okhttp3:okhttp-urlconnection:4.12.0") // retrofit cookie 관리  
  
    // kakaoSDK  
    implementation "com.kakao.sdk:v2-all:2.20.1" // 전체 모듈 설치, 2.11.0 버전부터 지원  
  
    // Glide  
    implementation 'com.github.bumptech.glide:glide:4.16.0'  
  
    // WorkManager  
//    implementation "androidx.work:work-runtime:2.3.3"  
  
    // 이미지 선택기 https://mvnrepository.com/artifact/io.github.ParkSangGwon/tedimagepicker  
    implementation group: 'io.github.ParkSangGwon', name: 'tedimagepicker', version: '1.6.1'  
  
    // https://mvnrepository.com/artifact/org.webrtc/google-webrtc  
    // 라이브러리가 다운로드 되지 않아 밑의 라이브러리로 대체함  
//    implementation 'org.webrtc:google-webrtc:1.0.+'  
  
    // https://github.com/webrtc-sdk/android  
//    implementation 'io.github.webrtc-sdk:android:125.6422.04'  
  
  
}  
</document_content>  
</document>  
</documents>